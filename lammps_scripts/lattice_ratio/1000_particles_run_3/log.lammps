LAMMPS (23 Jun 2022 - Update 1)
  using 1 OpenMP thread(s) per MPI task
variable num index 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99

label startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 0

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5                                                               
Lattice spacing in x,y,z = 5 5 5

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3750 ${n1e1} -100 100 -100 100 units box
region box block -3750 3750 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3750 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3750 3750 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3750 -100 -100) to (3750 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3750 -100 -100) to (3750 100 100)
  create_atoms CPU = 0.004 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3750 -100 -100) to (3750 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_0_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 4839 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 97.33 | 97.34 | 97.34 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7500           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7500           200            200            0.0027215089   4.4365029e-41  0              0.0081645266   587952.32      0              5.6780226e+10  1.1965779e-13  0              3.3278784    
    200000   7500           200            200            0.00098141897 -2.1540983e-35  0              0.0029442569   147251.73      0              1.4220518e+10  1.1965779e-13  0              3.0746671    
    300000   7500           200            200            0.00012239225 -2.1540857e-35  0              0.00036717674  4439.1914      0              4.2870533e+08  1.1965779e-13  0              3.0475209    
    400000   7500           200            200           -0.00012531407  4.308267e-35   0             -0.00037594221  7192.1672      0              6.9456803e+08  1.1965779e-13  0              3.0031456    
    500000   7500           200            200            0.00019056885 -4.0928179e-34  0              0.00057170655  1337.2387      0              1.2914095e+08  1.1965779e-13  0              2.9996754    
    600000   7500           200            200            0.0056501026   2.1541307e-35  0              0.016950308    44.039704      0              4253039.4      1.1965779e-13  0              2.9973975    
    700000   7500           200            200            0.0028248348   4.3082462e-35  0              0.0084745043   25.886816      0              2499963.4      1.1965779e-13  0              2.9983621    
    800000   7500           200            200            0.0030359911  -7.5393954e-35  0              0.0091079733   0.51604228     0              49835.67       1.1965779e-13  0              2.9982775    
    900000   7500           200            200            0.0033247433  -1.0770491e-35  0              0.00997423     0.73524851     0              71005.038      1.1965779e-13  0              2.9981698    
   1000000   7500           200            200            0.0033723201  -1.6155826e-35  0              0.01011696     0.020866377    0              2015.1254      1.1965779e-13  0              2.9981528    
   1100000   7500           200            200            0.00334666     1.0770605e-35  0              0.01003998     0.0054677606   0              528.03718      1.1965779e-13  0              2.9981624    
   1200000   7500           200            200            0.0033330145   2.6926482e-35  0              0.0099990435   0.0016440089   0              158.76661      1.1965779e-13  0              2.9981673    
   1300000   7500           200            200            0.0033325498   3.7699836e-41  0              0.0099976495   2.8493572e-06  0              0.27517053     1.1965779e-13  0              2.9981675    
   1400000   7500           200            200            0.0033342489   4.821642e-41   0              0.010002747    2.4632202e-05  0              2.3788018      1.1965779e-13  0              2.9981669    
   1500000   7500           200            200            0.0033347983  -2.1541109e-35  0              0.010004395    2.7182605e-06  0              0.26251014     1.1965779e-13  0              2.9981667    
   1600000   7500           200            200            0.0033347274  -1.0770528e-35  0              0.010004182    3.77651e-08    0              0.0036470831   1.1965779e-13  0              2.9981667    
   1700000   7500           200            200            0.0033346333   5.3853435e-36  0              0.0100039      7.6808314e-08  0              0.0074175972   1.1965779e-13  0              2.9981667    
   1800000   7500           200            200            0.0033346159   1.0770634e-35  0              0.010003848    2.8406674e-09  0              0.00027433132  1.1965779e-13  0              2.9981667    
   1900000   7500           200            200            0.0033346235   1.6155924e-35  0              0.010003871    4.8214621e-10  0              4.656223e-05   1.1965779e-13  0              2.9981667    
   2000000   7500           200            200            0.0033346281  -1.0770528e-35  0              0.010003884    1.8091823e-10  0              1.7471787e-05  1.1965779e-13  0              2.9981667    
   2100000   7500           200            200            0.0033346283  -1.6155818e-35  0              0.010003885    8.1708496e-13  0              7.8908217e-08  1.1965779e-13  0              2.9981667    
   2200000   7500           200            200            0.0033346278   2.1541215e-35  0              0.010003883    2.3956521e-12  0              2.3135494e-07  1.1965779e-13  0              2.9981667    
   2300000   7500           200            200            0.0033346276   4.8467667e-35  0              0.010003883    3.185485e-13   0              3.0763134e-08  1.1965779e-13  0              2.9981667    
   2400000   7500           200            200            0.0033346276   1.6155924e-35  0              0.010003883    2.0731697e-15  0              2.0021189e-10  1.1965779e-13  0              2.9981667    
   2500000   7500           200            200            0.0033346277   5.3853436e-36  0              0.010003883    7.9668617e-15  0              7.6938248e-10  1.1965779e-13  0              2.9981667    
   2600000   7500           200            200            0.0033346277   1.0770634e-35  0              0.010003883    3.489679e-16   0              3.3700822e-11  1.1965779e-13  0              2.9981667    
   2700000   7500           200            200            0.0033346277  -1.0770528e-35  0              0.010003883    9.1452477e-17  0              8.8318257e-12  1.1965779e-13  0              2.9981667    
   2800000   7500           200            200            0.0033346277  -5.9238142e-35  0              0.010003883    3.0111104e-18  0              2.9079149e-13  1.1965779e-13  0              2.9981667    
   2900000   7500           200            200            0.0033346277  -2.6925922e-36  0              0.010003883    3.894169e-18   0              3.7607097e-13  1.1965779e-13  0              2.9981667    
   3000000   7500           200            200            0.0033346277   5.294427e-41   0              0.010003883    3.1598008e-18  0              3.0515095e-13  1.1965779e-13  0              2.9981667    
Loop time of 317.686 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8158988.757 ns/day, 0.000 hours/ns, 9443.274 timesteps/s
99.9% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.898     | 44.927     | 77.97      | 492.7 | 14.14
Neigh   | 4.7681     | 4.8576     | 4.9543     |   3.8 |  1.53
Comm    | 19.962     | 42.593     | 91.952     | 440.7 | 13.41
Output  | 0.27018    | 0.27053    | 0.27093    |   0.1 |  0.09
Modify  | 113.7      | 166.76     | 186.91     | 237.7 | 52.49
Other   |            | 58.28      |            |       | 18.35

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         300.25 ave         601 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1201
Ave neighs/atom = 0.48020792
Neighbor list builds = 168
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 1

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.01                                                               
Lattice spacing in x,y,z = 5.01 5.01 5.01

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3757.5 ${n1e1} -100 100 -100 100 units box
region box block -3757.5 3757.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3757.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3757.5 3757.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3757.5 -100 -100) to (3757.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3757.5 -100 -100) to (3757.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3757.5 -100 -100) to (3757.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_1_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 4849 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 97.54 | 97.55 | 97.55 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7515           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7515           200            200            0.00269445     1.5703668e-40  0              0.00808335     581450.71      0              5.6152348e+10  1.1965779e-13  0              3.3293532    
    200000   7515           200            200            0.00093142593  8.5993919e-35  0              0.0027942778   136317.23      0              1.3164542e+10  1.1965779e-13  0              3.0792059    
    300000   7515           200            200            2.6269256e-05  8.9597393e-40  0              7.8807767e-05  234.68933      0              22664616       1.1965779e-13  0              3.0450564    
    400000   7515           200            200            7.6759267e-05 -2.1497742e-35  0              0.0002302778   1906.3284      0              1.8409955e+08  1.1965779e-13  0              3.004508     
    500000   7515           200            200           -0.00089056261 -0.021903159    0              0.019231471    586.37892      0              56628279       1.1965779e-13  0              2.9926318    
    600000   7515           200            200           -0.00067990901 -0.0085148335   0              0.0064751064   17.718742      0              1711149.3      1.1965779e-13  0              2.9957217    
    700000   7515           200            200            6.6841268e-05 -0.011174328    0              0.011374852    1.9806526      0              191277.25      1.1965779e-13  0              2.9943452    
    800000   7515           200            200           -0.00037651534 -0.01067588     0              0.0095463338   1.1495642      0              111016.68      1.1965779e-13  0              2.9948186    
    900000   7515           200            200           -0.00024229978 -0.010778191    0              0.010051291    0.40530154     0              39141.121      1.1965779e-13  0              2.9946839    
   1000000   7515           200            200           -0.00026170671 -0.010765252    0              0.0099801318   0.064609994    0              6239.5708      1.1965779e-13  0              2.9947018    
   1100000   7515           200            200           -0.000267846   -0.010760338    0              0.0099567996   0.0054735699   0              528.5982       1.1965779e-13  0              2.9947086    
   1200000   7515           200            200           -0.00026135906 -0.010765208    0              0.0099811304   0.00014999449  0              14.485394      1.1965779e-13  0              2.9947019    
   1300000   7515           200            200           -0.00026460845 -0.010762815    0              0.0099689892   5.2024649e-06  0              0.50241682     1.1965779e-13  0              2.9947052    
   1400000   7515           200            200           -0.00026344112 -0.010763664    0              0.009973341    9.5224571e-06  0              0.91961075     1.1965779e-13  0              2.994704     
   1500000   7515           200            200           -0.000263737   -0.010763453    0              0.0099722422   2.665074e-06   0              0.25737377     1.1965779e-13  0              2.9947043    
   1600000   7515           200            200           -0.00026370844 -0.010763471    0              0.0099723461   3.72367e-07    0              0.035960539    1.1965779e-13  0              2.9947043    
   1700000   7515           200            200           -0.00026368649 -0.010763488    0              0.009972429    2.6726273e-08  0              0.0025810321   1.1965779e-13  0              2.9947043    
   1800000   7515           200            200           -0.00026370414 -0.010763475    0              0.0099723628   4.1957347e-10  0              4.0519403e-05  1.1965779e-13  0              2.9947043    
   1900000   7515           200            200           -0.00026369601 -0.010763481    0              0.0099723932   8.4107234e-11  0              8.1224747e-06  1.1965779e-13  0              2.9947043    
   2000000   7515           200            200           -0.00026369874 -0.010763479    0              0.009972383    7.2729168e-11  0              7.0236625e-06  1.1965779e-13  0              2.9947043    
   2100000   7515           200            200           -0.00026369812 -0.01076348     0              0.0099723853   1.7021259e-11  0              1.6437913e-06  1.1965779e-13  0              2.9947043    
   2200000   7515           200            200           -0.00026369814 -0.01076348     0              0.0099723853   2.0832855e-12  0              2.011888e-07   1.1965779e-13  0              2.9947043    
   2300000   7515           200            200           -0.00026369821 -0.01076348     0              0.009972385    1.2297196e-13  0              1.1875752e-08  1.1965779e-13  0              2.9947043    
   2400000   7515           200            200           -0.00026369817 -0.01076348     0              0.0099723852   6.793494e-16   0              6.5606703e-11  1.1965779e-13  0              2.9947043    
   2500000   7515           200            200           -0.00026369819 -0.01076348     0              0.0099723851   9.1804639e-16  0              8.8658349e-11  1.1965779e-13  0              2.9947043    
   2600000   7515           200            200           -0.00026369818 -0.01076348     0              0.0099723851   5.2308432e-16  0              5.051574e-11   1.1965779e-13  0              2.9947043    
   2700000   7515           200            200           -0.00026369818 -0.01076348     0              0.0099723851   9.9737293e-17  0              9.6319139e-12  1.1965779e-13  0              2.9947043    
   2800000   7515           200            200           -0.00026369818 -0.01076348     0              0.0099723851   1.3672891e-17  0              1.3204299e-12  1.1965779e-13  0              2.9947043    
   2900000   7515           200            200           -0.00026369818 -0.01076348     0              0.0099723851   1.9987102e-18  0              1.9302113e-13  1.1965779e-13  0              2.9947043    
   3000000   7515           200            200           -0.00026369817 -0.01076348     0              0.0099723851   6.8005735e-19  0              6.5675071e-14  1.1965779e-13  0              2.9947043    
Loop time of 308.064 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8413830.371 ns/day, 0.000 hours/ns, 9738.230 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.649     | 40.362     | 72.335     | 452.3 | 13.10
Neigh   | 4.6284     | 4.7156     | 4.8044     |   3.6 |  1.53
Comm    | 19.92      | 43.965     | 89.001     | 401.6 | 14.27
Output  | 0.273      | 0.27333    | 0.27371    |   0.1 |  0.09
Modify  | 108.85     | 161.16     | 179.92     | 238.0 | 52.31
Other   |            | 57.59      |            |       | 18.70

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         329.25 ave         659 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1317
Ave neighs/atom = 0.52658936
Neighbor list builds = 164
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 2

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.02                                                               
Lattice spacing in x,y,z = 5.02 5.02 5.02

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3765 ${n1e1} -100 100 -100 100 units box
region box block -3765 3765 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3765 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3765 3765 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3765 -100 -100) to (3765 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3765 -100 -100) to (3765 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3765 -100 -100) to (3765 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_2_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 4859 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 97.68 | 97.68 | 97.69 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7530           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7530           200            200            0.0026890832   1.9988683e-41  0              0.0080672496   581450.96      0              5.6152372e+10  1.1965779e-13  0              3.3293526    
    200000   7530           200            200            0.00092957571  3.091394e-40   0              0.0027887271   136318.46      0              1.3164661e+10  1.1965779e-13  0              3.0792042    
    300000   7530           200            200            2.6226328e-05  6.665035e-41   0              7.8678985e-05  234.85404      0              22680522       1.1965779e-13  0              3.0450561    
    400000   7530           200            200            7.661384e-05  -2.681914e-35   0              0.00022984152  1906.6814      0              1.8413365e+08  1.1965779e-13  0              3.0045075    
    500000   7530           200            200            0.0023200375  -0.012243884    0              0.019203997    589.27023      0              56907501       1.1965779e-13  0              2.9926343    
    600000   7530           200            200            0.00054611536 -0.0048447975   0              0.0064831435   20.498525      0              1979600.8      1.1965779e-13  0              2.9957129    
    700000   7530           200            200            0.0017756777  -0.0060824182   0              0.011409451    0.0087479242   0              844.8119       1.1965779e-13  0              2.9943326    
    800000   7530           200            200            0.0012375459  -0.0057315111   0              0.0094441488   0.081553425    0              7875.8461      1.1965779e-13  0              2.9948433    
    900000   7530           200            200            0.001444607   -0.0058054629   0              0.010139284    0.019389812    0              1872.5292      1.1965779e-13  0              2.9946557    
   1000000   7530           200            200            0.0013684136  -0.0057797492   0              0.0098849901   0.0040551909   0              391.62131      1.1965779e-13  0              2.9947238    
   1100000   7530           200            200            0.0013959163  -0.0057892344   0              0.0099769833   0.00078765023  0              76.065621      1.1965779e-13  0              2.9946991    
   1200000   7530           200            200            0.001385961   -0.0057858228   0              0.009943706    0.00014364284  0              13.871998      1.1965779e-13  0              2.994708     
   1300000   7530           200            200            0.0013895465  -0.0057870563   0              0.0099556959   2.508688e-05   0              2.4227113      1.1965779e-13  0              2.9947048    
   1400000   7530           200            200            0.0013882582  -0.005786613    0              0.0099513875   4.2320373e-06  0              0.40869987     1.1965779e-13  0              2.9947059    
   1500000   7530           200            200            0.0013887195  -0.005786772    0              0.0099529305   6.9477367e-07  0              0.067096268    1.1965779e-13  0              2.9947055    
   1600000   7530           200            200            0.0013885549  -0.0057867152   0              0.0099523797   1.1152453e-07  0              0.010770241    1.1965779e-13  0              2.9947057    
   1700000   7530           200            200            0.0013886134  -0.0057867354   0              0.0099525756   1.7567967e-08  0              0.0016965885   1.1965779e-13  0              2.9947056    
   1800000   7530           200            200            0.0013885927  -0.0057867282   0              0.0099525062   2.7231667e-09  0              0.00026298395  1.1965779e-13  0              2.9947056    
   1900000   7530           200            200            0.0013886     -0.0057867308   0              0.0099525307   4.1622654e-10  0              4.019618e-05   1.1965779e-13  0              2.9947056    
   2000000   7530           200            200            0.0013885974  -0.0057867299   0              0.0099525221   6.2840559e-11  0              6.0686914e-06  1.1965779e-13  0              2.9947056    
   2100000   7530           200            200            0.0013885983  -0.0057867302   0              0.0099525251   9.383301e-12   0              9.0617205e-07  1.1965779e-13  0              2.9947056    
   2200000   7530           200            200            0.001388598   -0.0057867301   0              0.0099525241   1.3869965e-12  0              1.3394619e-07  1.1965779e-13  0              2.9947056    
   2300000   7530           200            200            0.0013885981  -0.0057867301   0              0.0099525244   2.0320497e-13  0              1.9624082e-08  1.1965779e-13  0              2.9947056    
   2400000   7530           200            200            0.0013885981  -0.0057867301   0              0.0099525243   2.95012e-14    0              2.8490147e-09  1.1965779e-13  0              2.9947056    
   2500000   7530           200            200            0.0013885981  -0.0057867301   0              0.0099525244   4.2009565e-15  0              4.0569831e-10  1.1965779e-13  0              2.9947056    
   2600000   7530           200            200            0.0013885981  -0.0057867301   0              0.0099525243   5.935198e-16   0              5.7317894e-11  1.1965779e-13  0              2.9947056    
   2700000   7530           200            200            0.0013885981  -0.0057867301   0              0.0099525244   8.644659e-17   0              8.3483929e-12  1.1965779e-13  0              2.9947056    
   2800000   7530           200            200            0.0013885981  -0.0057867301   0              0.0099525244   1.3801887e-17  0              1.3328875e-12  1.1965779e-13  0              2.9947056    
   2900000   7530           200            200            0.0013885981  -0.0057867301   0              0.0099525244   5.3116431e-18  0              5.1296047e-13  1.1965779e-13  0              2.9947056    
   3000000   7530           200            200            0.0013885981  -0.0057867301   0              0.0099525244   4.092829e-19   0              3.9525613e-14  1.1965779e-13  0              2.9947056    
Loop time of 304.507 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8512114.519 ns/day, 0.000 hours/ns, 9851.984 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.545     | 39.274     | 68.728     | 442.1 | 12.90
Neigh   | 4.6655     | 4.7499     | 4.8375     |   3.5 |  1.56
Comm    | 18.985     | 25.428     | 30.8       |  99.3 |  8.35
Output  | 0.27487    | 0.2752     | 0.27558    |   0.1 |  0.09
Modify  | 173.61     | 177.31     | 181.54     |  23.9 | 58.23
Other   |            | 57.47      |            |       | 18.87

Nlocal:         625.25 ave         877 max         374 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         328.75 ave         658 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1315
Ave neighs/atom = 0.52578968
Neighbor list builds = 164
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 3

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.03                                                               
Lattice spacing in x,y,z = 5.03 5.03 5.03

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3772.5 ${n1e1} -100 100 -100 100 units box
region box block -3772.5 3772.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3772.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3772.5 3772.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3772.5 -100 -100) to (3772.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3772.5 -100 -100) to (3772.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3772.5 -100 -100) to (3772.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_3_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 4868 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 97.82 | 97.82 | 97.83 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7545           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7545           200            200            0.0026837368   5.3531889e-36  0              0.0080512103   581450.84      0              5.615236e+10   1.1965779e-13  0              3.3293528    
    200000   7545           200            200            0.00092772707  1.3382947e-36  0              0.0027831812   136318.33      0              1.3164648e+10  1.1965779e-13  0              3.0792044    
    300000   7545           200            200            2.6174482e-05  1.0706383e-35  0              7.8523446e-05  234.85919      0              22681020       1.1965779e-13  0              3.0450561    
    400000   7545           200            200            7.646661e-05  -3.2118902e-35  0              0.00022939983  1906.9218      0              1.8415686e+08  1.1965779e-13  0              3.0045073    
    500000   7545           200            200            0.0042866889  -0.0062964974   0              0.019156564    589.76226      0              56955018       1.1965779e-13  0              2.992635     
    600000   7545           200            200            0.0011552777  -0.0030110876   0              0.0064769208   20.840722      0              2012647.7      1.1965779e-13  0              2.995712     
    700000   7545           200            200            0.002892229   -0.002709868    0              0.011386555    0.060649814    0              5857.1249      1.1965779e-13  0              2.9943333    
    800000   7545           200            200            0.0022550984  -0.0027298364   0              0.0094951315   1.0001094      0              96583.41       1.1965779e-13  0              2.9948246    
    900000   7545           200            200            0.0024302084  -0.0027382951   0              0.01002892     0.36160681     0              34921.397      1.1965779e-13  0              2.9946796    
   1000000   7545           200            200            0.0023973042  -0.0027373823   0              0.009929295    0.065733589    0              6348.0796      1.1965779e-13  0              2.9947071    
   1100000   7545           200            200            0.0023948574  -0.0027373354   0              0.0099219077   0.0073844339   0              713.13577      1.1965779e-13  0              2.9947087    
   1200000   7545           200            200            0.0024009193  -0.0027374828   0              0.0099402407   0.0004565153   0              44.08698       1.1965779e-13  0              2.9947039    
   1300000   7545           200            200            0.0023973077  -0.0027373929   0              0.0099293161   5.3562385e-06  0              0.51726717     1.1965779e-13  0              2.9947068    
   1400000   7545           200            200            0.0023988413  -0.0027374313   0              0.0099339552   1.8899913e-06  0              0.18252184     1.1965779e-13  0              2.9947056    
   1500000   7545           200            200            0.0023983301  -0.0027374184   0              0.0099324088   1.4567747e-06  0              0.14068488     1.1965779e-13  0              2.994706     
   1600000   7545           200            200            0.002398456   -0.0027374216   0              0.0099327897   3.6026356e-07  0              0.034791676    1.1965779e-13  0              2.9947059    
   1700000   7545           200            200            0.002398443   -0.0027374212   0              0.0099327503   5.1940833e-08  0              0.0050160739   1.1965779e-13  0              2.9947059    
   1800000   7545           200            200            0.0023984345  -0.002737421    0              0.0099327246   4.5421692e-09  0              0.00043865019  1.1965779e-13  0              2.9947059    
   1900000   7545           200            200            0.0023984418  -0.0027374212   0              0.0099327466   1.724412e-10   0              1.6653136e-05  1.1965779e-13  0              2.9947059    
   2000000   7545           200            200            0.0023984382  -0.0027374211   0              0.0099327357   2.9367779e-13  0              2.8361298e-08  1.1965779e-13  0              2.9947059    
   2100000   7545           200            200            0.0023984396  -0.0027374212   0              0.0099327399   4.5096821e-12  0              4.3551281e-07  1.1965779e-13  0              2.9947059    
   2200000   7545           200            200            0.0023984392  -0.0027374212   0              0.0099327387   1.7137217e-12  0              1.6549897e-07  1.1965779e-13  0              2.9947059    
   2300000   7545           200            200            0.0023984392  -0.0027374212   0              0.0099327389   3.2007165e-13  0              3.0910229e-08  1.1965779e-13  0              2.9947059    
   2400000   7545           200            200            0.0023984392  -0.0027374212   0              0.0099327389   3.6596667e-14  0              3.5342441e-09  1.1965779e-13  0              2.9947059    
   2500000   7545           200            200            0.0023984392  -0.0027374212   0              0.0099327389   2.2584278e-15  0              2.181028e-10   1.1965779e-13  0              2.9947059    
   2600000   7545           200            200            0.0023984392  -0.0027374212   0              0.0099327389   3.9687007e-17  0              3.832687e-12   1.1965779e-13  0              2.9947059    
   2700000   7545           200            200            0.0023984392  -0.0027374212   0              0.0099327389   9.4890133e-18  0              9.1638098e-13  1.1965779e-13  0              2.9947059    
   2800000   7545           200            200            0.0023984392  -0.0027374212   0              0.0099327389   9.9184805e-18  0              9.5785585e-13  1.1965779e-13  0              2.9947059    
   2900000   7545           200            200            0.0023984392  -0.0027374212   0              0.0099327389   7.7071598e-18  0              7.4430233e-13  1.1965779e-13  0              2.9947059    
   3000000   7545           200            200            0.0023984392  -0.0027374212   0              0.0099327389   1.5171219e-18  0              1.4651277e-13  1.1965779e-13  0              2.9947059    
Loop time of 301.694 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8591481.231 ns/day, 0.000 hours/ns, 9943.844 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.244     | 38.391     | 65.716     | 437.6 | 12.73
Neigh   | 4.7023     | 4.785      | 4.8702     |   3.4 |  1.59
Comm    | 19.605     | 40.983     | 82.055     | 377.9 | 13.58
Output  | 0.27183    | 0.27216    | 0.27253    |   0.1 |  0.09
Modify  | 111.14     | 160.34     | 178.7      | 224.9 | 53.15
Other   |            | 56.92      |            |       | 18.87

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         328.25 ave         657 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1313
Ave neighs/atom = 0.52499
Neighbor list builds = 164
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 4

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.04                                                               
Lattice spacing in x,y,z = 5.04 5.04 5.04

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3780 ${n1e1} -100 100 -100 100 units box
region box block -3780 3780 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3780 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3780 3780 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3780 -100 -100) to (3780 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3780 -100 -100) to (3780 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3780 -100 -100) to (3780 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_4_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 4878 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 97.97 | 98 | 98.03 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7560           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7560           200            200            0.0026784673  -2.1370102e-35  0              0.008035402    581472.07      0              5.6154411e+10  1.1965779e-13  0              3.3293126    
    200000   7560           200            200            0.0009260955  -2.1370011e-35  0              0.0027782865   136367.79      0              1.3169425e+10  1.1965779e-13  0              3.0791386    
    300000   7560           200            200            2.6732474e-05  4.4051875e-40  0              8.0197421e-05  245.70532      0              23728461       1.1965779e-13  0              3.0450468    
    400000   7560           200            200            7.3698628e-05  4.2675187e-40  0              0.00022109588  1784.7839      0              1.7236166e+08  1.1965779e-13  0              3.0046243    
    500000   7560           200            200            0.0043348637  -0.0056663779   0              0.018670969    689.61002      0              66597599       1.1965779e-13  0              2.9928058    
    600000   7560           200            200            0.0032782113  -0.0029953107   0              0.012829944    105.45928      0              10184503       1.1965779e-13  0              2.9941001    
    700000   7560           200            200            0.0027475007  -0.0027851663   0              0.011027668    12.257788      0              1183769.5      1.1965779e-13  0              2.9945188    
    800000   7560           200            200            0.0025451361  -0.0027522467   0              0.010387655    0.89208056     0              86150.755      1.1965779e-13  0              2.994673     
    900000   7560           200            200            0.0024560991  -0.0027360777   0              0.010104375    0.037939179    0              3663.8943      1.1965779e-13  0              2.9947428    
   1000000   7560           200            200            0.002418993   -0.0027289873   0              0.0099859663   0.00013390938  0              12.93201       1.1965779e-13  0              2.9947724    
   1100000   7560           200            200            0.0024044425  -0.0027261408   0              0.0099394683   0.00032340584  0              31.232222      1.1965779e-13  0              2.9947841    
   1200000   7560           200            200            0.0023990437  -0.0027250721   0              0.0099222033   0.00020748278  0              20.037202      1.1965779e-13  0              2.9947884    
   1300000   7560           200            200            0.0023971476  -0.002724694    0              0.0099161369   6.185149e-05   0              5.9731742      1.1965779e-13  0              2.99479      
   1400000   7560           200            200            0.0023965209  -0.0027245683   0              0.009914131    1.3510973e-05  0              1.3047931      1.1965779e-13  0              2.9947905    
   1500000   7560           200            200            0.0023963289  -0.0027245294   0              0.0099135161   2.4500326e-06  0              0.23660662     1.1965779e-13  0              2.9947907    
   1600000   7560           200            200            0.0023962762  -0.0027245187   0              0.0099133473   3.8748956e-07  0              0.037420968    1.1965779e-13  0              2.9947907    
   1700000   7560           200            200            0.0023962645  -0.0027245162   0              0.0099133096   5.4571057e-08  0              0.0052700821   1.1965779e-13  0              2.9947907    
   1800000   7560           200            200            0.0023962632  -0.0027245159   0              0.0099133055   6.8783944e-09  0              0.00066426609  1.1965779e-13  0              2.9947907    
   1900000   7560           200            200            0.0023962639  -0.002724516    0              0.0099133076   7.6979003e-10  0              7.4340811e-05  1.1965779e-13  0              2.9947907    
   2000000   7560           200            200            0.0023962645  -0.0027245161   0              0.0099133097   7.4576848e-11  0              7.2020982e-06  1.1965779e-13  0              2.9947907    
   2100000   7560           200            200            0.0023962649  -0.0027245162   0              0.0099133109   5.8945932e-12  0              5.6925762e-07  1.1965779e-13  0              2.9947907    
   2200000   7560           200            200            0.0023962651  -0.0027245162   0              0.0099133114   3.2470268e-13  0              3.1357461e-08  1.1965779e-13  0              2.9947907    
   2300000   7560           200            200            0.0023962651  -0.0027245162   0              0.0099133117   6.283985e-15   0              6.068623e-10   1.1965779e-13  0              2.9947907    
   2400000   7560           200            200            0.0023962652  -0.0027245163   0              0.0099133118   4.1341381e-16  0              3.9924547e-11  1.1965779e-13  0              2.9947907    
   2500000   7560           200            200            0.0023962652  -0.0027245163   0              0.0099133118   6.1311627e-16  0              5.9210381e-11  1.1965779e-13  0              2.9947907    
   2600000   7560           200            200            0.0023962652  -0.0027245163   0              0.0099133118   2.1603092e-16  0              2.086272e-11   1.1965779e-13  0              2.9947907    
   2700000   7560           200            200            0.0023962652  -0.0027245163   0              0.0099133118   5.540419e-17   0              5.3505401e-12  1.1965779e-13  0              2.9947907    
   2800000   7560           200            200            0.0023962652  -0.0027245163   0              0.0099133118   1.3363036e-17  0              1.2905064e-12  1.1965779e-13  0              2.9947907    
   2900000   7560           200            200            0.0023962652  -0.0027245163   0              0.0099133118   3.0664731e-18  0              2.9613802e-13  1.1965779e-13  0              2.9947907    
   3000000   7560           200            200            0.0023962652  -0.0027245163   0              0.0099133118   4.4187566e-19  0              4.2673188e-14  1.1965779e-13  0              2.9947907    
Loop time of 302.933 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8556336.757 ns/day, 0.000 hours/ns, 9903.168 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.267     | 38.461     | 65.565     | 435.0 | 12.70
Neigh   | 4.7193     | 4.8023     | 4.8872     |   3.4 |  1.59
Comm    | 19.684     | 41.274     | 82.461     | 377.8 | 13.62
Output  | 0.2724     | 0.27271    | 0.27306    |   0.1 |  0.09
Modify  | 111.67     | 161.03     | 180.18     | 225.1 | 53.16
Other   |            | 57.09      |            |       | 18.85

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         327.75 ave         656 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1311
Ave neighs/atom = 0.52419032
Neighbor list builds = 164
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 5

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.05                                                               
Lattice spacing in x,y,z = 5.05 5.05 5.05

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3787.5 ${n1e1} -100 100 -100 100 units box
region box block -3787.5 3787.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3787.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3787.5 3787.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3787.5 -100 -100) to (3787.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3787.5 -100 -100) to (3787.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3787.5 -100 -100) to (3787.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_5_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 4888 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 98.17 | 98.17 | 98.18 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7575           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7575           200            200            0.0026731048  -2.1327709e-35  0              0.0080193145   581449.8       0              5.615226e+10   1.1965779e-13  0              3.3293534    
    200000   7575           200            200            0.00092406028 -4.2655118e-35  0              0.0027721808   136320.11      0              1.316482e+10   1.1965779e-13  0              3.0792013    
    300000   7575           200            200            2.6132851e-05  5.1867792e-40  0              7.8398552e-05  235.95379      0              22786728       1.1965779e-13  0              3.0450544    
    400000   7575           200            200            7.6215828e-05 -4.2655625e-35  0              0.00022864748  1909.3945      0              1.8439566e+08  1.1965779e-13  0              3.0045043    
    500000   7575           200            200            0.0041538086  -0.0064341655   0              0.018895591    614.68246      0              59361633       1.1965779e-13  0              2.9926597    
    600000   7575           200            200            0.0019480037  -0.00052727653  0              0.0063712875   16.989543      0              1640728.4      1.1965779e-13  0              2.995728     
    700000   7575           200            200            0.0030020077  -0.0021396512   0              0.011145674    6.6039591      0              637763.1       1.1965779e-13  0              2.9943918    
    800000   7575           200            200            0.0026642612  -0.0018873619   0              0.0098801454   3.6385268      0              351382.88      1.1965779e-13  0              2.9947235    
    900000   7575           200            200            0.0026176469  -0.0018748458   0              0.0097277866   0.12688467     0              12253.613      1.1965779e-13  0              2.9947609    
   1000000   7575           200            200            0.0026864219  -0.0018945431   0              0.0099538089   0.017119299    0              1653.2594      1.1965779e-13  0              2.9947014    
   1100000   7575           200            200            0.0026683477  -0.0018893892   0              0.0098944322   0.0089275205   0              862.15603      1.1965779e-13  0              2.9947174    
   1200000   7575           200            200            0.0026654428  -0.00188862     0              0.0098849485   0.00025030979  0              24.173128      1.1965779e-13  0              2.9947197    
   1300000   7575           200            200            0.0026689054  -0.001889595    0              0.0098963112   5.0985704e-05  0              4.9238343      1.1965779e-13  0              2.9947167    
   1400000   7575           200            200            0.0026680714  -0.0018893539   0              0.0098935682   2.1733139e-05  0              2.098831       1.1965779e-13  0              2.9947175    
   1500000   7575           200            200            0.0026678997  -0.0018893079   0              0.0098930069   4.727764e-07   0              0.045657361    1.1965779e-13  0              2.9947176    
   1600000   7575           200            200            0.0026680729  -0.0018893567   0              0.0098935756   1.4843044e-07  0              0.01433435     1.1965779e-13  0              2.9947175    
   1700000   7575           200            200            0.0026680348  -0.0018893457   0              0.0098934499   5.2501528e-08  0              0.0050702217   1.1965779e-13  0              2.9947175    
   1800000   7575           200            200            0.0026680249  -0.001889343    0              0.0098934177   8.5068494e-10  0              8.2153062e-05  1.1965779e-13  0              2.9947175    
   1900000   7575           200            200            0.0026680335  -0.0018893454   0              0.0098934461   4.2329024e-10  0              4.0878342e-05  1.1965779e-13  0              2.9947175    
   2000000   7575           200            200            0.0026680318  -0.0018893449   0              0.0098934404   1.2584299e-10  0              1.2153015e-05  1.1965779e-13  0              2.9947175    
   2100000   7575           200            200            0.0026680313  -0.0018893448   0              0.0098934386   1.4327496e-12  0              1.383647e-07   1.1965779e-13  0              2.9947175    
   2200000   7575           200            200            0.0026680317  -0.0018893449   0              0.00989344     1.1860959e-12  0              1.1454465e-07  1.1965779e-13  0              2.9947175    
   2300000   7575           200            200            0.0026680316  -0.0018893449   0              0.0098934397   2.9900299e-13  0              2.8875568e-08  1.1965779e-13  0              2.9947175    
   2400000   7575           200            200            0.0026680316  -0.0018893449   0              0.0098934396   2.2280585e-15  0              2.1516994e-10  1.1965779e-13  0              2.9947175    
   2500000   7575           200            200            0.0026680316  -0.0018893449   0              0.0098934397   3.2784088e-15  0              3.1660526e-10  1.1965779e-13  0              2.9947175    
   2600000   7575           200            200            0.0026680316  -0.0018893449   0              0.0098934397   7.072348e-16   0              6.8299675e-11  1.1965779e-13  0              2.9947175    
   2700000   7575           200            200            0.0026680316  -0.0018893449   0              0.0098934397   8.3023118e-19  0              8.0177784e-14  1.1965779e-13  0              2.9947175    
   2800000   7575           200            200            0.0026680316  -0.0018893449   0              0.0098934397   1.1698258e-17  0              1.129734e-12   1.1965779e-13  0              2.9947175    
   2900000   7575           200            200            0.0026680316  -0.0018893449   0              0.0098934397   2.3057965e-18  0              2.2267732e-13  1.1965779e-13  0              2.9947175    
   3000000   7575           200            200            0.0026680316  -0.0018893449   0              0.0098934397   6.802298e-18   0              6.5691725e-13  1.1965779e-13  0              2.9947175    
Loop time of 301.61 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8593869.638 ns/day, 0.000 hours/ns, 9946.608 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.262     | 38.481     | 66.036     | 437.6 | 12.76
Neigh   | 4.6871     | 4.7776     | 4.8704     |   3.7 |  1.58
Comm    | 19.636     | 41.02      | 81.863     | 375.9 | 13.60
Output  | 0.27544    | 0.27576    | 0.27611    |   0.1 |  0.09
Modify  | 111.04     | 160.2      | 178.51     | 224.7 | 53.11
Other   |            | 56.86      |            |       | 18.85

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         327.25 ave         655 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1309
Ave neighs/atom = 0.52339064
Neighbor list builds = 164
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 6

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.06                                                               
Lattice spacing in x,y,z = 5.06 5.06 5.06

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3795 ${n1e1} -100 100 -100 100 units box
region box block -3795 3795 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3795 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3795 3795 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3795 -100 -100) to (3795 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3795 -100 -100) to (3795 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3795 -100 -100) to (3795 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_6_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 4897 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 98.37 | 98.38 | 98.39 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7590           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7590           200            200            0.0026672583   2.6607231e-36  0              0.0080017748   581267.39      0              5.6134644e+10  1.1965779e-13  0              3.3294851    
    200000   7590           200            200            0.00092071751  1.3303586e-34  0              0.0027621525   135968.45      0              1.313086e+10   1.1965779e-13  0              3.0794966    
    300000   7590           200            200            2.316955e-05  -2.1285669e-35  0              6.9508651e-05  187.14538      0              18073161       1.1965779e-13  0              3.0450268    
    400000   7590           200            200            6.8110234e-05 -4.2571209e-35  0              0.0002043307   1547.8344      0              1.4947876e+08  1.1965779e-13  0              3.004838     
    500000   7590           200            200            0.0063014925  -0.002305693    0              0.021210171    154.52594      0              14923010       1.1965779e-13  0              2.9922161    
    600000   7590           200            200            0.0024898308   0.0001375658   0              0.0073319266   108.21827      0              10450946       1.1965779e-13  0              2.9954179    
    700000   7590           200            200            0.0036265096  -0.00011115804  0              0.010990687    10.830662      0              1045947.8      1.1965779e-13  0              2.9944178    
    800000   7590           200            200            0.0030948447  -0.0001470116   0              0.0094315457   0.94212813     0              90983.991      1.1965779e-13  0              2.9948245    
    900000   7590           200            200            0.0032904752  -0.00017017383  0              0.010041599    0.1090569      0              10531.935      1.1965779e-13  0              2.994661     
   1000000   7590           200            200            0.0032163552  -0.00016175965  0              0.0098108253   0.011932062    0              1152.3131      1.1965779e-13  0              2.9947225    
   1100000   7590           200            200            0.0032441854  -0.00016497443  0              0.0098975307   0.0012772407   0              123.34677      1.1965779e-13  0              2.9946993    
   1200000   7590           200            200            0.003233738   -0.00016377356  0              0.0098649874   0.00013125517  0              12.675685      1.1965779e-13  0              2.994708     
   1300000   7590           200            200            0.0032376438  -0.00016422406  0              0.0098771555   1.2862997e-05  0              1.2422162      1.1965779e-13  0              2.9947047    
   1400000   7590           200            200            0.0032361872  -0.00016405602  0              0.0098726176   1.1778033e-06  0              0.11374381     1.1965779e-13  0              2.994706     
   1500000   7590           200            200            0.0032367288  -0.00016411858  0              0.009874305    9.7592356e-08  0              0.0094247712   1.1965779e-13  0              2.9947055    
   1600000   7590           200            200            0.003236528   -0.00016409536  0              0.0098736793   6.8520189e-09  0              0.00066171894  1.1965779e-13  0              2.9947057    
   1700000   7590           200            200            0.0032366022  -0.00016410396  0              0.0098739106   3.4545534e-10  0              3.3361604e-05  1.1965779e-13  0              2.9947056    
   1800000   7590           200            200            0.0032365748  -0.00016410078  0              0.0098738253   6.0990146e-12  0              5.8899918e-07  1.1965779e-13  0              2.9947056    
   1900000   7590           200            200            0.0032365849  -0.00016410195  0              0.0098738567   4.8371962e-13  0              4.6714178e-08  1.1965779e-13  0              2.9947056    
   2000000   7590           200            200            0.0032365812  -0.00016410152  0              0.0098738452   7.1081788e-13  0              6.8645703e-08  1.1965779e-13  0              2.9947056    
   2100000   7590           200            200            0.0032365826  -0.00016410168  0              0.0098738494   2.7513318e-13  0              2.6570393e-08  1.1965779e-13  0              2.9947056    
   2200000   7590           200            200            0.0032365821  -0.00016410162  0              0.0098738479   7.3587715e-14  0              7.1065748e-09  1.1965779e-13  0              2.9947056    
   2300000   7590           200            200            0.0032365823  -0.00016410164  0              0.0098738484   1.6443863e-14  0              1.5880306e-09  1.1965779e-13  0              2.9947056    
   2400000   7590           200            200            0.0032365822  -0.00016410164  0              0.0098738482   3.2489156e-15  0              3.1375701e-10  1.1965779e-13  0              2.9947056    
   2500000   7590           200            200            0.0032365822  -0.00016410164  0              0.0098738483   6.2058994e-16  0              5.9932134e-11  1.1965779e-13  0              2.9947056    
   2600000   7590           200            200            0.0032365822  -0.00016410164  0              0.0098738483   8.1686252e-17  0              7.8886735e-12  1.1965779e-13  0              2.9947056    
   2700000   7590           200            200            0.0032365822  -0.00016410164  0              0.0098738483   1.8090836e-17  0              1.7470835e-12  1.1965779e-13  0              2.9947056    
   2800000   7590           200            200            0.0032365822  -0.00016410164  0              0.0098738483   5.0423925e-18  0              4.8695818e-13  1.1965779e-13  0              2.9947056    
   2900000   7590           200            200            0.0032365822  -0.00016410164  0              0.0098738483   1.2717257e-18  0              1.2281417e-13  1.1965779e-13  0              2.9947056    
   3000000   7590           200            200            0.0032365822  -0.00016410164  0              0.0098738483   3.604004e-19   0              3.4804891e-14  1.1965779e-13  0              2.9947056    
Loop time of 307.788 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8421377.936 ns/day, 0.000 hours/ns, 9746.965 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.346     | 38.65      | 66.269     | 436.5 | 12.56
Neigh   | 4.7104     | 4.7995     | 4.8898     |   3.6 |  1.56
Comm    | 19.108     | 26.319     | 33.406     | 111.6 |  8.55
Output  | 0.27251    | 0.27283    | 0.27322    |   0.1 |  0.09
Modify  | 175.48     | 179.79     | 184.85     |  25.0 | 58.41
Other   |            | 57.95      |            |       | 18.83

Nlocal:         625.25 ave         876 max         374 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           2 max           1 min
Histogram: 1 0 0 0 0 0 0 0 0 3
Neighs:         328.25 ave         657 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1313
Ave neighs/atom = 0.52499
Neighbor list builds = 164
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 7

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.07                                                               
Lattice spacing in x,y,z = 5.07 5.07 5.07

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3802.5 ${n1e1} -100 100 -100 100 units box
region box block -3802.5 3802.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3802.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3802.5 3802.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3802.5 -100 -100) to (3802.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3802.5 -100 -100) to (3802.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3802.5 -100 -100) to (3802.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_7_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 4907 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 98.51 | 98.52 | 98.52 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7605           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7605           200            200            0.0026620293  -2.6554658e-35  0              0.0079860879   581275.56      0              5.6135433e+10  1.1965779e-13  0              3.3294953    
    200000   7605           200            200            0.00091892621  5.3109548e-36  0              0.0027567786   135972.94      0              1.3131294e+10  1.1965779e-13  0              3.0795195    
    300000   7605           200            200            2.3320828e-05 -1.0621795e-35  0              6.9962483e-05  190.27919      0              18375802       1.1965779e-13  0              3.0450491    
    400000   7605           200            200            6.9927278e-05  7.8149363e-40  0              0.00020978183  1633.5103      0              1.5775273e+08  1.1965779e-13  0              3.0047687    
    500000   7605           200            200            0.0071982901   0.0014855511   0              0.020109319    380.00547      0              36698208       1.1965779e-13  0              2.9924257    
    600000   7605           200            200            0.0026271164   0.0013434336   0              0.0065379157   33.778823      0              3262116.9      1.1965779e-13  0              2.9956739    
    700000   7605           200            200            0.0039994732   0.0008214269   0              0.011176993    4.201886       0              405788.07      1.1965779e-13  0              2.9943618    
    800000   7605           200            200            0.0034175635   0.00078032276  0              0.0094723677   1.5941466      0              153951.27      1.1965779e-13  0              2.9948075    
    900000   7605           200            200            0.0035629114   0.0007788103   0              0.009909924    0.44599827     0              43071.321      1.1965779e-13  0              2.99469      
   1000000   7605           200            200            0.0035498598   0.00077888869  0              0.0098706907   0.061606598    0              5949.5243      1.1965779e-13  0              2.9946995    
   1100000   7605           200            200            0.003538505    0.00077897679  0              0.0098365383   0.0043535735   0              420.43697      1.1965779e-13  0              2.9947092    
   1200000   7605           200            200            0.0035474267   0.00077890889  0              0.0098633713   6.4419088e-05  0              6.2211344      1.1965779e-13  0              2.9947018    
   1300000   7605           200            200            0.0035433511   0.00077893897  0              0.0098511142   1.4863024e-05  0              1.4353645      1.1965779e-13  0              2.9947051    
   1400000   7605           200            200            0.00354471     0.00077892894  0              0.009855201    1.2295503e-05  0              1.1874116      1.1965779e-13  0              2.994704     
   1500000   7605           200            200            0.0035444052   0.00077893114  0              0.0098542844   2.8379853e-06  0              0.2740723      1.1965779e-13  0              2.9947043    
   1600000   7605           200            200            0.0035444135   0.0007789311   0              0.0098543095   3.4369743e-07  0              0.033191838    1.1965779e-13  0              2.9947043    
   1700000   7605           200            200            0.0035444494   0.00077893083  0              0.0098544174   1.999011e-08   0              0.0019305017   1.1965779e-13  0              2.9947043    
   1800000   7605           200            200            0.0035444257   0.00077893101  0              0.0098543462   9.6494762e-11  0              9.3187734e-06  1.1965779e-13  0              2.9947043    
   1900000   7605           200            200            0.0035444358   0.00077893093  0              0.0098543764   1.6623139e-10  0              1.6053438e-05  1.1965779e-13  0              2.9947043    
   2000000   7605           200            200            0.0035444326   0.00077893095  0              0.009854367    8.8950029e-11  0              8.5901571e-06  1.1965779e-13  0              2.9947043    
   2100000   7605           200            200            0.0035444333   0.00077893095  0              0.0098543688   1.7563257e-11  0              1.6961336e-06  1.1965779e-13  0              2.9947043    
   2200000   7605           200            200            0.0035444333   0.00077893095  0              0.0098543689   1.8573517e-12  0              1.7936974e-07  1.1965779e-13  0              2.9947043    
   2300000   7605           200            200            0.0035444332   0.00077893095  0              0.0098543686   8.505745e-14   0              8.2142397e-09  1.1965779e-13  0              2.9947043    
   2400000   7605           200            200            0.0035444332   0.00077893095  0              0.0098543688   1.7934141e-20  0              1.7319509e-15  1.1965779e-13  0              2.9947043    
   2500000   7605           200            200            0.0035444332   0.00077893095  0              0.0098543687   1.5114004e-15  0              1.4596024e-10  1.1965779e-13  0              2.9947043    
   2600000   7605           200            200            0.0035444332   0.00077893095  0              0.0098543687   6.1194522e-16  0              5.9097289e-11  1.1965779e-13  0              2.9947043    
   2700000   7605           200            200            0.0035444332   0.00077893095  0              0.0098543687   1.0315873e-16  0              9.9623317e-12  1.1965779e-13  0              2.9947043    
   2800000   7605           200            200            0.0035444332   0.00077893095  0              0.0098543687   1.2700853e-17  0              1.2265574e-12  1.1965779e-13  0              2.9947043    
   2900000   7605           200            200            0.0035444332   0.00077893095  0              0.0098543687   2.3122712e-19  0              2.233026e-14   1.1965779e-13  0              2.9947043    
   3000000   7605           200            200            0.0035444332   0.00077893095  0              0.0098543687   6.3817286e-18  0              6.1630167e-13  1.1965779e-13  0              2.9947043    
Loop time of 301.202 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8605517.735 ns/day, 0.000 hours/ns, 9960.090 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.148     | 38.757     | 67.227     | 441.1 | 12.87
Neigh   | 4.6632     | 4.758      | 4.8537     |   3.9 |  1.58
Comm    | 19.821     | 39.887     | 79.76      | 371.2 | 13.24
Output  | 0.27547    | 0.2758     | 0.27616    |   0.1 |  0.09
Modify  | 112.48     | 160.64     | 178.41     | 219.9 | 53.33
Other   |            | 56.89      |            |       | 18.89

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         328.75 ave         658 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1315
Ave neighs/atom = 0.52578968
Neighbor list builds = 164
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 8

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.08                                                               
Lattice spacing in x,y,z = 5.08 5.08 5.08

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3810 ${n1e1} -100 100 -100 100 units box
region box block -3810 3810 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3810 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3810 3810 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3810 -100 -100) to (3810 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3810 -100 -100) to (3810 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3810 -100 -100) to (3810 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_8_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 4917 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 98.72 | 98.73 | 98.73 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7620           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7620           200            200            0.0026568302   5.3355812e-42  0              0.0079704905   581287.21      0              5.6136558e+10  1.1965779e-13  0              3.3294994    
    200000   7620           200            200            0.00091720128  2.4031692e-42  0              0.0027516038   135991.59      0              1.3133095e+10  1.1965779e-13  0              3.0795229    
    300000   7620           200            200            2.3676246e-05 -8.4807431e-35  0              7.1028738e-05  196.75836      0              19001514       1.1965779e-13  0              3.045063     
    400000   7620           200            200            7.2304518e-05  2.120226e-35   0              0.00021691355  1747.2389      0              1.6873582e+08  1.1965779e-13  0              3.0046631    
    500000   7620           200            200            0.0066154102   0.00053074092  0              0.01931549     525.92226      0              50789807       1.1965779e-13  0              2.992567     
    600000   7620           200            200            0.0014679205  -0.0020231933   0              0.0064269547   25.601325      0              2472392.7      1.1965779e-13  0              2.9956973    
    700000   7620           200            200            0.0031423603  -0.0015610218   0              0.010988103    9.6752906      0              934370.31      1.1965779e-13  0              2.9944086    
    800000   7620           200            200            0.0027801021  -0.0016768629   0              0.010017169    3.2239788      0              311348.8       1.1965779e-13  0              2.9946642    
    900000   7620           200            200            0.0026550272  -0.0016808498   0              0.0096459314   0.0071511394   0              690.60586      1.1965779e-13  0              2.99476      
   1000000   7620           200            200            0.0027211156  -0.0016785081   0              0.0098418549   0.065570229    0              6332.3034      1.1965779e-13  0              2.9947076    
   1100000   7620           200            200            0.0027270252  -0.0016783357   0              0.0098594114   0.00097592416  0              94.24777       1.1965779e-13  0              2.9947034    
   1200000   7620           200            200            0.0027171125  -0.0016786531   0              0.0098299907   0.00086040684  0              83.091934      1.1965779e-13  0              2.9947111    
   1300000   7620           200            200            0.0027179679  -0.0016786232   0              0.009832527    8.2628665e-05  0              7.979685       1.1965779e-13  0              2.9947104    
   1400000   7620           200            200            0.0027191623  -0.0016785849   0              0.0098360718   5.9742012e-06  0              0.57694559     1.1965779e-13  0              2.9947095    
   1500000   7620           200            200            0.0027188483  -0.0016785953   0              0.0098351402   2.6648214e-06  0              0.25734938     1.1965779e-13  0              2.9947097    
   1600000   7620           200            200            0.0027187395  -0.0016785987   0              0.0098348171   3.3779065e-09  0              0.00032621403  1.1965779e-13  0              2.9947098    
   1700000   7620           200            200            0.0027187999  -0.0016785968   0              0.0098349965   5.281411e-08   0              0.0051004087   1.1965779e-13  0              2.9947098    
   1800000   7620           200            200            0.0027188045  -0.0016785966   0              0.0098350102   9.231825e-10   0              8.9154358e-05  1.1965779e-13  0              2.9947098    
   1900000   7620           200            200            0.0027187956  -0.0016785969   0              0.0098349837   6.7282167e-10  0              6.4976301e-05  1.1965779e-13  0              2.9947098    
   2000000   7620           200            200            0.0027187965  -0.0016785969   0              0.0098349863   7.0754179e-11  0              6.8329322e-06  1.1965779e-13  0              2.9947098    
   2100000   7620           200            200            0.0027187975  -0.0016785969   0              0.0098349894   4.4052663e-12  0              4.2542909e-07  1.1965779e-13  0              2.9947098    
   2200000   7620           200            200            0.0027187972  -0.0016785969   0              0.0098349886   2.2007082e-12  0              2.1252864e-07  1.1965779e-13  0              2.9947098    
   2300000   7620           200            200            0.0027187971  -0.0016785969   0              0.0098349883   1.2382293e-15  0              1.1957933e-10  1.1965779e-13  0              2.9947098    
   2400000   7620           200            200            0.0027187972  -0.0016785969   0              0.0098349885   4.2449631e-14  0              4.0994815e-09  1.1965779e-13  0              2.9947098    
   2500000   7620           200            200            0.0027187972  -0.0016785969   0              0.0098349885   8.0255259e-16  0              7.7504785e-11  1.1965779e-13  0              2.9947098    
   2600000   7620           200            200            0.0027187972  -0.0016785969   0              0.0098349884   5.2239229e-16  0              5.0448909e-11  1.1965779e-13  0              2.9947098    
   2700000   7620           200            200            0.0027187972  -0.0016785969   0              0.0098349884   4.7157173e-17  0              4.5541022e-12  1.1965779e-13  0              2.9947098    
   2800000   7620           200            200            0.0027187972  -0.0016785969   0              0.0098349884   6.2896456e-18  0              6.0740895e-13  1.1965779e-13  0              2.9947098    
   2900000   7620           200            200            0.0027187972  -0.0016785969   0              0.0098349884   1.1729268e-18  0              1.1327288e-13  1.1965779e-13  0              2.9947098    
   3000000   7620           200            200            0.0027187972  -0.0016785969   0              0.0098349884   3.5575462e-18  0              3.4356235e-13  1.1965779e-13  0              2.9947098    
Loop time of 303.625 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8536848.084 ns/day, 0.000 hours/ns, 9880.611 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.194     | 38.701     | 67.417     | 440.0 | 12.75
Neigh   | 4.7145     | 4.8079     | 4.904      |   3.8 |  1.58
Comm    | 19.988     | 40.458     | 82.352     | 385.4 | 13.33
Output  | 0.27265    | 0.27298    | 0.27335    |   0.1 |  0.09
Modify  | 111.79     | 162.39     | 181.24     | 229.9 | 53.48
Other   |            | 57         |            |       | 18.77

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         326.75 ave         654 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1307
Ave neighs/atom = 0.52259096
Neighbor list builds = 164
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 9

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.09                                                               
Lattice spacing in x,y,z = 5.09 5.09 5.09

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3817.5 ${n1e1} -100 100 -100 100 units box
region box block -3817.5 3817.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3817.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3817.5 3817.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3817.5 -100 -100) to (3817.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3817.5 -100 -100) to (3817.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3817.5 -100 -100) to (3817.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_9_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 4926 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 98.8 | 98.83 | 98.86 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7635           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7635           200            200            0.0026516521   1.0580157e-35  0              0.0079549562   581299.03      0              5.61377e+10    1.1965779e-13  0              3.3295036    
    200000   7635           200            200            0.00091553128  1.0092556e-41  0              0.0027465938   136021.77      0              1.3136009e+10  1.1965779e-13  0              3.0795103    
    300000   7635           200            200            2.4185822e-05  4.2321246e-35  0              7.2557465e-05  205.92874      0              19887124       1.1965779e-13  0              3.0450689    
    400000   7635           200            200            7.3898688e-05  8.4641992e-35  0              0.00022169606  1827.9284      0              1.7652824e+08  1.1965779e-13  0              3.0045854    
    500000   7635           200            200            0.006496715    0.00036089619  0              0.019129249    554.14741      0              53515591       1.1965779e-13  0              2.9925975    
    600000   7635           200            200            0.0025410127   0.001201459    0              0.0064215791   23.36836       0              2256749        1.1965779e-13  0              2.9957046    
    700000   7635           200            200            0.0041235064   0.0011166189   0              0.0112539      0.017611045    0              1700.7486      1.1965779e-13  0              2.9943331    
    800000   7635           200            200            0.0035967715   0.0014127776   0              0.009377537    0.93230324     0              90035.174      1.1965779e-13  0              2.9948261    
    900000   7635           200            200            0.0037526893   0.0013438833   0              0.0099141845   0.35239108     0              34031.408      1.1965779e-13  0              2.9946787    
   1000000   7635           200            200            0.0037183057   0.0013441433   0              0.0098107739   0.065551534    0              6330.4979      1.1965779e-13  0              2.9947075    
   1100000   7635           200            200            0.0037165343   0.0013441586   0              0.0098054442   0.0075254528   0              726.75436      1.1965779e-13  0              2.9947085    
   1200000   7635           200            200            0.0037223446   0.0013440896   0              0.0098229442   0.00048156906  0              46.506493      1.1965779e-13  0              2.994704     
   1300000   7635           200            200            0.0037188052   0.0013441313   0              0.0098122843   6.6604833e-06  0              0.6432218      1.1965779e-13  0              2.9947068    
   1400000   7635           200            200            0.0037203254   0.0013441127   0              0.0098168635   1.6367284e-06  0              0.15806351     1.1965779e-13  0              2.9947056    
   1500000   7635           200            200            0.0037198131   0.001344119    0              0.0098153204   1.3942755e-06  0              0.13464915     1.1965779e-13  0              2.994706     
   1600000   7635           200            200            0.0037199415   0.0013441174   0              0.0098157072   3.5527713e-07  0              0.034310122    1.1965779e-13  0              2.9947059    
   1700000   7635           200            200            0.003719927    0.0013441176   0              0.0098156635   5.2314143e-08  0              0.0050521255   1.1965779e-13  0              2.9947059    
   1800000   7635           200            200            0.0037199191   0.0013441176   0              0.0098156398   4.6907903e-09  0              0.00045300296  1.1965779e-13  0              2.9947059    
   1900000   7635           200            200            0.0037199262   0.0013441176   0              0.0098156611   1.8860527e-10  0              1.8214147e-05  1.1965779e-13  0              2.9947059    
   2000000   7635           200            200            0.0037199227   0.0013441176   0              0.0098156504   8.8564007e-14  0              8.5528779e-09  1.1965779e-13  0              2.9947059    
   2100000   7635           200            200            0.003719924    0.0013441176   0              0.0098156545   4.1869211e-12  0              4.0434287e-07  1.1965779e-13  0              2.9947059    
   2200000   7635           200            200            0.0037199236   0.0013441176   0              0.0098156533   1.6688741e-12  0              1.6116791e-07  1.1965779e-13  0              2.9947059    
   2300000   7635           200            200            0.0037199237   0.0013441176   0              0.0098156536   3.1903625e-13  0              3.0810238e-08  1.1965779e-13  0              2.9947059    
   2400000   7635           200            200            0.0037199237   0.0013441176   0              0.0098156536   3.7310289e-14  0              3.6031606e-09  1.1965779e-13  0              2.9947059    
   2500000   7635           200            200            0.0037199237   0.0013441176   0              0.0098156535   2.3729181e-15  0              2.2915945e-10  1.1965779e-13  0              2.9947059    
   2600000   7635           200            200            0.0037199237   0.0013441176   0              0.0098156535   4.7603069e-17  0              4.5971637e-12  1.1965779e-13  0              2.9947059    
   2700000   7635           200            200            0.0037199237   0.0013441176   0              0.0098156535   8.6788506e-18  0              8.3814127e-13  1.1965779e-13  0              2.9947059    
   2800000   7635           200            200            0.0037199237   0.0013441176   0              0.0098156535   9.8122426e-18  0              9.4759615e-13  1.1965779e-13  0              2.9947059    
   2900000   7635           200            200            0.0037199237   0.0013441176   0              0.0098156535   6.3496503e-18  0              6.1320378e-13  1.1965779e-13  0              2.9947059    
   3000000   7635           200            200            0.0037199237   0.0013441176   0              0.0098156535   3.1239952e-18  0              3.016931e-13   1.1965779e-13  0              2.9947059    
Loop time of 301.474 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8597762.130 ns/day, 0.000 hours/ns, 9951.114 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.434     | 38.515     | 67.016     | 436.4 | 12.78
Neigh   | 4.7129     | 4.8001     | 4.8892     |   3.6 |  1.59
Comm    | 19.89      | 40.39      | 81.922     | 382.7 | 13.40
Output  | 0.27368    | 0.27401    | 0.27437    |   0.1 |  0.09
Modify  | 109.49     | 159.87     | 180.21     | 231.2 | 53.03
Other   |            | 57.62      |            |       | 19.11

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         327.25 ave         655 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1309
Ave neighs/atom = 0.52339064
Neighbor list builds = 164
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 10

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.1                                                               
Lattice spacing in x,y,z = 5.1 5.1 5.1

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3825 ${n1e1} -100 100 -100 100 units box
region box block -3825 3825 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3825 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3825 3825 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3825 -100 -100) to (3825 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3825 -100 -100) to (3825 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3825 -100 -100) to (3825 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_10_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 4936 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 99 | 99.01 | 99.01 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7650           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7650           200            200            0.0026472461   2.1118845e-35  0              0.0079417382   581567.96      0              5.616367e+10   1.1965779e-13  0              3.329234     
    200000   7650           200            200            0.00091768774  2.2427337e-40  0              0.0027530632   136968.17      0              1.3227406e+10  1.1965779e-13  0              3.0782446    
    300000   7650           200            200           -6.155622e-07   2.1119128e-35  0             -1.8466866e-06  0.11011986     0              10634.588      1.1965779e-13  0              3.0452733    
    400000   7650           200            200           -5.0633817e-05 -8.4474812e-35  0             -0.00015190145  1045.6999      0              1.0098621e+08  1.1965779e-13  0              3.0060215    
    500000   7650           200            200            0.00050229128  6.3399678e-16  0              0.0015068738   110.51562      0              10672807       1.1965779e-13  0              2.9988371    
    600000   7650           200            200            0.0021110439   2.7500697e-15  0              0.0063331316   12.916718      0              1247404.1      1.1965779e-13  0              2.996904     
    700000   7650           200            200            0.003061949    3.9886283e-15  0              0.009185847    21.855351      0              2110633.4      1.1965779e-13  0              2.9960314    
    800000   7650           200            200            0.0033483942   4.3689735e-15  0              0.010045183    2.8895333      0              279050.45      1.1965779e-13  0              2.9957827    
    900000   7650           200            200            0.0033287378   4.346927e-15   0              0.0099862134   0.0050353031   0              486.27353      1.1965779e-13  0              2.995797     
   1000000   7650           200            200            0.0032811862   4.2854827e-15  0              0.0098435586   0.039926669    0              3855.8319      1.1965779e-13  0              2.9958368    
   1100000   7650           200            200            0.0032643311   4.2632538e-15  0              0.0097929934   0.0084439222   0              815.45357      1.1965779e-13  0              2.9958512    
   1200000   7650           200            200            0.0032637816   4.2623585e-15  0              0.0097913449   0.00011966052  0              11.555956      1.1965779e-13  0              2.9958518    
   1300000   7650           200            200            0.0032658277   4.2649866e-15  0              0.0097974831   6.2195457e-05  0              6.0063921      1.1965779e-13  0              2.9958501    
   1400000   7650           200            200            0.0032667456   4.2661911e-15  0              0.0098002367   2.2339077e-05  0              2.1573481      1.1965779e-13  0              2.9958493    
   1500000   7650           200            200            0.0032668479   4.2663331e-15  0              0.0098005437   7.8204801e-07  0              0.075524599    1.1965779e-13  0              2.9958492    
   1600000   7650           200            200            0.0032667663   4.2662291e-15  0              0.0098002988   7.4546413e-08  0              0.007199159    1.1965779e-13  0              2.9958492    
   1700000   7650           200            200            0.0032667188   4.2661671e-15  0              0.0098001564   5.3742399e-08  0              0.0051900563   1.1965779e-13  0              2.9958493    
   1800000   7650           200            200            0.0032667103   4.2661556e-15  0              0.0098001308   3.4486043e-09  0              0.00033304152  1.1965779e-13  0              2.9958493    
   1900000   7650           200            200            0.0032667131   4.2661592e-15  0              0.0098001394   4.9904326e-11  0              4.8194026e-06  1.1965779e-13  0              2.9958493    
   2000000   7650           200            200            0.0032667155   4.2661623e-15  0              0.0098001464   1.1735189e-10  0              1.1333006e-05  1.1965779e-13  0              2.9958493    
   2100000   7650           200            200            0.0032667161   4.266163e-15   0              0.0098001482   1.2339515e-11  0              1.1916621e-06  1.1965779e-13  0              2.9958493    
   2200000   7650           200            200            0.003266716    4.2661629e-15  0              0.0098001479   1.8388723e-16  0              1.7758512e-11  1.1965779e-13  0              2.9958493    
   2300000   7650           200            200            0.0032667159   4.2661628e-15  0              0.0098001476   2.296471e-13   0              2.2177673e-08  1.1965779e-13  0              2.9958493    
   2400000   7650           200            200            0.0032667158   4.2661627e-15  0              0.0098001475   3.8309952e-14  0              3.699701e-09   1.1965779e-13  0              2.9958493    
   2500000   7650           200            200            0.0032667158   4.2661627e-15  0              0.0098001475   2.8625151e-16  0              2.7644122e-11  1.1965779e-13  0              2.9958493    
   2600000   7650           200            200            0.0032667158   4.2661627e-15  0              0.0098001475   3.6311715e-16  0              3.5067255e-11  1.1965779e-13  0              2.9958493    
   2700000   7650           200            200            0.0032667158   4.2661628e-15  0              0.0098001475   1.0479785e-16  0              1.0120627e-11  1.1965779e-13  0              2.9958493    
   2800000   7650           200            200            0.0032667158   4.2661628e-15  0              0.0098001475   1.4044003e-18  0              1.3562693e-13  1.1965779e-13  0              2.9958493    
   2900000   7650           200            200            0.0032667158   4.2661628e-15  0              0.0098001475   8.976985e-19   0              8.6693296e-14  1.1965779e-13  0              2.9958493    
   3000000   7650           200            200            0.0032667158   4.2661627e-15  0              0.0098001475   6.0090454e-18  0              5.803106e-13   1.1965779e-13  0              2.9958493    
Loop time of 300.811 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8616716.873 ns/day, 0.000 hours/ns, 9973.052 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.265     | 37.751     | 64.66      | 425.2 | 12.55
Neigh   | 4.679      | 4.7654     | 4.8535     |   3.5 |  1.58
Comm    | 19.293     | 25.215     | 29.854     |  87.2 |  8.38
Output  | 0.27552    | 0.27585    | 0.27622    |   0.1 |  0.09
Modify  | 168.42     | 174.96     | 181.18     |  44.0 | 58.16
Other   |            | 57.84      |            |       | 19.23

Nlocal:         625.25 ave         877 max         374 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         323.75 ave         648 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1295
Ave neighs/atom = 0.51779288
Neighbor list builds = 164
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 11

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.11                                                               
Lattice spacing in x,y,z = 5.11 5.11 5.11

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3832.5 ${n1e1} -100 100 -100 100 units box
region box block -3832.5 3832.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3832.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3832.5 3832.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3832.5 -100 -100) to (3832.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1499 atoms
  using lattice units in orthogonal box = (-3832.5 -100 -100) to (3832.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3832.5 -100 -100) to (3832.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1499 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1499 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1499 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_11_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 4946 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 99.15 | 99.18 | 99.21 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7665           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7665           200            200            0.0026413778   1.3173415e-36  0              0.0079241335   581331.41      0              5.6253334e+10  1.1965779e-13  0              3.3294922    
    200000   7665           200            200            0.00091234673  8.4310924e-35  0              0.0027370402   136115.14      0              1.3171369e+10  1.1965779e-13  0              3.0794315    
    300000   7665           200            200            2.5155795e-05  8.8116837e-41  0              7.5467386e-05  224.12089      0              21687367       1.1965779e-13  0              3.0450638    
    400000   7665           200            200            7.4757551e-05  2.1077777e-35  0              0.00022427265  1882.4006      0              1.8215308e+08  1.1965779e-13  0              3.0045319    
    500000   7665           200            200            0.0056014103  -0.0021193296   0              0.01892356     577.82231      0              55913770       1.1965779e-13  0              2.9926222    
    600000   7665           200            200            0.0012974361  -0.0024900727   0              0.0063823811   21.680854      0              2097977.6      1.1965779e-13  0              2.9957096    
    700000   7665           200            200            0.0030807935  -0.0019665458   0              0.011208926    0.043217254    0              4181.977       1.1965779e-13  0              2.9943332    
    800000   7665           200            200            0.0024996097  -0.0018457121   0              0.0093445412   0.97705419     0              94545.992      1.1965779e-13  0              2.9948251    
    900000   7665           200            200            0.0026549345  -0.001908288    0              0.0098730915   0.35852825     0              34693.479      1.1965779e-13  0              2.9946793    
   1000000   7665           200            200            0.002622531   -0.0019057559   0              0.0097733487   0.065681209    0              6355.7325      1.1965779e-13  0              2.9947073    
   1100000   7665           200            200            0.0026203691  -0.0019056327   0              0.0097667402   0.0074330009   0              719.26455      1.1965779e-13  0              2.9947086    
   1200000   7665           200            200            0.002626171   -0.0019060667   0              0.0097845797   0.00046497572  0              44.994015      1.1965779e-13  0              2.9947039    
   1300000   7665           200            200            0.0026226898  -0.0019058016   0              0.0097738711   5.7821022e-06  0              0.55951307     1.1965779e-13  0              2.9947068    
   1400000   7665           200            200            0.0026241734  -0.001905916    0              0.0097784362   1.8025828e-06  0              0.1744294      1.1965779e-13  0              2.9947056    
   1500000   7665           200            200            0.0026236771  -0.0019058774   0              0.0097769088   1.4356924e-06  0              0.13892675     1.1965779e-13  0              2.994706     
   1600000   7665           200            200            0.0026238001  -0.0019058871   0              0.0097772873   3.5862395e-07  0              0.03470274     1.1965779e-13  0              2.9947059    
   1700000   7665           200            200            0.002623787   -0.001905886    0              0.0097772469   5.2074002e-08  0              0.0050390124   1.1965779e-13  0              2.9947059    
   1800000   7665           200            200            0.0026237789  -0.0019058854   0              0.0097772222   4.5927878e-09  0              0.00044442743  1.1965779e-13  0              2.9947059    
   1900000   7665           200            200            0.0026237859  -0.001905886    0              0.0097772437   1.7784657e-10  0              1.7209568e-05  1.1965779e-13  0              2.9947059    
   2000000   7665           200            200            0.0026237824  -0.0019058857   0              0.009777233    2.1134978e-13  0              2.0451552e-08  1.1965779e-13  0              2.9947059    
   2100000   7665           200            200            0.0026237838  -0.0019058858   0              0.0097772371   4.3991145e-12  0              4.2568637e-07  1.1965779e-13  0              2.9947059    
   2200000   7665           200            200            0.0026237834  -0.0019058858   0              0.0097772359   1.6997887e-12  0              1.644824e-07   1.1965779e-13  0              2.9947059    
   2300000   7665           200            200            0.0026237834  -0.0019058858   0              0.0097772361   3.1982914e-13  0              3.0948707e-08  1.1965779e-13  0              2.9947059    
   2400000   7665           200            200            0.0026237835  -0.0019058858   0              0.0097772361   3.6848709e-14  0              3.565716e-09   1.1965779e-13  0              2.9947059    
   2500000   7665           200            200            0.0026237834  -0.0019058858   0              0.0097772361   2.295949e-15   0              2.2217066e-10  1.1965779e-13  0              2.9947059    
   2600000   7665           200            200            0.0026237834  -0.0019058858   0              0.0097772361   4.4466064e-17  0              4.3028198e-12  1.1965779e-13  0              2.9947059    
   2700000   7665           200            200            0.0026237834  -0.0019058858   0              0.0097772361   7.7430934e-18  0              7.4927108e-13  1.1965779e-13  0              2.9947059    
   2800000   7665           200            200            0.0026237834  -0.0019058858   0              0.0097772361   9.1519755e-18  0              8.8560349e-13  1.1965779e-13  0              2.9947059    
   2900000   7665           200            200            0.0026237834  -0.0019058858   0              0.0097772361   4.7440427e-18  0              4.5906381e-13  1.1965779e-13  0              2.9947059    
   3000000   7665           200            200            0.0026237834  -0.0019058858   0              0.0097772361   4.330514e-20   0              4.1904815e-15  1.1965779e-13  0              2.9947059    
Loop time of 300.733 on 4 procs for 3000000 steps with 2500 atoms

Performance: 8618952.728 ns/day, 0.000 hours/ns, 9975.640 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.584     | 38.125     | 66.513     | 442.7 | 12.68
Neigh   | 4.7467     | 4.8342     | 4.9238     |   3.6 |  1.61
Comm    | 28.257     | 54.62      | 82.383     | 354.3 | 18.16
Output  | 0.27415    | 0.27451    | 0.27486    |   0.1 |  0.09
Modify  | 108.44     | 145.15     | 180.19     | 290.0 | 48.27
Other   |            | 57.73      |            |       | 19.20

Nlocal:            625 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:            1.5 ave           4 max           0 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         326.75 ave         654 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1307
Ave neighs/atom = 0.5228
Neighbor list builds = 164
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 12

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.12                                                               
Lattice spacing in x,y,z = 5.12 5.12 5.12

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3840 ${n1e1} -100 100 -100 100 units box
region box block -3840 3840 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3840 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3840 3840 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3840 -100 -100) to (3840 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3840 -100 -100) to (3840 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3840 -100 -100) to (3840 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_12_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 4955 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 99.35 | 99.35 | 99.36 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7680           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7680           200            200            0.0026362646   5.4492658e-42  0              0.0079087937   581345.94      0              5.614223e+10   1.1965779e-13  0              3.3294848    
    200000   7680           200            200            0.00091078598  4.6372906e-42  0              0.002732358    136167.5       0              1.3150083e+10  1.1965779e-13  0              3.0793776    
    300000   7680           200            200            2.5340704e-05 -4.7331626e-35  0              7.6022113e-05  228.22768      0              22040596       1.1965779e-13  0              3.0450613    
    400000   7680           200            200            7.4901712e-05  2.1036474e-35  0              0.00022470514  1896.3095      0              1.83132e+08    1.1965779e-13  0              3.0045178    
    500000   7680           200            200            0.0080833474   0.005471708    0              0.018778334    595.14893      0              57475224       1.1965779e-13  0              2.9926392    
    600000   7680           200            200            0.002035997   -0.0002282516   0              0.0063362426   20.595567      0              1988972.5      1.1965779e-13  0              2.9957119    
    700000   7680           200            200            0.004055716    0.0013028881   0              0.01086426     10.781824      0              1041231.4      1.1965779e-13  0              2.994418     
    800000   7680           200            200            0.0036574393   0.0010134102   0              0.0099589076   3.1220058      0              301500.98      1.1965779e-13  0              2.9946588    
    900000   7680           200            200            0.0035179957   0.00098223395  0              0.0095717531   0.012808073    0              1236.912       1.1965779e-13  0              2.9947597    
   1000000   7680           200            200            0.0035869286   0.00099869259  0              0.0097620932   0.066030839    0              6376.7858      1.1965779e-13  0              2.9947084    
   1100000   7680           200            200            0.0035943215   0.0010002616   0              0.0097827028   0.00075738371  0              73.142697      1.1965779e-13  0              2.9947033    
   1200000   7680           200            200            0.0035837994   0.00099787006  0              0.0097535281   0.00090443609  0              87.343964      1.1965779e-13  0              2.994711     
   1300000   7680           200            200            0.0035845566   0.00099805775  0              0.0097556119   7.5896876e-05  0              7.329577       1.1965779e-13  0              2.9947104    
   1400000   7680           200            200            0.0035858497   0.00099835049  0              0.0097591987   6.7967142e-06  0              0.65637801     1.1965779e-13  0              2.9947095    
   1500000   7680           200            200            0.0035855326   0.00099827657  0              0.0097583212   2.5873148e-06  0              0.24986435     1.1965779e-13  0              2.9947097    
   1600000   7680           200            200            0.003585411    0.0009982494   0              0.0097579835   7.0654665e-09  0              0.00068233218  1.1965779e-13  0              2.9947098    
   1700000   7680           200            200            0.003585474    0.00099826389  0              0.009758158    5.3315582e-08  0              0.0051488373   1.1965779e-13  0              2.9947098    
   1800000   7680           200            200            0.0035854799   0.00099826515  0              0.0097581745   7.3264892e-10  0              7.0753988e-05  1.1965779e-13  0              2.9947098    
   1900000   7680           200            200            0.0035854704   0.00099826299  0              0.0097581482   7.0957908e-10  0              6.8526069e-05  1.1965779e-13  0              2.9947098    
   2000000   7680           200            200            0.0035854712   0.00099826318  0              0.0097581504   6.5292096e-11  0              6.3054433e-06  1.1965779e-13  0              2.9947098    
   2100000   7680           200            200            0.0035854723   0.00099826344  0              0.0097581536   5.0553164e-12  0              4.8820627e-07  1.1965779e-13  0              2.9947098    
   2200000   7680           200            200            0.003585472    0.00099826337  0              0.0097581527   2.1417658e-12  0              2.0683641e-07  1.1965779e-13  0              2.9947098    
   2300000   7680           200            200            0.0035854719   0.00099826334  0              0.0097581524   3.4568633e-15  0              3.3383912e-10  1.1965779e-13  0              2.9947098    
   2400000   7680           200            200            0.003585472    0.00099826336  0              0.0097581526   4.2901984e-14  0              4.1431666e-09  1.1965779e-13  0              2.9947098    
   2500000   7680           200            200            0.003585472    0.00099826336  0              0.0097581526   6.4195047e-16  0              6.1994981e-11  1.1965779e-13  0              2.9947098    
   2600000   7680           200            200            0.003585472    0.00099826336  0              0.0097581526   5.5214057e-16  0              5.3321784e-11  1.1965779e-13  0              2.9947098    
   2700000   7680           200            200            0.003585472    0.00099826336  0              0.0097581526   4.1259282e-17  0              3.9845261e-12  1.1965779e-13  0              2.9947098    
   2800000   7680           200            200            0.003585472    0.00099826336  0              0.0097581526   7.7360314e-18  0              7.4709054e-13  1.1965779e-13  0              2.9947098    
   2900000   7680           200            200            0.003585472    0.00099826336  0              0.0097581526   5.7357807e-18  0              5.5392064e-13  1.1965779e-13  0              2.9947098    
   3000000   7680           200            200            0.003585472    0.00099826336  0              0.0097581526   2.0196871e-18  0              1.9504692e-13  1.1965779e-13  0              2.9947098    
Loop time of 304.351 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8516480.833 ns/day, 0.000 hours/ns, 9857.038 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.217     | 39.323     | 70.053     | 446.6 | 12.92
Neigh   | 4.7463     | 4.8316     | 4.9183     |   3.4 |  1.59
Comm    | 19.974     | 41.881     | 85.156     | 392.9 | 13.76
Output  | 0.27264    | 0.27297    | 0.27332    |   0.1 |  0.09
Modify  | 110.01     | 161.01     | 179.23     | 232.3 | 52.90
Other   |            | 57.03      |            |       | 18.74

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         326.25 ave         653 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1305
Ave neighs/atom = 0.52179128
Neighbor list builds = 164
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 13

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.13                                                               
Lattice spacing in x,y,z = 5.13 5.13 5.13

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3847.5 ${n1e1} -100 100 -100 100 units box
region box block -3847.5 3847.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3847.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3847.5 3847.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3847.5 -100 -100) to (3847.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3847.5 -100 -100) to (3847.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3847.5 -100 -100) to (3847.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_13_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 4965 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 99.56 | 99.56 | 99.57 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7695           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7695           200            200            0.0026305059  -1.5746436e-35  0              0.0078915176   581147.37      0              5.6123053e+10  1.1965779e-13  0              3.3295933    
    200000   7695           200            200            0.00090778141  4.1990631e-35  0              0.0027233442   135883.2       0              1.3122627e+10  1.1965779e-13  0              3.0795186    
    300000   7695           200            200            2.2898529e-05  4.1991731e-35  0              6.8695588e-05  187.88009      0              18144114       1.1965779e-13  0              3.0449444    
    400000   7695           200            200            6.6343831e-05  2.0995504e-35  0              0.00019903149  1511.3669      0              1.45957e+08    1.1965779e-13  0              3.0047962    
    500000   7695           200            200            0.0069595735  -0.00071823265  0              0.021596953    0.051468701    0              4970.4787      1.1965779e-13  0              2.9920073    
    600000   7695           200            200            0.0026998493  -0.0019288479   0              0.010028396    198.76642      0              19195438       1.1965779e-13  0              2.994519     
    700000   7695           200            200            0.0023346279  -0.0016751204   0              0.0086790042   9.6410953      0              931067.98      1.1965779e-13  0              2.9949274    
    800000   7695           200            200            0.002842042   -0.0016816405   0              0.010207767    0.52276336     0              50484.744      1.1965779e-13  0              2.99449      
    900000   7695           200            200            0.0026927019  -0.0016940374   0              0.0097721433   0.46366562     0              44777.507      1.1965779e-13  0              2.9946074    
   1000000   7695           200            200            0.0026609113  -0.0016909001   0              0.0096736339   0.0034762325   0              335.70966      1.1965779e-13  0              2.994636     
   1100000   7695           200            200            0.0026796449  -0.0016926781   0              0.0097316127   0.0079526464   0              768.00966      1.1965779e-13  0              2.9946198    
   1200000   7695           200            200            0.0026846916  -0.0016931708   0              0.0097472457   0.00016271518  0              15.713867      1.1965779e-13  0              2.9946153    
   1300000   7695           200            200            0.0026824322  -0.0016929596   0              0.0097402562   0.00012870131  0              12.429052      1.1965779e-13  0              2.9946173    
   1400000   7695           200            200            0.0026816304  -0.0016928818   0              0.0097377731   5.4283314e-06  0              0.52422939     1.1965779e-13  0              2.994618     
   1500000   7695           200            200            0.0026818921  -0.0016929061   0              0.0097385823   1.9740017e-06  0              0.19063496     1.1965779e-13  0              2.9946178    
   1600000   7695           200            200            0.0026820143  -0.0016929179   0              0.0097389607   1.5191205e-07  0              0.014670578    1.1965779e-13  0              2.9946176    
   1700000   7695           200            200            0.0026819855  -0.0016929153   0              0.0097388719   2.8415836e-08  0              0.002744198    1.1965779e-13  0              2.9946177    
   1800000   7695           200            200            0.0026819675  -0.0016929136   0              0.0097388161   3.7982153e-09  0              0.00036680445  1.1965779e-13  0              2.9946177    
   1900000   7695           200            200            0.0026819704  -0.0016929138   0              0.0097388251   3.773708e-10   0              3.6443771e-05  1.1965779e-13  0              2.9946177    
   2000000   7695           200            200            0.002681973   -0.0016929141   0              0.0097388331   8.7547195e-11  0              8.4546815e-06  1.1965779e-13  0              2.9946177    
   2100000   7695           200            200            0.0026819728  -0.001692914    0              0.0097388323   4.4862199e-12  0              4.3324701e-07  1.1965779e-13  0              2.9946177    
   2200000   7695           200            200            0.0026819724  -0.001692914    0              0.0097388312   1.8930948e-12  0              1.8282155e-07  1.1965779e-13  0              2.9946177    
   2300000   7695           200            200            0.0026819724  -0.001692914    0              0.0097388312   4.5085554e-14  0              4.3540401e-09  1.1965779e-13  0              2.9946177    
   2400000   7695           200            200            0.0026819725  -0.001692914    0              0.0097388314   3.8741319e-14  0              3.7413592e-09  1.1965779e-13  0              2.9946177    
   2500000   7695           200            200            0.0026819725  -0.001692914    0              0.0097388314   3.4243201e-16  0              3.3069633e-11  1.1965779e-13  0              2.9946177    
   2600000   7695           200            200            0.0026819725  -0.001692914    0              0.0097388314   7.5454737e-16  0              7.2868784e-11  1.1965779e-13  0              2.9946177    
   2700000   7695           200            200            0.0026819725  -0.001692914    0              0.0097388314   2.7574114e-18  0              2.6629106e-13  1.1965779e-13  0              2.9946177    
   2800000   7695           200            200            0.0026819725  -0.001692914    0              0.0097388314   1.2634974e-17  0              1.2201954e-12  1.1965779e-13  0              2.9946177    
   2900000   7695           200            200            0.0026819725  -0.001692914    0              0.0097388314   1.2473971e-18  0              1.2046468e-13  1.1965779e-13  0              2.9946177    
   3000000   7695           200            200            0.0026819725  -0.001692914    0              0.0097388314   1.8983018e-18  0              1.833244e-13   1.1965779e-13  0              2.9946177    
Loop time of 303.123 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8550975.163 ns/day, 0.000 hours/ns, 9896.962 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.145     | 39.192     | 69.137     | 443.8 | 12.93
Neigh   | 4.7369     | 4.8207     | 4.907      |   3.4 |  1.59
Comm    | 20.147     | 41.243     | 83.854     | 388.8 | 13.61
Output  | 0.27266    | 0.27298    | 0.27336    |   0.1 |  0.09
Modify  | 109.57     | 160.43     | 179.12     | 232.3 | 52.93
Other   |            | 57.17      |            |       | 18.86

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         327.25 ave         655 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1309
Ave neighs/atom = 0.52339064
Neighbor list builds = 164
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 14

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.14                                                               
Lattice spacing in x,y,z = 5.14 5.14 5.14

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3855 ${n1e1} -100 100 -100 100 units box
region box block -3855 3855 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3855 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3855 3855 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3855 -100 -100) to (3855 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3855 -100 -100) to (3855 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3855 -100 -100) to (3855 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_14_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 4975 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 99.7 | 99.7 | 99.71 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7710           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7710           200            200            0.0026253632   1.5715855e-35  0              0.0078760897   581141.15      0              5.6122453e+10  1.1965779e-13  0              3.3295832    
    200000   7710           200            200            0.00090621319 -2.5145228e-34  0              0.0027186396   135932.06      0              1.3127346e+10  1.1965779e-13  0              3.0794289    
    300000   7710           200            200            2.3343171e-05 -4.1908654e-35  0              7.0029513e-05  195.84571      0              18913376       1.1965779e-13  0              3.0448999    
    400000   7710           200            200            6.8093917e-05  6.7054545e-34  0              0.00020428175  1594.1594      0              1.5395251e+08  1.1965779e-13  0              3.00467      
    500000   7710           200            200            0.014024467    0.020678731    0              0.021394669    37.807299      0              3651158.3      1.1965779e-13  0              2.9919946    
    600000   7710           200            200            0.0069844284   0.012053677    0              0.0088996081   191.57023      0              18500481       1.1965779e-13  0              2.994788     
    700000   7710           200            200            0.007044       0.011653393    0              0.0094786071   25.8425        0              2495683.7      1.1965779e-13  0              2.9946492    
    800000   7710           200            200            0.0072676042   0.011845919    0              0.0099568941   2.77822        0              268300.6       1.1965779e-13  0              2.9945079    
    900000   7710           200            200            0.0071100747   0.011759523    0              0.0095707009   0.1607244      0              15521.612      1.1965779e-13  0              2.9946169    
   1000000   7710           200            200            0.0071976324   0.011806305    0              0.0097865923   0.0019028648   0              183.76506      1.1965779e-13  0              2.9945564    
   1100000   7710           200            200            0.0071607565   0.011786776    0              0.0096954939   0.00047138251  0              45.522749      1.1965779e-13  0              2.9945815    
   1200000   7710           200            200            0.0071735467   0.01179347     0              0.0097271701   0.00041457947  0              40.037118      1.1965779e-13  0              2.9945728    
   1300000   7710           200            200            0.0071698617   0.011791597    0              0.0097179881   0.00011756867  0              11.353941      1.1965779e-13  0              2.9945753    
   1400000   7710           200            200            0.0071706399   0.011791986    0              0.0097199341   2.1152957e-05  0              2.0428012      1.1965779e-13  0              2.9945748    
   1500000   7710           200            200            0.0071706099   0.011791976    0              0.0097198543   2.7318673e-06  0              0.26382419     1.1965779e-13  0              2.9945748    
   1600000   7710           200            200            0.0071705253   0.01179193     0              0.0097196459   2.4926203e-07  0              0.024071943    1.1965779e-13  0              2.9945749    
   1700000   7710           200            200            0.0071705867   0.011791962    0              0.0097197978   1.3285221e-08  0              0.0012829916   1.1965779e-13  0              2.9945749    
   1800000   7710           200            200            0.0071705565   0.011791947    0              0.0097197231   1.1527539e-10  0              1.1132472e-05  1.1965779e-13  0              2.9945749    
   1900000   7710           200            200            0.0071705687   0.011791953    0              0.0097197532   6.8444589e-11  0              6.6098885e-06  1.1965779e-13  0              2.9945749    
   2000000   7710           200            200            0.0071705645   0.011791951    0              0.0097197429   4.9729882e-11  0              4.8025561e-06  1.1965779e-13  0              2.9945749    
   2100000   7710           200            200            0.0071705657   0.011791951    0              0.0097197458   1.3404577e-11  0              1.2945181e-06  1.1965779e-13  0              2.9945749    
   2200000   7710           200            200            0.0071705655   0.011791951    0              0.0097197452   2.3367822e-12  0              2.256697e-07   1.1965779e-13  0              2.9945749    
   2300000   7710           200            200            0.0071705655   0.011791951    0              0.0097197452   2.9372908e-13  0              2.8366252e-08  1.1965779e-13  0              2.9945749    
   2400000   7710           200            200            0.0071705655   0.011791951    0              0.0097197453   2.5923708e-14  0              2.5035261e-09  1.1965779e-13  0              2.9945749    
   2500000   7710           200            200            0.0071705655   0.011791951    0              0.0097197453   1.317523e-15   0              1.2723694e-10  1.1965779e-13  0              2.9945749    
   2600000   7710           200            200            0.0071705655   0.011791951    0              0.0097197453   3.0470893e-18  0              2.9426608e-13  1.1965779e-13  0              2.9945749    
   2700000   7710           200            200            0.0071705655   0.011791951    0              0.0097197453   4.5732174e-18  0              4.416486e-13   1.1965779e-13  0              2.9945749    
   2800000   7710           200            200            0.0071705655   0.011791951    0              0.0097197453   1.4632769e-18  0              1.413128e-13   1.1965779e-13  0              2.9945749    
   2900000   7710           200            200            0.0071705655   0.011791951    0              0.0097197453   3.4740687e-18  0              3.3550069e-13  1.1965779e-13  0              2.9945749    
   3000000   7710           200            200            0.0071705655   0.011791951    0              0.0097197453   1.9732387e-18  0              1.9056127e-13  1.1965779e-13  0              2.9945749    
Loop time of 303.821 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8531330.641 ns/day, 0.000 hours/ns, 9874.225 timesteps/s
99.9% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.466     | 38.784     | 67.761     | 437.0 | 12.77
Neigh   | 4.7583     | 4.8471     | 4.9384     |   3.7 |  1.60
Comm    | 19.497     | 25.761     | 31.094     |  96.2 |  8.48
Output  | 0.27157    | 0.27191    | 0.27229    |   0.1 |  0.09
Modify  | 173.21     | 177.28     | 181.12     |  24.4 | 58.35
Other   |            | 56.88      |            |       | 18.72

Nlocal:         625.25 ave         877 max         374 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         327.25 ave         655 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1309
Ave neighs/atom = 0.52339064
Neighbor list builds = 164
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 15

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.15                                                               
Lattice spacing in x,y,z = 5.15 5.15 5.15

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3862.5 ${n1e1} -100 100 -100 100 units box
region box block -3862.5 3862.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3862.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3862.5 3862.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3862.5 -100 -100) to (3862.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1499 atoms
  using lattice units in orthogonal box = (-3862.5 -100 -100) to (3862.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3862.5 -100 -100) to (3862.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1499 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1499 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1499 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_15_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 4984 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 99.83 | 99.84 | 99.85 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7725           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7725           200            200            0.0026202435   4.1828197e-35  0              0.0078607305   581132.73      0              5.6234108e+10  1.1965779e-13  0              3.3295981    
    200000   7725           200            200            0.00090434237 -8.3654863e-35  0              0.0027130271   135905.03      0              1.3151037e+10  1.1965779e-13  0              3.0794688    
    300000   7725           200            200            2.3173464e-05  2.5540954e-39  0              6.9520393e-05  193.80122      0              18753442       1.1965779e-13  0              3.0449118    
    400000   7725           200            200            6.7376176e-05 -4.1826981e-35  0              0.00020212853  1568.0981      0              1.5173917e+08  1.1965779e-13  0              3.0047085    
    500000   7725           200            200            0.0052631454  -0.0056631876   0              0.021452624    21.517295      0              2082150.7      1.1965779e-13  0              2.991991     
    600000   7725           200            200            0.0022594139  -0.0026395106   0              0.0094177524   200.11489      0              19364393       1.1965779e-13  0              2.9946615    
    700000   7725           200            200            0.0023901074  -0.0023607298   0              0.009531052    26.342406      0              2549059.1      1.1965779e-13  0              2.9946559    
    800000   7725           200            200            0.0024248395  -0.0024384697   0              0.0097129882   3.6033347      0              348681.64      1.1965779e-13  0              2.9945964    
    900000   7725           200            200            0.0024252293  -0.0024376777   0              0.0097133657   0.48492733     0              46924.66       1.1965779e-13  0              2.9945998    
   1000000   7725           200            200            0.0024175818  -0.0024364318   0              0.0096891772   0.063854234    0              6178.9428      1.1965779e-13  0              2.9946051    
   1100000   7725           200            200            0.0024234262  -0.0024375135   0              0.0097077921   0.0082321166   0              796.59208      1.1965779e-13  0              2.9946005    
   1200000   7725           200            200            0.0024202156  -0.0024368977   0              0.0096975445   0.0010360061   0              100.25056      1.1965779e-13  0              2.9946031    
   1300000   7725           200            200            0.0024217768  -0.0024372028   0              0.0097025333   0.00012721552  0              12.310184      1.1965779e-13  0              2.9946018    
   1400000   7725           200            200            0.0024210698  -0.0024370631   0              0.0097002724   1.5195054e-05  0              1.4703703      1.1965779e-13  0              2.9946024    
   1500000   7725           200            200            0.0024213758  -0.0024371241   0              0.0097012514   1.7596377e-06  0              0.17027376     1.1965779e-13  0              2.9946022    
   1600000   7725           200            200            0.0024212476  -0.0024370984   0              0.0097008412   1.965207e-07   0              0.019016596    1.1965779e-13  0              2.9946023    
   1700000   7725           200            200            0.0024213     -0.0024371089   0              0.0097010088   2.1007884e-08  0              0.0020328568   1.1965779e-13  0              2.9946022    
   1800000   7725           200            200            0.002421279   -0.0024371047   0              0.0097009417   2.1246298e-09  0              0.00020559273  1.1965779e-13  0              2.9946023    
   1900000   7725           200            200            0.0024212872  -0.0024371064   0              0.0097009681   1.9950511e-10  0              1.9305386e-05  1.1965779e-13  0              2.9946023    
   2000000   7725           200            200            0.002421284   -0.0024371057   0              0.0097009578   1.6821756e-11  0              1.6277803e-06  1.1965779e-13  0              2.9946023    
   2100000   7725           200            200            0.0024212853  -0.002437106    0              0.0097009618   1.190196e-12   0              1.1517095e-07  1.1965779e-13  0              2.9946023    
   2200000   7725           200            200            0.0024212848  -0.0024371059   0              0.0097009603   5.9357299e-14  0              5.7437907e-09  1.1965779e-13  0              2.9946023    
   2300000   7725           200            200            0.002421285   -0.0024371059   0              0.0097009608   9.2935548e-16  0              8.9930361e-11  1.1965779e-13  0              2.9946023    
   2400000   7725           200            200            0.0024212849  -0.0024371059   0              0.0097009606   9.4993759e-17  0              9.1922017e-12  1.1965779e-13  0              2.9946023    
   2500000   7725           200            200            0.0024212849  -0.0024371059   0              0.0097009607   1.4954479e-16  0              1.4470907e-11  1.1965779e-13  0              2.9946023    
   2600000   7725           200            200            0.0024212849  -0.0024371059   0              0.0097009607   3.5426306e-17  0              3.4280752e-12  1.1965779e-13  0              2.9946023    
   2700000   7725           200            200            0.0024212849  -0.0024371059   0              0.0097009607   1.440888e-17   0              1.3942951e-12  1.1965779e-13  0              2.9946023    
   2800000   7725           200            200            0.0024212849  -0.0024371059   0              0.0097009607   4.4725981e-18  0              4.327971e-13   1.1965779e-13  0              2.9946023    
   2900000   7725           200            200            0.0024212849  -0.0024371059   0              0.0097009607   8.3833454e-19  0              8.1122595e-14  1.1965779e-13  0              2.9946023    
   3000000   7725           200            200            0.0024212849  -0.0024371059   0              0.0097009607   2.3135752e-18  0              2.2387628e-13  1.1965779e-13  0              2.9946023    
Loop time of 300.205 on 4 procs for 3000000 steps with 2500 atoms

Performance: 8634094.407 ns/day, 0.000 hours/ns, 9993.165 timesteps/s
99.9% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.798     | 37.717     | 65.389     | 436.1 | 12.56
Neigh   | 4.7242     | 4.8149     | 4.9076     |   3.7 |  1.60
Comm    | 27.89      | 53.981     | 81.15      | 349.9 | 17.98
Output  | 0.26909    | 0.26941    | 0.26976    |   0.1 |  0.09
Modify  | 109.48     | 145.89     | 180.88     | 288.2 | 48.60
Other   |            | 57.53      |            |       | 19.16

Nlocal:            625 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:            1.5 ave           4 max           0 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         325.75 ave         652 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1303
Ave neighs/atom = 0.5212
Neighbor list builds = 164
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 16

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.16                                                               
Lattice spacing in x,y,z = 5.16 5.16 5.16

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3870 ${n1e1} -100 100 -100 100 units box
region box block -3870 3870 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3870 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3870 3870 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3870 -100 -100) to (3870 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3870 -100 -100) to (3870 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3870 -100 -100) to (3870 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_16_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 4994 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 99.98 | 100 | 100 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7740           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7740           200            200            0.0026152269   2.2178585e-40  0              0.0078456808   581153.29      0              5.6123625e+10  1.1965779e-13  0              3.3295811    
    200000   7740           200            200            0.00090244837 -2.6091447e-36  0              0.0027073451   135869.38      0              1.3121292e+10  1.1965779e-13  0              3.0795466    
    300000   7740           200            200            2.2983965e-05 -4.1745964e-35  0              6.8951895e-05  191.42796      0              18486743       1.1965779e-13  0              3.0449673    
    400000   7740           200            200            6.2967051e-05  2.0873803e-35  0              0.00018890115  1383.298       0              1.3358902e+08  1.1965779e-13  0              3.0049456    
    500000   7740           200            200            0.0085000705   0.004168151    0              0.02133206     7.0637011      0              682161.69      1.1965779e-13  0              2.9921082    
    600000   7740           200            200            0.0028137294   0.0013629714   0              0.0070782168   102.23876      0              9873488.1      1.1965779e-13  0              2.9954831    
    700000   7740           200            200            0.0034004519   0.001888819    0              0.0083125366   0.79534639     0              76808.862      1.1965779e-13  0              2.9951124    
    800000   7740           200            200            0.003783712    0.0019485748   0              0.0094025614   2.6296247      0              253950.33      1.1965779e-13  0              2.9948146    
    900000   7740           200            200            0.0038977758   0.0019636266   0              0.0097297009   0.46348588     0              44760.149      1.1965779e-13  0              2.9947292    
   1000000   7740           200            200            0.0039027024   0.0019641443   0              0.009743963    0.015116763    0              1459.8687      1.1965779e-13  0              2.9947262    
   1100000   7740           200            200            0.0038898503   0.0019624476   0              0.0097071033   0.00089082898  0              86.029887      1.1965779e-13  0              2.9947361    
   1200000   7740           200            200            0.0038827338   0.00196152     0              0.0096866813   0.00099870843  0              96.448112      1.1965779e-13  0              2.9947415    
   1300000   7740           200            200            0.0038808815   0.0019612823   0              0.0096813621   0.00014160232  0              13.674938      1.1965779e-13  0              2.9947428    
   1400000   7740           200            200            0.0038809075   0.0019612879   0              0.0096814346   3.0098717e-06  0              0.29067186     1.1965779e-13  0              2.9947428    
   1500000   7740           200            200            0.0038811704   0.0019613228   0              0.0096821884   5.3359635e-07  0              0.051530916    1.1965779e-13  0              2.9947426    
   1600000   7740           200            200            0.0038812994   0.0019613396   0              0.0096825585   3.6245327e-07  0              0.035003142    1.1965779e-13  0              2.9947425    
   1700000   7740           200            200            0.0038813289   0.0019613434   0              0.0096826433   4.1967928e-08  0              0.0040529621   1.1965779e-13  0              2.9947425    
   1800000   7740           200            200            0.0038813264   0.001961343    0              0.0096826362   4.8586844e-10  0              4.6921696e-05  1.1965779e-13  0              2.9947425    
   1900000   7740           200            200            0.0038813211   0.0019613423   0              0.0096826211   2.7286209e-10  0              2.6351067e-05  1.1965779e-13  0              2.9947425    
   2000000   7740           200            200            0.0038813188   0.001961342    0              0.0096826145   1.2759457e-10  0              1.232217e-05   1.1965779e-13  0              2.9947425    
   2100000   7740           200            200            0.0038813184   0.001961342    0              0.0096826132   1.2000885e-11  0              1.1589596e-06  1.1965779e-13  0              2.9947425    
   2200000   7740           200            200            0.0038813185   0.001961342    0              0.0096826134   4.9688774e-14  0              4.7985861e-09  1.1965779e-13  0              2.9947425    
   2300000   7740           200            200            0.0038813186   0.001961342    0              0.0096826137   1.2600826e-13  0              1.2168976e-08  1.1965779e-13  0              2.9947425    
   2400000   7740           200            200            0.0038813186   0.001961342    0              0.0096826138   4.363735e-14   0              4.214183e-09   1.1965779e-13  0              2.9947425    
   2500000   7740           200            200            0.0038813186   0.001961342    0              0.0096826138   3.3200563e-15  0              3.2062727e-10  1.1965779e-13  0              2.9947425    
   2600000   7740           200            200            0.0038813186   0.001961342    0              0.0096826138   3.325075e-19   0              3.2111194e-14  1.1965779e-13  0              2.9947425    
   2700000   7740           200            200            0.0038813186   0.001961342    0              0.0096826138   4.7661002e-17  0              4.6027584e-12  1.1965779e-13  0              2.9947425    
   2800000   7740           200            200            0.0038813186   0.001961342    0              0.0096826138   1.3560157e-17  0              1.3095429e-12  1.1965779e-13  0              2.9947425    
   2900000   7740           200            200            0.0038813186   0.001961342    0              0.0096826138   3.8412611e-18  0              3.709615e-13   1.1965779e-13  0              2.9947425    
   3000000   7740           200            200            0.0038813186   0.001961342    0              0.0096826138   1.1517054e-18  0              1.1122346e-13  1.1965779e-13  0              2.9947425    
Loop time of 307.276 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8435411.873 ns/day, 0.000 hours/ns, 9763.208 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.291     | 38.192     | 65.165     | 434.4 | 12.43
Neigh   | 4.8025     | 4.8894     | 4.9794     |   3.6 |  1.59
Comm    | 19.912     | 41.259     | 82.085     | 374.5 | 13.43
Output  | 0.27374    | 0.27409    | 0.27448    |   0.1 |  0.09
Modify  | 112.87     | 164.12     | 183.96     | 232.3 | 53.41
Other   |            | 58.54      |            |       | 19.05

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         325.75 ave         652 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1303
Ave neighs/atom = 0.5209916
Neighbor list builds = 164
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 17

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.17                                                               
Lattice spacing in x,y,z = 5.17 5.17 5.17

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3877.5 ${n1e1} -100 100 -100 100 units box
region box block -3877.5 3877.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3877.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3877.5 3877.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3877.5 -100 -100) to (3877.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3877.5 -100 -100) to (3877.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3877.5 -100 -100) to (3877.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_17_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5004 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 100.2 | 100.2 | 100.2 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7755           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7755           200            200            0.0026101275   2.0832983e-35  0              0.0078303824   581132.57      0              5.6121624e+10  1.1965779e-13  0              3.3296491    
    200000   7755           200            200            0.00090016655  1.2499794e-34  0              0.0027004996   135737.54      0              1.310856e+10   1.1965779e-13  0              3.0797615    
    300000   7755           200            200            2.1958196e-05  2.6041072e-36  0              6.5874588e-05  175.70005      0              16967854       1.1965779e-13  0              3.0450429    
    400000   7755           200            200            6.6594231e-05 -1.0416392e-34  0              0.00019978269  1544.873       0              1.4919278e+08  1.1965779e-13  0              3.0048472    
    500000   7755           200            200            0.0077474152   0.0027498382   0              0.020492407    215.92641      0              20852627       1.1965779e-13  0              2.9922734    
    600000   7755           200            200            0.0021443847  -0.00033727341  0              0.0067704275   71.955051      0              6948903.8      1.1965779e-13  0              2.9955511    
    700000   7755           200            200            0.0038821568   0.00062403112  0              0.011022439    2.2636877      0              218610.76      1.1965779e-13  0              2.9943496    
    800000   7755           200            200            0.0032934509   0.00070589655  0              0.0091744561   0.17642688     0              17038.045      1.1965779e-13  0              2.9948416    
    900000   7755           200            200            0.0035059947   0.00071298967  0              0.0098049944   0.20387224     0              19688.522      1.1965779e-13  0              2.9946669    
   1000000   7755           200            200            0.0034479324   0.00070546247  0              0.0096383349   0.05641149     0              5447.8179      1.1965779e-13  0              2.9947131    
   1100000   7755           200            200            0.0034559322   0.00070656091  0              0.0096612358   0.0088247576   0              852.23192      1.1965779e-13  0              2.9947065    
   1200000   7755           200            200            0.0034585686   0.00070687327  0              0.0096688324   0.00084724891  0              81.821235      1.1965779e-13  0              2.9947045    
   1300000   7755           200            200            0.0034557776   0.00070652263  0              0.0096608101   3.9371564e-05  0              3.8022238      1.1965779e-13  0              2.9947067    
   1400000   7755           200            200            0.0034572393   0.00070670886  0              0.0096650089   2.5309786e-08  0              0.002444238    1.1965779e-13  0              2.9947055    
   1500000   7755           200            200            0.0034566643   0.00070663496  0              0.0096633578   5.5164361e-07  0              0.053273792    1.1965779e-13  0              2.994706     
   1600000   7755           200            200            0.0034568414   0.00070665795  0              0.0096638662   2.5492721e-07  0              0.024619045    1.1965779e-13  0              2.9947059    
   1700000   7755           200            200            0.0034568036   0.00070665295  0              0.009663758    5.2200298e-08  0              0.0050411312   1.1965779e-13  0              2.9947059    
   1800000   7755           200            200            0.0034568043   0.00070665311  0              0.0096637599   6.4997063e-09  0              0.00062769512  1.1965779e-13  0              2.9947059    
   1900000   7755           200            200            0.003456809    0.00070665368  0              0.0096637732   4.6927673e-10  0              4.5319388e-05  1.1965779e-13  0              2.9947059    
   2000000   7755           200            200            0.0034568059   0.00070665329  0              0.0096637643   1.0414604e-11  0              1.0057679e-06  1.1965779e-13  0              2.9947059    
   2100000   7755           200            200            0.0034568073   0.00070665347  0              0.0096637683   6.7419549e-13  0              6.5108975e-08  1.1965779e-13  0              2.9947059    
   2200000   7755           200            200            0.0034568068   0.0007066534   0              0.0096637669   9.4000466e-13  0              9.0778922e-08  1.1965779e-13  0              2.9947059    
   2300000   7755           200            200            0.0034568069   0.00070665342  0              0.0096637673   2.7099115e-13  0              2.6170386e-08  1.1965779e-13  0              2.9947059    
   2400000   7755           200            200            0.0034568069   0.00070665342  0              0.0096637672   4.323488e-14   0              4.1753153e-09  1.1965779e-13  0              2.9947059    
   2500000   7755           200            200            0.0034568069   0.00070665342  0              0.0096637672   4.21362e-15    0              4.0692126e-10  1.1965779e-13  0              2.9947059    
   2600000   7755           200            200            0.0034568069   0.00070665342  0              0.0096637672   2.2013027e-16  0              2.1258606e-11  1.1965779e-13  0              2.9947059    
   2700000   7755           200            200            0.0034568069   0.00070665342  0              0.0096637672   7.0013461e-20  0              6.761399e-15   1.1965779e-13  0              2.9947059    
   2800000   7755           200            200            0.0034568069   0.00070665342  0              0.0096637672   4.8879134e-18  0              4.7203969e-13  1.1965779e-13  0              2.9947059    
   2900000   7755           200            200            0.0034568069   0.00070665342  0              0.0096637672   1.5949126e-19  0              1.5402524e-14  1.1965779e-13  0              2.9947059    
   3000000   7755           200            200            0.0034568069   0.00070665342  0              0.0096637672   6.473512e-18   0              6.2516546e-13  1.1965779e-13  0              2.9947059    
Loop time of 303.354 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8544486.758 ns/day, 0.000 hours/ns, 9889.452 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.11      | 38.867     | 66.517     | 441.5 | 12.81
Neigh   | 4.8311     | 4.9253     | 5.0226     |   3.8 |  1.62
Comm    | 20.54      | 40.271     | 81.132     | 376.6 | 13.28
Output  | 0.27402    | 0.27434    | 0.27471    |   0.1 |  0.09
Modify  | 111.6      | 161.1      | 181.52     | 226.3 | 53.11
Other   |            | 57.91      |            |       | 19.09

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         326.25 ave         653 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1305
Ave neighs/atom = 0.52179128
Neighbor list builds = 164
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 18

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.18                                                               
Lattice spacing in x,y,z = 5.18 5.18 5.18

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3885 ${n1e1} -100 100 -100 100 units box
region box block -3885 3885 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3885 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3885 3885 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3885 -100 -100) to (3885 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3885 -100 -100) to (3885 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3885 -100 -100) to (3885 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_18_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5013 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 100.4 | 100.4 | 100.4 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7770           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7770           200            200            0.0026051309   1.0725076e-40  0              0.0078153926   581144.24      0              5.6122751e+10  1.1965779e-13  0              3.3296578    
    200000   7770           200            200            0.00089837045  3.1189094e-35  0              0.0026951114   135721.64      0              1.3107025e+10  1.1965779e-13  0              3.0798192    
    300000   7770           200            200            2.2098247e-05  7.9607142e-41  0              6.6294741e-05  178.57467      0              17245464       1.1965779e-13  0              3.0450793    
    400000   7770           200            200            7.0824963e-05  2.599088e-36   0              0.00021247489  1743.3198      0              1.6835734e+08  1.1965779e-13  0              3.0046688    
    500000   7770           200            200            0.0080458508   0.005124525    0              0.019013027    515.4083       0              49774444       1.1965779e-13  0              2.9925575    
    600000   7770           200            200            0.0038873091   0.005335154    0              0.0063267732   25.878415      0              2499152.1      1.1965779e-13  0              2.9956971    
    700000   7770           200            200            0.0055172892   0.0054967282   0              0.011055139    0.10904228     0              10530.523      1.1965779e-13  0              2.9943333    
    800000   7770           200            200            0.0048908944   0.0055233328   0              0.0091493504   0.041009059    0              3960.3614      1.1965779e-13  0              2.9948441    
    900000   7770           200            200            0.0051263799   0.0055514683   0              0.0098276715   0.011811924    0              1140.711       1.1965779e-13  0              2.9946553    
   1000000   7770           200            200            0.0050402037   0.0055416671   0              0.009578944    0.0027680641   0              267.31982      1.1965779e-13  0              2.994724     
   1100000   7770           200            200            0.0050714761   0.0055452946   0              0.0096691337   0.00057842073  0              55.859734      1.1965779e-13  0              2.994699     
   1200000   7770           200            200            0.0050601382   0.0055439871   0              0.0096364274   0.00011099429  0              10.719034      1.1965779e-13  0              2.994708     
   1300000   7770           200            200            0.0050642342   0.005544461    0              0.0096482415   2.0128109e-05  0              1.9438287      1.1965779e-13  0              2.9947048    
   1400000   7770           200            200            0.0050627585   0.0055442903   0              0.0096439851   3.4956878e-06  0              0.3375885      1.1965779e-13  0              2.9947059    
   1500000   7770           200            200            0.0050632885   0.0055443517   0              0.0096455137   5.8739125e-07  0              0.056726042    1.1965779e-13  0              2.9947055    
   1600000   7770           200            200            0.0050630987   0.0055443297   0              0.0096449665   9.6107047e-08  0              0.0092813306   1.1965779e-13  0              2.9947057    
   1700000   7770           200            200            0.0050631664   0.0055443375   0              0.0096451617   1.5384639e-08  0              0.0014857383   1.1965779e-13  0              2.9947056    
   1800000   7770           200            200            0.0050631423   0.0055443347   0              0.0096450923   2.417748e-09   0              0.00023348879  1.1965779e-13  0              2.9947056    
   1900000   7770           200            200            0.0050631509   0.0055443357   0              0.0096451169   3.740036e-10   0              3.6118591e-05  1.1965779e-13  0              2.9947056    
   2000000   7770           200            200            0.0050631479   0.0055443354   0              0.0096451082   5.70694e-11    0              5.5113542e-06  1.1965779e-13  0              2.9947056    
   2100000   7770           200            200            0.0050631489   0.0055443355   0              0.0096451113   8.6028654e-12  0              8.3080316e-07  1.1965779e-13  0              2.9947056    
   2200000   7770           200            200            0.0050631486   0.0055443355   0              0.0096451102   1.2821789e-12  0              1.2382366e-07  1.1965779e-13  0              2.9947056    
   2300000   7770           200            200            0.0050631487   0.0055443355   0              0.0096451106   1.8922774e-13  0              1.827426e-08   1.1965779e-13  0              2.9947056    
   2400000   7770           200            200            0.0050631486   0.0055443355   0              0.0096451104   2.7712375e-14  0              2.6762628e-09  1.1965779e-13  0              2.9947056    
   2500000   7770           200            200            0.0050631486   0.0055443355   0              0.0096451105   3.9663854e-15  0              3.8304511e-10  1.1965779e-13  0              2.9947056    
   2600000   7770           200            200            0.0050631486   0.0055443355   0              0.0096451105   5.5783463e-16  0              5.3871676e-11  1.1965779e-13  0              2.9947056    
   2700000   7770           200            200            0.0050631486   0.0055443355   0              0.0096451105   8.0957215e-17  0              7.8182684e-12  1.1965779e-13  0              2.9947056    
   2800000   7770           200            200            0.0050631486   0.0055443355   0              0.0096451105   1.3462629e-17  0              1.3001244e-12  1.1965779e-13  0              2.9947056    
   2900000   7770           200            200            0.0050631486   0.0055443355   0              0.0096451105   5.5511966e-18  0              5.3609483e-13  1.1965779e-13  0              2.9947056    
   3000000   7770           200            200            0.0050631486   0.0055443355   0              0.0096451105   6.4686687e-19  0              6.2469772e-14  1.1965779e-13  0              2.9947056    
Loop time of 304.949 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8499781.151 ns/day, 0.000 hours/ns, 9837.710 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.427     | 38.733     | 67.89      | 438.9 | 12.70
Neigh   | 4.8136     | 4.9065     | 5.0014     |   3.8 |  1.61
Comm    | 20.06      | 41.117     | 83.167     | 384.6 | 13.48
Output  | 0.27698    | 0.27731    | 0.27767    |   0.1 |  0.09
Modify  | 111.4      | 162.21     | 182.24     | 231.3 | 53.19
Other   |            | 57.7       |            |       | 18.92

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         326.75 ave         654 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1307
Ave neighs/atom = 0.52259096
Neighbor list builds = 164
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 19

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.19                                                               
Lattice spacing in x,y,z = 5.19 5.19 5.19

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3892.5 ${n1e1} -100 100 -100 100 units box
region box block -3892.5 3892.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3892.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3892.5 3892.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3892.5 -100 -100) to (3892.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1499 atoms
  using lattice units in orthogonal box = (-3892.5 -100 -100) to (3892.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3892.5 -100 -100) to (3892.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1499 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1499 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1499 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_19_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5023 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 100.5 | 100.5 | 100.5 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7785           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7785           200            200            0.0026001094   5.1881474e-36  0              0.0078003282   581141         0              5.6234908e+10  1.1965779e-13  0              3.3296794    
    200000   7785           200            200            0.00089683946  4.4164841e-40  0              0.0026905184   135769.45      0              1.3137917e+10  1.1965779e-13  0              3.0797729    
    300000   7785           200            200            2.2523492e-05 -1.2451519e-34  0              6.7570476e-05  186.075        0              18005803       1.1965779e-13  0              3.0450709    
    400000   7785           200            200            7.0101718e-05  9.0150737e-41  0              0.00021030515  1715.9233      0              1.6604368e+08  1.1965779e-13  0              3.0046948    
    500000   7785           200            200            0.005975776   -0.0011175561   0              0.019044884    496.90073      0              48083282       1.1965779e-13  0              2.9925392    
    600000   7785           200            200            0.0016033907  -0.0014917499   0              0.006301922    23.94421       0              2316994.4      1.1965779e-13  0              2.9957035    
    700000   7785           200            200            0.0034260683  -0.00067911884  0              0.010957324    2.8286605      0              273719.22      1.1965779e-13  0              2.9943514    
    800000   7785           200            200            0.0028287382  -0.00074424792  0              0.0092304626   1.3333701      0              129025.39      1.1965779e-13  0              2.9948142    
    900000   7785           200            200            0.0029871307  -0.00073222007  0              0.0096936123   0.42397519     0              41026.542      1.1965779e-13  0              2.9946864    
   1000000   7785           200            200            0.0029680554  -0.00073342069  0              0.0096375868   0.063603594    0              6154.6892      1.1965779e-13  0              2.9947008    
   1100000   7785           200            200            0.0029587791  -0.00073410707  0              0.0096104444   0.0050074757   0              484.55527      1.1965779e-13  0              2.9947089    
   1200000   7785           200            200            0.0029672078  -0.00073350711  0              0.0096351304   0.00011009091  0              10.653098      1.1965779e-13  0              2.9947018    
   1300000   7785           200            200            0.0029631628  -0.00073379024  0              0.0096232787   8.7012331e-06  0              0.84198678     1.1965779e-13  0              2.9947052    
   1400000   7785           200            200            0.0029645693  -0.00073369257  0              0.0096274004   1.0691392e-05  0              1.0345673      1.1965779e-13  0              2.994704     
   1500000   7785           200            200            0.0029642305  -0.00073371568  0              0.0096264073   2.7487106e-06  0              0.26598276     1.1965779e-13  0              2.9947043    
   1600000   7785           200            200            0.0029642538  -0.00073371431  0              0.0096264758   3.6167379e-07  0              0.034997861    1.1965779e-13  0              2.9947043    
   1700000   7785           200            200            0.0029642849  -0.00073371205  0              0.0096265666   2.3871794e-08  0              0.0023099869   1.1965779e-13  0              2.9947043    
   1800000   7785           200            200            0.0029642622  -0.00073371366  0              0.0096265003   2.5694784e-10  0              2.4863911e-05  1.1965779e-13  0              2.9947043    
   1900000   7785           200            200            0.0029642723  -0.00073371295  0              0.0096265297   1.1578806e-10  0              1.1204391e-05  1.1965779e-13  0              2.9947043    
   2000000   7785           200            200            0.002964269   -0.00073371318  0              0.0096265202   7.9696519e-11  0              7.7119433e-06  1.1965779e-13  0              2.9947043    
   2100000   7785           200            200            0.0029642697  -0.00073371313  0              0.0096265222   1.7321354e-11  0              1.6761246e-06  1.1965779e-13  0              2.9947043    
   2200000   7785           200            200            0.0029642697  -0.00073371313  0              0.0096265222   1.9949578e-12  0              1.9304484e-07  1.1965779e-13  0              2.9947043    
   2300000   7785           200            200            0.0029642696  -0.00073371314  0              0.0096265219   1.0669832e-13  0              1.0324809e-08  1.1965779e-13  0              2.9947043    
   2400000   7785           200            200            0.0029642697  -0.00073371313  0              0.0096265221   2.3124381e-16  0              2.2376625e-11  1.1965779e-13  0              2.9947043    
   2500000   7785           200            200            0.0029642696  -0.00073371314  0              0.009626522    1.1421445e-15  0              1.1052118e-10  1.1965779e-13  0              2.9947043    
   2600000   7785           200            200            0.0029642696  -0.00073371313  0              0.0096265221   5.6008623e-16  0              5.4197514e-11  1.1965779e-13  0              2.9947043    
   2700000   7785           200            200            0.0029642696  -0.00073371313  0              0.0096265221   1.0206171e-16  0              9.8761417e-12  1.1965779e-13  0              2.9947043    
   2800000   7785           200            200            0.0029642696  -0.00073371313  0              0.0096265221   1.312771e-17   0              1.2703209e-12  1.1965779e-13  0              2.9947043    
   2900000   7785           200            200            0.0029642696  -0.00073371313  0              0.0096265221   2.7140609e-18  0              2.6262983e-13  1.1965779e-13  0              2.9947043    
   3000000   7785           200            200            0.0029642696  -0.00073371314  0              0.0096265221   8.5660797e-20  0              8.2890848e-15  1.1965779e-13  0              2.9947043    
Loop time of 299.793 on 4 procs for 3000000 steps with 2500 atoms

Performance: 8645979.924 ns/day, 0.000 hours/ns, 10006.921 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.671     | 37.981     | 65.163     | 440.2 | 12.67
Neigh   | 4.8299     | 4.9165     | 5.0056     |   3.5 |  1.64
Comm    | 26.722     | 54.24      | 80.809     | 355.5 | 18.09
Output  | 0.27169    | 0.27203    | 0.27241    |   0.1 |  0.09
Modify  | 110.44     | 145.42     | 180.71     | 284.5 | 48.51
Other   |            | 56.96      |            |       | 19.00

Nlocal:            625 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:            1.5 ave           4 max           0 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         327.25 ave         655 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1309
Ave neighs/atom = 0.5236
Neighbor list builds = 164
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 20

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.2                                                               
Lattice spacing in x,y,z = 5.2 5.2 5.2

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3900 ${n1e1} -100 100 -100 100 units box
region box block -3900 3900 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3900 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3900 3900 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3900 -100 -100) to (3900 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3900 -100 -100) to (3900 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3900 -100 -100) to (3900 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_20_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5033 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 100.7 | 100.7 | 100.7 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7800           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7800           200            200            0.0025948317   5.1781671e-36  0              0.0077844951   581059.98      0              5.6114614e+10  1.1965779e-13  0              3.3296547    
    200000   7800           200            200            0.00089229021 -1.0356249e-35  0              0.0026768706   135091.25      0              1.3046146e+10  1.1965779e-13  0              3.0804756    
    300000   7800           200            200            2.3979528e-05 -1.8641361e-34  0              7.1938584e-05  211.17311      0              20393587       1.1965779e-13  0              3.0449794    
    400000   7800           200            200            7.4113415e-05  2.0712959e-35  0              0.00022234025  1914.2548      0              1.8486503e+08  1.1965779e-13  0              3.0043626    
    500000   7800           200            200            0.00084795437  3.7282803e-34  0              0.0025438631   71.249793      0              6880795        1.1965779e-13  0              2.9977224    
    600000   7800           200            200            0.0024281657   8.2850851e-35  0              0.0072844971   60.523631      0              5844939.1      1.1965779e-13  0              2.9954684    
    700000   7800           200            200            0.0028514289   1.1391979e-34  0              0.0085542868   1.1156729      0              107743.71      1.1965779e-13  0              2.99494      
    800000   7800           200            200            0.0030700952  -6.2137823e-35  0              0.0092102855   0.063853608    0              6166.5244      1.1965779e-13  0              2.9946816    
    900000   7800           200            200            0.0031589528   1.5534634e-35  0              0.0094768584   0.098171879    0              9480.7374      1.1965779e-13  0              2.9945792    
   1000000   7800           200            200            0.0031903906   5.1783328e-36  0              0.0095711718   0.033013618    0              3188.2189      1.1965779e-13  0              2.9945435    
   1100000   7800           200            200            0.0032000281   5.1783404e-36  0              0.0096000844   0.0068789403   0              664.31882      1.1965779e-13  0              2.9945327    
   1200000   7800           200            200            0.0032024235  -2.5889054e-36  0              0.0096072705   0.0010659024   0              102.93722      1.1965779e-13  0              2.9945301    
   1300000   7800           200            200            0.0032027736   1.7699727e-40  0              0.0096083207   0.00012796208  0              12.357662      1.1965779e-13  0              2.9945297    
   1400000   7800           200            200            0.0032026916   1.7669996e-40  0              0.0096080748   1.1503441e-05  0              1.11092        1.1965779e-13  0              2.9945298    
   1500000   7800           200            200            0.0032025878   1.0356505e-35  0              0.0096077635   6.5823975e-07  0              0.063568084    1.1965779e-13  0              2.99453      
   1600000   7800           200            200            0.0032025274   5.1783408e-36  0              0.0096075821   1.0303576e-08  0              0.00099504564  1.1965779e-13  0              2.99453      
   1700000   7800           200            200            0.0032024997   1.7666332e-40  0              0.0096074991   1.5634113e-09  0              0.00015098308  1.1965779e-13  0              2.9945301    
   1800000   7800           200            200            0.0032024888  -1.0356151e-35  0              0.0096074663   1.6780153e-09  0              0.0001620507   1.1965779e-13  0              2.9945301    
   1900000   7800           200            200            0.003202485   -4.1425134e-35  0              0.0096074549   5.2460745e-10  0              5.0662832e-05  1.1965779e-13  0              2.9945301    
   2000000   7800           200            200            0.0032024838  -2.0712479e-35  0              0.0096074515   1.0530891e-10  0              1.0169981e-05  1.1965779e-13  0              2.9945301    
   2100000   7800           200            200            0.0032024836  -1.035631e-34   0              0.0096074507   1.5866105e-11  0              1.5322349e-06  1.1965779e-13  0              2.9945301    
   2200000   7800           200            200            0.0032024835  -2.2783903e-34  0              0.0096074506   1.8525414e-12  0              1.7890519e-07  1.1965779e-13  0              2.9945301    
   2300000   7800           200            200            0.0032024835  -4.1425134e-35  0              0.0096074506   1.6081864e-13  0              1.5530714e-08  1.1965779e-13  0              2.9945301    
   2400000   7800           200            200            0.0032024835   1.7694994e-40  0              0.0096074506   8.4832461e-15  0              8.1925119e-10  1.1965779e-13  0              2.9945301    
   2500000   7800           200            200            0.0032024836   2.0712832e-35  0              0.0096074507   1.0358453e-16  0              1.0003453e-11  1.1965779e-13  0              2.9945301    
   2600000   7800           200            200            0.0032024836   2.0712832e-35  0              0.0096074507   2.2253946e-17  0              2.1491269e-12  1.1965779e-13  0              2.9945301    
   2700000   7800           200            200            0.0032024836  -8.2850445e-35  0              0.0096074507   7.5852306e-18  0              7.3252728e-13  1.1965779e-13  0              2.9945301    
   2800000   7800           200            200            0.0032024836   8.2850801e-35  0              0.0096074507   3.2483958e-18  0              3.1370682e-13  1.1965779e-13  0              2.9945301    
   2900000   7800           200            200            0.0032024836   2.0712673e-34  0              0.0096074507   4.4322579e-19  0              4.2803575e-14  1.1965779e-13  0              2.9945301    
   3000000   7800           200            200            0.0032024836  -4.1425152e-35  0              0.0096074507   6.5275142e-18  0              6.303806e-13   1.1965779e-13  0              2.9945301    
Loop time of 299.952 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8641381.647 ns/day, 0.000 hours/ns, 10001.599 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.345     | 37.182     | 63.041     | 421.2 | 12.40
Neigh   | 4.7548     | 4.8444     | 4.9369     |   3.7 |  1.62
Comm    | 19.912     | 39.018     | 77.561     | 361.7 | 13.01
Output  | 0.26742    | 0.26775    | 0.26812    |   0.1 |  0.09
Modify  | 111.8      | 161.01     | 181.2      | 226.8 | 53.68
Other   |            | 57.63      |            |       | 19.21

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         317.25 ave         635 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1269
Ave neighs/atom = 0.50739704
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 21

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.21                                                               
Lattice spacing in x,y,z = 5.21 5.21 5.21

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3907.5 ${n1e1} -100 100 -100 100 units box
region box block -3907.5 3907.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3907.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3907.5 3907.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3907.5 -100 -100) to (3907.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3907.5 -100 -100) to (3907.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3907.5 -100 -100) to (3907.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_21_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5042 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 100.8 | 100.8 | 100.9 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7815           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7815           200            200            0.0025896194   2.067296e-35   0              0.0077688583   580969.55      0              5.6105881e+10  1.1965779e-13  0              3.3298179    
    200000   7815           200            200            0.0008921748   2.5841204e-36  0              0.0026765244   135478.06      0              1.3083502e+10  1.1965779e-13  0              3.0800176    
    300000   7815           200            200            2.0759354e-05  5.5755519e-40  0              6.2278062e-05  159.78078      0              15430484       1.1965779e-13  0              3.0450259    
    400000   7815           200            200            6.3968322e-05 -4.1344259e-35  0              0.00019190497  1452.0224      0              1.4022593e+08  1.1965779e-13  0              3.0049187    
    500000   7815           200            200            0.002115074   -0.014736829    0              0.021082051    41.753546      0              4032258.6      1.1965779e-13  0              2.9921085    
    600000   7815           200            200           -0.0001209893  -0.0089811062   0              0.0086181383   187.86265      0              18142430       1.1965779e-13  0              2.9949534    
    700000   7815           200            200            0.00045085327 -0.0080115139   0              0.0093640737   26.070241      0              2517677.3      1.1965779e-13  0              2.994765     
    800000   7815           200            200            0.00050570599 -0.0082676446   0              0.0097847626   3.0376303      0              293352.59      1.1965779e-13  0              2.9946382    
    900000   7815           200            200            0.00041550153 -0.0082222785   0              0.009468783    0.26909665     0              25987.428      1.1965779e-13  0              2.9947293    
   1000000   7815           200            200            0.00045670824 -0.0082770288   0              0.0096471535   0.016829472    0              1625.2699      1.1965779e-13  0              2.9946786    
   1100000   7815           200            200            0.00043773959 -0.0082523301   0              0.0095655489   0.00042575998  0              41.116852      1.1965779e-13  0              2.9947015    
   1200000   7815           200            200            0.00044542564 -0.0082622857   0              0.0095985626   9.2329974e-06  0              0.8916568      1.1965779e-13  0              2.9946923    
   1300000   7815           200            200            0.00044259965 -0.0082586616   0              0.0095864606   2.4099948e-05  0              2.3274005      1.1965779e-13  0              2.9946956    
   1400000   7815           200            200            0.00044353921 -0.0082598561   0              0.0095904738   9.1526891e-06  0              0.8839012      1.1965779e-13  0              2.9946945    
   1500000   7815           200            200            0.00044326282 -0.0082595093   0              0.0095892978   2.1159102e-06  0              0.20433946     1.1965779e-13  0              2.9946949    
   1600000   7815           200            200            0.00044332947 -0.0082595909   0              0.0095895793   3.7179965e-07  0              0.035905749    1.1965779e-13  0              2.9946948    
   1700000   7815           200            200            0.00044332011 -0.0082595806   0              0.0095895409   5.3106211e-08  0              0.0051286178   1.1965779e-13  0              2.9946948    
   1800000   7815           200            200            0.00044331767 -0.0082595768   0              0.0095895298   6.2413706e-09  0              0.0006027469   1.1965779e-13  0              2.9946948    
   1900000   7815           200            200            0.00044332064 -0.0082595809   0              0.0095895428   5.8544382e-10  0              5.6537973e-05  1.1965779e-13  0              2.9946948    
   2000000   7815           200            200            0.00044331889 -0.0082595785   0              0.0095895352   3.9366237e-11  0              3.8017094e-06  1.1965779e-13  0              2.9946948    
   2100000   7815           200            200            0.00044331971 -0.0082595796   0              0.0095895388   1.2694175e-12  0              1.2259125e-07  1.1965779e-13  0              2.9946948    
   2200000   7815           200            200            0.00044331937 -0.0082595792   0              0.0095895373   3.351118e-15   0              3.2362699e-10  1.1965779e-13  0              2.9946948    
   2300000   7815           200            200            0.0004433195  -0.0082595793   0              0.0095895378   3.7189894e-14  0              3.5915338e-09  1.1965779e-13  0              2.9946948    
   2400000   7815           200            200            0.00044331946 -0.0082595793   0              0.0095895377   1.6163204e-14  0              1.5609266e-09  1.1965779e-13  0              2.9946948    
   2500000   7815           200            200            0.00044331947 -0.0082595793   0              0.0095895377   3.9236688e-15  0              3.7891984e-10  1.1965779e-13  0              2.9946948    
   2600000   7815           200            200            0.00044331947 -0.0082595793   0              0.0095895377   7.2168391e-16  0              6.9695067e-11  1.1965779e-13  0              2.9946948    
   2700000   7815           200            200            0.00044331947 -0.0082595793   0              0.0095895377   1.0277518e-16  0              9.9252909e-12  1.1965779e-13  0              2.9946948    
   2800000   7815           200            200            0.00044331947 -0.0082595793   0              0.0095895377   1.3939918e-17  0              1.3462175e-12  1.1965779e-13  0              2.9946948    
   2900000   7815           200            200            0.00044331947 -0.0082595793   0              0.0095895377   2.234207e-18   0              2.1576372e-13  1.1965779e-13  0              2.9946948    
   3000000   7815           200            200            0.00044331946 -0.0082595793   0              0.0095895377   7.7277654e-19  0              7.4629227e-14  1.1965779e-13  0              2.9946948    
Loop time of 301.086 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8608848.673 ns/day, 0.000 hours/ns, 9963.945 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.06      | 38.065     | 64.98      | 434.3 | 12.64
Neigh   | 4.8633     | 4.958      | 5.0534     |   3.9 |  1.65
Comm    | 20.283     | 40.094     | 79.666     | 366.7 | 13.32
Output  | 0.2691     | 0.26943    | 0.2698     |   0.1 |  0.09
Modify  | 112.53     | 160.92     | 179.49     | 221.2 | 53.45
Other   |            | 56.78      |            |       | 18.86

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         325.75 ave         652 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1303
Ave neighs/atom = 0.5209916
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 22

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.22                                                               
Lattice spacing in x,y,z = 5.22 5.22 5.22

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3915 ${n1e1} -100 100 -100 100 units box
region box block -3915 3915 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3915 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3915 3915 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3915 -100 -100) to (3915 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3915 -100 -100) to (3915 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3915 -100 -100) to (3915 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_22_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5052 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 101 | 101 | 101 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7830           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7830           200            200            0.0025844917   2.0633351e-35  0              0.0077534751   580916.85      0              5.6100792e+10  1.1965779e-13  0              3.329834     
    200000   7830           200            200            0.00089027371 -5.1583131e-36  0              0.0026708211   135434.91      0              1.3079335e+10  1.1965779e-13  0              3.0799961    
    300000   7830           200            200            1.9911135e-05  2.0633322e-35  0              5.9733406e-05  147.78248      0              14271774       1.1965779e-13  0              3.0449753    
    400000   7830           200            200            6.1249985e-05  2.0633508e-35  0              0.00018374996  1341.4407      0              1.2954674e+08  1.1965779e-13  0              3.004988     
    500000   7830           200            200            0.0062814981  -0.0024630218   0              0.021307516    0.0049328206   0              476.3765       1.1965779e-13  0              2.9920398    
    600000   7830           200            200            0.0034307914  -0.0010465788   0              0.011338953    153.6192       0              14835443       1.1965779e-13  0              2.9941392    
    700000   7830           200            200            0.0027463573  -0.00081519251  0              0.0090542644   22.241167      0              2147892.7      1.1965779e-13  0              2.9947812    
    800000   7830           200            200            0.0028459497  -0.0008207176   0              0.0093585666   2.8371416      0              273990.83      1.1965779e-13  0              2.9946929    
    900000   7830           200            200            0.0029279204  -0.00082511618  0              0.0096088775   0.44907931     0              43368.865      1.1965779e-13  0              2.9946189    
   1000000   7830           200            200            0.0029353226  -0.000825458    0              0.0096314257   0.0061123455   0              590.28657      1.1965779e-13  0              2.994613     
   1100000   7830           200            200            0.00292134    -0.00082470205  0              0.0095887221   0.0037413883   0              361.31651      1.1965779e-13  0              2.994626     
   1200000   7830           200            200            0.002915041   -0.00082436682  0              0.0095694898   0.0011246485   0              108.6105       1.1965779e-13  0              2.9946317    
   1300000   7830           200            200            0.002914557   -0.00082434336  0              0.0095680144   1.9027883e-05  0              1.8375768      1.1965779e-13  0              2.9946321    
   1400000   7830           200            200            0.0029152245  -0.00082437985  0              0.0095700533   8.3154572e-06  0              0.80304734     1.1965779e-13  0              2.9946315    
   1500000   7830           200            200            0.0029155409  -0.00082439674  0              0.0095710193   2.7988129e-06  0              0.27028932     1.1965779e-13  0              2.9946312    
   1600000   7830           200            200            0.0029155698  -0.00082439817  0              0.0095711075   5.7664764e-08  0              0.0055688502   1.1965779e-13  0              2.9946312    
   1700000   7830           200            200            0.002915538   -0.00082439643  0              0.0095710104   1.8328446e-08  0              0.0017700301   1.1965779e-13  0              2.9946312    
   1800000   7830           200            200            0.0029155221  -0.00082439558  0              0.0095709619   6.9403757e-09  0              0.00067025181  1.1965779e-13  0              2.9946312    
   1900000   7830           200            200            0.0029155204  -0.0008243955   0              0.0095709568   1.707338e-10   0              1.6488248e-05  1.1965779e-13  0              2.9946312    
   2000000   7830           200            200            0.002915522   -0.00082439558  0              0.0095709615   4.0009899e-11  0              3.8638696e-06  1.1965779e-13  0              2.9946312    
   2100000   7830           200            200            0.0029155228  -0.00082439562  0              0.0095709639   1.7152837e-11  0              1.6564982e-06  1.1965779e-13  0              2.9946312    
   2200000   7830           200            200            0.0029155228  -0.00082439563  0              0.0095709642   4.9604736e-13  0              4.7904703e-08  1.1965779e-13  0              2.9946312    
   2300000   7830           200            200            0.0029155228  -0.00082439562  0              0.0095709639   8.6648998e-14  0              8.3679401e-09  1.1965779e-13  0              2.9946312    
   2400000   7830           200            200            0.0029155227  -0.00082439562  0              0.0095709638   4.2241445e-14  0              4.0793764e-09  1.1965779e-13  0              2.9946312    
   2500000   7830           200            200            0.0029155227  -0.00082439562  0              0.0095709638   1.4564401e-15  0              1.4065256e-10  1.1965779e-13  0              2.9946312    
   2600000   7830           200            200            0.0029155227  -0.00082439562  0              0.0095709638   1.8744993e-16  0              1.8102573e-11  1.1965779e-13  0              2.9946312    
   2700000   7830           200            200            0.0029155227  -0.00082439562  0              0.0095709638   1.0014736e-16  0              9.6715155e-12  1.1965779e-13  0              2.9946312    
   2800000   7830           200            200            0.0029155227  -0.00082439562  0              0.0095709638   6.3805652e-18  0              6.1618931e-13  1.1965779e-13  0              2.9946312    
   2900000   7830           200            200            0.0029155227  -0.00082439562  0              0.0095709638   5.6026416e-21  0              5.4106302e-16  1.1965779e-13  0              2.9946312    
   3000000   7830           200            200            0.0029155227  -0.00082439562  0              0.0095709638   3.5967935e-18  0              3.4735257e-13  1.1965779e-13  0              2.9946312    
Loop time of 305.095 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8495721.197 ns/day, 0.000 hours/ns, 9833.011 timesteps/s
99.9% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.355     | 39.311     | 69.056     | 443.6 | 12.88
Neigh   | 4.9184     | 5.0123     | 5.1077     |   3.8 |  1.64
Comm    | 20.453     | 41.31      | 83.943     | 388.3 | 13.54
Output  | 0.27334    | 0.27368    | 0.27406    |   0.1 |  0.09
Modify  | 109.27     | 160.48     | 182.16     | 234.6 | 52.60
Other   |            | 58.7       |            |       | 19.24

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         327.25 ave         655 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1309
Ave neighs/atom = 0.52339064
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 23

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.23                                                               
Lattice spacing in x,y,z = 5.23 5.23 5.23

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3922.5 ${n1e1} -100 100 -100 100 units box
region box block -3922.5 3922.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3922.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3922.5 3922.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3922.5 -100 -100) to (3922.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1499 atoms
  using lattice units in orthogonal box = (-3922.5 -100 -100) to (3922.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3922.5 -100 -100) to (3922.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1499 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1499 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1499 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_23_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5062 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 101.2 | 101.2 | 101.2 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7845           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7845           200            200            0.0025794137  -4.1187404e-35  0              0.0077382411   580888.52      0              5.6210477e+10  1.1965779e-13  0              3.3297267    
    200000   7845           200            200            0.00088801791  1.0297074e-35  0              0.0026640537   135308.4       0              1.3093303e+10  1.1965779e-13  0              3.0799753    
    300000   7845           200            200            1.7697153e-05 -5.1484239e-36  0              5.3091458e-05  117.69226      0              11388653       1.1965779e-13  0              3.044875     
    400000   7845           200            200            5.3332231e-05  1.6475124e-34  0              0.00015999669  1032.8611      0              99946227       1.1965779e-13  0              3.0052133    
    500000   7845           200            200            0.0054374072  -0.0030059175   0              0.019318139    388.64327      0              37607600       1.1965779e-13  0              2.9923305    
    600000   7845           200            200            0.0036363644  -0.0022641797   0              0.013173273    23.851422      0              2308015.6      1.1965779e-13  0              2.9936479    
    700000   7845           200            200            0.002363292   -0.0015965613   0              0.0086864374   15.386274      0              1488874        1.1965779e-13  0              2.9948455    
    800000   7845           200            200            0.0025818834  -0.0016080399   0              0.0093536901   2.962376       0              286658.38      1.1965779e-13  0              2.9946582    
    900000   7845           200            200            0.0027059949  -0.001615064    0              0.0097330488   0.00038593908  0              37.345926      1.1965779e-13  0              2.9945477    
   1000000   7845           200            200            0.0026434275  -0.0016020661   0              0.0095323485   0.059287082    0              5736.9961      1.1965779e-13  0              2.9946042    
   1100000   7845           200            200            0.0026434865  -0.0016020183   0              0.0095324779   0.0026581231   0              257.21694      1.1965779e-13  0              2.9946046    
   1200000   7845           200            200            0.0026520769  -0.0016030008   0              0.0095592314   0.00052813445  0              51.105656      1.1965779e-13  0              2.9945969    
   1300000   7845           200            200            0.002650406   -0.0016028171   0              0.009554035    0.00012585412  0              12.178447      1.1965779e-13  0              2.9945984    
   1400000   7845           200            200            0.0026495566  -0.0016027187   0              0.0095513886   1.0636503e-06  0              0.10292559     1.1965779e-13  0              2.9945991    
   1500000   7845           200            200            0.0026499386  -0.0016027616   0              0.0095525773   2.9010834e-06  0              0.28072733     1.1965779e-13  0              2.9945988    
   1600000   7845           200            200            0.0026499827  -0.001602767    0              0.0095527151   3.0584039e-08  0              0.0029595066   1.1965779e-13  0              2.9945988    
   1700000   7845           200            200            0.0026499231  -0.0016027602   0              0.0095525294   3.9005471e-08  0              0.003774418    1.1965779e-13  0              2.9945988    
   1800000   7845           200            200            0.0026499281  -0.0016027607   0              0.009552545    3.5996381e-09  0              0.00034832393  1.1965779e-13  0              2.9945988    
   1900000   7845           200            200            0.0026499352  -0.0016027615   0              0.0095525672   2.4268038e-10  0              2.3483301e-05  1.1965779e-13  0              2.9945988    
   2000000   7845           200            200            0.0026499332  -0.0016027613   0              0.009552561    1.2021882e-10  0              1.163314e-05   1.1965779e-13  0              2.9945988    
   2100000   7845           200            200            0.0026499326  -0.0016027612   0              0.0095525592   6.3382516e-15  0              6.1332963e-10  1.1965779e-13  0              2.9945988    
   2200000   7845           200            200            0.002649933   -0.0016027613   0              0.0095525603   2.2307013e-12  0              2.1585688e-07  1.1965779e-13  0              2.9945988    
   2300000   7845           200            200            0.002649933   -0.0016027613   0              0.0095525604   7.0355475e-14  0              6.8080442e-09  1.1965779e-13  0              2.9945988    
   2400000   7845           200            200            0.002649933   -0.0016027613   0              0.0095525602   2.3238412e-14  0              2.2486969e-09  1.1965779e-13  0              2.9945988    
   2500000   7845           200            200            0.002649933   -0.0016027613   0              0.0095525602   4.0674868e-15  0              3.9359595e-10  1.1965779e-13  0              2.9945988    
   2600000   7845           200            200            0.002649933   -0.0016027613   0              0.0095525602   8.7522414e-17  0              8.4692267e-12  1.1965779e-13  0              2.9945988    
   2700000   7845           200            200            0.002649933   -0.0016027613   0              0.0095525602   1.0308247e-16  0              9.9749172e-12  1.1965779e-13  0              2.9945988    
   2800000   7845           200            200            0.002649933   -0.0016027613   0              0.0095525602   2.8455479e-18  0              2.7535335e-13  1.1965779e-13  0              2.9945988    
   2900000   7845           200            200            0.002649933   -0.0016027613   0              0.0095525602   7.3213534e-18  0              7.0846082e-13  1.1965779e-13  0              2.9945988    
   3000000   7845           200            200            0.002649933   -0.0016027613   0              0.0095525602   1.0265755e-19  0              9.9337987e-15  1.1965779e-13  0              2.9945988    
Loop time of 306.502 on 4 procs for 3000000 steps with 2500 atoms

Performance: 8456710.423 ns/day, 0.000 hours/ns, 9787.859 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.553     | 39.207     | 70.214     | 451.5 | 12.79
Neigh   | 4.9167     | 5.0099     | 5.1057     |   3.8 |  1.63
Comm    | 26.608     | 56.587     | 85.128     | 347.5 | 18.46
Output  | 0.27168    | 0.27203    | 0.27241    |   0.1 |  0.09
Modify  | 113.18     | 148.35     | 182.69     | 272.7 | 48.40
Other   |            | 57.08      |            |       | 18.62

Nlocal:            625 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:            1.5 ave           4 max           0 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         324.75 ave         650 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1299
Ave neighs/atom = 0.5196
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 24

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.24                                                               
Lattice spacing in x,y,z = 5.24 5.24 5.24

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3930 ${n1e1} -100 100 -100 100 units box
region box block -3930 3930 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3930 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3930 3930 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3930 -100 -100) to (3930 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3930 -100 -100) to (3930 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3930 -100 -100) to (3930 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_24_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5071 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 101.4 | 101.4 | 101.4 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7860           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7860           200            200            0.0025743309   2.0243979e-40  0              0.0077229928   580851.87      0              5.6094516e+10  1.1965779e-13  0              3.3296272    
    200000   7860           200            200            0.00088649009  4.110951e-35   0              0.0026594703   135358.72      0              1.3071976e+10  1.1965779e-13  0              3.0797119    
    300000   7860           200            200            1.7976521e-05 -4.8303171e-34  0              5.3929563e-05  121.84315      0              11766739       1.1965779e-13  0              3.0446665    
    400000   7860           200            200            4.9788396e-05  5.159883e-40   0              0.00014936519  908.42479      0              87729164       1.1965779e-13  0              3.0051514    
    500000   7860           200            200            0.0042920503  -0.00065228324  0              0.013528434    1259.7431      0              1.2165697e+08  1.1965779e-13  0              2.9934095    
    600000   7860           200            200            0.0031879111  -0.0010862852   0              0.010650019    180.99328      0              17479035       1.1965779e-13  0              2.9941358    
    700000   7860           200            200            0.0032385183  -0.0011568623   0              0.010872417    0.32436887     0              31325.224      1.1965779e-13  0              2.9940563    
    800000   7860           200            200            0.0027245593  -0.0013083877   0              0.0094820656   3.5149584      0              339449.52      1.1965779e-13  0              2.9944434    
    900000   7860           200            200            0.0026824267  -0.0013099802   0              0.0093572602   0.004916919    0              474.84085      1.1965779e-13  0              2.9944821    
   1000000   7860           200            200            0.0027446896  -0.0013078697   0              0.0095419387   0.06371198     0              6152.847       1.1965779e-13  0              2.9944291    
   1100000   7860           200            200            0.0027499624  -0.0013077007   0              0.0095575878   0.00015042592  0              14.527059      1.1965779e-13  0              2.9944242    
   1200000   7860           200            200            0.0027414897  -0.0013079522   0              0.0095324213   0.0011494661   0              111.0072       1.1965779e-13  0              2.9944314    
   1300000   7860           200            200            0.0027408771  -0.0013079726   0              0.0095306038   4.1438067e-06  0              0.40017919     1.1965779e-13  0              2.994432     
   1400000   7860           200            200            0.0027420265  -0.0013079378   0              0.0095340174   2.0704456e-05  0              1.9994882      1.1965779e-13  0              2.994431     
   1500000   7860           200            200            0.0027420963  -0.0013079355   0              0.0095342243   1.0618099e-07  0              0.0102542      1.1965779e-13  0              2.994431     
   1600000   7860           200            200            0.0027419404  -0.0013079402   0              0.0095337615   3.7219057e-07  0              0.035943501    1.1965779e-13  0              2.9944311    
   1700000   7860           200            200            0.0027419328  -0.0013079405   0              0.0095337388   2.5831559e-09  0              0.00024946271  1.1965779e-13  0              2.9944311    
   1800000   7860           200            200            0.0027419539  -0.0013079398   0              0.0095338015   6.6775006e-09  0              0.00064486521  1.1965779e-13  0              2.9944311    
   1900000   7860           200            200            0.0027419547  -0.0013079398   0              0.0095338039   6.0466475e-11  0              5.8394193e-06  1.1965779e-13  0              2.9944311    
   2000000   7860           200            200            0.0027419518  -0.0013079399   0              0.0095337954   1.1955626e-10  0              1.1545888e-05  1.1965779e-13  0              2.9944311    
   2100000   7860           200            200            0.0027419518  -0.0013079399   0              0.0095337952   1.3728816e-12  0              1.3258308e-07  1.1965779e-13  0              2.9944311    
   2200000   7860           200            200            0.0027419521  -0.0013079399   0              0.0095337963   2.1358598e-12  0              2.0626605e-07  1.1965779e-13  0              2.9944311    
   2300000   7860           200            200            0.0027419522  -0.0013079399   0              0.0095337963   3.0326142e-14  0              2.9286817e-09  1.1965779e-13  0              2.9944311    
   2400000   7860           200            200            0.0027419521  -0.0013079399   0              0.0095337962   3.8155536e-14  0              3.6847885e-09  1.1965779e-13  0              2.9944311    
   2500000   7860           200            200            0.0027419521  -0.0013079399   0              0.0095337962   6.6583996e-16  0              6.4302057e-11  1.1965779e-13  0              2.9944311    
   2600000   7860           200            200            0.0027419521  -0.0013079399   0              0.0095337962   6.7766374e-16  0              6.5443913e-11  1.1965779e-13  0              2.9944311    
   2700000   7860           200            200            0.0027419521  -0.0013079399   0              0.0095337962   2.0877557e-17  0              2.016205e-12   1.1965779e-13  0              2.9944311    
   2800000   7860           200            200            0.0027419521  -0.0013079399   0              0.0095337962   6.4967297e-18  0              6.2740766e-13  1.1965779e-13  0              2.9944311    
   2900000   7860           200            200            0.0027419521  -0.0013079399   0              0.0095337962   5.640767e-20   0              5.447449e-15   1.1965779e-13  0              2.9944311    
   3000000   7860           200            200            0.0027419521  -0.0013079399   0              0.0095337962   7.3219816e-18  0              7.0710457e-13  1.1965779e-13  0              2.9944311    
Loop time of 304.119 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8522973.097 ns/day, 0.000 hours/ns, 9864.552 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.169     | 38.64      | 67.302     | 437.1 | 12.71
Neigh   | 4.894      | 4.9876     | 5.0833     |   3.8 |  1.64
Comm    | 20.007     | 42.406     | 84.927     | 384.9 | 13.94
Output  | 0.2757     | 0.27606    | 0.27647    |   0.1 |  0.09
Modify  | 110.18     | 160.27     | 180.3      | 229.0 | 52.70
Other   |            | 57.54      |            |       | 18.92

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         324.25 ave         649 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1297
Ave neighs/atom = 0.51859256
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 25

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.25                                                               
Lattice spacing in x,y,z = 5.25 5.25 5.25

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3937.5 ${n1e1} -100 100 -100 100 units box
region box block -3937.5 3937.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3937.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3937.5 3937.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3937.5 -100 -100) to (3937.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3937.5 -100 -100) to (3937.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3937.5 -100 -100) to (3937.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_25_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5081 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 101.6 | 101.6 | 101.6 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7875           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7875           200            200            0.0025772011   2.0515462e-35  0              0.0077316033   582894.66      0              5.6291794e+10  1.1965779e-13  0              3.3323448    
    200000   7875           200            200            0.00089984681 -2.0515197e-35  0              0.0026995404   138730.2       0              1.339757e+10   1.1965779e-13  0              3.082271     
    300000   7875           200            200            6.3353255e-05 -2.0515083e-35  0              0.00019005976  1408.7801      0              1.360499e+08   1.1965779e-13  0              3.0489101    
    400000   7875           200            200            0.017478291   -4.1030524e-35  0              0.052434873    1169.2974      0              1.1292237e+08  1.1965779e-13  0              2.9928364    
    500000   7875           200            200           -3.4809842e-05  2.0515647e-35  0             -0.00010442953  511.37219      0              49384666       1.1965779e-13  0              3.0000563    
    600000   7875           200            200            0.0033795032   1.0257713e-34  0              0.01013851     270.58007      0              26130687       1.1965779e-13  0              2.9976146    
    700000   7875           200            200            0.003179195    1.4960261e-40  0              0.009537585    36.871534      0              3560788.9      1.1965779e-13  0              2.9977025    
    800000   7875           200            200            0.0032371798  -1.0257563e-35  0              0.0097115393   4.6877105      0              452705.52      1.1965779e-13  0              2.9976715    
    900000   7875           200            200            0.003222037    1.02578e-35    0              0.0096661109   0.50590069     0              48856.267      1.1965779e-13  0              2.9976777    
   1000000   7875           200            200            0.0032000192   6.0116148e-41  0              0.0096000575   0.044099737    0              4258.8369      1.1965779e-13  0              2.9976879    
   1100000   7875           200            200            0.0031864543   1.0257728e-35  0              0.009559363    0.0027476156   0              265.34504      1.1965779e-13  0              2.9976943    
   1200000   7875           200            200            0.0031798576  -5.1288284e-36  0              0.0095395729   7.6100928e-05  0              7.349283       1.1965779e-13  0              2.9976974    
   1300000   7875           200            200            0.0031770313  -2.5644076e-36  0              0.0095310938   8.0656587e-07  0              0.077892359    1.1965779e-13  0              2.9976988    
   1400000   7875           200            200            0.0031759255  -1.2822105e-35  0              0.0095277764   3.2644473e-06  0              0.31525695     1.1965779e-13  0              2.9976993    
   1500000   7875           200            200            0.0031755258   5.1288633e-36  0              0.0095265775   1.3302657e-06  0              0.12846754     1.1965779e-13  0              2.9976995    
   1600000   7875           200            200            0.0031753928  -1.0257681e-35  0              0.0095261783   3.2527833e-07  0              0.031413052    1.1965779e-13  0              2.9976996    
   1700000   7875           200            200            0.0031753527  -3.8466208e-36  0              0.009526058    6.1035804e-08  0              0.0058944011   1.1965779e-13  0              2.9976996    
   1800000   7875           200            200            0.0031753423   5.1288632e-36  0              0.0095260269   9.5070408e-09  0              0.00091812195  1.1965779e-13  0              2.9976996    
   1900000   7875           200            200            0.0031753404  -1.2821969e-36  0              0.0095260211   1.2621362e-09  0              0.00012188808  1.1965779e-13  0              2.9976996    
   2000000   7875           200            200            0.0031753404   1.0257711e-35  0              0.0095260213   1.4250918e-10  0              1.3762517e-05  1.1965779e-13  0              2.9976996    
   2100000   7875           200            200            0.0031753407  -3.8466208e-36  0              0.0095260221   1.3245511e-11  0              1.2791566e-06  1.1965779e-13  0              2.9976996    
   2200000   7875           200            200            0.0031753409  -6.4109083e-37  0              0.0095260227   9.2230621e-13  0              8.9069732e-08  1.1965779e-13  0              2.9976996    
   2300000   7875           200            200            0.003175341    1.9233332e-36  0              0.009526023    3.5607505e-14  0              3.438718e-09   1.1965779e-13  0              2.9976996    
   2400000   7875           200            200            0.003175341    6.4110753e-36  0              0.0095260231   2.4431008e-17  0              2.3593719e-12  1.1965779e-13  0              2.9976996    
   2500000   7875           200            200            0.0031753411  -1.9233028e-36  0              0.0095260232   5.1604178e-16  0              4.9835621e-11  1.1965779e-13  0              2.9976996    
   2600000   7875           200            200            0.0031753411  -4.808143e-37   0              0.0095260232   2.8420327e-16  0              2.7446318e-11  1.1965779e-13  0              2.9976996    
   2700000   7875           200            200            0.0031753411   1.6029171e-37  0              0.0095260232   3.3406739e-17  0              3.2261837e-12  1.1965779e-13  0              2.9976996    
   2800000   7875           200            200            0.0031753411  -2.2438558e-36  0              0.0095260232   2.5948415e-18  0              2.5059122e-13  1.1965779e-13  0              2.9976996    
   2900000   7875           200            200            0.0031753411  -3.2053772e-37  0              0.0095260232   6.4814997e-18  0              6.2593685e-13  1.1965779e-13  0              2.9976996    
   3000000   7875           200            200            0.0031753411  -1.2821977e-36  0              0.0095260232   4.5332947e-18  0              4.3779316e-13  1.1965779e-13  0              2.9976996    
Loop time of 315.789 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8208018.765 ns/day, 0.000 hours/ns, 9500.022 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.282     | 44.001     | 77.572     | 489.9 | 13.93
Neigh   | 4.7869     | 4.8768     | 4.9685     |   3.6 |  1.54
Comm    | 20.551     | 43.102     | 92.085     | 434.7 | 13.65
Output  | 0.27457    | 0.2749     | 0.27528    |   0.1 |  0.09
Modify  | 112.01     | 165.44     | 185.65     | 240.3 | 52.39
Other   |            | 58.09      |            |       | 18.40

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         357.25 ave         715 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1429
Ave neighs/atom = 0.57137145
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 26

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.26                                                               
Lattice spacing in x,y,z = 5.26 5.26 5.26

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3945 ${n1e1} -100 100 -100 100 units box
region box block -3945 3945 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3945 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3945 3945 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3945 -100 -100) to (3945 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3945 -100 -100) to (3945 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3945 -100 -100) to (3945 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_26_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5091 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 101.7 | 101.7 | 101.7 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7890           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7890           200            200            0.0025645419   5.9333195e-44  0              0.0076936256   580851.52      0              5.6094482e+10  1.1965779e-13  0              3.3296282    
    200000   7890           200            200            0.00088311377  2.0751345e-40  0              0.0026493413   135357.32      0              1.3071841e+10  1.1965779e-13  0              3.079714     
    300000   7890           200            200            1.7904171e-05  7.8268332e-40  0              5.3712512e-05  121.78968      0              11761575       1.1965779e-13  0              3.0446668    
    400000   7890           200            200            4.9509456e-05  3.1385938e-42  0              0.00014852837  905.26844      0              87424346       1.1965779e-13  0              3.0051547    
    500000   7890           200            200            0.0046821678   0.00067195674  0              0.013374547    1273.7023      0              1.2300505e+08  1.1965779e-13  0              2.9934403    
    600000   7890           200            200            0.0038896058   0.0010385066   0              0.010630311    180.01068      0              17384143       1.1965779e-13  0              2.9941226    
    700000   7890           200            200            0.0039760854   0.0010941245   0              0.010834132    0.52239878     0              50449.535      1.1965779e-13  0              2.9940506    
    800000   7890           200            200            0.0036340734   0.0012384375   0              0.0096637828   3.1154158      0              300864.56      1.1965779e-13  0              2.9943719    
    900000   7890           200            200            0.0035209436   0.0012247568   0              0.0093380739   0.092226062    0              8906.5329      1.1965779e-13  0              2.9944679    
   1000000   7890           200            200            0.0035640634   0.0012267509   0              0.0094654394   0.048238955    0              4658.573       1.1965779e-13  0              2.9944316    
   1100000   7890           200            200            0.0035812271   0.0012261729   0              0.0095175084   0.0026852777   0              259.3249       1.1965779e-13  0              2.9944163    
   1200000   7890           200            200            0.0035763729   0.0012263317   0              0.0095027869   0.00073926147  0              71.392581      1.1965779e-13  0              2.9944205    
   1300000   7890           200            200            0.0035738295   0.0012264176   0              0.009495071    6.8450573e-05  0              6.6104664      1.1965779e-13  0              2.9944227    
   1400000   7890           200            200            0.0035743637   0.0012264004   0              0.0094966907   1.0727728e-05  0              1.0360072      1.1965779e-13  0              2.9944223    
   1500000   7890           200            200            0.0035747321   0.0012263881   0              0.0094978082   1.6155734e-06  0              0.15602052     1.1965779e-13  0              2.994422     
   1600000   7890           200            200            0.0035746775   0.0012263898   0              0.0094976426   1.4564676e-07  0              0.014065521    1.1965779e-13  0              2.994422     
   1700000   7890           200            200            0.0035746252   0.0012263915   0              0.009497484    3.5912856e-08  0              0.0034682066   1.1965779e-13  0              2.9944221    
   1800000   7890           200            200            0.0035746301   0.0012263914   0              0.0094974989   1.8067915e-09  0              0.00017448699  1.1965779e-13  0              2.9944221    
   1900000   7890           200            200            0.0035746374   0.0012263912   0              0.0094975209   7.6027945e-10  0              7.3422348e-05  1.1965779e-13  0              2.994422     
   2000000   7890           200            200            0.0035746371   0.0012263912   0              0.00949752     1.9611995e-11  0              1.8939861e-06  1.1965779e-13  0              2.994422     
   2100000   7890           200            200            0.0035746361   0.0012263912   0              0.009497517    1.5437386e-11  0              1.4908322e-06  1.1965779e-13  0              2.994422     
   2200000   7890           200            200            0.003574636    0.0012263912   0              0.009497517    1.6905876e-13  0              1.6326485e-08  1.1965779e-13  0              2.994422     
   2300000   7890           200            200            0.0035746362   0.0012263912   0              0.0094975174   3.0175805e-13  0              2.9141632e-08  1.1965779e-13  0              2.994422     
   2400000   7890           200            200            0.0035746362   0.0012263912   0              0.0094975174   9.1141275e-16  0              8.801772e-11   1.1965779e-13  0              2.994422     
   2500000   7890           200            200            0.0035746362   0.0012263912   0              0.0094975173   5.6931479e-15  0              5.4980347e-10  1.1965779e-13  0              2.994422     
   2600000   7890           200            200            0.0035746362   0.0012263912   0              0.0094975173   1.1994896e-19  0              1.1583812e-14  1.1965779e-13  0              2.994422     
   2700000   7890           200            200            0.0035746362   0.0012263912   0              0.0094975173   1.0219872e-16  0              9.8696207e-12  1.1965779e-13  0              2.994422     
   2800000   7890           200            200            0.0035746362   0.0012263912   0              0.0094975173   5.5142072e-19  0              5.3252266e-14  1.1965779e-13  0              2.994422     
   2900000   7890           200            200            0.0035746362   0.0012263912   0              0.0094975173   3.7301094e-18  0              3.6022727e-13  1.1965779e-13  0              2.994422     
   3000000   7890           200            200            0.0035746362   0.0012263912   0              0.0094975173   1.4803103e-18  0              1.4295778e-13  1.1965779e-13  0              2.994422     
Loop time of 303.458 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8541547.330 ns/day, 0.000 hours/ns, 9886.050 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.891     | 38.921     | 65.483     | 425.0 | 12.83
Neigh   | 4.892      | 4.9949     | 5.1004     |   4.2 |  1.65
Comm    | 20.514     | 39.722     | 79.035     | 365.2 | 13.09
Output  | 0.27493    | 0.27529    | 0.27571    |   0.1 |  0.09
Modify  | 112.18     | 161.51     | 182.07     | 225.8 | 53.22
Other   |            | 58.03      |            |       | 19.12

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         324.75 ave         650 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1299
Ave neighs/atom = 0.51939224
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 27

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.27                                                               
Lattice spacing in x,y,z = 5.27 5.27 5.27

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3952.5 ${n1e1} -100 100 -100 100 units box
region box block -3952.5 3952.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3952.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3952.5 3952.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3952.5 -100 -100) to (3952.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3952.5 -100 -100) to (3952.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3952.5 -100 -100) to (3952.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_27_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5100 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 101.9 | 101.9 | 101.9 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7905           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7905           200            200            0.0025597927   5.1093992e-36  0              0.0076793782   580872.34      0              5.6096493e+10  1.1965779e-13  0              3.3297513    
    200000   7905           200            200            0.00088124048  4.9312873e-40  0              0.0026437214   135299.26      0              1.3066234e+10  1.1965779e-13  0              3.0799863    
    300000   7905           200            200            1.7539404e-05  4.0877044e-35  0              5.2618212e-05  117.38397      0              11336104       1.1965779e-13  0              3.0448752    
    400000   7905           200            200            5.2903946e-05  1.5830882e-39  0              0.00015871184  1031.9813      0              99661371       1.1965779e-13  0              3.0052141    
    500000   7905           200            200            0.0071089927   0.0021581003   0              0.019168878    389.1996       0              37586112       1.1965779e-13  0              2.9923311    
    600000   7905           200            200            0.0041551659  -0.00060836539  0              0.013073863    23.800391      0              2298471.4      1.1965779e-13  0              2.9936478    
    700000   7905           200            200            0.0025217399  -0.0010556412   0              0.0086208608   15.396076      0              1486842.8      1.1965779e-13  0              2.9948454    
    800000   7905           200            200            0.0027746504  -0.00095857861  0              0.0092825299   2.961387       0              285989.56      1.1965779e-13  0              2.9946582    
    900000   7905           200            200            0.0029153707  -0.00091306073  0              0.0096591729   0.00039624073  0              38.266094      1.1965779e-13  0              2.9945477    
   1000000   7905           200            200            0.0028495974  -0.00091122772  0              0.0094600198   0.059301267    0              5726.8919      1.1965779e-13  0              2.9946042    
   1100000   7905           200            200            0.0028496471  -0.00091117875  0              0.0094601201   0.0026551346   0              256.41389      1.1965779e-13  0              2.9946046    
   1200000   7905           200            200            0.0028581705  -0.00091216201  0              0.0094866734   0.00052857686  0              51.04617       1.1965779e-13  0              2.9945969    
   1300000   7905           200            200            0.0028565142  -0.00091197712  0              0.0094815197   0.00012580633  0              12.149475      1.1965779e-13  0              2.9945984    
   1400000   7905           200            200            0.0028556714  -0.00091187809  0              0.0094788924   1.0671422e-06  0              0.10305696     1.1965779e-13  0              2.9945991    
   1500000   7905           200            200            0.0028560502  -0.0009119212   0              0.0094800718   2.9011671e-06  0              0.28017396     1.1965779e-13  0              2.9945988    
   1600000   7905           200            200            0.0028560941  -0.00091192661  0              0.0094802088   3.0505953e-08  0              0.0029460466   1.1965779e-13  0              2.9945988    
   1700000   7905           200            200            0.0028560349  -0.0009119198   0              0.0094800244   3.9023367e-08  0              0.0037685974   1.1965779e-13  0              2.9945988    
   1800000   7905           200            200            0.0028560399  -0.00091192032  0              0.0094800399   3.596989e-09   0              0.00034737145  1.1965779e-13  0              2.9945988    
   1900000   7905           200            200            0.0028560469  -0.00091192114  0              0.009480062    2.4301439e-10  0              2.3468591e-05  1.1965779e-13  0              2.9945988    
   2000000   7905           200            200            0.002856045   -0.00091192092  0              0.0094800558   1.2019574e-10  0              1.1607645e-05  1.1965779e-13  0              2.9945988    
   2100000   7905           200            200            0.0028560444  -0.00091192085  0              0.009480054    6.7119301e-15  0              6.4819017e-10  1.1965779e-13  0              2.9945988    
   2200000   7905           200            200            0.0028560447  -0.00091192089  0              0.0094800551   2.2305612e-12  0              2.1541163e-07  1.1965779e-13  0              2.9945988    
   2300000   7905           200            200            0.0028560448  -0.0009119209   0              0.0094800552   7.0226546e-14  0              6.7819771e-09  1.1965779e-13  0              2.9945988    
   2400000   7905           200            200            0.0028560447  -0.00091192089  0              0.009480055    2.3234325e-14  0              2.2438048e-09  1.1965779e-13  0              2.9945988    
   2500000   7905           200            200            0.0028560447  -0.00091192089  0              0.009480055    4.0569342e-15  0              3.9178967e-10  1.1965779e-13  0              2.9945988    
   2600000   7905           200            200            0.0028560447  -0.00091192089  0              0.009480055    8.9816501e-17  0              8.6738348e-12  1.1965779e-13  0              2.9945988    
   2700000   7905           200            200            0.0028560447  -0.00091192089  0              0.009480055    1.034543e-16   0              9.990876e-12   1.1965779e-13  0              2.9945988    
   2800000   7905           200            200            0.0028560447  -0.00091192089  0              0.009480055    2.6093825e-18  0              2.5199548e-13  1.1965779e-13  0              2.9945988    
   2900000   7905           200            200            0.0028560447  -0.00091192089  0              0.009480055    6.4775989e-18  0              6.2556013e-13  1.1965779e-13  0              2.9945988    
   3000000   7905           200            200            0.0028560447  -0.00091192089  0              0.009480055    1.8324538e-20  0              1.7696527e-15  1.1965779e-13  0              2.9945988    
Loop time of 303.299 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8546030.828 ns/day, 0.000 hours/ns, 9891.239 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.357     | 38.838     | 67.804     | 438.5 | 12.81
Neigh   | 4.9464     | 5.0438     | 5.1429     |   3.9 |  1.66
Comm    | 19.734     | 26.039     | 31.059     |  93.7 |  8.59
Output  | 0.27321    | 0.27354    | 0.27391    |   0.1 |  0.09
Modify  | 171.14     | 175.53     | 180.45     |  28.0 | 57.87
Other   |            | 57.58      |            |       | 18.98

Nlocal:         625.25 ave         877 max         374 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         324.75 ave         650 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1299
Ave neighs/atom = 0.51939224
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 28

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.28                                                               
Lattice spacing in x,y,z = 5.28 5.28 5.28

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3960 ${n1e1} -100 100 -100 100 units box
region box block -3960 3960 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3960 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3960 3960 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3960 -100 -100) to (3960 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3960 -100 -100) to (3960 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3960 -100 -100) to (3960 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_28_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5110 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 102 | 102 | 102.1 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7920           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7920           200            200            0.0025550108   5.9762797e-42  0              0.0076650323   580878.82      0              5.6097118e+10  1.1965779e-13  0              3.3298639    
    200000   7920           200            200            0.0008799285   1.4279199e-34  0              0.0026397855   135379.38      0              1.3073972e+10  1.1965779e-13  0              3.0800501    
    300000   7920           200            200            1.988009e-05   2.0399232e-35  0              5.964027e-05   150.67248      0              14550870       1.1965779e-13  0              3.0449743    
    400000   7920           200            200            5.7703823e-05  5.0997168e-36  0              0.00017311147  1223.3011      0              1.1813766e+08  1.1965779e-13  0              3.0051008    
    500000   7920           200            200            0.0077547841   0.0023817189   0              0.020882633    0.073336775    0              7082.3408      1.1965779e-13  0              2.9921033    
    600000   7920           200            200            0.0025221073   0.0007751997   0              0.0067911221   91.693538      0              8855105.6      1.1965779e-13  0              2.9955208    
    700000   7920           200            200            0.0030721329   0.0010797696   0              0.0081366292   1.3521634      0              130582.26      1.1965779e-13  0              2.9951084    
    800000   7920           200            200            0.0034420089   0.0011140562   0              0.0092119706   2.803765       0              270767.55      1.1965779e-13  0              2.9948083    
    900000   7920           200            200            0.0035468356   0.001122251    0              0.0095182556   0.44919675     0              43380.207      1.1965779e-13  0              2.9947266    
   1000000   7920           200            200            0.003548851    0.0011223367   0              0.0095242163   0.012217258    0              1179.8554      1.1965779e-13  0              2.9947257    
   1100000   7920           200            200            0.0035357845   0.0011213116   0              0.009486042    0.0012015442   0              116.03654      1.1965779e-13  0              2.9947362    
   1200000   7920           200            200            0.0035289526   0.0011207819   0              0.0094660757   0.0010468393   0              101.09625      1.1965779e-13  0              2.9947416    
   1300000   7920           200            200            0.0035272721   0.0011206538   0              0.0094611626   0.00013524765  0              13.06125       1.1965779e-13  0              2.9947429    
   1400000   7920           200            200            0.0035273463   0.0011206608   0              0.0094613782   2.241969e-06   0              0.21651332     1.1965779e-13  0              2.9947428    
   1500000   7920           200            200            0.0035276104   0.0011206817   0              0.0094621494   6.6223024e-07  0              0.063953456    1.1965779e-13  0              2.9947426    
   1600000   7920           200            200            0.0035277334   0.0011206912   0              0.009462509    3.7451656e-07  0              0.036168128    1.1965779e-13  0              2.9947425    
   1700000   7920           200            200            0.0035277598   0.0011206932   0              0.0094625861   3.9455682e-08  0              0.0038103474   1.1965779e-13  0              2.9947425    
   1800000   7920           200            200            0.0035277565   0.0011206929   0              0.0094625765   3.0854202e-10  0              2.979678e-05   1.1965779e-13  0              2.9947425    
   1900000   7920           200            200            0.0035277513   0.0011206925   0              0.0094625613   3.2165542e-10  0              3.1063178e-05  1.1965779e-13  0              2.9947425    
   2000000   7920           200            200            0.0035277491   0.0011206924   0              0.0094625549   1.3009152e-10  0              1.2563308e-05  1.1965779e-13  0              2.9947425    
   2100000   7920           200            200            0.0035277487   0.0011206923   0              0.0094625537   1.108391e-11   0              1.0704047e-06  1.1965779e-13  0              2.9947425    
   2200000   7920           200            200            0.0035277488   0.0011206923   0              0.009462554    1.956441e-14   0              1.8893907e-09  1.1965779e-13  0              2.9947425    
   2300000   7920           200            200            0.0035277489   0.0011206923   0              0.0094625543   1.4342238e-13  0              1.3850707e-08  1.1965779e-13  0              2.9947425    
   2400000   7920           200            200            0.0035277489   0.0011206923   0              0.0094625544   4.393615e-14   0              4.2430389e-09  1.1965779e-13  0              2.9947425    
   2500000   7920           200            200            0.0035277489   0.0011206924   0              0.0094625544   3.0024345e-15  0              2.8995363e-10  1.1965779e-13  0              2.9947425    
   2600000   7920           200            200            0.0035277489   0.0011206923   0              0.0094625544   4.606567e-18   0              4.4486927e-13  1.1965779e-13  0              2.9947425    
   2700000   7920           200            200            0.0035277489   0.0011206923   0              0.0094625544   5.1233154e-17  0              4.9477313e-12  1.1965779e-13  0              2.9947425    
   2800000   7920           200            200            0.0035277489   0.0011206923   0              0.0094625544   1.342943e-17   0              1.2969182e-12  1.1965779e-13  0              2.9947425    
   2900000   7920           200            200            0.0035277489   0.0011206923   0              0.0094625544   2.9348637e-18  0              2.8342813e-13  1.1965779e-13  0              2.9947425    
   3000000   7920           200            200            0.0035277489   0.0011206924   0              0.0094625544   7.7664474e-19  0              7.500279e-14   1.1965779e-13  0              2.9947425    
Loop time of 298.676 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8678295.861 ns/day, 0.000 hours/ns, 10044.324 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.34      | 37.554     | 65.325     | 424.8 | 12.57
Neigh   | 4.9311     | 5.0294     | 5.1299     |   4.0 |  1.68
Comm    | 19.805     | 40.526     | 80.707     | 371.2 | 13.57
Output  | 0.27151    | 0.27184    | 0.27221    |   0.1 |  0.09
Modify  | 109.76     | 158.86     | 178.01     | 226.0 | 53.19
Other   |            | 56.44      |            |       | 18.90

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         324.25 ave         649 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1297
Ave neighs/atom = 0.51859256
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 29

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.29                                                               
Lattice spacing in x,y,z = 5.29 5.29 5.29

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3967.5 ${n1e1} -100 100 -100 100 units box
region box block -3967.5 3967.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3967.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3967.5 3967.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3967.5 -100 -100) to (3967.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3967.5 -100 -100) to (3967.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3967.5 -100 -100) to (3967.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_29_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5120 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 102.2 | 102.2 | 102.2 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7935           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7935           200            200            0.0025501161   4.0720707e-35  0              0.0076503483   580851.44      0              5.6094475e+10  1.1965779e-13  0              3.3299242    
    200000   7935           200            200            0.00087788521 -8.1440359e-35  0              0.0026336556   135284.69      0              1.3064827e+10  1.1965779e-13  0              3.0801889    
    300000   7935           200            200            1.878104e-05   2.3211237e-40  0              5.6343119e-05  135.25454      0              13061915       1.1965779e-13  0              3.0450168    
    400000   7935           200            200            5.9268227e-05  2.5450428e-36  0              0.00017780468  1292.167       0              1.2478824e+08  1.1965779e-13  0              3.005072     
    500000   7935           200            200            0.0075408494   0.0017353885   0              0.02088716     14.718211      0              1421379.5      1.1965779e-13  0              2.9920872    
    600000   7935           200            200            0.0034047448   0.0015281278   0              0.0086861065   193.03344      0              18641788       1.1965779e-13  0              2.9948947    
    700000   7935           200            200            0.0035115846   0.0013872631   0              0.0091474906   25.455741      0              2458333.2      1.1965779e-13  0              2.9947865    
    800000   7935           200            200            0.0037122134   0.0014737799   0              0.0096628604   2.8764255      0              277784.58      1.1965779e-13  0              2.994631     
    900000   7935           200            200            0.0035876611   0.0014449745   0              0.0093180088   0.24103579     0              23277.512      1.1965779e-13  0              2.9947314    
   1000000   7935           200            200            0.0036528841   0.0014555089   0              0.0095031433   0.013622295    0              1315.5438      1.1965779e-13  0              2.994678     
   1100000   7935           200            200            0.0036238524   0.0014509499   0              0.0094206073   0.00023367538  0              22.566696      1.1965779e-13  0              2.9947016    
   1200000   7935           200            200            0.0036353719   0.0014527659   0              0.00945335     2.5276237e-05  0              2.440998       1.1965779e-13  0              2.9946923    
   1300000   7935           200            200            0.003631227    0.0014521187   0              0.0094415623   3.1126696e-05  0              3.0059935      1.1965779e-13  0              2.9946956    
   1400000   7935           200            200            0.0036325733   0.0014523279   0              0.0094453921   1.0406434e-05  0              1.0049789      1.1965779e-13  0              2.9946945    
   1500000   7935           200            200            0.0036321903   0.001452269    0              0.009444302    2.2637701e-06  0              0.21861871     1.1965779e-13  0              2.9946949    
   1600000   7935           200            200            0.0036322767   0.001452282    0              0.0094445482   3.815084e-07   0              0.03684335     1.1965779e-13  0              2.9946948    
   1700000   7935           200            200            0.0036322679   0.0014522808   0              0.009444523    5.2553215e-08  0              0.0050752133   1.1965779e-13  0              2.9946948    
   1800000   7935           200            200            0.0036322624   0.0014522799   0              0.0094445074   5.9433766e-09  0              0.00057396877  1.1965779e-13  0              2.9946948    
   1900000   7935           200            200            0.0036322675   0.0014522807   0              0.0094445217   5.3003012e-10  0              5.1186515e-05  1.1965779e-13  0              2.9946948    
   2000000   7935           200            200            0.0036322647   0.0014522803   0              0.0094445138   3.2613261e-11  0              3.1495553e-06  1.1965779e-13  0              2.9946948    
   2100000   7935           200            200            0.003632266    0.0014522805   0              0.0094445174   7.9257425e-13  0              7.6541148e-08  1.1965779e-13  0              2.9946948    
   2200000   7935           200            200            0.0036322654   0.0014522804   0              0.0094445159   2.1526307e-14  0              2.0788567e-09  1.1965779e-13  0              2.9946948    
   2300000   7935           200            200            0.0036322656   0.0014522804   0              0.0094445165   4.982508e-14   0              4.8117496e-09  1.1965779e-13  0              2.9946948    
   2400000   7935           200            200            0.0036322656   0.0014522804   0              0.0094445163   1.8583122e-14  0              1.7946249e-09  1.1965779e-13  0              2.9946948    
   2500000   7935           200            200            0.0036322656   0.0014522804   0              0.0094445164   4.2166298e-15  0              4.0721192e-10  1.1965779e-13  0              2.9946948    
   2600000   7935           200            200            0.0036322656   0.0014522804   0              0.0094445163   7.4122069e-16  0              7.1581789e-11  1.1965779e-13  0              2.9946948    
   2700000   7935           200            200            0.0036322656   0.0014522804   0              0.0094445163   1.0405162e-16  0              1.0048561e-11  1.1965779e-13  0              2.9946948    
   2800000   7935           200            200            0.0036322656   0.0014522804   0              0.0094445163   1.391353e-17   0              1.3436691e-12  1.1965779e-13  0              2.9946948    
   2900000   7935           200            200            0.0036322656   0.0014522804   0              0.0094445163   4.4447248e-18  0              4.2923971e-13  1.1965779e-13  0              2.9946948    
   3000000   7935           200            200            0.0036322656   0.0014522804   0              0.0094445163   5.219416e-19   0              5.0405384e-14  1.1965779e-13  0              2.9946948    
Loop time of 299.782 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8646292.669 ns/day, 0.000 hours/ns, 10007.283 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.024     | 36.932     | 63.829     | 423.9 | 12.32
Neigh   | 4.9584     | 5.0572     | 5.1578     |   4.0 |  1.69
Comm    | 19.812     | 41.143     | 81.287     | 369.2 | 13.72
Output  | 0.27206    | 0.2724     | 0.27281    |   0.1 |  0.09
Modify  | 109.59     | 159.51     | 179.45     | 229.4 | 53.21
Other   |            | 56.87      |            |       | 18.97

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         324.25 ave         649 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1297
Ave neighs/atom = 0.51859256
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 30

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.3                                                               
Lattice spacing in x,y,z = 5.3 5.3 5.3

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3975 ${n1e1} -100 100 -100 100 units box
region box block -3975 3975 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3975 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3975 3975 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3975 -100 -100) to (3975 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3975 -100 -100) to (3975 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3975 -100 -100) to (3975 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_30_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5130 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 102.3 | 102.4 | 102.4 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7950           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7950           200            200            0.002545267   -1.0160911e-35  0              0.0076358011   580848.85      0              5.6094225e+10  1.1965779e-13  0              3.329851     
    200000   7950           200            200            0.000876178    8.1288339e-35  0              0.002628534    135276.59      0              1.3064045e+10  1.1965779e-13  0              3.0801053    
    300000   7950           200            200            1.8447423e-05 -6.0965326e-35  0              5.534227e-05   131.06876      0              12657682       1.1965779e-13  0              3.0449353    
    400000   7950           200            200            5.9087796e-05  8.1287641e-35  0              0.00017726339  1289.3569      0              1.2451687e+08  1.1965779e-13  0              3.0050063    
    500000   7950           200            200            0.0047800985  -0.0055803109   0              0.019920606    172.18488      0              16628384       1.1965779e-13  0              2.9921422    
    600000   7950           200            200            0.0020580855  -0.0032336895   0              0.009407946    194.14455      0              18749091       1.1965779e-13  0              2.9947013    
    700000   7950           200            200            0.001683921   -0.0034672726   0              0.0085190356   12.351881      0              1192856.2      1.1965779e-13  0              2.9949604    
    800000   7950           200            200            0.0018187684  -0.0035054333   0              0.0089617386   0.0074476812   0              719.24375      1.1965779e-13  0              2.9948175    
    900000   7950           200            200            0.0019197285  -0.0035307583   0              0.009289944    0.17900726     0              17287.24       1.1965779e-13  0              2.9947162    
   1000000   7950           200            200            0.0019578172  -0.0035397018   0              0.0094131534   0.061626942    0              5951.4889      1.1965779e-13  0              2.994679     
   1100000   7950           200            200            0.0019653862  -0.0035414014   0              0.0094375599   0.0066841186   0              645.50433      1.1965779e-13  0              2.9946718    
   1200000   7950           200            200            0.0019644671  -0.0035411622   0              0.0094345636   0.00015010674  0              14.496235      1.1965779e-13  0              2.9946728    
   1300000   7950           200            200            0.0019629326  -0.0035407995   0              0.0094295974   1.7406904e-05  0              1.6810342      1.1965779e-13  0              2.9946744    
   1400000   7950           200            200            0.0019621982  -0.0035406287   0              0.0094272232   1.5898998e-05  0              1.5354114      1.1965779e-13  0              2.9946751    
   1500000   7950           200            200            0.0019619942  -0.0035405821   0              0.0094265645   2.7840041e-06  0              0.26885919     1.1965779e-13  0              2.9946753    
   1600000   7950           200            200            0.0019619791  -0.003540579    0              0.0094265162   1.5668112e-07  0              0.015131142    1.1965779e-13  0              2.9946753    
   1700000   7950           200            200            0.0019619981  -0.0035405836   0              0.009426578    1.2807483e-11  0              1.236855e-06   1.1965779e-13  0              2.9946753    
   1800000   7950           200            200            0.0019620108  -0.0035405866   0              0.0094266191   3.06925e-09    0              0.00029640619  1.1965779e-13  0              2.9946752    
   1900000   7950           200            200            0.0019620154  -0.0035405876   0              0.0094266338   9.3149531e-10  0              8.995715e-05   1.1965779e-13  0              2.9946752    
   2000000   7950           200            200            0.0019620162  -0.0035405878   0              0.0094266364   9.2260167e-11  0              8.9098266e-06  1.1965779e-13  0              2.9946752    
   2100000   7950           200            200            0.0019620161  -0.0035405878   0              0.009426636    1.5817892e-12  0              1.5275788e-07  1.1965779e-13  0              2.9946752    
   2200000   7950           200            200            0.0019620159  -0.0035405877   0              0.0094266353   3.5052615e-13  0              3.3851306e-08  1.1965779e-13  0              2.9946752    
   2300000   7950           200            200            0.0019620158  -0.0035405877   0              0.009426635    2.506625e-13   0              2.420719e-08   1.1965779e-13  0              2.9946752    
   2400000   7950           200            200            0.0019620157  -0.0035405877   0              0.009426635    4.0141519e-14  0              3.8765806e-09  1.1965779e-13  0              2.9946752    
   2500000   7950           200            200            0.0019620157  -0.0035405877   0              0.009426635    2.0342995e-15  0              1.9645808e-10  1.1965779e-13  0              2.9946752    
   2600000   7950           200            200            0.0019620157  -0.0035405877   0              0.009426635    8.9383249e-18  0              8.6319944e-13  1.1965779e-13  0              2.9946752    
   2700000   7950           200            200            0.0019620157  -0.0035405877   0              0.009426635    4.1277365e-17  0              3.9862725e-12  1.1965779e-13  0              2.9946752    
   2800000   7950           200            200            0.0019620157  -0.0035405877   0              0.009426635    1.2441001e-17  0              1.2014628e-12  1.1965779e-13  0              2.9946752    
   2900000   7950           200            200            0.0019620157  -0.0035405877   0              0.009426635    6.3805506e-18  0              6.1618791e-13  1.1965779e-13  0              2.9946752    
   3000000   7950           200            200            0.0019620158  -0.0035405877   0              0.009426635    1.7071441e-20  0              1.6486376e-15  1.1965779e-13  0              2.9946752    
Loop time of 293.589 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8828660.303 ns/day, 0.000 hours/ns, 10218.357 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.964     | 36.194     | 62.146     | 416.6 | 12.33
Neigh   | 4.8063     | 4.9036     | 5.0041     |   4.1 |  1.67
Comm    | 19.762     | 38.833     | 76.828     | 357.6 | 13.23
Output  | 0.27027    | 0.27059    | 0.27092    |   0.1 |  0.09
Modify  | 109.07     | 157.13     | 177.29     | 223.4 | 53.52
Other   |            | 56.26      |            |       | 19.16

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         321.25 ave         643 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1285
Ave neighs/atom = 0.51379448
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 31

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.31                                                               
Lattice spacing in x,y,z = 5.31 5.31 5.31

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3982.5 ${n1e1} -100 100 -100 100 units box
region box block -3982.5 3982.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3982.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3982.5 3982.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3982.5 -100 -100) to (3982.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3982.5 -100 -100) to (3982.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3982.5 -100 -100) to (3982.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_31_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5139 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 102.5 | 102.6 | 102.6 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7965           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7965           200            200            0.0025399593   2.6445631e-41  0              0.0076198779   580673.27      0              5.6077268e+10  1.1965779e-13  0              3.3299851    
    200000   7965           200            200            0.00087327697  5.145058e-40   0              0.0026198309   134973.48      0              1.3034773e+10  1.1965779e-13  0              3.0803469    
    300000   7965           200            200            1.6128357e-05 -4.0567098e-35  0              4.838507e-05   101.0315       0              9756899.5      1.1965779e-13  0              3.0448919    
    400000   7965           200            200            5.4644418e-05  5.0709002e-35  0              0.00016393325  1114.1531      0              1.0759694e+08  1.1965779e-13  0              3.0051321    
    500000   7965           200            200            0.0073584108   0.0012627176   0              0.020812515    16.064951      0              1551438        1.1965779e-13  0              2.9919826    
    600000   7965           200            200            0.0026223848  -0.0015034796   0              0.0093706338   200.44282      0              19357333       1.1965779e-13  0              2.9945671    
    700000   7965           200            200            0.0023054615  -0.0017428024   0              0.0086591871   17.570114      0              1696795.8      1.1965779e-13  0              2.9948026    
    800000   7965           200            200            0.0027420922  -0.001657299    0              0.0098835755   0.2244367      0              21674.49       1.1965779e-13  0              2.9944412    
    900000   7965           200            200            0.0025260889  -0.0016869975   0              0.0092652641   0.16904244     0              16324.908      1.1965779e-13  0              2.9946162    
   1000000   7965           200            200            0.0025750771  -0.0016864734   0              0.0094117047   0.065159831    0              6292.6701      1.1965779e-13  0              2.9945746    
   1100000   7965           200            200            0.0025798589  -0.001685815    0              0.0094253917   0.0043925269   0              424.19881      1.1965779e-13  0              2.9945702    
   1200000   7965           200            200            0.0025711751  -0.0016862453   0              0.0093997707   1.4055783e-06  0              0.13574069     1.1965779e-13  0              2.9945777    
   1300000   7965           200            200            0.0025748234  -0.0016862506   0              0.0094107207   9.0425282e-05  0              8.7326265      1.1965779e-13  0              2.9945745    
   1400000   7965           200            200            0.0025741414  -0.0016862479   0              0.0094086721   2.1352213e-05  0              2.0620439      1.1965779e-13  0              2.9945751    
   1500000   7965           200            200            0.0025739925  -0.0016862474   0              0.009408225    1.0842836e-06  0              0.10471235     1.1965779e-13  0              2.9945752    
   1600000   7965           200            200            0.0025741594  -0.0016862479   0              0.0094087262   9.9158046e-09  0              0.00095759743  1.1965779e-13  0              2.9945751    
   1700000   7965           200            200            0.0025740956  -0.0016862477   0              0.0094085345   3.6299821e-08  0              0.0035055769   1.1965779e-13  0              2.9945752    
   1800000   7965           200            200            0.0025741052  -0.0016862477   0              0.0094085633   6.7870145e-09  0              0.00065544128  1.1965779e-13  0              2.9945751    
   1900000   7965           200            200            0.002574109   -0.0016862478   0              0.0094085746   2.4751105e-10  0              2.3902845e-05  1.1965779e-13  0              2.9945751    
   2000000   7965           200            200            0.0025741058  -0.0016862477   0              0.009408565    1.0239391e-11  0              9.888471e-07   1.1965779e-13  0              2.9945751    
   2100000   7965           200            200            0.0025741069  -0.0016862477   0              0.0094085683   1.3921295e-11  0              1.3444191e-06  1.1965779e-13  0              2.9945751    
   2200000   7965           200            200            0.0025741067  -0.0016862477   0              0.009408568    2.0872037e-12  0              2.0156719e-07  1.1965779e-13  0              2.9945751    
   2300000   7965           200            200            0.0025741067  -0.0016862477   0              0.0094085677   4.9651299e-14  0              4.7949671e-09  1.1965779e-13  0              2.9945751    
   2400000   7965           200            200            0.0025741067  -0.0016862477   0              0.0094085679   6.9018221e-15  0              6.6652858e-10  1.1965779e-13  0              2.9945751    
   2500000   7965           200            200            0.0025741067  -0.0016862477   0              0.0094085678   5.1446285e-15  0              4.968314e-10   1.1965779e-13  0              2.9945751    
   2600000   7965           200            200            0.0025741067  -0.0016862477   0              0.0094085678   5.9304429e-16  0              5.7271973e-11  1.1965779e-13  0              2.9945751    
   2700000   7965           200            200            0.0025741067  -0.0016862477   0              0.0094085679   8.0390426e-18  0              7.7635319e-13  1.1965779e-13  0              2.9945751    
   2800000   7965           200            200            0.0025741067  -0.0016862477   0              0.0094085678   6.3863605e-19  0              6.1674899e-14  1.1965779e-13  0              2.9945751    
   2900000   7965           200            200            0.0025741067  -0.0016862477   0              0.0094085678   7.1133786e-18  0              6.8695919e-13  1.1965779e-13  0              2.9945751    
   3000000   7965           200            200            0.0025741067  -0.0016862477   0              0.0094085678   1.7500622e-19  0              1.6900848e-14  1.1965779e-13  0              2.9945751    
Loop time of 298.098 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8695131.326 ns/day, 0.000 hours/ns, 10063.809 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.259     | 37.428     | 64.739     | 426.6 | 12.56
Neigh   | 4.9268     | 5.0295     | 5.134      |   4.2 |  1.69
Comm    | 19.926     | 25.794     | 30.43      |  91.3 |  8.65
Output  | 0.26354    | 0.26384    | 0.26419    |   0.1 |  0.09
Modify  | 168.51     | 173.25     | 177.87     |  31.2 | 58.12
Other   |            | 56.33      |            |       | 18.90

Nlocal:         625.25 ave         877 max         374 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         324.75 ave         650 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1299
Ave neighs/atom = 0.51939224
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 32

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.32                                                               
Lattice spacing in x,y,z = 5.32 5.32 5.32

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3990 ${n1e1} -100 100 -100 100 units box
region box block -3990 3990 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3990 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3990 3990 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3990 -100 -100) to (3990 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3990 -100 -100) to (3990 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3990 -100 -100) to (3990 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_32_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5149 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 102.8 | 102.8 | 102.8 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7980           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7980           200            200            0.0025354994   2.5306865e-36  0              0.0076064981   580777.67      0              5.6087351e+10  1.1965779e-13  0              3.3299284    
    200000   7980           200            200            0.00087259339 -4.0490879e-35  0              0.0026177802   135206.19      0              1.3057246e+10  1.1965779e-13  0              3.0801573    
    300000   7980           200            200            1.7557894e-05  6.0736589e-35  0              5.2673682e-05  119.82638      0              11571974       1.1965779e-13  0              3.0449255    
    400000   7980           200            200            5.3679279e-05  5.5241138e-40  0              0.00016103784  1080.5836      0              1.0435503e+08  1.1965779e-13  0              3.0052065    
    500000   7980           200            200            0.0065499102   0.00045264623  0              0.019197084    344.60166      0              33279162       1.1965779e-13  0              2.9923253    
    600000   7980           200            200            0.0043121665  -8.4604952e-05  0              0.013021104    16.286107      0              1572795.7      1.1965779e-13  0              2.9936725    
    700000   7980           200            200            0.0025872829  -0.00046235778  0              0.0082242066   5.4951789      0              530685.05      1.1965779e-13  0              2.9949856    
    800000   7980           200            200            0.0030985038  -0.00036513981  0              0.0096606511   2.5326978      0              244589.83      1.1965779e-13  0              2.9945712    
    900000   7980           200            200            0.0030003762  -0.00036887472  0              0.0093700034   0.47998349     0              46353.369      1.1965779e-13  0              2.9946508    
   1000000   7980           200            200            0.0029997498  -0.00036896671  0              0.0093682162   0.057128833    0              5517.0938      1.1965779e-13  0              2.9946525    
   1100000   7980           200            200            0.003013488   -0.00036835811  0              0.0094088222   0.0039718078   0              383.56877      1.1965779e-13  0              2.9946405    
   1200000   7980           200            200            0.0030046164  -0.00036874076  0              0.00938259     8.0779007e-05  0              7.8010583      1.1965779e-13  0              2.9946481    
   1300000   7980           200            200            0.0030085719  -0.00036857112  0              0.009394287    6.8374398e-06  0              0.66031099     1.1965779e-13  0              2.9946447    
   1400000   7980           200            200            0.0030071795  -0.00036863016  0              0.0093901688   8.5474339e-06  0              0.82544998     1.1965779e-13  0              2.9946459    
   1500000   7980           200            200            0.0030075573  -0.00036861433  0              0.0093912862   2.4362112e-06  0              0.23527184     1.1965779e-13  0              2.9946456    
   1600000   7980           200            200            0.0030074979  -0.00036861672  0              0.0093911103   3.9340901e-07  0              0.037992626    1.1965779e-13  0              2.9946456    
   1700000   7980           200            200            0.0030074858  -0.00036861729  0              0.0093910747   3.9997419e-08  0              0.0038626645   1.1965779e-13  0              2.9946457    
   1800000   7980           200            200            0.0030075017  -0.0003686166   0              0.0093911217   2.1434155e-09  0              0.00020699573  1.1965779e-13  0              2.9946456    
   1900000   7980           200            200            0.0030074929  -0.00036861698  0              0.0093910958   1.1069973e-11  0              1.0690587e-06  1.1965779e-13  0              2.9946457    
   2000000   7980           200            200            0.0030074965  -0.00036861682  0              0.0093911064   1.6539495e-11  0              1.597266e-06   1.1965779e-13  0              2.9946457    
   2100000   7980           200            200            0.0030074954  -0.00036861687  0              0.009391103    9.6755186e-12  0              9.3439233e-07  1.1965779e-13  0              2.9946457    
   2200000   7980           200            200            0.0030074956  -0.00036861686  0              0.0093911038   2.2119946e-12  0              2.1361861e-07  1.1965779e-13  0              2.9946457    
   2300000   7980           200            200            0.0030074956  -0.00036861686  0              0.0093911037   3.0694579e-13  0              2.9642627e-08  1.1965779e-13  0              2.9946457    
   2400000   7980           200            200            0.0030074956  -0.00036861686  0              0.0093911037   2.6181157e-14  0              2.5283887e-09  1.1965779e-13  0              2.9946457    
   2500000   7980           200            200            0.0030074956  -0.00036861686  0              0.0093911037   9.6970588e-16  0              9.3647253e-11  1.1965779e-13  0              2.9946457    
   2600000   7980           200            200            0.0030074956  -0.00036861686  0              0.0093911037   6.8218764e-18  0              6.58808e-13    1.1965779e-13  0              2.9946457    
   2700000   7980           200            200            0.0030074956  -0.00036861686  0              0.0093911037   2.0341844e-17  0              1.9644697e-12  1.1965779e-13  0              2.9946457    
   2800000   7980           200            200            0.0030074956  -0.00036861686  0              0.0093911037   4.9514934e-18  0              4.7817979e-13  1.1965779e-13  0              2.9946457    
   2900000   7980           200            200            0.0030074956  -0.00036861686  0              0.0093911037   4.1046822e-18  0              3.9640083e-13  1.1965779e-13  0              2.9946457    
   3000000   7980           200            200            0.0030074956  -0.00036861686  0              0.0093911037   3.7993626e-18  0              3.6691524e-13  1.1965779e-13  0              2.9946457    
Loop time of 297.804 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8703716.262 ns/day, 0.000 hours/ns, 10073.746 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.21      | 36.894     | 63.705     | 422.0 | 12.39
Neigh   | 4.9553     | 5.0571     | 5.1616     |   4.1 |  1.70
Comm    | 20.05      | 39.646     | 78.85      | 365.0 | 13.31
Output  | 0.27087    | 0.27116    | 0.27148    |   0.1 |  0.09
Modify  | 110.62     | 159.2      | 179.66     | 224.2 | 53.46
Other   |            | 56.74      |            |       | 19.05

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         323.75 ave         648 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1295
Ave neighs/atom = 0.51779288
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 33

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.33                                                               
Lattice spacing in x,y,z = 5.33 5.33 5.33

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -3997.5 ${n1e1} -100 100 -100 100 units box
region box block -3997.5 3997.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3997.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -3997.5 3997.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-3997.5 -100 -100) to (3997.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-3997.5 -100 -100) to (3997.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-3997.5 -100 -100) to (3997.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_33_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5159 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 102.9 | 102.9 | 102.9 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   7995           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   7995           200            200            0.0025300998  -4.4203836e-36  0              0.0075902994   580560.04      0              5.6066333e+10  1.1965779e-13  0              3.3300761    
    200000   7995           200            200            0.00086964458  1.5155632e-35  0              0.0026089337   134888.98      0              1.3026612e+10  1.1965779e-13  0              3.0803726    
    300000   7995           200            200            1.7693928e-05 -1.2124376e-34  0              5.3081785e-05  122.1188       0              11793360       1.1965779e-13  0              3.0447732    
    400000   7995           200            200            5.6176854e-05  4.0415668e-35  0              0.00016853056  1183.3749      0              1.1428188e+08  1.1965779e-13  0              3.0049452    
    500000   7995           200            200            0.0078433729   0.0042963991   0              0.01923372     333.79411      0              32235446       1.1965779e-13  0              2.9921489    
    600000   7995           200            200            0.0052547675   0.0029847357   0              0.012779567    37.553171      0              3626616.5      1.1965779e-13  0              2.9935515    
    700000   7995           200            200            0.0036038157   0.0025083095   0              0.0083031375   8.4519417      0              816228.04      1.1965779e-13  0              2.9947778    
    800000   7995           200            200            0.0039775982   0.002498233    0              0.0094345617   3.52705        0              340617.24      1.1965779e-13  0              2.9944484    
    900000   7995           200            200            0.0039828052   0.0024761542   0              0.0094722613   0.32668459     0              31548.859      1.1965779e-13  0              2.9944343    
   1000000   7995           200            200            0.0039217916   0.0024552784   0              0.0093100964   0.0038365314   0              370.50475      1.1965779e-13  0              2.9944817    
   1100000   7995           200            200            0.0039516664   0.0024607043   0              0.0093942948   0.001800775    0              173.90596      1.1965779e-13  0              2.9944575    
   1200000   7995           200            200            0.0039429498   0.0024592985   0              0.0093695508   0.0010150721   0              98.028401      1.1965779e-13  0              2.9944645    
   1300000   7995           200            200            0.0039437727   0.0024594232   0              0.0093718949   0.00014247424  0              13.759142      1.1965779e-13  0              2.9944639    
   1400000   7995           200            200            0.0039444929   0.0024595459   0              0.0093739328   5.3721621e-06  0              0.51880497     1.1965779e-13  0              2.9944633    
   1500000   7995           200            200            0.0039439829   0.0024594611   0              0.0093724874   1.0591498e-07  0              0.010228511    1.1965779e-13  0              2.9944637    
   1600000   7995           200            200            0.0039441684   0.0024594916   0              0.0093730136   2.4302397e-07  0              0.023469516    1.1965779e-13  0              2.9944635    
   1700000   7995           200            200            0.0039441344   0.0024594861   0              0.009372917    5.2583598e-08  0              0.0050781475   1.1965779e-13  0              2.9944636    
   1800000   7995           200            200            0.0039441282   0.002459485    0              0.0093728996   3.6715784e-09  0              0.00035457477  1.1965779e-13  0              2.9944636    
   1900000   7995           200            200            0.0039441362   0.0024594864   0              0.0093729222   7.0366152e-12  0              6.7954593e-07  1.1965779e-13  0              2.9944635    
   2000000   7995           200            200            0.0039441326   0.0024594858   0              0.009372912    4.4929179e-11  0              4.3389386e-06  1.1965779e-13  0              2.9944636    
   2100000   7995           200            200            0.0039441335   0.0024594859   0              0.0093729146   1.6586818e-11  0              1.6018362e-06  1.1965779e-13  0              2.9944636    
   2200000   7995           200            200            0.0039441335   0.0024594859   0              0.0093729146   1.830929e-12   0              1.7681802e-07  1.1965779e-13  0              2.9944636    
   2300000   7995           200            200            0.0039441334   0.0024594859   0              0.0093729142   4.0481342e-14  0              3.9093983e-09  1.1965779e-13  0              2.9944636    
   2400000   7995           200            200            0.0039441334   0.0024594859   0              0.0093729144   5.0253419e-15  0              4.8531155e-10  1.1965779e-13  0              2.9944636    
   2500000   7995           200            200            0.0039441334   0.0024594859   0              0.0093729144   4.4177293e-15  0              4.2663268e-10  1.1965779e-13  0              2.9944636    
   2600000   7995           200            200            0.0039441334   0.0024594859   0              0.0093729144   7.3251393e-16  0              7.0740952e-11  1.1965779e-13  0              2.9944636    
   2700000   7995           200            200            0.0039441334   0.0024594859   0              0.0093729144   3.7939902e-17  0              3.6639641e-12  1.1965779e-13  0              2.9944636    
   2800000   7995           200            200            0.0039441334   0.0024594859   0              0.0093729144   3.9585636e-19  0              3.8228974e-14  1.1965779e-13  0              2.9944636    
   2900000   7995           200            200            0.0039441334   0.0024594859   0              0.0093729144   3.2206938e-18  0              3.1103155e-13  1.1965779e-13  0              2.9944636    
   3000000   7995           200            200            0.0039441334   0.0024594859   0              0.0093729144   2.6972139e-18  0              2.6047761e-13  1.1965779e-13  0              2.9944636    
Loop time of 301.31 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8602449.605 ns/day, 0.000 hours/ns, 9956.539 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.278     | 38.018     | 67.544     | 429.9 | 12.62
Neigh   | 4.9279     | 5.0255     | 5.1256     |   3.9 |  1.67
Comm    | 19.647     | 41.457     | 82.947     | 380.4 | 13.76
Output  | 0.27219    | 0.27251    | 0.27283    |   0.1 |  0.09
Modify  | 109.78     | 159.62     | 178.42     | 228.4 | 52.98
Other   |            | 56.91      |            |       | 18.89

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         323.25 ave         647 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1293
Ave neighs/atom = 0.5169932
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 34

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.34                                                               
Lattice spacing in x,y,z = 5.34 5.34 5.34

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4005 ${n1e1} -100 100 -100 100 units box
region box block -4005 4005 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4005 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4005 4005 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4005 -100 -100) to (4005 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4005 -100 -100) to (4005 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4005 -100 -100) to (4005 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_34_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5168 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 103 | 103 | 103 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8010           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8010           200            200            0.0025253737  -2.0169577e-35  0              0.007576121    580563.52      0              5.6066669e+10  1.1965779e-13  0              3.3300778    
    200000   8010           200            200            0.00086781027  4.0340542e-35  0              0.0026034308   134837.4       0              1.3021631e+10  1.1965779e-13  0              3.0804453    
    300000   8010           200            200            1.6063262e-05  4.0339648e-35  0              4.8189786e-05  101.35193      0              9787844.2      1.1965779e-13  0              3.0448281    
    400000   8010           200            200            5.1542876e-05 -6.0508627e-35  0              0.00015462863  1006.824       0              97231857       1.1965779e-13  0              3.0051848    
    500000   8010           200            200            0.0081552336   0.0061690295   0              0.018296671    531.97487      0              51374325       1.1965779e-13  0              2.9924208    
    600000   8010           200            200            0.0058455677   0.0044572081   0              0.013079495    11.287266      0              1090043.3      1.1965779e-13  0              2.9935454    
    700000   8010           200            200            0.0048317127   0.0039033202   0              0.010591818    3.7128121      0              358556.82      1.1965779e-13  0              2.9941628    
    800000   8010           200            200            0.0045071145   0.003830299    0              0.0096910445   1.7843645      0              172321.15      1.1965779e-13  0              2.9944116    
    900000   8010           200            200            0.0043907908   0.0038013638   0              0.0093710086   0.47497302     0              45869.495      1.1965779e-13  0              2.9945054    
   1000000   8010           200            200            0.0043690896   0.0037956506   0              0.0093116182   0.034266211    0              3309.1854      1.1965779e-13  0              2.9945238    
   1100000   8010           200            200            0.0043765118   0.0037973088   0              0.0093322266   3.0398105e-05  0              2.9356314      1.1965779e-13  0              2.9945179    
   1200000   8010           200            200            0.0043830996   0.0037987757   0              0.0093505231   0.00076374476  0              73.757002      1.1965779e-13  0              2.9945125    
   1300000   8010           200            200            0.0043851914   0.0037992469   0              0.0093563273   0.00014783851  0              14.277185      1.1965779e-13  0              2.9945107    
   1400000   8010           200            200            0.004385278    0.0037992697   0              0.0093565643   3.7827928e-06  0              0.36531505     1.1965779e-13  0              2.9945107    
   1500000   8010           200            200            0.0043850362   0.0037992169   0              0.0093558918   5.3664352e-07  0              0.05182519     1.1965779e-13  0              2.9945109    
   1600000   8010           200            200            0.0043849118   0.0037991892   0              0.0093555461   3.6500619e-07  0              0.035249685    1.1965779e-13  0              2.994511     
   1700000   8010           200            200            0.0043848863   0.0037991834   0              0.0093554755   3.3524137e-08  0              0.0032375212   1.1965779e-13  0              2.994511     
   1800000   8010           200            200            0.0043848912   0.0037991844   0              0.0093554892   1.5535828e-11  0              1.5003391e-06  1.1965779e-13  0              2.994511     
   1900000   8010           200            200            0.0043848969   0.0037991857   0              0.0093555051   5.2249909e-10  0              5.0459222e-05  1.1965779e-13  0              2.994511     
   2000000   8010           200            200            0.0043848989   0.0037991861   0              0.0093555107   1.2538685e-10  0              1.2108964e-05  1.1965779e-13  0              2.994511     
   2100000   8010           200            200            0.0043848991   0.0037991862   0              0.0093555111   4.5865716e-12  0              4.4293825e-07  1.1965779e-13  0              2.994511     
   2200000   8010           200            200            0.0043848989   0.0037991861   0              0.0093555106   2.6108826e-13  0              2.5214035e-08  1.1965779e-13  0              2.994511     
   2300000   8010           200            200            0.0043848988   0.0037991861   0              0.0093555103   2.7802046e-13  0              2.6849226e-08  1.1965779e-13  0              2.994511     
   2400000   8010           200            200            0.0043848988   0.0037991861   0              0.0093555102   3.1388512e-14  0              3.0312778e-09  1.1965779e-13  0              2.994511     
   2500000   8010           200            200            0.0043848988   0.0037991861   0              0.0093555102   1.4890737e-16  0              1.4380408e-11  1.1965779e-13  0              2.994511     
   2600000   8010           200            200            0.0043848988   0.0037991861   0              0.0093555102   2.9925795e-16  0              2.8900191e-11  1.1965779e-13  0              2.994511     
   2700000   8010           200            200            0.0043848988   0.0037991861   0              0.0093555102   1.0150529e-16  0              9.8026546e-12  1.1965779e-13  0              2.994511     
   2800000   8010           200            200            0.0043848988   0.0037991861   0              0.0093555102   1.1243332e-18  0              1.0858005e-13  1.1965779e-13  0              2.994511     
   2900000   8010           200            200            0.0043848988   0.0037991861   0              0.0093555102   9.3222525e-19  0              9.0027642e-14  1.1965779e-13  0              2.994511     
   3000000   8010           200            200            0.0043848988   0.0037991861   0              0.0093555102   3.0305199e-18  0              2.9266592e-13  1.1965779e-13  0              2.994511     
Loop time of 299.833 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8644802.466 ns/day, 0.000 hours/ns, 10005.558 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.227     | 37.672     | 65.86      | 429.1 | 12.56
Neigh   | 4.9741     | 5.0721     | 5.1722     |   3.9 |  1.69
Comm    | 19.557     | 40.744     | 81.646     | 377.1 | 13.59
Output  | 0.27436    | 0.2747     | 0.27506    |   0.1 |  0.09
Modify  | 109.77     | 159.36     | 178.49     | 227.8 | 53.15
Other   |            | 56.71      |            |       | 18.91

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         325.75 ave         652 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1303
Ave neighs/atom = 0.5209916
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 35

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.35                                                               
Lattice spacing in x,y,z = 5.35 5.35 5.35

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4012.5 ${n1e1} -100 100 -100 100 units box
region box block -4012.5 4012.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4012.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4012.5 4012.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4012.5 -100 -100) to (4012.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4012.5 -100 -100) to (4012.5 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4012.5 -100 -100) to (4012.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_35_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5178 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 103.2 | 103.2 | 103.2 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8025           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8025           200            200            0.0025206004   1.006601e-35   0              0.0075618012   580537.45      0              5.6064152e+10  1.1965779e-13  0              3.3301556    
    200000   8025           200            200            0.00086589534  9.7484455e-40  0              0.002597686    134761.82      0              1.3014332e+10  1.1965779e-13  0              3.0805949    
    300000   8025           200            200            1.5595289e-05 -1.006588e-35   0              4.6785868e-05  95.975049      0              9268583.3      1.1965779e-13  0              3.0448976    
    400000   8025           200            200            5.0740565e-05  8.0528434e-35  0              0.00015222169  980.40891      0              94680875       1.1965779e-13  0              3.0052754    
    500000   8025           200            200            0.0055401686  -0.0017452559   0              0.018365762    488.65969      0              47191255       1.1965779e-13  0              2.9924392    
    600000   8025           200            200            0.0037955193  -0.0016954842   0              0.013082042    0.39946066     0              38577.051      1.1965779e-13  0              2.9936072    
    700000   8025           200            200            0.0022907167  -0.001842345    0              0.0087144952   20.730488      0              2002002.1      1.1965779e-13  0              2.9947989    
    800000   8025           200            200            0.0024105636  -0.001890483    0              0.0091221739   2.8322919      0              273522.47      1.1965779e-13  0              2.9946871    
    900000   8025           200            200            0.0025384457  -0.0018968712   0              0.0095122083   0.015169863    0              1464.9967      1.1965779e-13  0              2.9945715    
   1000000   8025           200            200            0.0024656187  -0.0018932971   0              0.0092901532   0.029727058    0              2870.8265      1.1965779e-13  0              2.9946356    
   1100000   8025           200            200            0.0024808191  -0.0018940197   0              0.0093364771   0.0087413186   0              844.17398      1.1965779e-13  0              2.9946226    
   1200000   8025           200            200            0.0024838457  -0.0018941765   0              0.0093457138   0.00033992406  0              32.827433      1.1965779e-13  0              2.9946197    
   1300000   8025           200            200            0.0024804461  -0.001894009    0              0.0093353474   1.924407e-05   0              1.8584545      1.1965779e-13  0              2.9946228    
   1400000   8025           200            200            0.0024815547  -0.0018940626   0              0.0093387267   1.9744849e-05  0              1.9068161      1.1965779e-13  0              2.9946218    
   1500000   8025           200            200            0.0024815187  -0.0018940613   0              0.0093386173   1.9334843e-06  0              0.18672207     1.1965779e-13  0              2.9946218    
   1600000   8025           200            200            0.0024813852  -0.0018940546   0              0.0093382103   4.3920739e-10  0              4.2415506e-05  1.1965779e-13  0              2.9946219    
   1700000   8025           200            200            0.0024814496  -0.0018940578   0              0.0093384066   3.1754697e-08  0              0.0030666413   1.1965779e-13  0              2.9946219    
   1800000   8025           200            200            0.0024814389  -0.0018940573   0              0.0093383739   6.7763976e-09  0              0.00065441598  1.1965779e-13  0              2.9946219    
   1900000   8025           200            200            0.002481435   -0.0018940571   0              0.009338362    1.6095504e-10  0              1.5543886e-05  1.1965779e-13  0              2.9946219    
   2000000   8025           200            200            0.0024814382  -0.0018940572   0              0.0093383718   2.9629937e-11  0              2.8614472e-06  1.1965779e-13  0              2.9946219    
   2100000   8025           200            200            0.0024814373  -0.0018940572   0              0.009338369    1.7134453e-11  0              1.6547228e-06  1.1965779e-13  0              2.9946219    
   2200000   8025           200            200            0.0024814373  -0.0018940572   0              0.0093383689   1.2369865e-12  0              1.194593e-07   1.1965779e-13  0              2.9946219    
   2300000   8025           200            200            0.0024814374  -0.0018940572   0              0.0093383694   3.8779291e-15  0              3.7450263e-10  1.1965779e-13  0              2.9946219    
   2400000   8025           200            200            0.0024814373  -0.0018940572   0              0.0093383692   3.1622267e-14  0              3.0538522e-09  1.1965779e-13  0              2.9946219    
   2500000   8025           200            200            0.0024814373  -0.0018940572   0              0.0093383692   5.0225041e-15  0              4.8503749e-10  1.1965779e-13  0              2.9946219    
   2600000   8025           200            200            0.0024814373  -0.0018940572   0              0.0093383692   4.3018174e-17  0              4.1543873e-12  1.1965779e-13  0              2.9946219    
   2700000   8025           200            200            0.0024814373  -0.0018940572   0              0.0093383692   2.8809856e-17  0              2.7822497e-12  1.1965779e-13  0              2.9946219    
   2800000   8025           200            200            0.0024814373  -0.0018940572   0              0.0093383692   1.2742165e-17  0              1.2305471e-12  1.1965779e-13  0              2.9946219    
   2900000   8025           200            200            0.0024814373  -0.0018940572   0              0.0093383692   6.7921992e-19  0              6.5594199e-14  1.1965779e-13  0              2.9946219    
   3000000   8025           200            200            0.0024814373  -0.0018940572   0              0.0093383692   3.7122983e-18  0              3.5850719e-13  1.1965779e-13  0              2.9946219    
Loop time of 295.487 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8771956.348 ns/day, 0.000 hours/ns, 10152.727 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.404     | 36.827     | 63.242     | 418.8 | 12.46
Neigh   | 4.9686     | 5.0661     | 5.1657     |   4.0 |  1.71
Comm    | 19.77      | 25.565     | 30.249     |  91.1 |  8.65
Output  | 0.27409    | 0.27441    | 0.27476    |   0.1 |  0.09
Modify  | 166.07     | 171.66     | 176.35     |  36.0 | 58.09
Other   |            | 56.09      |            |       | 18.98

Nlocal:         625.25 ave         877 max         374 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         322.25 ave         645 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1289
Ave neighs/atom = 0.51539384
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 36

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.36                                                               
Lattice spacing in x,y,z = 5.36 5.36 5.36

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4020 ${n1e1} -100 100 -100 100 units box
region box block -4020 4020 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4020 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4020 4020 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4020 -100 -100) to (4020 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1499 atoms
  using lattice units in orthogonal box = (-4020 -100 -100) to (4020 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4020 -100 -100) to (4020 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1499 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1499 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1499 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_36_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5188 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 103.4 | 103.4 | 103.4 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8040           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8040           200            200            0.0025158873  -5.023564e-36   0              0.0075476618   580544.22      0              5.6177159e+10  1.1965779e-13  0              3.3300739    
    200000   8040           200            200            0.00086449961 -5.023585e-36   0              0.0025934988   134821.52      0              1.304619e+10   1.1965779e-13  0              3.0804181    
    300000   8040           200            200            1.449461e-05  -1.0047118e-35  0              4.3483829e-05  83.413663      0              8071637.8      1.1965779e-13  0              3.0448197    
    400000   8040           200            200            4.6226972e-05  4.5352846e-42  0              0.00013868091  822.46291      0              79586754       1.1965779e-13  0              3.0053745    
    500000   8040           200            200            0.0051835446  -0.002403972    0              0.017954606    568.23696      0              54986231       1.1965779e-13  0              2.9924877    
    600000   8040           200            200            0.0038826577  -0.0012457244   0              0.012893698    19.248067      0              1862565.7      1.1965779e-13  0              2.993612     
    700000   8040           200            200            0.0025376473  -0.0004734641   0              0.0080864059   2.4646454      0              238494.8       1.1965779e-13  0              2.9949398    
    800000   8040           200            200            0.0030096865  -0.00066544176  0              0.0096945013   1.4960468      0              144767.03      1.1965779e-13  0              2.9944716    
    900000   8040           200            200            0.00286074    -0.00064810249  0              0.0092303226   0.36228259     0              35056.773      1.1965779e-13  0              2.9946017    
   1000000   8040           200            200            0.0028935899  -0.00065216429  0              0.009332934    0.063381305    0              6133.1792      1.1965779e-13  0              2.9945733    
   1100000   8040           200            200            0.0028908812  -0.00065189147  0              0.009324535    0.0085853855   0              830.77663      1.1965779e-13  0              2.9945753    
   1200000   8040           200            200            0.0028883443  -0.00065154549  0              0.0093165785   0.00090513313  0              87.586452      1.1965779e-13  0              2.9945777    
   1300000   8040           200            200            0.0028904668  -0.00065182214  0              0.0093232226   6.8875955e-05  0              6.6648765      1.1965779e-13  0              2.9945758    
   1400000   8040           200            200            0.0028893424  -0.00065167778  0              0.009319705    2.8151038e-06  0              0.27240739     1.1965779e-13  0              2.9945768    
   1500000   8040           200            200            0.0028898333  -0.00065174031  0              0.0093212402   1.6296441e-09  0              0.00015769475  1.1965779e-13  0              2.9945764    
   1600000   8040           200            200            0.0028896457  -0.00065171658  0              0.0093206535   3.9360845e-08  0              0.0038088063   1.1965779e-13  0              2.9945765    
   1700000   8040           200            200            0.0028897091  -0.00065172455  0              0.0093208519   2.0325657e-08  0              0.0019668401   1.1965779e-13  0              2.9945765    
   1800000   8040           200            200            0.0028896906  -0.00065172224  0              0.0093207939   5.152149e-09   0              0.00049855478  1.1965779e-13  0              2.9945765    
   1900000   8040           200            200            0.0028896948  -0.00065172276  0              0.0093208073   9.2307039e-10  0              8.9322176e-05  1.1965779e-13  0              2.9945765    
   2000000   8040           200            200            0.0028896944  -0.00065172271  0              0.0093208059   1.2809141e-10  0              1.2394942e-05  1.1965779e-13  0              2.9945765    
   2100000   8040           200            200            0.0028896941  -0.00065172267  0              0.009320805    1.3872251e-11  0              1.3423674e-06  1.1965779e-13  0              2.9945765    
   2200000   8040           200            200            0.0028896944  -0.00065172271  0              0.0093208058   1.0977136e-12  0              1.0622176e-07  1.1965779e-13  0              2.9945765    
   2300000   8040           200            200            0.0028896942  -0.00065172269  0              0.0093208054   4.9204966e-14  0              4.7613862e-09  1.1965779e-13  0              2.9945765    
   2400000   8040           200            200            0.0028896943  -0.0006517227   0              0.0093208056   1.4943778e-16  0              1.4460552e-11  1.1965779e-13  0              2.9945765    
   2500000   8040           200            200            0.0028896943  -0.00065172269  0              0.0093208055   4.2202021e-16  0              4.0837366e-11  1.1965779e-13  0              2.9945765    
   2600000   8040           200            200            0.0028896943  -0.00065172269  0              0.0093208055   2.7006936e-16  0              2.6133633e-11  1.1965779e-13  0              2.9945765    
   2700000   8040           200            200            0.0028896943  -0.00065172269  0              0.0093208055   5.4904381e-17  0              5.312898e-12   1.1965779e-13  0              2.9945765    
   2800000   8040           200            200            0.0028896943  -0.00065172269  0              0.0093208055   8.5833545e-18  0              8.305801e-13   1.1965779e-13  0              2.9945765    
   2900000   8040           200            200            0.0028896943  -0.00065172269  0              0.0093208055   4.8275826e-18  0              4.6714766e-13  1.1965779e-13  0              2.9945765    
   3000000   8040           200            200            0.0028896943  -0.00065172269  0              0.0093208055   2.2705349e-20  0              2.1971143e-15  1.1965779e-13  0              2.9945765    
Loop time of 298.814 on 4 procs for 3000000 steps with 2500 atoms

Performance: 8674300.093 ns/day, 0.000 hours/ns, 10039.699 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.798     | 36.964     | 64.708     | 430.6 | 12.37
Neigh   | 5.0042     | 5.1014     | 5.2019     |   3.9 |  1.71
Comm    | 30.832     | 55.65      | 83.216     | 328.2 | 18.62
Output  | 0.27496    | 0.27527    | 0.27561    |   0.1 |  0.09
Modify  | 108.17     | 144.4      | 178.21     | 274.9 | 48.33
Other   |            | 56.42      |            |       | 18.88

Nlocal:            625 ave         875 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:            1.5 ave           3 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Neighs:         322.75 ave         646 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1291
Ave neighs/atom = 0.5164
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 37

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.37                                                               
Lattice spacing in x,y,z = 5.37 5.37 5.37

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4027.5 ${n1e1} -100 100 -100 100 units box
region box block -4027.5 4027.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4027.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4027.5 4027.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4027.5 -100 -100) to (4027.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4027.5 -100 -100) to (4027.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4027.5 -100 -100) to (4027.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_37_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5197 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 103.6 | 103.6 | 103.6 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8055           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8055           200            200            0.0025111463  -2.0056895e-35  0              0.0075334389   580524.43      0              5.6062894e+10  1.1965779e-13  0              3.3300926    
    200000   8055           200            200            0.00086267643 -6.0170327e-35  0              0.0025880293   134768.48      0              1.3014975e+10  1.1965779e-13  0              3.0804779    
    300000   8055           200            200            1.5100067e-05  2.431322e-40   0              4.5300202e-05  90.741058      0              8763121.9      1.1965779e-13  0              3.0448043    
    400000   8055           200            200            4.7256496e-05  2.0057023e-35  0              0.00014176949  861.21516      0              83169996       1.1965779e-13  0              3.005315     
    500000   8055           200            200            0.0067507223   0.0035702224   0              0.016681945    785.23664      0              75832534       1.1965779e-13  0              2.9927271    
    600000   8055           200            200            0.0051512145   0.002431979    0              0.013021665    5.870784       0              566958.3       1.1965779e-13  0              2.9935608    
    700000   8055           200            200            0.003801868    0.0018881526   0              0.0095174514   25.72287       0              2484130.7      1.1965779e-13  0              2.994482     
    800000   8055           200            200            0.0035739004   0.0018618175   0              0.0088598838   0.37954824     0              36654.053      1.1965779e-13  0              2.9946841    
    900000   8055           200            200            0.0036992956   0.0018770244   0              0.0092208626   0.36922771     0              35657.369      1.1965779e-13  0              2.9945766    
   1000000   8055           200            200            0.0037475724   0.0018851295   0              0.0093575877   0.018969446    0              1831.9333      1.1965779e-13  0              2.9945356    
   1100000   8055           200            200            0.0037332363   0.0018828792   0              0.0093168296   0.0057943125   0              559.57322      1.1965779e-13  0              2.9945472    
   1200000   8055           200            200            0.0037261635   0.0018819416   0              0.0092965489   0.00045107168  0              43.561274      1.1965779e-13  0              2.9945533    
   1300000   8055           200            200            0.0037278197   0.0018821388   0              0.0093013204   9.0909438e-05  0              8.7793828      1.1965779e-13  0              2.9945519    
   1400000   8055           200            200            0.0037288278   0.0018822629   0              0.0093042204   1.0180766e-05  0              0.98318554     1.1965779e-13  0              2.9945511    
   1500000   8055           200            200            0.0037286388   0.0018822408   0              0.0093036756   1.386221e-06   0              0.1338713      1.1965779e-13  0              2.9945512    
   1600000   8055           200            200            0.0037284964   0.0018822233   0              0.0093032659   2.2137431e-07  0              0.021378746    1.1965779e-13  0              2.9945513    
   1700000   8055           200            200            0.003728517    0.0018822257   0              0.0093033254   2.0382352e-08  0              0.0019683817   1.1965779e-13  0              2.9945513    
   1800000   8055           200            200            0.0037285369   0.0018822281   0              0.0093033827   4.6691496e-09  0              0.00045091304  1.1965779e-13  0              2.9945513    
   1900000   8055           200            200            0.0037285348   0.0018822279   0              0.0093033766   2.8654317e-10  0              2.7672288e-05  1.1965779e-13  0              2.9945513    
   2000000   8055           200            200            0.0037285321   0.0018822276   0              0.0093033687   9.591968e-11   0              9.2632361e-06  1.1965779e-13  0              2.9945513    
   2100000   8055           200            200            0.0037285323   0.0018822276   0              0.0093033692   3.8011044e-12  0              3.6708346e-07  1.1965779e-13  0              2.9945513    
   2200000   8055           200            200            0.0037285327   0.0018822276   0              0.0093033703   1.9254041e-12  0              1.8594174e-07  1.1965779e-13  0              2.9945513    
   2300000   8055           200            200            0.0037285326   0.0018822276   0              0.0093033703   4.6462523e-14  0              4.4870179e-09  1.1965779e-13  0              2.9945513    
   2400000   8055           200            200            0.0037285326   0.0018822276   0              0.0093033701   3.7813104e-14  0              3.6517189e-09  1.1965779e-13  0              2.9945513    
   2500000   8055           200            200            0.0037285326   0.0018822276   0              0.0093033701   5.2602061e-16  0              5.0799305e-11  1.1965779e-13  0              2.9945513    
   2600000   8055           200            200            0.0037285326   0.0018822276   0              0.0093033702   7.2491829e-16  0              7.000742e-11   1.1965779e-13  0              2.9945513    
   2700000   8055           200            200            0.0037285326   0.0018822276   0              0.0093033702   8.2370456e-18  0              7.9547491e-13  1.1965779e-13  0              2.9945513    
   2800000   8055           200            200            0.0037285326   0.0018822276   0              0.0093033702   1.0589624e-17  0              1.0226701e-12  1.1965779e-13  0              2.9945513    
   2900000   8055           200            200            0.0037285326   0.0018822276   0              0.0093033702   1.8569475e-18  0              1.793307e-13   1.1965779e-13  0              2.9945513    
   3000000   8055           200            200            0.0037285326   0.0018822276   0              0.0093033702   5.0530641e-19  0              4.8798876e-14  1.1965779e-13  0              2.9945513    
Loop time of 298.144 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8693779.271 ns/day, 0.000 hours/ns, 10062.245 timesteps/s
99.9% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.188     | 37.147     | 64.481     | 425.4 | 12.46
Neigh   | 4.9849     | 5.0803     | 5.1777     |   3.8 |  1.70
Comm    | 19.79      | 40.096     | 79.926     | 369.5 | 13.45
Output  | 0.28783    | 0.28813    | 0.28846    |   0.1 |  0.10
Modify  | 109.82     | 159.07     | 177.79     | 226.5 | 53.35
Other   |            | 56.47      |            |       | 18.94

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         323.75 ave         648 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1295
Ave neighs/atom = 0.51779288
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 38

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.38                                                               
Lattice spacing in x,y,z = 5.38 5.38 5.38

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4035 ${n1e1} -100 100 -100 100 units box
region box block -4035 4035 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4035 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4035 4035 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4035 -100 -100) to (4035 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4035 -100 -100) to (4035 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4035 -100 -100) to (4035 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_38_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5207 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 103.7 | 103.7 | 103.7 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8070           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8070           200            200            0.0025063442  -6.0058989e-35  0              0.0075190326   580461.68      0              5.6056834e+10  1.1965779e-13  0              3.33026      
    200000   8070           200            200            0.00086052312  1.0009889e-35  0              0.0025815694   134625.45      0              1.3001162e+10  1.1965779e-13  0              3.0807684    
    300000   8070           200            200            1.4694184e-05 -4.0038704e-35  0              4.4082552e-05  86.312928      0              8335484.8      1.1965779e-13  0              3.0449318    
    400000   8070           200            200            4.9900281e-05 -1.2412186e-33  0              0.00014970084  959.68252      0              92679268       1.1965779e-13  0              3.0053258    
    500000   8070           200            200            0.0060940962  -0.0014755541   0              0.019757843    191.80312      0              18522973       1.1965779e-13  0              2.9921848    
    600000   8070           200            200            0.0032323901  -0.0013108696   0              0.01100804     156.23568      0              15088123       1.1965779e-13  0              2.9941411    
    700000   8070           200            200            0.0024385845  -0.00082676328  0              0.0081425167   5.2146858      0              503597.03      1.1965779e-13  0              2.9949765    
    800000   8070           200            200            0.0029695038  -0.00085195061  0              0.0097604622   0.15877479     0              15333.332      1.1965779e-13  0              2.9944951    
    900000   8070           200            200            0.0027846381  -0.0008526045   0              0.0092065189   0.38686887     0              37361.026      1.1965779e-13  0              2.9946527    
   1000000   8070           200            200            0.0027997741  -0.00085388563  0              0.009253208    0.047431904    0              4580.6338      1.1965779e-13  0              2.9946402    
   1100000   8070           200            200            0.0028181293  -0.00085557827  0              0.0093099662   5.6729421e-07  0              0.054785214    1.1965779e-13  0              2.9946233    
   1200000   8070           200            200            0.0028089492  -0.00085475689  0              0.0092816045   0.00084641751  0              81.740945      1.1965779e-13  0              2.9946316    
   1300000   8070           200            200            0.002810039   -0.00085484973  0              0.0092849668   0.00013002514  0              12.556897      1.1965779e-13  0              2.9946307    
   1400000   8070           200            200            0.0028108534  -0.00085492496  0              0.0092874852   2.5502792e-07  0              0.024628771    1.1965779e-13  0              2.9946299    
   1500000   8070           200            200            0.0028103901  -0.00085488324  0              0.0092860536   1.8006129e-06  0              0.17389031     1.1965779e-13  0              2.9946303    
   1600000   8070           200            200            0.0028104602  -0.0008548893   0              0.00928627     3.4732238e-07  0              0.033541909    1.1965779e-13  0              2.9946303    
   1700000   8070           200            200            0.0028104955  -0.00085489258  0              0.009286379    2.2971769e-09  0              0.0002218449   1.1965779e-13  0              2.9946302    
   1800000   8070           200            200            0.0028104723  -0.00085489049  0              0.0092863075   3.7054663e-09  0              0.00035784741  1.1965779e-13  0              2.9946302    
   1900000   8070           200            200            0.0028104766  -0.00085489086  0              0.0092863206   9.0656491e-10  0              8.754955e-05   1.1965779e-13  0              2.9946302    
   2000000   8070           200            200            0.002810478   -0.000854891    0              0.0092863251   1.2144011e-11  0              1.1727817e-06  1.1965779e-13  0              2.9946302    
   2100000   8070           200            200            0.0028104769  -0.00085489089  0              0.0092863216   7.3330525e-12  0              7.0817372e-07  1.1965779e-13  0              2.9946302    
   2200000   8070           200            200            0.0028104771  -0.00085489092  0              0.0092863223   2.3154835e-12  0              2.2361283e-07  1.1965779e-13  0              2.9946302    
   2300000   8070           200            200            0.0028104772  -0.00085489092  0              0.0092863225   5.131379e-14   0              4.9555185e-09  1.1965779e-13  0              2.9946302    
   2400000   8070           200            200            0.0028104771  -0.00085489092  0              0.0092863224   1.3765484e-14  0              1.3293719e-09  1.1965779e-13  0              2.9946302    
   2500000   8070           200            200            0.0028104772  -0.00085489092  0              0.0092863224   5.7886568e-15  0              5.5902704e-10  1.1965779e-13  0              2.9946302    
   2600000   8070           200            200            0.0028104772  -0.00085489092  0              0.0092863224   1.583042e-16   0              1.5287887e-11  1.1965779e-13  0              2.9946302    
   2700000   8070           200            200            0.0028104772  -0.00085489092  0              0.0092863224   1.66305e-17    0              1.6060547e-12  1.1965779e-13  0              2.9946302    
   2800000   8070           200            200            0.0028104772  -0.00085489092  0              0.0092863224   1.1831204e-17  0              1.142573e-12   1.1965779e-13  0              2.9946302    
   2900000   8070           200            200            0.0028104772  -0.00085489092  0              0.0092863224   9.8461337e-19  0              9.5086911e-14  1.1965779e-13  0              2.9946302    
   3000000   8070           200            200            0.0028104772  -0.00085489091  0              0.0092863224   1.6163342e-18  0              1.5609399e-13  1.1965779e-13  0              2.9946302    
Loop time of 299.203 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8663015.520 ns/day, 0.000 hours/ns, 10026.638 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.249     | 37.203     | 64.474     | 420.8 | 12.43
Neigh   | 5.031      | 5.1297     | 5.2291     |   3.9 |  1.71
Comm    | 19.699     | 40.212     | 80.225     | 370.9 | 13.44
Output  | 0.27439    | 0.2747     | 0.27505    |   0.1 |  0.09
Modify  | 109.19     | 158.79     | 178.94     | 229.2 | 53.07
Other   |            | 57.59      |            |       | 19.25

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         323.75 ave         648 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1295
Ave neighs/atom = 0.51779288
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 39

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.39                                                               
Lattice spacing in x,y,z = 5.39 5.39 5.39

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4042.5 ${n1e1} -100 100 -100 100 units box
region box block -4042.5 4042.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4042.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4042.5 4042.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4042.5 -100 -100) to (4042.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4042.5 -100 -100) to (4042.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4042.5 -100 -100) to (4042.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_39_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5217 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 103.9 | 103.9 | 103.9 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8085           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8085           200            200            0.0025018485   9.9912763e-36  0              0.0075055454   580545.51      0              5.606493e+10   1.1965779e-13  0              3.3299723    
    200000   8085           200            200            0.00085981732  3.9965216e-35  0              0.0025794519   134860.35      0              1.3023848e+10  1.1965779e-13  0              3.0802357    
    300000   8085           200            200            1.4149545e-05 -2.9973687e-35  0              4.2448635e-05  80.435809      0              7767914.7      1.1965779e-13  0              3.0446911    
    400000   8085           200            200            4.0489215e-05  3.6869596e-41  0              0.00012146765  643.70631      0              62164548       1.1965779e-13  0              3.0054461    
    500000   8085           200            200            0.002943561   -0.0024619065   0              0.01129259     1414.3964      0              1.3659228e+08  1.1965779e-13  0              2.9939618    
    600000   8085           200            200            0.0025232975  -0.0021532407   0              0.0097231333   195.12552      0              18843826       1.1965779e-13  0              2.9943705    
    700000   8085           200            200            0.0025217928  -0.0029166639   0              0.010482042    3.9336909      0              379887.71      1.1965779e-13  0              2.9941377    
    800000   8085           200            200            0.0023207369  -0.0026324938   0              0.0095947043   1.8375429      0              177456.74      1.1965779e-13  0              2.9943867    
    900000   8085           200            200            0.0021985439  -0.0025888551   0              0.0091844868   0.36896739     0              35632.229      1.1965779e-13  0              2.9945088    
   1000000   8085           200            200            0.002205486   -0.002590482    0              0.00920694     0.0030495975   0              294.5083       1.1965779e-13  0              2.994503     
   1100000   8085           200            200            0.0022238647  -0.0025959579   0              0.009267552    0.0086832455   0              838.5657       1.1965779e-13  0              2.994485     
   1200000   8085           200            200            0.0022266405  -0.00259684     0              0.0092767614   0.00012362944  0              11.939247      1.1965779e-13  0              2.9944821    
   1300000   8085           200            200            0.0022247132  -0.0025962654   0              0.0092704052   0.00010723843  0              10.35632       1.1965779e-13  0              2.994484     
   1400000   8085           200            200            0.0022239556  -0.0025960318   0              0.0092678987   1.268735e-05   0              1.2252534      1.1965779e-13  0              2.9944848    
   1500000   8085           200            200            0.0022240646  -0.002596063    0              0.0092682567   4.7242572e-07  0              0.045623494    1.1965779e-13  0              2.9944846    
   1600000   8085           200            200            0.0022241885  -0.0025961007   0              0.0092686661   3.8112921e-07  0              0.036806731    1.1965779e-13  0              2.9944845    
   1700000   8085           200            200            0.0022241984  -0.002596104    0              0.0092686993   9.1484991e-10  0              8.8349656e-05  1.1965779e-13  0              2.9944845    
   1800000   8085           200            200            0.0022241837  -0.0025960996   0              0.0092686507   5.9672412e-09  0              0.00057627344  1.1965779e-13  0              2.9944845    
   1900000   8085           200            200            0.0022241794  -0.0025960982   0              0.0092686366   3.7888776e-10  0              3.6590268e-05  1.1965779e-13  0              2.9944845    
   2000000   8085           200            200            0.0022241806  -0.0025960986   0              0.0092686403   4.2807487e-11  0              4.1340407e-06  1.1965779e-13  0              2.9944845    
   2100000   8085           200            200            0.0022241814  -0.0025960988   0              0.009268643    1.543244e-11   0              1.4903546e-06  1.1965779e-13  0              2.9944845    
   2200000   8085           200            200            0.0022241814  -0.0025960988   0              0.009268643    1.00471e-14    0              9.7027704e-10  1.1965779e-13  0              2.9944845    
   2300000   8085           200            200            0.0022241813  -0.0025960988   0              0.0092686426   3.021138e-13   0              2.9175988e-08  1.1965779e-13  0              2.9944845    
   2400000   8085           200            200            0.0022241813  -0.0025960988   0              0.0092686426   9.2611364e-15  0              8.9437426e-10  1.1965779e-13  0              2.9944845    
   2500000   8085           200            200            0.0022241813  -0.0025960988   0              0.0092686426   3.0398185e-15  0              2.9356391e-10  1.1965779e-13  0              2.9944845    
   2600000   8085           200            200            0.0022241813  -0.0025960988   0              0.0092686426   5.6994904e-16  0              5.5041599e-11  1.1965779e-13  0              2.9944845    
   2700000   8085           200            200            0.0022241813  -0.0025960988   0              0.0092686426   1.1826143e-17  0              1.1420842e-12  1.1965779e-13  0              2.9944845    
   2800000   8085           200            200            0.0022241813  -0.0025960988   0              0.0092686426   1.3243149e-17  0              1.2789286e-12  1.1965779e-13  0              2.9944845    
   2900000   8085           200            200            0.0022241813  -0.0025960988   0              0.0092686426   4.695715e-20   0              4.5347854e-15  1.1965779e-13  0              2.9944845    
   3000000   8085           200            200            0.0022241813  -0.0025960988   0              0.0092686426   6.5197751e-18  0              6.2963321e-13  1.1965779e-13  0              2.9944845    
Loop time of 299.109 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8665739.387 ns/day, 0.000 hours/ns, 10029.791 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.539     | 36.974     | 63.023     | 416.8 | 12.36
Neigh   | 5.0181     | 5.1212     | 5.2261     |   4.1 |  1.71
Comm    | 19.684     | 26.67      | 32.739     | 112.0 |  8.92
Output  | 0.27667    | 0.27699    | 0.27733    |   0.1 |  0.09
Modify  | 169.06     | 173.59     | 177.65     |  28.5 | 58.03
Other   |            | 56.48      |            |       | 18.88

Nlocal:         625.25 ave         876 max         374 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           2 max           1 min
Histogram: 1 0 0 0 0 0 0 0 0 3
Neighs:         322.25 ave         645 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1289
Ave neighs/atom = 0.51539384
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 40

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.4                                                               
Lattice spacing in x,y,z = 5.4 5.4 5.4

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4050 ${n1e1} -100 100 -100 100 units box
region box block -4050 4050 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4050 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4050 4050 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4050 -100 -100) to (4050 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1499 atoms
  using lattice units in orthogonal box = (-4050 -100 -100) to (4050 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4050 -100 -100) to (4050 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1499 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1499 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1499 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_40_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5226 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 104 | 104 | 104.1 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8100           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8100           200            200            0.0024936007  -9.9726974e-36  0              0.007480802    578662.32      0              5.5995055e+10  1.1965779e-13  0              3.3360528    
    200000   8100           200            200            0.00084655588  1.9945703e-35  0              0.0025396676   131737.11      0              1.2747723e+10  1.1965779e-13  0              3.0884038    
    300000   8100           200            200            2.0071101e-05 -5.9836266e-35  0              6.0213303e-05  160.06508      0              15488918       1.1965779e-13  0              3.0487337    
    400000   8100           200            200            0.00015010275  3.9891316e-35  0              0.00045030824  7615.1631      0              7.3689173e+08  1.1965779e-13  0              3.0017236    
    500000   8100           200            200            0.00019821748 -1.357417e-16   0              0.00059465244  585.71377      0              56677399       1.1965779e-13  0              2.9996219    
    600000   8100           200            200            0.0019273363  -1.6441876e-15  0              0.005782009    112.90605      0              10925509       1.1965779e-13  0              2.9979995    
    700000   8100           200            200            0.0025034752  -2.1161472e-15  0              0.0075104255   0.059111717    0              5720.0265      1.1965779e-13  0              2.9976317    
    800000   8100           200            200            0.0029921761  -2.5264748e-15  0              0.0089765283   3.7026876      0              358295.66      1.1965779e-13  0              2.9973341    
    900000   8100           200            200            0.0031368963  -2.6504551e-15  0              0.0094106888   0.38277491     0              37039.74       1.1965779e-13  0              2.9972475    
   1000000   8100           200            200            0.0031155137  -2.6333378e-15  0              0.009346541    0.0038381503   0              371.40389      1.1965779e-13  0              2.9972594    
   1100000   8100           200            200            0.0030891304  -2.6111196e-15  0              0.0092673913   0.0106047      0              1026.1784      1.1965779e-13  0              2.9972749    
   1200000   8100           200            200            0.0030836024  -2.6063449e-15  0              0.0092508073   0.00060277145  0              58.328008      1.1965779e-13  0              2.9972782    
   1300000   8100           200            200            0.0030853841  -2.6078071e-15  0              0.0092561522   3.6282239e-05  0              3.5109007      1.1965779e-13  0              2.9972772    
   1400000   8100           200            200            0.0030866979  -2.6089174e-15  0              0.0092600937   2.7354022e-05  0              2.6469495      1.1965779e-13  0              2.9972764    
   1500000   8100           200            200            0.0030868776  -2.6090752e-15  0              0.0092606329   7.3816651e-07  0              0.071429698    1.1965779e-13  0              2.9972763    
   1600000   8100           200            200            0.0030867581  -2.608976e-15   0              0.0092602742   1.8479771e-07  0              0.017882204    1.1965779e-13  0              2.9972764    
   1700000   8100           200            200            0.0030866957  -2.6089231e-15  0              0.0092600871   6.3997245e-08  0              0.0061927814   1.1965779e-13  0              2.9972764    
   1800000   8100           200            200            0.0030866919  -2.6089196e-15  0              0.0092600757   5.2466912e-10  0              5.0770329e-05  1.1965779e-13  0              2.9972764    
   1900000   8100           200            200            0.0030866991  -2.6089255e-15  0              0.0092600972   7.1558727e-10  0              6.9244786e-05  1.1965779e-13  0              2.9972764    
   2000000   8100           200            200            0.0030867019  -2.6089279e-15  0              0.0092601056   1.3519659e-10  0              1.3082484e-05  1.1965779e-13  0              2.9972764    
   2100000   8100           200            200            0.0030867018  -2.6089279e-15  0              0.0092601054   1.2390768e-14  0              1.1990097e-09  1.1965779e-13  0              2.9972764    
   2200000   8100           200            200            0.0030867014  -2.6089276e-15  0              0.0092601042   2.3417603e-12  0              2.2660366e-07  1.1965779e-13  0              2.9972764    
   2300000   8100           200            200            0.0030867013  -2.6089275e-15  0              0.0092601038   2.537391e-13   0              2.4553413e-08  1.1965779e-13  0              2.9972764    
   2400000   8100           200            200            0.0030867013  -2.6089275e-15  0              0.0092601039   1.9259466e-15  0              1.8636687e-10  1.1965779e-13  0              2.9972764    
   2500000   8100           200            200            0.0030867013  -2.6089275e-15  0              0.009260104    6.726271e-15   0              6.5087686e-10  1.1965779e-13  0              2.9972764    
   2600000   8100           200            200            0.0030867013  -2.6089275e-15  0              0.009260104    3.8201505e-16  0              3.6966212e-11  1.1965779e-13  0              2.9972764    
   2700000   8100           200            200            0.0030867013  -2.6089275e-15  0              0.009260104    3.4738029e-18  0              3.3614732e-13  1.1965779e-13  0              2.9972764    
   2800000   8100           200            200            0.0030867013  -2.6089275e-15  0              0.009260104    1.2103098e-17  0              1.1711729e-12  1.1965779e-13  0              2.9972764    
   2900000   8100           200            200            0.0030867013  -2.6089275e-15  0              0.009260104    1.6818405e-19  0              1.6274561e-14  1.1965779e-13  0              2.9972764    
   3000000   8100           200            200            0.0030867013  -2.6089275e-15  0              0.009260104    3.8134706e-19  0              3.6901573e-14  1.1965779e-13  0              2.9972764    
Loop time of 300.041 on 4 procs for 3000000 steps with 2500 atoms

Performance: 8638806.581 ns/day, 0.000 hours/ns, 9998.619 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.682     | 38.294     | 67.525     | 444.8 | 12.76
Neigh   | 5.0464     | 5.1472     | 5.2508     |   4.1 |  1.72
Comm    | 29.181     | 55.608     | 84.141     | 347.9 | 18.53
Output  | 0.27084    | 0.27114    | 0.27148    |   0.1 |  0.09
Modify  | 108.04     | 144.05     | 177.26     | 276.4 | 48.01
Other   |            | 56.67      |            |       | 18.89

Nlocal:            625 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:            1.5 ave           4 max           0 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         333.25 ave         667 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1333
Ave neighs/atom = 0.5332
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 41

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.41                                                               
Lattice spacing in x,y,z = 5.41 5.41 5.41

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4057.5 ${n1e1} -100 100 -100 100 units box
region box block -4057.5 4057.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4057.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4057.5 4057.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4057.5 -100 -100) to (4057.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4057.5 -100 -100) to (4057.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4057.5 -100 -100) to (4057.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_41_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5236 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 104.2 | 104.2 | 104.2 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8115           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8115           200            200            0.0024924921   9.9543399e-36  0              0.0074774763   580505.37      0              5.6061053e+10  1.1965779e-13  0              3.3300235    
    200000   8115           200            200            0.00085642231  9.9045132e-41  0              0.0025692669   134806.06      0              1.3018604e+10  1.1965779e-13  0              3.0802986    
    300000   8115           200            200            1.3981702e-05 -7.1671102e-34  0              4.1945106e-05  79.143414      0              7643104.5      1.1965779e-13  0              3.0446921    
    400000   8115           200            200            4.0235982e-05  1.9908695e-35  0              0.00012070795  640.51361      0              61856220       1.1965779e-13  0              3.0054493    
    500000   8115           200            200            0.0047691164   0.0030731991   0              0.01123415     1415.3823      0              1.3668749e+08  1.1965779e-13  0              2.9939664    
    600000   8115           200            200            0.0041704893   0.002830062    0              0.009681406    195.20699      0              18851694       1.1965779e-13  0              2.9943721    
    700000   8115           200            200            0.0044052458   0.0027732683   0              0.010442469    3.9652303      0              382933.56      1.1965779e-13  0              2.9941379    
    800000   8115           200            200            0.0041205084   0.0028017218   0              0.0095598034   1.8317486      0              176897.17      1.1965779e-13  0              2.9943866    
    900000   8115           200            200            0.0039699567   0.0027590937   0              0.0091507762   0.36963401     0              35696.607      1.1965779e-13  0              2.9945087    
   1000000   8115           200            200            0.0039779803   0.0027610616   0              0.0091728792   0.0030051429   0              290.21519      1.1965779e-13  0              2.994503     
   1100000   8115           200            200            0.0039994957   0.0027652336   0              0.0092332533   0.0086818514   0              838.43107      1.1965779e-13  0              2.994485     
   1200000   8115           200            200            0.0040027468   0.0027657781   0              0.0092424623   0.00012481282  0              12.053529      1.1965779e-13  0              2.9944821    
   1300000   8115           200            200            0.0040005212   0.0027654255   0              0.009236138    0.00010699889  0              10.333186      1.1965779e-13  0              2.994484     
   1400000   8115           200            200            0.0039996398   0.0027652814   0              0.009233638    1.2721963e-05  0              1.2285961      1.1965779e-13  0              2.9944847    
   1500000   8115           200            200            0.0039997645   0.0027653005   0              0.009233993    4.6895751e-07  0              0.04528856     1.1965779e-13  0              2.9944846    
   1600000   8115           200            200            0.0039999082   0.0027653238   0              0.0092344009   3.8131686e-07  0              0.036824853    1.1965779e-13  0              2.9944845    
   1700000   8115           200            200            0.00399992     0.0027653258   0              0.0092344343   9.3745491e-10  0              9.0532686e-05  1.1965779e-13  0              2.9944845    
   1800000   8115           200            200            0.003999903    0.0027653231   0              0.0092343859   5.9589442e-09  0              0.00057547217  1.1965779e-13  0              2.9944845    
   1900000   8115           200            200            0.003999898    0.0027653223   0              0.0092343718   3.8044315e-10  0              3.6740477e-05  1.1965779e-13  0              2.9944845    
   2000000   8115           200            200            0.0039998993   0.0027653225   0              0.0092343755   4.2612413e-11  0              4.1152019e-06  1.1965779e-13  0              2.9944845    
   2100000   8115           200            200            0.0039999002   0.0027653226   0              0.0092343781   1.5452863e-11  0              1.4923269e-06  1.1965779e-13  0              2.9944845    
   2200000   8115           200            200            0.0039999003   0.0027653226   0              0.0092343781   9.4697237e-15  0              9.1451813e-10  1.1965779e-13  0              2.9944845    
   2300000   8115           200            200            0.0039999001   0.0027653226   0              0.0092343778   3.0238964e-13  0              2.9202627e-08  1.1965779e-13  0              2.9944845    
   2400000   8115           200            200            0.0039999001   0.0027653226   0              0.0092343777   9.2707534e-15  0              8.9530301e-10  1.1965779e-13  0              2.9944845    
   2500000   8115           200            200            0.0039999001   0.0027653226   0              0.0092343777   3.0715724e-15  0              2.9663048e-10  1.1965779e-13  0              2.9944845    
   2600000   8115           200            200            0.0039999001   0.0027653226   0              0.0092343778   5.6962904e-16  0              5.5010696e-11  1.1965779e-13  0              2.9944845    
   2700000   8115           200            200            0.0039999001   0.0027653226   0              0.0092343778   1.1660126e-17  0              1.1260515e-12  1.1965779e-13  0              2.9944845    
   2800000   8115           200            200            0.0039999001   0.0027653226   0              0.0092343778   1.2744808e-17  0              1.2308023e-12  1.1965779e-13  0              2.9944845    
   2900000   8115           200            200            0.0039999001   0.0027653226   0              0.0092343778   2.6246327e-19  0              2.5346824e-14  1.1965779e-13  0              2.9944845    
   3000000   8115           200            200            0.0039999001   0.0027653226   0              0.0092343778   6.0249817e-18  0              5.8184961e-13  1.1965779e-13  0              2.9944845    
Loop time of 296.906 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8730033.469 ns/day, 0.000 hours/ns, 10104.205 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.933     | 36.882     | 63.072     | 421.4 | 12.42
Neigh   | 5.0418     | 5.1422     | 5.2445     |   4.0 |  1.73
Comm    | 20.678     | 39.524     | 77.648     | 355.2 | 13.31
Output  | 0.2733     | 0.27361    | 0.27395    |   0.1 |  0.09
Modify  | 110.98     | 158.79     | 178.65     | 220.9 | 53.48
Other   |            | 56.3       |            |       | 18.96

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         322.25 ave         645 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1289
Ave neighs/atom = 0.51539384
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 42

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.42                                                               
Lattice spacing in x,y,z = 5.42 5.42 5.42

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4065 ${n1e1} -100 100 -100 100 units box
region box block -4065 4065 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4065 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4065 4065 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4065 -100 -100) to (4065 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4065 -100 -100) to (4065 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4065 -100 -100) to (4065 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_42_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5246 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 104.4 | 104.4 | 104.4 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8130           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8130           200            200            0.0024876019   4.9679956e-36  0              0.0074628057   580377.45      0              5.60487e+10    1.1965779e-13  0              3.3303154    
    200000   8130           200            200            0.00085354897 -1.9871556e-35  0              0.0025606469   134471.7       0              1.2986315e+10  1.1965779e-13  0              3.0808858    
    300000   8130           200            200            1.3369207e-05 -6.2099739e-37  0              4.0107621e-05  72.717369      0              7022523        1.1965779e-13  0              3.0449008    
    400000   8130           200            200            4.6021226e-05  4.967981e-36   0              0.00013806368  833.0713       0              80452064       1.1965779e-13  0              3.0054292    
    500000   8130           200            200            0.0065388054   0.0016075119   0              0.018008904    523.13408      0              50520545       1.1965779e-13  0              2.9925       
    600000   8130           200            200            0.0046484799   0.0016012896   0              0.01234415     58.960648      0              5693997.4      1.1965779e-13  0              2.9937758    
    700000   8130           200            200            0.0031924125   0.0016095932   0              0.0079676444   0.86417787     0              83456.113      1.1965779e-13  0              2.9950077    
    800000   8130           200            200            0.0037505295   0.0017572529   0              0.0094943355   2.4168325      0              233400.39      1.1965779e-13  0              2.9945518    
    900000   8130           200            200            0.0036733834   0.0017509252   0              0.009269225    0.43925883     0              42420.474      1.1965779e-13  0              2.9946142    
   1000000   8130           200            200            0.0036340953   0.0017462558   0              0.00915603     0.0039129759   0              377.88721      1.1965779e-13  0              2.9946485    
   1100000   8130           200            200            0.0036614256   0.0017494258   0              0.0092348511   0.0042349797   0              408.98403      1.1965779e-13  0              2.9946253    
   1200000   8130           200            200            0.0036561097   0.0017488317   0              0.0092194974   0.0011366411   0              109.76866      1.1965779e-13  0              2.9946297    
   1300000   8130           200            200            0.0036544869   0.0017486375   0              0.0092148233   1.8661419e-05  0              1.8021863      1.1965779e-13  0              2.9946311    
   1400000   8130           200            200            0.0036558344   0.0017487933   0              0.0092187099   8.2321539e-06  0              0.7950025      1.1965779e-13  0              2.99463      
   1500000   8130           200            200            0.0036555299   0.001748759    0              0.0092178308   2.8803361e-06  0              0.27816225     1.1965779e-13  0              2.9946302    
   1600000   8130           200            200            0.0036554664   0.0017487513   0              0.009217648    7.4118344e-08  0              0.0071578192   1.1965779e-13  0              2.9946303    
   1700000   8130           200            200            0.0036555322   0.0017487589   0              0.0092178376   1.5168475e-08  0              0.0014648627   1.1965779e-13  0              2.9946302    
   1800000   8130           200            200            0.0036555152   0.001748757    0              0.0092177886   7.1504172e-09  0              0.00069053611  1.1965779e-13  0              2.9946302    
   1900000   8130           200            200            0.0036555129   0.0017487567   0              0.0092177821   2.6356269e-10  0              2.5452998e-05  1.1965779e-13  0              2.9946302    
   2000000   8130           200            200            0.0036555161   0.0017487571   0              0.0092177912   2.6005951e-11  0              2.5114686e-06  1.1965779e-13  0              2.9946302    
   2100000   8130           200            200            0.0036555152   0.001748757    0              0.0092177885   1.739254e-11   0              1.6796471e-06  1.1965779e-13  0              2.9946302    
   2200000   8130           200            200            0.0036555151   0.001748757    0              0.0092177883   8.6925582e-13  0              8.3946505e-08  1.1965779e-13  0              2.9946302    
   2300000   8130           200            200            0.0036555153   0.001748757    0              0.0092177888   4.0234798e-14  0              3.8855888e-09  1.1965779e-13  0              2.9946302    
   2400000   8130           200            200            0.0036555152   0.001748757    0              0.0092177886   4.1383946e-14  0              3.9965653e-09  1.1965779e-13  0              2.9946302    
   2500000   8130           200            200            0.0036555152   0.001748757    0              0.0092177886   2.6947735e-15  0              2.6024193e-10  1.1965779e-13  0              2.9946302    
   2600000   8130           200            200            0.0036555152   0.001748757    0              0.0092177887   6.220732e-17   0              6.0075377e-12  1.1965779e-13  0              2.9946302    
   2700000   8130           200            200            0.0036555152   0.001748757    0              0.0092177886   8.6256669e-17  0              8.3300517e-12  1.1965779e-13  0              2.9946302    
   2800000   8130           200            200            0.0036555152   0.001748757    0              0.0092177886   1.2135356e-17  0              1.1719458e-12  1.1965779e-13  0              2.9946302    
   2900000   8130           200            200            0.0036555152   0.001748757    0              0.0092177886   1.3096332e-18  0              1.26475e-13    1.1965779e-13  0              2.9946302    
   3000000   8130           200            200            0.0036555152   0.001748757    0              0.0092177886   3.4829307e-18  0              3.3635652e-13  1.1965779e-13  0              2.9946302    
Loop time of 297.574 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8710447.976 ns/day, 0.000 hours/ns, 10081.537 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.107     | 36.91      | 64.235     | 422.4 | 12.40
Neigh   | 5.0096     | 5.103      | 5.1997     |   3.8 |  1.71
Comm    | 19.82      | 41.478     | 81.778     | 369.7 | 13.94
Output  | 0.27255    | 0.27287    | 0.27323    |   0.1 |  0.09
Modify  | 108.59     | 157.96     | 176.26     | 227.4 | 53.08
Other   |            | 55.85      |            |       | 18.77

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         322.75 ave         646 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1291
Ave neighs/atom = 0.51619352
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 43

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.43                                                               
Lattice spacing in x,y,z = 5.43 5.43 5.43

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4072.5 ${n1e1} -100 100 -100 100 units box
region box block -4072.5 4072.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4072.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4072.5 4072.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4072.5 -100 -100) to (4072.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4072.5 -100 -100) to (4072.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4072.5 -100 -100) to (4072.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_43_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5255 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 104.6 | 104.6 | 104.6 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8145           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8145           200            200            0.0024831367  -1.2397072e-36  0              0.0074494101   580436.51      0              5.6054403e+10  1.1965779e-13  0              3.3301335    
    200000   8145           200            200            0.00085261772  6.7144534e-41  0              0.0025578532   134640.19      0              1.3002586e+10  1.1965779e-13  0              3.0805367    
    300000   8145           200            200            1.3859024e-05 -1.0909424e-34  0              4.1577071e-05  78.346848      0              7566177.8      1.1965779e-13  0              3.0447425    
    400000   8145           200            200            4.4361892e-05  1.9835404e-35  0              0.00013308568  778.96223      0              75226597       1.1965779e-13  0              3.005341     
    500000   8145           200            200            0.0042460362  -0.00083828664  0              0.013576395    1209.5168      0              1.1680647e+08  1.1965779e-13  0              2.9933594    
    600000   8145           200            200            0.0034790908  -0.00022438344  0              0.010661656    166.1864       0              16049093       1.1965779e-13  0              2.9940906    
    700000   8145           200            200            0.0033926209  -0.00028803061  0              0.010465893    1.7559085      0              169573.07      1.1965779e-13  0              2.9941298    
    800000   8145           200            200            0.0031268358  -0.00019131091  0              0.0095718185   1.3174856      0              127233.33      1.1965779e-13  0              2.9943807    
    900000   8145           200            200            0.0030065022  -0.00015017478  0              0.0091696813   0.46584272     0              44987.755      1.1965779e-13  0              2.9945004    
   1000000   8145           200            200            0.0029975821  -0.00014676146  0              0.0091395077   0.0040536762   0              391.47503      1.1965779e-13  0              2.9945104    
   1100000   8145           200            200            0.0030124046  -0.00014909949  0              0.0091863134   0.0053825033   0              519.80365      1.1965779e-13  0              2.9944965    
   1200000   8145           200            200            0.0030182996  -0.00014958781  0              0.0092044867   0.00090840078  0              87.726846      1.1965779e-13  0              2.994491     
   1300000   8145           200            200            0.003017974   -0.00014956578  0              0.0092034879   1.1506916e-06  0              0.11112556     1.1965779e-13  0              2.9944912    
   1400000   8145           200            200            0.0030170829  -0.0001494948   0              0.0092007434   1.9177338e-05  0              1.8520101      1.1965779e-13  0              2.994492     
   1500000   8145           200            200            0.0030168659  -0.00014947691  0              0.0092000746   1.294704e-06   0              0.12503325     1.1965779e-13  0              2.9944922    
   1600000   8145           200            200            0.0030169225  -0.0001494813   0              0.0092002489   6.6273991e-08  0              0.0064002677   1.1965779e-13  0              2.9944922    
   1700000   8145           200            200            0.0030169684  -0.000149485    0              0.0092003901   5.2385988e-08  0              0.0050590638   1.1965779e-13  0              2.9944921    
   1800000   8145           200            200            0.0030169742  -0.00014948549  0              0.009200408    1.0438857e-09  0              0.00010081101  1.1965779e-13  0              2.9944921    
   1900000   8145           200            200            0.0030169697  -0.00014948513  0              0.0092003942   4.5838691e-10  0              4.4267726e-05  1.1965779e-13  0              2.9944921    
   2000000   8145           200            200            0.0030169676  -0.00014948496  0              0.0092003877   1.1296829e-10  0              1.0909669e-05  1.1965779e-13  0              2.9944921    
   2100000   8145           200            200            0.0030169676  -0.00014948496  0              0.0092003877   5.0710005e-14  0              4.8972093e-09  1.1965779e-13  0              2.9944921    
   2200000   8145           200            200            0.0030169678  -0.00014948498  0              0.0092003885   1.8704616e-12  0              1.8063579e-07  1.1965779e-13  0              2.9944921    
   2300000   8145           200            200            0.0030169679  -0.00014948499  0              0.0092003888   1.8567049e-13  0              1.7930727e-08  1.1965779e-13  0              2.9944921    
   2400000   8145           200            200            0.0030169679  -0.00014948499  0              0.0092003887   3.4555097e-15  0              3.337084e-10   1.1965779e-13  0              2.9944921    
   2500000   8145           200            200            0.0030169679  -0.00014948499  0              0.0092003887   5.6643276e-15  0              5.4702021e-10  1.1965779e-13  0              2.9944921    
   2600000   8145           200            200            0.0030169679  -0.00014948499  0              0.0092003887   1.9776845e-16  0              1.9099061e-11  1.1965779e-13  0              2.9944921    
   2700000   8145           200            200            0.0030169679  -0.00014948499  0              0.0092003887   4.336793e-17   0              4.1881643e-12  1.1965779e-13  0              2.9944921    
   2800000   8145           200            200            0.0030169679  -0.00014948499  0              0.0092003887   9.900047e-18   0              9.5607567e-13  1.1965779e-13  0              2.9944921    
   2900000   8145           200            200            0.0030169679  -0.00014948499  0              0.0092003887   1.0502058e-18  0              1.0142136e-13  1.1965779e-13  0              2.9944921    
   3000000   8145           200            200            0.0030169679  -0.00014948499  0              0.0092003887   3.1979062e-18  0              3.0883089e-13  1.1965779e-13  0              2.9944921    
Loop time of 296.825 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8732427.675 ns/day, 0.000 hours/ns, 10106.976 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.268     | 37.089     | 64.315     | 423.3 | 12.50
Neigh   | 5.0326     | 5.1388     | 5.2472     |   4.3 |  1.73
Comm    | 20.114     | 40.072     | 79.772     | 367.9 | 13.50
Output  | 0.27546    | 0.27577    | 0.27612    |   0.1 |  0.09
Modify  | 108.7      | 157.81     | 177.09     | 227.1 | 53.17
Other   |            | 56.44      |            |       | 19.02

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         323.25 ave         647 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1293
Ave neighs/atom = 0.5169932
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 44

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.44                                                               
Lattice spacing in x,y,z = 5.44 5.44 5.44

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4080 ${n1e1} -100 100 -100 100 units box
region box block -4080 4080 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4080 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4080 4080 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4080 -100 -100) to (4080 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1499 atoms
  using lattice units in orthogonal box = (-4080 -100 -100) to (4080 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4080 -100 -100) to (4080 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1499 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1499 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1499 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_44_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5265 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 104.8 | 104.8 | 104.8 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8160           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8160           200            200            0.0024784066  -1.8561431e-36  0              0.0074352197   580368.33      0              5.616014e+10   1.1965779e-13  0              3.3302613    
    200000   8160           200            200            0.00085036779 -2.4748514e-36  0              0.0025511034   134464.67      0              1.3011659e+10  1.1965779e-13  0              3.0808124    
    300000   8160           200            200            1.3234934e-05  9.8994954e-36  0              3.9704802e-05  71.808739      0              6948671.3      1.1965779e-13  0              3.0448251    
    400000   8160           200            200            4.4702913e-05 -3.9597014e-35  0              0.00013410874  793.32553      0              76767236       1.1965779e-13  0              3.0054032    
    500000   8160           200            200            0.0060343863   0.00051791194  0              0.017585247    589.12867      0              57007846       1.1965779e-13  0              2.9925104    
    600000   8160           200            200            0.0044388237   0.00059603023  0              0.012720441    17.700017      0              1712766.5      1.1965779e-13  0              2.993608     
    700000   8160           200            200            0.0029340481   0.00083007793  0              0.0079720664   2.6622874      0              257619.9       1.1965779e-13  0              2.9949383    
    800000   8160           200            200            0.0034349643   0.00075689216  0              0.0095480008   1.5418759      0              149201.74      1.1965779e-13  0              2.9944727    
    900000   8160           200            200            0.0032847429   0.00075773835  0              0.0090964905   0.36767909     0              35578.972      1.1965779e-13  0              2.9946012    
   1000000   8160           200            200            0.0033174515   0.0007574741   0              0.0091948805   0.063672833    0              6161.3893      1.1965779e-13  0              2.9945736    
   1100000   8160           200            200            0.0033150648   0.00075748813  0              0.0091877064   0.0085487337   0              827.22998      1.1965779e-13  0              2.9945752    
   1200000   8160           200            200            0.0033123281   0.00075751111  0              0.0091794733   0.00089221098  0              86.336022      1.1965779e-13  0              2.9945778    
   1300000   8160           200            200            0.0033145455   0.00075749324  0              0.0091861432   6.6862798e-05  0              6.4700705      1.1965779e-13  0              2.9945758    
   1400000   8160           200            200            0.0033133825   0.00075750245  0              0.009182645    2.6323272e-06  0              0.25472076     1.1965779e-13  0              2.9945768    
   1500000   8160           200            200            0.0033138872   0.00075749848  0              0.0091841633   3.4484795e-10  0              3.3369686e-05  1.1965779e-13  0              2.9945764    
   1600000   8160           200            200            0.0033136952   0.00075749998  0              0.0091835857   4.2432973e-08  0              0.0041060849   1.1965779e-13  0              2.9945765    
   1700000   8160           200            200            0.0033137599   0.00075749948  0              0.0091837801   2.0989982e-08  0              0.0020311244   1.1965779e-13  0              2.9945765    
   1800000   8160           200            200            0.0033137411   0.00075749962  0              0.0091837237   5.2346998e-09  0              0.00050654292  1.1965779e-13  0              2.9945765    
   1900000   8160           200            200            0.0033137454   0.00075749959  0              0.0091837365   9.2818581e-10  0              8.9817176e-05  1.1965779e-13  0              2.9945765    
   2000000   8160           200            200            0.0033137449   0.00075749959  0              0.0091837352   1.2765674e-10  0              1.235288e-05   1.1965779e-13  0              2.9945765    
   2100000   8160           200            200            0.0033137447   0.00075749959  0              0.0091837344   1.3690838e-11  0              1.3248128e-06  1.1965779e-13  0              2.9945765    
   2200000   8160           200            200            0.0033137449   0.00075749959  0              0.0091837351   1.0678703e-12  0              1.0333394e-07  1.1965779e-13  0              2.9945765    
   2300000   8160           200            200            0.0033137448   0.00075749959  0              0.0091837347   4.6243987e-14  0              4.474863e-09   1.1965779e-13  0              2.9945765    
   2400000   8160           200            200            0.0033137448   0.00075749959  0              0.0091837349   8.667321e-17   0              8.3870523e-12  1.1965779e-13  0              2.9945765    
   2500000   8160           200            200            0.0033137448   0.00075749959  0              0.0091837348   4.6472517e-16  0              4.496977e-11   1.1965779e-13  0              2.9945765    
   2600000   8160           200            200            0.0033137448   0.00075749959  0              0.0091837349   2.8254372e-16  0              2.7340732e-11  1.1965779e-13  0              2.9945765    
   2700000   8160           200            200            0.0033137448   0.00075749959  0              0.0091837348   5.7507671e-17  0              5.5648088e-12  1.1965779e-13  0              2.9945765    
   2800000   8160           200            200            0.0033137448   0.00075749959  0              0.0091837348   8.7541212e-18  0              8.4710457e-13  1.1965779e-13  0              2.9945765    
   2900000   8160           200            200            0.0033137448   0.00075749959  0              0.0091837348   3.381467e-18   0              3.272123e-13   1.1965779e-13  0              2.9945765    
   3000000   8160           200            200            0.0033137448   0.00075749959  0              0.0091837348   8.7737785e-19  0              8.4900674e-14  1.1965779e-13  0              2.9945765    
Loop time of 294.617 on 4 procs for 3000000 steps with 2500 atoms

Performance: 8797857.397 ns/day, 0.000 hours/ns, 10182.705 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.946     | 36.038     | 61.618     | 417.3 | 12.23
Neigh   | 5.0503     | 5.1547     | 5.263      |   4.2 |  1.75
Comm    | 27.805     | 52.482     | 77.955     | 332.2 | 17.81
Output  | 0.27322    | 0.27352    | 0.27385    |   0.1 |  0.09
Modify  | 109.42     | 144.56     | 178.31     | 279.9 | 49.07
Other   |            | 56.11      |            |       | 19.05

Nlocal:            625 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:            1.5 ave           4 max           0 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         321.75 ave         644 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1287
Ave neighs/atom = 0.5148
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 45

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.45                                                               
Lattice spacing in x,y,z = 5.45 5.45 5.45

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4087.5 ${n1e1} -100 100 -100 100 units box
region box block -4087.5 4087.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4087.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4087.5 4087.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4087.5 -100 -100) to (4087.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4087.5 -100 -100) to (4087.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4087.5 -100 -100) to (4087.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_45_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5275 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 104.9 | 104.9 | 104.9 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8175           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8175           200            200            0.0024738491  -2.4703106e-36  0              0.0074215474   580369.94      0              5.6047974e+10  1.1965779e-13  0              3.3302228    
    200000   8175           200            200            0.00084888564 -2.9643709e-35  0              0.0025466569   134486.98      0              1.298779e+10   1.1965779e-13  0              3.080732     
    300000   8175           200            200            1.330295e-05   7.2738841e-40  0              3.9908849e-05  72.802304      0              7030725.4      1.1965779e-13  0              3.0447733    
    400000   8175           200            200            4.486509e-05   9.8812766e-36  0              0.00013459527  801.74376      0              77426674       1.1965779e-13  0              3.0053443    
    500000   8175           200            200            0.0036287362  -0.0051353204   0              0.016021529    857.76384      0              82836692       1.1965779e-13  0              2.9927814    
    600000   8175           200            200            0.0027591646  -0.0044884292   0              0.012765923    8.4014834      0              811355.13      1.1965779e-13  0              2.9935321    
    700000   8175           200            200            0.0015977435  -0.0040992189   0              0.0088924495   25.449838      0              2457763.1      1.1965779e-13  0              2.9945983    
    800000   8175           200            200            0.0015843772  -0.0040774455   0              0.0088305772   1.7007215      0              164243.51      1.1965779e-13  0              2.9946255    
    900000   8175           200            200            0.0017399629  -0.0041167972   0              0.0093366859   0.01996657     0              1928.2284      1.1965779e-13  0              2.9944738    
   1000000   8175           200            200            0.0016796581  -0.0041024533   0              0.0091414277   0.055172861    0              5328.2         1.1965779e-13  0              2.9945308    
   1100000   8175           200            200            0.00168369    -0.0041033239   0              0.0091543939   0.0062494107   0              603.52335      1.1965779e-13  0              2.9945274    
   1200000   8175           200            200            0.0016901163  -0.0041049268   0              0.0091752757   1.7507841e-06  0              0.16907819     1.1965779e-13  0              2.9945211    
   1300000   8175           200            200            0.0016868904  -0.0041041419   0              0.0091648133   0.00010224465  0              9.8740565      1.1965779e-13  0              2.9945242    
   1400000   8175           200            200            0.0016873707  -0.0041042539   0              0.0091663659   1.9368867e-05  0              1.8705065      1.1965779e-13  0              2.9945238    
   1500000   8175           200            200            0.0016876052  -0.0041043131   0              0.0091671286   2.2461316e-07  0              0.021691531    1.1965779e-13  0              2.9945235    
   1600000   8175           200            200            0.0016874425  -0.0041042733   0              0.0091666007   1.5657548e-07  0              0.015120939    1.1965779e-13  0              2.9945237    
   1700000   8175           200            200            0.0016874788  -0.0041042819   0              0.0091667182   5.2514285e-08  0              0.0050714538   1.1965779e-13  0              2.9945237    
   1800000   8175           200            200            0.0016874856  -0.0041042837   0              0.0091667403   1.7911612e-09  0              0.00017297752  1.1965779e-13  0              2.9945237    
   1900000   8175           200            200            0.0016874778  -0.0041042818   0              0.0091667153   1.7517382e-10  0              1.6917033e-05  1.1965779e-13  0              2.9945237    
   2000000   8175           200            200            0.0016874801  -0.0041042823   0              0.0091667228   1.2622681e-10  0              1.2190082e-05  1.1965779e-13  0              2.9945237    
   2100000   8175           200            200            0.0016874802  -0.0041042824   0              0.009166723    8.4495358e-12  0              8.1599569e-07  1.1965779e-13  0              2.9945237    
   2200000   8175           200            200            0.0016874799  -0.0041042823   0              0.0091667219   9.0720028e-14  0              8.761091e-09   1.1965779e-13  0              2.9945237    
   2300000   8175           200            200            0.00168748    -0.0041042823   0              0.0091667223   2.6857756e-13  0              2.5937298e-08  1.1965779e-13  0              2.9945237    
   2400000   8175           200            200            0.00168748    -0.0041042823   0              0.0091667223   3.0727647e-14  0              2.9674562e-09  1.1965779e-13  0              2.9945237    
   2500000   8175           200            200            0.00168748    -0.0041042823   0              0.0091667222   1.372291e-17   0              1.3252604e-12  1.1965779e-13  0              2.9945237    
   2600000   8175           200            200            0.00168748    -0.0041042823   0              0.0091667223   4.9231309e-16  0              4.7544074e-11  1.1965779e-13  0              2.9945237    
   2700000   8175           200            200            0.00168748    -0.0041042823   0              0.0091667223   9.8277648e-17  0              9.4909518e-12  1.1965779e-13  0              2.9945237    
   2800000   8175           200            200            0.00168748    -0.0041042823   0              0.0091667223   2.9242487e-18  0              2.8240301e-13  1.1965779e-13  0              2.9945237    
   2900000   8175           200            200            0.00168748    -0.0041042823   0              0.0091667223   6.2542279e-19  0              6.0398857e-14  1.1965779e-13  0              2.9945237    
   3000000   8175           200            200            0.00168748    -0.0041042823   0              0.0091667223   5.1604419e-18  0              4.9835854e-13  1.1965779e-13  0              2.9945237    
Loop time of 298.243 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8690904.536 ns/day, 0.000 hours/ns, 10058.917 timesteps/s
99.9% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.082     | 36.785     | 64.036     | 422.3 | 12.33
Neigh   | 5.1024     | 5.2093     | 5.3185     |   4.3 |  1.75
Comm    | 19.929     | 41.722     | 81.902     | 367.9 | 13.99
Output  | 0.27048    | 0.27079    | 0.27115    |   0.1 |  0.09
Modify  | 109.02     | 158.33     | 176.8      | 226.9 | 53.09
Other   |            | 55.93      |            |       | 18.75

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         321.25 ave         643 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1285
Ave neighs/atom = 0.51379448
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 46

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.46                                                               
Lattice spacing in x,y,z = 5.46 5.46 5.46

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4095 ${n1e1} -100 100 -100 100 units box
region box block -4095 4095 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4095 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4095 4095 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4095 -100 -100) to (4095 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4095 -100 -100) to (4095 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4095 -100 -100) to (4095 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_46_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5284 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 105 | 105.1 | 105.1 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8190           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8190           200            200            0.0024692257   2.0745003e-42  0              0.0074076771   580335.27      0              5.6044626e+10  1.1965779e-13  0              3.3302654    
    200000   8190           200            200            0.00084715437 -7.3973688e-36  0              0.0025414631   134442.49      0              1.2983493e+10  1.1965779e-13  0              3.0807799    
    300000   8190           200            200            1.2851034e-05  3.9453246e-35  0              3.8553101e-05  68.258529      0              6591920.1      1.1965779e-13  0              3.0447768    
    400000   8190           200            200            4.2591391e-05  5.9179193e-35  0              0.00012777417  727.75758      0              70281618       1.1965779e-13  0              3.0054284    
    500000   8190           200            200            0.0064917981   0.0047714924   0              0.014703902    1067.2719      0              1.0306948e+08  1.1965779e-13  0              2.9931134    
    600000   8190           200            200            0.0053124196   0.00447351     0              0.011463749    118.98449      0              11490670       1.1965779e-13  0              2.9938803    
    700000   8190           200            200            0.0049571589   0.0045677504   0              0.010303726    5.8130192      0              561379.78      1.1965779e-13  0              2.9941806    
    800000   8190           200            200            0.0047392721   0.0046165535   0              0.0096012627   0.28101146     0              27138.075      1.1965779e-13  0              2.9943772    
    900000   8190           200            200            0.0046470921   0.0046237362   0              0.0093175402   0.014890078    0              1437.9772      1.1965779e-13  0              2.99446      
   1000000   8190           200            200            0.0046054421   0.0046227649   0              0.0091935615   0.032039632    0              3094.1583      1.1965779e-13  0              2.9944972    
   1100000   8190           200            200            0.0045915764   0.004621351    0              0.009153378    0.0084343157   0              814.52584      1.1965779e-13  0              2.9945095    
   1200000   8190           200            200            0.0045889366   0.0046207358   0              0.0091460741   0.00093377608  0              90.17741       1.1965779e-13  0              2.9945118    
   1300000   8190           200            200            0.0045893217   0.0046208135   0              0.0091471516   3.3350116e-05  0              3.2207155      1.1965779e-13  0              2.9945115    
   1400000   8190           200            200            0.0045899073   0.0046209428   0              0.0091487792   4.770774e-07   0              0.046072721    1.1965779e-13  0              2.994511     
   1500000   8190           200            200            0.0045902035   0.0046210092   0              0.0091496014   1.4149664e-06  0              0.13664733     1.1965779e-13  0              2.9945108    
   1600000   8190           200            200            0.0045903005   0.0046210312   0              0.0091498704   3.7658399e-07  0              0.036367787    1.1965779e-13  0              2.9945107    
   1700000   8190           200            200            0.0045903182   0.0046210353   0              0.0091499193   4.1693534e-08  0              0.0040264631   1.1965779e-13  0              2.9945107    
   1800000   8190           200            200            0.0045903156   0.0046210348   0              0.0091499121   1.4864169e-09  0              0.00014354751  1.1965779e-13  0              2.9945107    
   1900000   8190           200            200            0.0045903117   0.0046210339   0              0.0091499013   2.1474431e-11  0              2.0738468e-06  1.1965779e-13  0              2.9945107    
   2000000   8190           200            200            0.0045903097   0.0046210335   0              0.0091498958   6.3269391e-11  0              6.110105e-06   1.1965779e-13  0              2.9945107    
   2100000   8190           200            200            0.0045903091   0.0046210333   0              0.009149894    1.6820369e-11  0              1.6243908e-06  1.1965779e-13  0              2.9945107    
   2200000   8190           200            200            0.004590309    0.0046210333   0              0.0091498936   1.8595673e-12  0              1.795837e-07   1.1965779e-13  0              2.9945107    
   2300000   8190           200            200            0.004590309    0.0046210333   0              0.0091498937   6.6318997e-14  0              6.4046141e-09  1.1965779e-13  0              2.9945107    
   2400000   8190           200            200            0.004590309    0.0046210333   0              0.0091498938   1.0226127e-15  0              9.8756614e-11  1.1965779e-13  0              2.9945107    
   2500000   8190           200            200            0.004590309    0.0046210333   0              0.0091498938   2.9624253e-15  0              2.8608983e-10  1.1965779e-13  0              2.9945107    
   2600000   8190           200            200            0.004590309    0.0046210333   0              0.0091498938   7.4782884e-16  0              7.2219957e-11  1.1965779e-13  0              2.9945107    
   2700000   8190           200            200            0.004590309    0.0046210333   0              0.0091498938   6.9077208e-17  0              6.6709824e-12  1.1965779e-13  0              2.9945107    
   2800000   8190           200            200            0.004590309    0.0046210333   0              0.0091498938   1.3685343e-19  0              1.3216325e-14  1.1965779e-13  0              2.9945107    
   2900000   8190           200            200            0.004590309    0.0046210333   0              0.0091498938   4.7695454e-20  0              4.6060855e-15  1.1965779e-13  0              2.9945107    
   3000000   8190           200            200            0.004590309    0.0046210333   0              0.0091498938   6.3124442e-18  0              6.0961068e-13  1.1965779e-13  0              2.9945107    
Loop time of 297.766 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8704824.711 ns/day, 0.000 hours/ns, 10075.029 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.183     | 37.193     | 64.66      | 426.1 | 12.49
Neigh   | 5.0869     | 5.1904     | 5.2953     |   4.1 |  1.74
Comm    | 20.122     | 40.519     | 80.5       | 369.0 | 13.61
Output  | 0.27238    | 0.2727     | 0.27305    |   0.1 |  0.09
Modify  | 108.72     | 157.94     | 177.74     | 227.3 | 53.04
Other   |            | 56.65      |            |       | 19.02

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         324.25 ave         649 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1297
Ave neighs/atom = 0.51859256
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 47

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.47                                                               
Lattice spacing in x,y,z = 5.47 5.47 5.47

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4102.5 ${n1e1} -100 100 -100 100 units box
region box block -4102.5 4102.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4102.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4102.5 4102.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4102.5 -100 -100) to (4102.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4102.5 -100 -100) to (4102.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4102.5 -100 -100) to (4102.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_47_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5294 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 105.2 | 105.2 | 105.3 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8205           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8205           200            200            0.0024646592  -1.9690158e-35  0              0.0073939777   580317.13      0              5.6042875e+10  1.1965779e-13  0              3.3302773    
    200000   8205           200            200            0.00084535475  1.1774864e-40  0              0.0025360642   134379.09      0              1.2977371e+10  1.1965779e-13  0              3.0808494    
    300000   8205           200            200            1.2604596e-05 -1.9690117e-34  0              3.7813788e-05  65.942007      0              6368207.1      1.1965779e-13  0              3.0447754    
    400000   8205           200            200            4.0269545e-05  3.9382229e-35  0              0.00012080864  655.35259      0              63289262       1.1965779e-13  0              3.0055048    
    500000   8205           200            200            0.00087034611 -0.012497493    0              0.015108531    998.66259      0              96443685       1.1965779e-13  0              2.9930349    
    600000   8205           200            200            0.0013141819  -0.008871859    0              0.012814405    1.6245833      0              156890.63      1.1965779e-13  0              2.9935632    
    700000   8205           200            200            0.001262082   -0.0047804775   0              0.0085667234   21.573725      0              2083435.9      1.1965779e-13  0              2.9947332    
    800000   8205           200            200            0.0013869119  -0.0047639042   0              0.00892464     2.8489063      0              275126.98      1.1965779e-13  0              2.9946338    
    900000   8205           200            200            0.0014735603  -0.0048816303   0              0.0093023111   0.021309944    0              2057.9618      1.1965779e-13  0              2.9945192    
   1000000   8205           200            200            0.0014227207  -0.0048153685   0              0.0090835307   0.025475143    0              2460.207       1.1965779e-13  0              2.9945838    
   1100000   8205           200            200            0.0014344355  -0.0048306608   0              0.0091339674   0.0087993078   0              849.77416      1.1965779e-13  0              2.9945692    
   1200000   8205           200            200            0.0014357136  -0.00483262     0              0.0091397609   0.00050784398  0              49.043937      1.1965779e-13  0              2.9945673    
   1300000   8205           200            200            0.001433525   -0.0048296674   0              0.0091302423   4.2089847e-06  0              0.40647361     1.1965779e-13  0              2.9945701    
   1400000   8205           200            200            0.0014343813  -0.0048307952   0              0.0091339391   1.6034356e-05  0              1.5484834      1.1965779e-13  0              2.9945691    
   1500000   8205           200            200            0.0014342735  -0.0048306634   0              0.0091334839   2.5822531e-06  0              0.24937552     1.1965779e-13  0              2.9945692    
   1600000   8205           200            200            0.0014342087  -0.0048305733   0              0.0091331994   4.6590207e-08  0              0.0044993487   1.1965779e-13  0              2.9945693    
   1700000   8205           200            200            0.0014342537  -0.0048306335   0              0.0091333946   1.3271167e-08  0              0.0012816343   1.1965779e-13  0              2.9945692    
   1800000   8205           200            200            0.0014342413  -0.0048306173   0              0.0091333411   6.9397768e-09  0              0.00067019397  1.1965779e-13  0              2.9945692    
   1900000   8205           200            200            0.0014342411  -0.0048306168   0              0.00913334     5.5933595e-10  0              5.4016662e-05  1.1965779e-13  0              2.9945692    
   2000000   8205           200            200            0.0014342428  -0.0048306192   0              0.0091333477   1.216701e-14   0              1.1750027e-09  1.1965779e-13  0              2.9945692    
   2100000   8205           200            200            0.001434242   -0.0048306181   0              0.0091333442   1.0509538e-11  0              1.014936e-06   1.1965779e-13  0              2.9945692    
   2200000   8205           200            200            0.0014342422  -0.0048306183   0              0.0091333448   2.2818483e-12  0              2.2036458e-07  1.1965779e-13  0              2.9945692    
   2300000   8205           200            200            0.0014342422  -0.0048306184   0              0.009133345    7.5200431e-14  0              7.2623194e-09  1.1965779e-13  0              2.9945692    
   2400000   8205           200            200            0.0014342422  -0.0048306183   0              0.0091333449   5.6563282e-15  0              5.462477e-10   1.1965779e-13  0              2.9945692    
   2500000   8205           200            200            0.0014342422  -0.0048306183   0              0.0091333449   5.2095048e-15  0              5.0309669e-10  1.1965779e-13  0              2.9945692    
   2600000   8205           200            200            0.0014342422  -0.0048306183   0              0.0091333449   5.4017857e-16  0              5.216658e-11   1.1965779e-13  0              2.9945692    
   2700000   8205           200            200            0.0014342422  -0.0048306183   0              0.0091333449   2.7391317e-18  0              2.6452573e-13  1.1965779e-13  0              2.9945692    
   2800000   8205           200            200            0.0014342422  -0.0048306183   0              0.0091333449   2.2346295e-18  0              2.1580452e-13  1.1965779e-13  0              2.9945692    
   2900000   8205           200            200            0.0014342422  -0.0048306183   0              0.0091333449   3.4261984e-18  0              3.3087772e-13  1.1965779e-13  0              2.9945692    
   3000000   8205           200            200            0.0014342422  -0.0048306183   0              0.0091333449   2.5573955e-18  0              2.4697496e-13  1.1965779e-13  0              2.9945692    
Loop time of 296.123 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8753126.425 ns/day, 0.000 hours/ns, 10130.933 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.953     | 36.625     | 63.371     | 422.1 | 12.37
Neigh   | 5.0817     | 5.1828     | 5.2877     |   4.1 |  1.75
Comm    | 20.283     | 39.881     | 78.812     | 361.7 | 13.47
Output  | 0.27246    | 0.27278    | 0.27311    |   0.1 |  0.09
Modify  | 109.6      | 158.02     | 177.67     | 224.0 | 53.36
Other   |            | 56.14      |            |       | 18.96

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         321.75 ave         644 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1287
Ave neighs/atom = 0.51459416
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 48

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.48                                                               
Lattice spacing in x,y,z = 5.48 5.48 5.48

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4110 ${n1e1} -100 100 -100 100 units box
region box block -4110 4110 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4110 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4110 4110 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4110 -100 -100) to (4110 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4110 -100 -100) to (4110 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4110 -100 -100) to (4110 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_48_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5304 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 105.4 | 105.4 | 105.4 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8220           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8220           200            200            0.002460108    1.5615613e-39  0              0.0073803241   580299.89      0              5.604121e+10   1.1965779e-13  0              3.3302783    
    200000   8220           200            200            0.00084386156 -5.8962876e-35  0              0.0025315847   134393.39      0              1.2978752e+10  1.1965779e-13  0              3.0807957    
    300000   8220           200            200            1.2349757e-05 -3.9306963e-35  0              3.704927e-05   63.571453      0              6139275.9      1.1965779e-13  0              3.044746     
    400000   8220           200            200            4.1328918e-05  7.8617642e-35  0              0.00012398675  691.54194      0              66784171       1.1965779e-13  0              3.0054363    
    500000   8220           200            200            0.005265912    0.0023781459   0              0.01341959     1209.0591      0              1.1676228e+08  1.1965779e-13  0              2.9933726    
    600000   8220           200            200            0.0043092499   0.0020730347   0              0.010854715    152.92635      0              14768533       1.1965779e-13  0              2.9940327    
    700000   8220           200            200            0.0040794462   0.0019736913   0              0.010264647    5.3947744      0              520988.69      1.1965779e-13  0              2.9941803    
    800000   8220           200            200            0.0035576045   0.0018208075   0              0.0088520062   2.4366645      0              235315.62      1.1965779e-13  0              2.9945964    
    900000   8220           200            200            0.0036064919   0.0018263966   0              0.0089930791   0.22487516     0              21716.833      1.1965779e-13  0              2.9945566    
   1000000   8220           200            200            0.0036667178   0.0018332776   0              0.0091668759   0.023805545    0              2298.9691      1.1965779e-13  0              2.994504     
   1100000   8220           200            200            0.0036529519   0.0018318101   0              0.0091270456   0.0068658751   0              663.05707      1.1965779e-13  0              2.9945156    
   1200000   8220           200            200            0.0036465116   0.0018310822   0              0.0091084527   0.0001142502   0              11.033467      1.1965779e-13  0              2.9945212    
   1300000   8220           200            200            0.0036491541   0.0018313727   0              0.0091160898   0.00015571438  0              15.03778       1.1965779e-13  0              2.994519     
   1400000   8220           200            200            0.0036497008   0.0018314356   0              0.0091176667   6.4599652e-09  0              0.0006238572   1.1965779e-13  0              2.9945185    
   1500000   8220           200            200            0.0036492776   0.0018313888   0              0.0091164441   2.8000517e-06  0              0.27040895     1.1965779e-13  0              2.9945188    
   1600000   8220           200            200            0.0036492555   0.0018313861   0              0.0091163806   4.6213769e-08  0              0.004462995    1.1965779e-13  0              2.9945189    
   1700000   8220           200            200            0.0036493153   0.0018313927   0              0.0091165532   3.9791896e-08  0              0.0038428165   1.1965779e-13  0              2.9945188    
   1800000   8220           200            200            0.003649311    0.0018313923   0              0.0091165407   2.844203e-09   0              0.00027467277  1.1965779e-13  0              2.9945188    
   1900000   8220           200            200            0.0036493035   0.0018313914   0              0.009116519    4.1618777e-10  0              4.0192436e-05  1.1965779e-13  0              2.9945188    
   2000000   8220           200            200            0.003649305    0.0018313916   0              0.0091165233   9.3748361e-11  0              9.0535456e-06  1.1965779e-13  0              2.9945188    
   2100000   8220           200            200            0.0036493058   0.0018313917   0              0.0091165257   2.4681413e-12  0              2.3835542e-07  1.1965779e-13  0              2.9945188    
   2200000   8220           200            200            0.0036493055   0.0018313916   0              0.0091165248   2.2431639e-12  0              2.1662871e-07  1.1965779e-13  0              2.9945188    
   2300000   8220           200            200            0.0036493054   0.0018313916   0              0.0091165246   8.4405459e-16  0              8.1512751e-11  1.1965779e-13  0              2.9945188    
   2400000   8220           200            200            0.0036493055   0.0018313916   0              0.0091165248   4.2305747e-14  0              4.0855862e-09  1.1965779e-13  0              2.9945188    
   2500000   8220           200            200            0.0036493055   0.0018313916   0              0.0091165248   4.6417054e-16  0              4.4826268e-11  1.1965779e-13  0              2.9945188    
   2600000   8220           200            200            0.0036493055   0.0018313916   0              0.0091165248   6.2852951e-16  0              6.0698882e-11  1.1965779e-13  0              2.9945188    
   2700000   8220           200            200            0.0036493055   0.0018313916   0              0.0091165248   4.1022778e-17  0              3.9616863e-12  1.1965779e-13  0              2.9945188    
   2800000   8220           200            200            0.0036493055   0.0018313916   0              0.0091165248   1.7747478e-18  0              1.7139244e-13  1.1965779e-13  0              2.9945188    
   2900000   8220           200            200            0.0036493055   0.0018313916   0              0.0091165248   3.3816492e-18  0              3.2657547e-13  1.1965779e-13  0              2.9945188    
   3000000   8220           200            200            0.0036493055   0.0018313916   0              0.0091165248   1.1580717e-18  0              1.1183828e-13  1.1965779e-13  0              2.9945188    
Loop time of 294.678 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8796052.164 ns/day, 0.000 hours/ns, 10180.616 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.913     | 36.602     | 63.134     | 421.5 | 12.42
Neigh   | 5.0549     | 5.1538     | 5.2577     |   4.0 |  1.75
Comm    | 20.242     | 39.576     | 78.321     | 361.0 | 13.43
Output  | 0.27409    | 0.2744     | 0.27474    |   0.1 |  0.09
Modify  | 109.01     | 157.18     | 176.42     | 223.5 | 53.34
Other   |            | 55.89      |            |       | 18.97

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         321.25 ave         643 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1285
Ave neighs/atom = 0.51379448
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 49

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.49                                                               
Lattice spacing in x,y,z = 5.49 5.49 5.49

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4117.5 ${n1e1} -100 100 -100 100 units box
region box block -4117.5 4117.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4117.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4117.5 4117.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4117.5 -100 -100) to (4117.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4117.5 -100 -100) to (4117.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4117.5 -100 -100) to (4117.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_49_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5313 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 105.6 | 105.6 | 105.6 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8235           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8235           200            200            0.0024554952   9.8092837e-36  0              0.0073664857   580249.29      0              5.6036323e+10  1.1965779e-13  0              3.3303473    
    200000   8235           200            200            0.00084183951 -1.9618191e-35  0              0.0025255185   134269.34      0              1.2966772e+10  1.1965779e-13  0              3.0809547    
    300000   8235           200            200            1.1666919e-05  3.9237274e-35  0              3.5000758e-05  57.036627      0              5508189.1      1.1965779e-13  0              3.0447764    
    400000   8235           200            200            4.0729778e-05 -3.9236804e-35  0              0.00012218933  674.65792      0              65153633       1.1965779e-13  0              3.005481     
    500000   8235           200            200            0.0033453016  -0.004055938    0              0.014091843    1134.3067      0              1.0954322e+08  1.1965779e-13  0              2.9932415    
    600000   8235           200            200            0.0029064246  -0.0033292135   0              0.012048487    70.668816      0              6824688.4      1.1965779e-13  0              2.9937259    
    700000   8235           200            200            0.0023889821  -0.0028057496   0              0.009972696    14.139037      0              1365447        1.1965779e-13  0              2.994274     
    800000   8235           200            200            0.0020747657  -0.0026127543   0              0.0088370515   2.4290479      0              234580.06      1.1965779e-13  0              2.9946121    
    900000   8235           200            200            0.00210862    -0.0026204985   0              0.0089463586   0.082441991    0              7961.6574      1.1965779e-13  0              2.9945809    
   1000000   8235           200            200            0.0021616975  -0.002637257    0              0.0091223495   0.056943927    0              5499.2369      1.1965779e-13  0              2.9945275    
   1100000   8235           200            200            0.0021614464  -0.0026374933   0              0.0091218327   0.00076698839  0              74.070249      1.1965779e-13  0              2.9945272    
   1200000   8235           200            200            0.0021540277  -0.0026357595   0              0.0090978427   0.0011087843   0              107.07846      1.1965779e-13  0              2.9945345    
   1300000   8235           200            200            0.0021537501  -0.0026356804   0              0.0090969308   5.6454828e-06  0              0.54520032     1.1965779e-13  0              2.9945348    
   1400000   8235           200            200            0.0021547378  -0.002635914    0              0.0091001273   2.1053217e-05  0              2.033169       1.1965779e-13  0              2.9945338    
   1500000   8235           200            200            0.0021548155  -0.0026359342   0              0.0091003807   1.7936347e-08  0              0.001732164    1.1965779e-13  0              2.9945337    
   1600000   8235           200            200            0.0021546854  -0.0026359035   0              0.0090999598   3.8980169e-07  0              0.037644257    1.1965779e-13  0              2.9945339    
   1700000   8235           200            200            0.0021546696  -0.0026358996   0              0.0090999085   5.3642315e-11  0              5.1803909e-06  1.1965779e-13  0              2.9945339    
   1800000   8235           200            200            0.0021546865  -0.0026359035   0              0.0090999632   7.0418327e-09  0              0.0006800498   1.1965779e-13  0              2.9945339    
   1900000   8235           200            200            0.0021546894  -0.0026359042   0              0.0090999723   1.9363804e-11  0              1.8700176e-06  1.1965779e-13  0              2.9945339    
   2000000   8235           200            200            0.0021546872  -0.0026359037   0              0.0090999653   1.2409561e-10  0              1.1984266e-05  1.1965779e-13  0              2.9945339    
   2100000   8235           200            200            0.0021546867  -0.0026359036   0              0.0090999638   1.0962334e-12  0              1.0586637e-07  1.1965779e-13  0              2.9945339    
   2200000   8235           200            200            0.002154687   -0.0026359037   0              0.0090999647   2.1324003e-12  0              2.0593196e-07  1.1965779e-13  0              2.9945339    
   2300000   8235           200            200            0.0021546871  -0.0026359037   0              0.0090999649   4.036075e-14   0              3.8977524e-09  1.1965779e-13  0              2.9945339    
   2400000   8235           200            200            0.002154687   -0.0026359037   0              0.0090999648   3.5569785e-14  0              3.4350752e-09  1.1965779e-13  0              2.9945339    
   2500000   8235           200            200            0.002154687   -0.0026359037   0              0.0090999648   1.2546867e-15  0              1.2116866e-10  1.1965779e-13  0              2.9945339    
   2600000   8235           200            200            0.002154687   -0.0026359037   0              0.0090999648   5.3935181e-16  0              5.2086737e-11  1.1965779e-13  0              2.9945339    
   2700000   8235           200            200            0.002154687   -0.0026359037   0              0.0090999648   2.3640872e-17  0              2.2830662e-12  1.1965779e-13  0              2.9945339    
   2800000   8235           200            200            0.002154687   -0.0026359037   0              0.0090999648   1.1773177e-17  0              1.1369691e-12  1.1965779e-13  0              2.9945339    
   2900000   8235           200            200            0.002154687   -0.0026359037   0              0.0090999648   1.5795045e-18  0              1.5253724e-13  1.1965779e-13  0              2.9945339    
   3000000   8235           200            200            0.002154687   -0.0026359037   0              0.0090999648   3.65501e-18    0              3.529747e-13   1.1965779e-13  0              2.9945339    
Loop time of 299.677 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8649298.202 ns/day, 0.000 hours/ns, 10010.762 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.039     | 36.571     | 62.765     | 421.3 | 12.20
Neigh   | 5.0661     | 5.1661     | 5.2687     |   4.0 |  1.72
Comm    | 20.106     | 40.826     | 80.067     | 362.1 | 13.62
Output  | 0.27507    | 0.27539    | 0.27572    |   0.1 |  0.09
Modify  | 110.1      | 159.83     | 180.37     | 228.6 | 53.33
Other   |            | 57.01      |            |       | 19.02

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         322.25 ave         645 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1289
Ave neighs/atom = 0.51539384
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 50

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.5                                                               
Lattice spacing in x,y,z = 5.5 5.5 5.5

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4125 ${n1e1} -100 100 -100 100 units box
region box block -4125 4125 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4125 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4125 4125 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4125 -100 -100) to (4125 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4125 -100 -100) to (4125 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4125 -100 -100) to (4125 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_50_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5323 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 105.7 | 105.7 | 105.8 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8250           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8250           200            200            0.0024446018  -9.7914079e-36  0              0.0073338055   577589.26      0              5.5779436e+10  1.1965779e-13  0              3.3352538    
    200000   8250           200            200            0.00081318731  2.158314e-40   0              0.0024395619   127296.3       0              1.2293365e+10  1.1965779e-13  0              3.0917452    
    300000   8250           200            200           -1.0265343e-05 -3.9165392e-35  0             -3.0796029e-05  44.89801       0              4335928.4      1.1965779e-13  0              3.0476151    
    400000   8250           200            200            6.9245621e-05  1.9583157e-35  0              0.00020773686  1868.9257      0              1.8048747e+08  1.1965779e-13  0              3.0069159    
    500000   8250           200            200            0.0073432497   5.8748805e-35  0              0.022029749    32.758343      0              3163566.3      1.1965779e-13  0              2.9943916    
    600000   8250           200            200            0.0016698323   9.7914536e-35  0              0.0050094968   0.36316102     0              35071.492      1.1965779e-13  0              2.9979098    
    700000   8250           200            200            0.0029246945  -9.7912873e-36  0              0.0087740834   30.814839      0              2975876.6      1.1965779e-13  0              2.9969576    
    800000   8250           200            200            0.0031920768  -5.8748482e-35  0              0.0095762304   1.348481       0              130226.65      1.1965779e-13  0              2.9967797    
    900000   8250           200            200            0.0030921039  -9.79132e-36    0              0.0092763117   0.15321697     0              14796.599      1.1965779e-13  0              2.9968489    
   1000000   8250           200            200            0.003027981    2.9374405e-35  0              0.009083943    0.077609331    0              7494.9537      1.1965779e-13  0              2.9968925    
   1100000   8250           200            200            0.0030211704   2.4478658e-35  0              0.0090635113   0.0012807355   0              123.68427      1.1965779e-13  0              2.9968969    
   1200000   8250           200            200            0.0030276192  -4.8956683e-36  0              0.0090828575   0.00068481873  0              66.134891      1.1965779e-13  0              2.9968924    
   1300000   8250           200            200            0.0030305888   4.6936291e-41  0              0.0090917664   0.00017251178  0              16.659953      1.1965779e-13  0              2.9968904    
   1400000   8250           200            200            0.0030306626   4.6416579e-41  0              0.0090919879   4.1533623e-07  0              0.040110201    1.1965779e-13  0              2.9968904    
   1500000   8250           200            200            0.0030302859   7.3436241e-36  0              0.0090908578   2.4493662e-06  0              0.23654226     1.1965779e-13  0              2.9968906    
   1600000   8250           200            200            0.0030301564   2.4479054e-36  0              0.0090904691   3.4084057e-07  0              0.032915943    1.1965779e-13  0              2.9968907    
   1700000   8250           200            200            0.003030166   -1.2238835e-36  0              0.0090904979   6.491953e-10   0              6.2694635e-05  1.1965779e-13  0              2.9968907    
   1800000   8250           200            200            0.0030301865   4.8957646e-36  0              0.0090905594   7.5262064e-09  0              0.00072682715  1.1965779e-13  0              2.9968907    
   1900000   8250           200            200            0.0030301917  -2.4478133e-36  0              0.0090905751   5.8157774e-10  0              5.6164615e-05  1.1965779e-13  0              2.9968907    
   2000000   8250           200            200            0.0030301906  -2.2944087e-37  0              0.0090905718   1.6247675e-11  0              1.5690841e-06  1.1965779e-13  0              2.9968907    
   2100000   8250           200            200            0.0030301895  -6.1191867e-37  0              0.0090905686   2.0513633e-11  0              1.9810598e-06  1.1965779e-13  0              2.9968907    
   2200000   8250           200            200            0.0030301893  -6.1191879e-37  0              0.009090568    8.0199873e-13  0              7.7451297e-08  1.1965779e-13  0              2.9968907    
   2300000   8250           200            200            0.0030301894  -4.8956726e-36  0              0.0090905683   1.0609804e-13  0              1.0246189e-08  1.1965779e-13  0              2.9968907    
   2400000   8250           200            200            0.0030301895   4.6037736e-41  0              0.0090905685   5.0320372e-14  0              4.8595814e-09  1.1965779e-13  0              2.9968907    
   2500000   8250           200            200            0.0030301895   4.6056813e-41  0              0.0090905685   8.2007451e-16  0              7.9196927e-11  1.1965779e-13  0              2.9968907    
   2600000   8250           200            200            0.0030301895   1.7135061e-35  0              0.0090905685   4.5354416e-16  0              4.3800048e-11  1.1965779e-13  0              2.9968907    
   2700000   8250           200            200            0.0030301895  -4.8956724e-36  0              0.0090905684   9.2201714e-17  0              8.9041816e-12  1.1965779e-13  0              2.9968907    
   2800000   8250           200            200            0.0030301895  -1.4687109e-35  0              0.0090905684   5.0355107e-19  0              4.8629358e-14  1.1965779e-13  0              2.9968907    
   2900000   8250           200            200            0.0030301895  -1.4687109e-35  0              0.0090905684   7.1536998e-18  0              6.9085313e-13  1.1965779e-13  0              2.9968907    
   3000000   8250           200            200            0.0030301895  -4.895668e-36   0              0.0090905684   4.0583893e-18  0              3.9193019e-13  1.1965779e-13  0              2.9968907    
Loop time of 295.535 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8770549.096 ns/day, 0.000 hours/ns, 10151.098 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.9       | 36.778     | 63.339     | 423.4 | 12.44
Neigh   | 5.1499     | 5.2536     | 5.3606     |   4.1 |  1.78
Comm    | 20.41      | 39.731     | 78.594     | 361.3 | 13.44
Output  | 0.27099    | 0.2713     | 0.27164    |   0.1 |  0.09
Modify  | 108.96     | 157.39     | 177.09     | 224.4 | 53.26
Other   |            | 56.11      |            |       | 18.99

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         318.25 ave         637 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1273
Ave neighs/atom = 0.5089964
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 51

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.51                                                               
Lattice spacing in x,y,z = 5.51 5.51 5.51

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4132.5 ${n1e1} -100 100 -100 100 units box
region box block -4132.5 4132.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4132.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4132.5 4132.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4132.5 -100 -100) to (4132.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4132.5 -100 -100) to (4132.5 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4132.5 -100 -100) to (4132.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_51_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5333 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 106 | 106 | 106 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8265           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8265           200            200            0.0024464091   7.6473296e-41  0              0.0073392273   580187.11      0              5.6030318e+10  1.1965779e-13  0              3.3304008    
    200000   8265           200            200            0.00083830574 -1.9547166e-35  0              0.0025149172   134148.57      0              1.2955109e+10  1.1965779e-13  0              3.0810684    
    300000   8265           200            200            1.0814049e-05 -1.9547095e-35  0              3.2442147e-05  49.466198      0              4777091.3      1.1965779e-13  0              3.0447698    
    400000   8265           200            200            3.9099601e-05 -1.9547029e-35  0              0.0001172988   627.80945      0              60629343       1.1965779e-13  0              3.0055249    
    500000   8265           200            200            0.0055807686   0.0029493653   0              0.01379294     1164.9442      0              1.1250197e+08  1.1965779e-13  0              2.9932992    
    600000   8265           200            200            0.0047910678   0.0024823253   0              0.011890878    79.320116      0              7660169        1.1965779e-13  0              2.9937544    
    700000   8265           200            200            0.0039457984   0.0020624714   0              0.0097749237   18.265417      0              1763943.3      1.1965779e-13  0              2.994324     
    800000   8265           200            200            0.0036336362   0.0022623087   0              0.0086385999   0.49810557     0              48103.471      1.1965779e-13  0              2.994668     
    900000   8265           200            200            0.0037653766   0.0022494175   0              0.0090467123   0.47401633     0              45777.104      1.1965779e-13  0              2.9945455    
   1000000   8265           200            200            0.0037937204   0.0022524504   0              0.009128711    0.0016005032   0              154.56515      1.1965779e-13  0              2.9945199    
   1100000   8265           200            200            0.0037689918   0.0022500761   0              0.0090568994   0.007148527    0              690.35357      1.1965779e-13  0              2.9945414    
   1200000   8265           200            200            0.0037702951   0.0022501747   0              0.0090607106   0.00052488316  0              50.689459      1.1965779e-13  0              2.9945404    
   1300000   8265           200            200            0.003773346    0.0022504412   0              0.0090695967   4.4264643e-05  0              4.2747624      1.1965779e-13  0              2.9945377    
   1400000   8265           200            200            0.0037725375   0.0022503726   0              0.00906724     1.9987967e-05  0              1.9302948      1.1965779e-13  0              2.9945384    
   1500000   8265           200            200            0.0037722938   0.0022503509   0              0.0090665304   9.1294753e-10  0              8.8165938e-05  1.1965779e-13  0              2.9945386    
   1600000   8265           200            200            0.0037724534   0.0022503647   0              0.0090669954   3.5611461e-07  0              0.034391       1.1965779e-13  0              2.9945385    
   1700000   8265           200            200            0.0037724531   0.0022503647   0              0.0090669947   1.6354321e-08  0              0.0015793833   1.1965779e-13  0              2.9945385    
   1800000   8265           200            200            0.0037724317   0.0022503629   0              0.0090669321   2.9115461e-09  0              0.00028117628  1.1965779e-13  0              2.9945385    
   1900000   8265           200            200            0.0037724361   0.0022503632   0              0.0090669452   8.0906095e-10  0              7.8133315e-05  1.1965779e-13  0              2.9945385    
   2000000   8265           200            200            0.0037724381   0.0022503634   0              0.0090669509   1.8960911e-12  0              1.831109e-07   1.1965779e-13  0              2.9945385    
   2100000   8265           200            200            0.0037724371   0.0022503633   0              0.009066948    1.6992906e-11  0              1.6410533e-06  1.1965779e-13  0              2.9945385    
   2200000   8265           200            200            0.003772437    0.0022503633   0              0.0090669478   4.4845838e-13  0              4.3308901e-08  1.1965779e-13  0              2.9945385    
   2300000   8265           200            200            0.0037724372   0.0022503633   0              0.0090669482   1.7422645e-13  0              1.6825543e-08  1.1965779e-13  0              2.9945385    
   2400000   8265           200            200            0.0037724372   0.0022503633   0              0.0090669482   3.11841e-14    0              3.0115372e-09  1.1965779e-13  0              2.9945385    
   2500000   8265           200            200            0.0037724372   0.0022503633   0              0.0090669481   3.749802e-16   0              3.6212903e-11  1.1965779e-13  0              2.9945385    
   2600000   8265           200            200            0.0037724372   0.0022503633   0              0.0090669481   7.7656918e-16  0              7.4995493e-11  1.1965779e-13  0              2.9945385    
   2700000   8265           200            200            0.0037724372   0.0022503633   0              0.0090669481   1.4180639e-17  0              1.3694646e-12  1.1965779e-13  0              2.9945385    
   2800000   8265           200            200            0.0037724372   0.0022503633   0              0.0090669481   4.30355e-18    0              4.1560605e-13  1.1965779e-13  0              2.9945385    
   2900000   8265           200            200            0.0037724372   0.0022503633   0              0.0090669481   2.156093e-18   0              2.0822003e-13  1.1965779e-13  0              2.9945385    
   3000000   8265           200            200            0.0037724372   0.0022503633   0              0.0090669481   2.2300139e-18  0              2.1535878e-13  1.1965779e-13  0              2.9945385    
Loop time of 295.548 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8770134.363 ns/day, 0.000 hours/ns, 10150.618 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.879     | 36.506     | 62.812     | 420.8 | 12.35
Neigh   | 5.1544     | 5.255      | 5.3596     |   4.0 |  1.78
Comm    | 20.544     | 39.84      | 78.355     | 357.8 | 13.48
Output  | 0.27536    | 0.2757     | 0.27606    |   0.1 |  0.09
Modify  | 109.4      | 157.63     | 177.15     | 223.5 | 53.34
Other   |            | 56.04      |            |       | 18.96

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         321.25 ave         643 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1285
Ave neighs/atom = 0.51379448
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 52

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.52                                                               
Lattice spacing in x,y,z = 5.52 5.52 5.52

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4140 ${n1e1} -100 100 -100 100 units box
region box block -4140 4140 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4140 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4140 4140 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4140 -100 -100) to (4140 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4140 -100 -100) to (4140 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4140 -100 -100) to (4140 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_52_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5342 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 106 | 106.1 | 106.1 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8280           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8280           200            200            0.002442057    6.3317432e-41  0              0.0073261709   580224.95      0              5.6033973e+10  1.1965779e-13  0              3.3303016    
    200000   8280           200            200            0.00083745947  9.7560459e-36  0              0.0025123784   134324.14      0              1.2972064e+10  1.1965779e-13  0              3.0807872    
    300000   8280           200            200            1.1932539e-05  2.3185797e-39  0              3.5797617e-05  60.270151      0              5820459.8      1.1965779e-13  0              3.0446818    
    400000   8280           200            200            3.7153474e-05  3.9024043e-35  0              0.00011146042  570.74364      0              55118336       1.1965779e-13  0              3.0054943    
    500000   8280           200            200            0.0032904694  -0.0021369007   0              0.012008309    1374.039       0              1.3269485e+08  1.1965779e-13  0              2.9937857    
    600000   8280           200            200            0.003021009   -0.0022992501   0              0.011362277    116.50004      0              11250740       1.1965779e-13  0              2.9938986    
    700000   8280           200            200            0.0021271493  -0.0018782066   0              0.0082596545   16.166053      0              1561201.6      1.1965779e-13  0              2.9948019    
    800000   8280           200            200            0.0024409173  -0.0019293834   0              0.0092521355   2.9316621      0              283118.94      1.1965779e-13  0              2.9945       
    900000   8280           200            200            0.0023651913  -0.0019179255   0              0.0090134994   0.46292474     0              44705.958      1.1965779e-13  0              2.9945728    
   1000000   8280           200            200            0.0023764685  -0.0019198074   0              0.0090492128   0.065688561    0              6343.7311      1.1965779e-13  0              2.9945611    
   1100000   8280           200            200            0.0023788064  -0.0019200728   0              0.009056492    0.008335148    0              804.94894      1.1965779e-13  0              2.9945594    
   1200000   8280           200            200            0.0023756379  -0.0019196339   0              0.0090465477   0.00093910356  0              90.6919        1.1965779e-13  0              2.9945621    
   1300000   8280           200            200            0.0023775896  -0.0019199122   0              0.0090526812   9.1786135e-05  0              8.864048       1.1965779e-13  0              2.9945604    
   1400000   8280           200            200            0.0023766231  -0.0019197727   0              0.009049642    7.3462627e-06  0              0.70944947     1.1965779e-13  0              2.9945613    
   1500000   8280           200            200            0.0023770503  -0.0019198349   0              0.0090509859   4.1491629e-07  0              0.040069645    1.1965779e-13  0              2.9945609    
   1600000   8280           200            200            0.0023768755  -0.0019198093   0              0.0090504358   8.9470929e-09  0              0.00086404619  1.1965779e-13  0              2.994561     
   1700000   8280           200            200            0.0023769428  -0.0019198192   0              0.0090506475   3.7261366e-10  0              3.598436e-05   1.1965779e-13  0              2.994561     
   1800000   8280           200            200            0.0023769183  -0.0019198156   0              0.0090505705   7.0469815e-10  0              6.8054703e-05  1.1965779e-13  0              2.994561     
   1900000   8280           200            200            0.0023769267  -0.0019198168   0              0.009050597    2.6764463e-10  0              2.5847203e-05  1.1965779e-13  0              2.994561     
   2000000   8280           200            200            0.002376924   -0.0019198164   0              0.0090505884   6.5715406e-11  0              6.3463235e-06  1.1965779e-13  0              2.994561     
   2100000   8280           200            200            0.0023769248  -0.0019198165   0              0.009050591    1.2845556e-11  0              1.2405318e-06  1.1965779e-13  0              2.994561     
   2200000   8280           200            200            0.0023769246  -0.0019198165   0              0.0090505903   2.1526303e-12  0              2.0788562e-07  1.1965779e-13  0              2.994561     
   2300000   8280           200            200            0.0023769246  -0.0019198165   0              0.0090505904   3.1888831e-13  0              3.0795951e-08  1.1965779e-13  0              2.994561     
   2400000   8280           200            200            0.0023769246  -0.0019198165   0              0.0090505904   4.2141627e-14  0              4.0697367e-09  1.1965779e-13  0              2.994561     
   2500000   8280           200            200            0.0023769246  -0.0019198165   0              0.0090505904   5.0392318e-15  0              4.8665294e-10  1.1965779e-13  0              2.994561     
   2600000   8280           200            200            0.0023769246  -0.0019198165   0              0.0090505904   5.2668438e-16  0              5.0863408e-11  1.1965779e-13  0              2.994561     
   2700000   8280           200            200            0.0023769246  -0.0019198165   0              0.0090505904   3.1244657e-17  0              3.0173853e-12  1.1965779e-13  0              2.994561     
   2800000   8280           200            200            0.0023769246  -0.0019198165   0              0.0090505904   1.8219725e-19  0              1.7595306e-14  1.1965779e-13  0              2.994561     
   2900000   8280           200            200            0.0023769246  -0.0019198165   0              0.0090505904   7.7440396e-19  0              7.4786392e-14  1.1965779e-13  0              2.994561     
   3000000   8280           200            200            0.0023769246  -0.0019198165   0              0.0090505904   5.2095366e-18  0              5.0309976e-13  1.1965779e-13  0              2.994561     
Loop time of 295.855 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8761038.913 ns/day, 0.000 hours/ns, 10140.091 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.977     | 36.345     | 62.316     | 418.2 | 12.28
Neigh   | 5.1877     | 5.2864     | 5.3887     |   4.0 |  1.79
Comm    | 20.307     | 39.626     | 77.922     | 357.0 | 13.39
Output  | 0.27172    | 0.27202    | 0.27236    |   0.1 |  0.09
Modify  | 109.68     | 157.89     | 177.67     | 223.5 | 53.37
Other   |            | 56.44      |            |       | 19.08

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         320.75 ave         642 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1283
Ave neighs/atom = 0.5129948
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 53

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.53                                                               
Lattice spacing in x,y,z = 5.53 5.53 5.53

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4147.5 ${n1e1} -100 100 -100 100 units box
region box block -4147.5 4147.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4147.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4147.5 4147.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4147.5 -100 -100) to (4147.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4147.5 -100 -100) to (4147.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4147.5 -100 -100) to (4147.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_53_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5352 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 106.2 | 106.2 | 106.2 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8295           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8295           200            200            0.002437383   -7.3037347e-36  0              0.0073121489   580123.56      0              5.6024181e+10  1.1965779e-13  0              3.3304506    
    200000   8295           200            200            0.00083480201  1.1686024e-34  0              0.002504406    134029.36      0              1.2943596e+10  1.1965779e-13  0              3.0811726    
    300000   8295           200            200            9.9452989e-06  3.8953637e-35  0              2.9835897e-05  42.240934      0              4079327        1.1965779e-13  0              3.0447538    
    400000   8295           200            200            3.6731283e-05 -5.8429744e-35  0              0.00011019385  560.17647      0              54097834       1.1965779e-13  0              3.0055828    
    500000   8295           200            200            0.0044239598   0.00047956573  0              0.012792314    1275.8674      0              1.2321414e+08  1.1965779e-13  0              2.9935377    
    600000   8295           200            200            0.0041189185   0.00080850937  0              0.011548246    102.96006      0              9943145.7      1.1965779e-13  0              2.9938321    
    700000   8295           200            200            0.0035537176   0.0007849418   0              0.009876211    14.840035      0              1433144.3      1.1965779e-13  0              2.9942813    
    800000   8295           200            200            0.0031400585   0.00078410448  0              0.0086360709   0.90865064     0              87750.975      1.1965779e-13  0              2.9946552    
    900000   8295           200            200            0.003251554    0.0007672073   0              0.0089874547   0.44290002     0              42772.114      1.1965779e-13  0              2.99455      
   1000000   8295           200            200            0.00328769     0.00076653336  0              0.0090965367   1.6617319e-05  0              1.6047817      1.1965779e-13  0              2.9945162    
   1100000   8295           200            200            0.003265035    0.0007669722   0              0.0090281327   0.0081965573   0              791.56483      1.1965779e-13  0              2.9945366    
   1200000   8295           200            200            0.0032646384   0.00076698577  0              0.0090269294   0.00030080431  0              29.049527      1.1965779e-13  0              2.9945371    
   1300000   8295           200            200            0.0032677645   0.00076691059  0              0.009036383    7.7113647e-05  0              7.4470841      1.1965779e-13  0              2.9945343    
   1400000   8295           200            200            0.0032671999   0.00076692356  0              0.0090346762   1.6622127e-05  0              1.605246       1.1965779e-13  0              2.9945348    
   1500000   8295           200            200            0.0032668899   0.0007669311   0              0.0090337387   1.4269347e-07  0              0.013780314    1.1965779e-13  0              2.9945351    
   1600000   8295           200            200            0.0032670274   0.00076692785  0              0.0090341544   3.9018481e-07  0              0.037681256    1.1965779e-13  0              2.9945349    
   1700000   8295           200            200            0.003267042    0.00076692748  0              0.0090341986   5.2761682e-09  0              0.00050953456  1.1965779e-13  0              2.9945349    
   1800000   8295           200            200            0.0032670206   0.00076692799  0              0.0090341338   4.8834141e-09  0              0.00047160518  1.1965779e-13  0              2.9945349    
   1900000   8295           200            200            0.0032670229   0.00076692794  0              0.0090341406   5.5806423e-10  0              5.3893848e-05  1.1965779e-13  0              2.9945349    
   2000000   8295           200            200            0.0032670253   0.00076692788  0              0.009034148    2.258055e-11   0              2.1806679e-06  1.1965779e-13  0              2.9945349    
   2100000   8295           200            200            0.0032670245   0.0007669279   0              0.0090341456   1.7028022e-11  0              1.6444445e-06  1.1965779e-13  0              2.9945349    
   2200000   8295           200            200            0.0032670243   0.0007669279   0              0.0090341451   3.0989748e-14  0              2.992768e-09   1.1965779e-13  0              2.9945349    
   2300000   8295           200            200            0.0032670245   0.0007669279   0              0.0090341455   2.7240409e-13  0              2.6306837e-08  1.1965779e-13  0              2.9945349    
   2400000   8295           200            200            0.0032670245   0.0007669279   0              0.0090341455   1.6015122e-14  0              1.5466258e-09  1.1965779e-13  0              2.9945349    
   2500000   8295           200            200            0.0032670245   0.0007669279   0              0.0090341455   2.0697003e-15  0              1.9987684e-10  1.1965779e-13  0              2.9945349    
   2600000   8295           200            200            0.0032670245   0.0007669279   0              0.0090341455   6.5792335e-16  0              6.3537528e-11  1.1965779e-13  0              2.9945349    
   2700000   8295           200            200            0.0032670245   0.0007669279   0              0.0090341455   2.7392212e-19  0              2.6453438e-14  1.1965779e-13  0              2.9945349    
   2800000   8295           200            200            0.0032670245   0.0007669279   0              0.0090341455   1.1350981e-17  0              1.0961965e-12  1.1965779e-13  0              2.9945349    
   2900000   8295           200            200            0.0032670245   0.0007669279   0              0.0090341455   3.7395182e-18  0              3.611359e-13   1.1965779e-13  0              2.9945349    
   3000000   8295           200            200            0.0032670245   0.0007669279   0              0.0090341455   3.2245251e-22  0              3.1140156e-17  1.1965779e-13  0              2.9945349    
Loop time of 296.904 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8730109.068 ns/day, 0.000 hours/ns, 10104.293 timesteps/s
99.9% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.03      | 36.511     | 62.95      | 419.6 | 12.30
Neigh   | 5.1921     | 5.2927     | 5.3973     |   4.0 |  1.78
Comm    | 20.458     | 39.819     | 78.415     | 358.7 | 13.41
Output  | 0.2741     | 0.2744     | 0.27474    |   0.1 |  0.09
Modify  | 109.99     | 158.44     | 178.8      | 224.2 | 53.37
Other   |            | 56.56      |            |       | 19.05

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         320.75 ave         642 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1283
Ave neighs/atom = 0.5129948
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 54

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.54                                                               
Lattice spacing in x,y,z = 5.54 5.54 5.54

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4155 ${n1e1} -100 100 -100 100 units box
region box block -4155 4155 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4155 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4155 4155 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4155 -100 -100) to (4155 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4155 -100 -100) to (4155 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4155 -100 -100) to (4155 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_54_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5362 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 106.4 | 106.4 | 106.4 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8310           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8310           200            200            0.0024329782  -2.4301793e-36  0              0.0072989345   580126.07      0              5.6024424e+10  1.1965779e-13  0              3.3304165    
    200000   8310           200            200            0.00083379871  2.4301913e-36  0              0.0025013961   134161.88      0              1.2956394e+10  1.1965779e-13  0              3.0809476    
    300000   8310           200            200            1.0305595e-05  2.8607838e-40  0              3.0916784e-05  45.473929      0              4391546.6      1.1965779e-13  0              3.0446788    
    400000   8310           200            200            3.8988478e-05 -1.4581091e-35  0              0.00011696544  630.98897      0              60936398       1.1965779e-13  0              3.0054384    
    500000   8310           200            200            0.0056018771   0.00087619273  0              0.015929439    843.04289      0              81415048       1.1965779e-13  0              2.9927019    
    600000   8310           200            200            0.0040676241  -0.00043490337  0              0.012637776    5.0533272      0              488014.17      1.1965779e-13  0              2.9934543    
    700000   8310           200            200            0.0020770356  -0.0019018788   0              0.0081329857   13.306959      0              1285090.9      1.1965779e-13  0              2.9947148    
    800000   8310           200            200            0.0024059722  -0.0018155465   0              0.0090334633   3.5838307      0              346100.71      1.1965779e-13  0              2.9944444    
    900000   8310           200            200            0.0024348514  -0.001799462    0              0.0091040163   0.35573554     0              34354.392      1.1965779e-13  0              2.9944201    
   1000000   8310           200            200            0.0023833079  -0.0018122219   0              0.0089621456   0.013513802    0              1305.0663      1.1965779e-13  0              2.9944633    
   1100000   8310           200            200            0.0024101313  -0.0018101468   0              0.0090405406   5.1748148e-05  0              4.9974658      1.1965779e-13  0              2.9944398    
   1200000   8310           200            200            0.0023999421  -0.0018108604   0              0.0090106866   0.00040738623  0              39.342447      1.1965779e-13  0              2.9944487    
   1300000   8310           200            200            0.0024027084  -0.0018106618   0              0.0090187868   0.00013612335  0              13.145819      1.1965779e-13  0              2.9944463    
   1400000   8310           200            200            0.0024023517  -0.0018106857   0              0.0090177409   2.0983446e-05  0              2.026431       1.1965779e-13  0              2.9944466    
   1500000   8310           200            200            0.002402202   -0.0018106972   0              0.0090173032   1.6744027e-06  0              0.16170183     1.1965779e-13  0              2.9944467    
   1600000   8310           200            200            0.0024023438  -0.0018106868   0              0.0090177183   3.6947156e-08  0              0.0035680919   1.1965779e-13  0              2.9944466    
   1700000   8310           200            200            0.0024022752  -0.0018106917   0              0.0090175174   2.9376626e-09  0              0.00028369842  1.1965779e-13  0              2.9944466    
   1800000   8310           200            200            0.002402299   -0.00181069     0              0.0090175872   3.5826272e-09  0              0.00034598449  1.1965779e-13  0              2.9944466    
   1900000   8310           200            200            0.0024022934  -0.0018106904   0              0.0090175706   9.0959332e-10  0              8.7842012e-05  1.1965779e-13  0              2.9944466    
   2000000   8310           200            200            0.0024022937  -0.0018106904   0              0.0090175716   1.1677939e-10  0              1.1277718e-05  1.1965779e-13  0              2.9944466    
   2100000   8310           200            200            0.0024022943  -0.0018106904   0              0.0090175732   7.2757326e-12  0              7.0263818e-07  1.1965779e-13  0              2.9944466    
   2200000   8310           200            200            0.0024022939  -0.0018106904   0              0.0090175721   5.3302098e-14  0              5.1475351e-09  1.1965779e-13  0              2.9944466    
   2300000   8310           200            200            0.0024022941  -0.0018106904   0              0.0090175726   4.7829319e-14  0              4.6190133e-09  1.1965779e-13  0              2.9944466    
   2400000   8310           200            200            0.002402294   -0.0018106904   0              0.0090175724   2.8040675e-14  0              2.7079677e-09  1.1965779e-13  0              2.9944466    
   2500000   8310           200            200            0.002402294   -0.0018106904   0              0.0090175724   5.7383932e-15  0              5.5417294e-10  1.1965779e-13  0              2.9944466    
   2600000   8310           200            200            0.002402294   -0.0018106904   0              0.0090175724   5.9133169e-16  0              5.7106582e-11  1.1965779e-13  0              2.9944466    
   2700000   8310           200            200            0.002402294   -0.0018106904   0              0.0090175724   2.9863662e-17  0              2.8840187e-12  1.1965779e-13  0              2.9944466    
   2800000   8310           200            200            0.002402294   -0.0018106904   0              0.0090175724   6.8201485e-19  0              6.5864113e-14  1.1965779e-13  0              2.9944466    
   2900000   8310           200            200            0.002402294   -0.0018106904   0              0.0090175724   3.412111e-18   0              3.2951726e-13  1.1965779e-13  0              2.9944466    
   3000000   8310           200            200            0.002402294   -0.0018106904   0              0.0090175724   1.4944701e-18  0              1.4432522e-13  1.1965779e-13  0              2.9944466    
Loop time of 297.157 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8722670.478 ns/day, 0.000 hours/ns, 10095.683 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.963     | 36.811     | 63.743     | 423.7 | 12.39
Neigh   | 5.1681     | 5.2669     | 5.3689     |   4.0 |  1.77
Comm    | 20.468     | 40.194     | 79.444     | 363.1 | 13.53
Output  | 0.28909    | 0.28941    | 0.28973    |   0.1 |  0.10
Modify  | 109.1      | 158        | 177.89     | 226.2 | 53.17
Other   |            | 56.59      |            |       | 19.04

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         321.25 ave         643 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1285
Ave neighs/atom = 0.51379448
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 55

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.55                                                               
Lattice spacing in x,y,z = 5.55 5.55 5.55

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4162.5 ${n1e1} -100 100 -100 100 units box
region box block -4162.5 4162.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4162.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4162.5 4162.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4162.5 -100 -100) to (4162.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4162.5 -100 -100) to (4162.5 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4162.5 -100 -100) to (4162.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_55_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5371 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 106.6 | 106.6 | 106.6 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8325           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8325           200            200            0.0024285932  -2.425805e-36   0              0.0072857796   580130.33      0              5.6024835e+10  1.1965779e-13  0              3.3303787    
    200000   8325           200            200            0.00083180442 -9.7031263e-36  0              0.0024954132   134034.95      0              1.2944136e+10  1.1965779e-13  0              3.0811056    
    300000   8325           200            200            9.1288963e-06 -3.8812353e-35  0              2.7386689e-05  35.934896      0              3470335        1.1965779e-13  0              3.0446841    
    400000   8325           200            200            3.6020226e-05  1.690308e-40   0              0.00010806068  543.14617      0              52453169       1.1965779e-13  0              3.0055634    
    500000   8325           200            200            0.0051140914  -0.0045162006   0              0.019858475    145.64236      0              14065097       1.1965779e-13  0              2.9919427    
    600000   8325           200            200            0.0028838095  -0.0016456051   0              0.010297034    186.74309      0              18034311       1.1965779e-13  0              2.9940499    
    700000   8325           200            200            0.0027353446  -0.0016704319   0              0.0098764659   16.002944      0              1545449.8      1.1965779e-13  0              2.9941368    
    800000   8325           200            200            0.0023239699  -0.0015374194   0              0.008509329    0.0082308289   0              794.87454      1.1965779e-13  0              2.9945049    
    900000   8325           200            200            0.0025210134  -0.001575799    0              0.0091388392   0.21865035     0              21115.685      1.1965779e-13  0              2.9943351    
   1000000   8325           200            200            0.0024757351  -0.0015678746   0              0.00899508     0.066453925    0              6417.6445      1.1965779e-13  0              2.9943726    
   1100000   8325           200            200            0.0024728156  -0.0015672436   0              0.0089856902   0.0053988067   0              521.37811      1.1965779e-13  0              2.9943755    
   1200000   8325           200            200            0.0024804614  -0.0015686699   0              0.0090100541   1.7137224e-05  0              1.6549905      1.1965779e-13  0              2.9943689    
   1300000   8325           200            200            0.0024768113  -0.0015680019   0              0.0089984359   5.9561314e-05  0              5.7520054      1.1965779e-13  0              2.994372     
   1400000   8325           200            200            0.0024777121  -0.0015681638   0              0.0090012999   2.1556924e-05  0              2.0818134      1.1965779e-13  0              2.9943713    
   1500000   8325           200            200            0.0024777273  -0.0015681683   0              0.0090013503   2.007358e-06   0              0.19385627     1.1965779e-13  0              2.9943712    
   1600000   8325           200            200            0.0024775978  -0.0015681441   0              0.0090009375   1.5351294e-08  0              0.0014825181   1.1965779e-13  0              2.9943714    
   1700000   8325           200            200            0.0024776643  -0.0015681563   0              0.0090011492   1.5735449e-08  0              0.001519617    1.1965779e-13  0              2.9943713    
   1800000   8325           200            200            0.0024776466  -0.0015681531   0              0.0090010928   6.90502e-09    0              0.00066683741  1.1965779e-13  0              2.9943713    
   1900000   8325           200            200            0.002477647   -0.0015681531   0              0.0090010941   7.3268418e-10  0              7.0757394e-05  1.1965779e-13  0              2.9943713    
   2000000   8325           200            200            0.0024776492  -0.0015681535   0              0.009001101    9.7517283e-12  0              9.4175212e-07  1.1965779e-13  0              2.9943713    
   2100000   8325           200            200            0.002477648   -0.0015681533   0              0.0090010972   3.9865376e-12  0              3.8499126e-07  1.1965779e-13  0              2.9943713    
   2200000   8325           200            200            0.0024776483  -0.0015681534   0              0.0090010983   2.1834081e-12  0              2.1085793e-07  1.1965779e-13  0              2.9943713    
   2300000   8325           200            200            0.0024776483  -0.0015681534   0              0.0090010982   2.6280836e-13  0              2.538015e-08   1.1965779e-13  0              2.9943713    
   2400000   8325           200            200            0.0024776482  -0.0015681534   0              0.0090010981   5.0682618e-15  0              4.8945644e-10  1.1965779e-13  0              2.9943713    
   2500000   8325           200            200            0.0024776483  -0.0015681534   0              0.0090010982   1.0360677e-15  0              1.0005601e-10  1.1965779e-13  0              2.9943713    
   2600000   8325           200            200            0.0024776483  -0.0015681534   0              0.0090010981   6.9198475e-16  0              6.6826935e-11  1.1965779e-13  0              2.9943713    
   2700000   8325           200            200            0.0024776483  -0.0015681534   0              0.0090010982   9.3866046e-17  0              9.0649109e-12  1.1965779e-13  0              2.9943713    
   2800000   8325           200            200            0.0024776483  -0.0015681534   0              0.0090010982   5.9775392e-18  0              5.7726795e-13  1.1965779e-13  0              2.9943713    
   2900000   8325           200            200            0.0024776483  -0.0015681534   0              0.0090010982   5.8784285e-18  0              5.6769655e-13  1.1965779e-13  0              2.9943713    
   3000000   8325           200            200            0.0024776483  -0.0015681534   0              0.0090010982   6.2154779e-18  0              6.0024637e-13  1.1965779e-13  0              2.9943713    
Loop time of 298.464 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8684464.071 ns/day, 0.000 hours/ns, 10051.463 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.119     | 36.833     | 63.07      | 421.2 | 12.34
Neigh   | 5.2012     | 5.3038     | 5.4092     |   4.1 |  1.78
Comm    | 20.122     | 41.18      | 80.936     | 365.4 | 13.80
Output  | 0.26825    | 0.26857    | 0.26891    |   0.1 |  0.09
Modify  | 108.72     | 158.07     | 177.55     | 227.9 | 52.96
Other   |            | 56.81      |            |       | 19.03

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         324.25 ave         649 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1297
Ave neighs/atom = 0.51859256
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 56

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.56                                                               
Lattice spacing in x,y,z = 5.56 5.56 5.56

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4170 ${n1e1} -100 100 -100 100 units box
region box block -4170 4170 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4170 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4170 4170 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4170 -100 -100) to (4170 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4170 -100 -100) to (4170 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4170 -100 -100) to (4170 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_56_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5381 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 106.8 | 106.8 | 106.8 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8340           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8340           200            200            0.0024239414   5.811484e-35   0              0.0072718241   580020.21      0              5.60142e+10    1.1965779e-13  0              3.3305268    
    200000   8340           200            200            0.00082943094  1.9371746e-35  0              0.0024882928   133808.99      0              1.2922315e+10  1.1965779e-13  0              3.0813714    
    300000   8340           200            200            8.5146092e-06  7.7487886e-35  0              2.5543828e-05  31.434395      0              3035708.8      1.1965779e-13  0              3.0447296    
    400000   8340           200            200            3.2502584e-05 -3.8742875e-35  0              9.7507752e-05  446.46827      0              43116710       1.1965779e-13  0              3.0056844    
    500000   8340           200            200            0.0037835216   0.0011149482   0              0.010235617    1451.0742      0              1.4013436e+08  1.1965779e-13  0              2.9942296    
    600000   8340           200            200            0.0033347121   0.00082368563  0              0.0091804506   198.58449      0              19177868       1.1965779e-13  0              2.9945082    
    700000   8340           200            200            0.0038178103   0.0011949605   0              0.01025847     0.13606411     0              13140.097      1.1965779e-13  0              2.9941713    
    800000   8340           200            200            0.0034133465   0.0012549694   0              0.0089850702   3.5697456      0              344740.48      1.1965779e-13  0              2.9945452    
    900000   8340           200            200            0.0033562832   0.0012509157   0              0.0088179339   0.0023008149   0              222.19624      1.1965779e-13  0              2.9945989    
   1000000   8340           200            200            0.0034168872   0.0012549882   0              0.0089956732   0.063370043    0              6119.8252      1.1965779e-13  0              2.9945449    
   1100000   8340           200            200            0.0034209061   0.0012552914   0              0.009007427    0.00052380954  0              50.585776      1.1965779e-13  0              2.994541     
   1200000   8340           200            200            0.0034124424   0.0012547147   0              0.0089826125   0.0010531412   0              101.70484      1.1965779e-13  0              2.9945485    
   1300000   8340           200            200            0.0034124566   0.0012547117   0              0.0089826582   2.7123404e-05  0              2.6193842      1.1965779e-13  0              2.9945485    
   1400000   8340           200            200            0.0034135969   0.0012547896   0              0.0089860012   1.6296272e-05  0              1.5737773      1.1965779e-13  0              2.9945475    
   1500000   8340           200            200            0.0034135205   0.0012547849   0              0.0089857765   9.3410551e-07  0              0.090209224    1.1965779e-13  0              2.9945476    
   1600000   8340           200            200            0.0034133717   0.0012547747   0              0.0089853403   2.3164386e-07  0              0.022370506    1.1965779e-13  0              2.9945477    
   1700000   8340           200            200            0.0034133917   0.001254776    0              0.0089853991   2.6190843e-08  0              0.0025293242   1.1965779e-13  0              2.9945477    
   1800000   8340           200            200            0.0034134105   0.0012547773   0              0.0089854541   2.9523802e-09  0              0.00028511975  1.1965779e-13  0              2.9945477    
   1900000   8340           200            200            0.0034134065   0.001254777    0              0.0089854426   6.4422531e-10  0              6.2214669e-05  1.1965779e-13  0              2.9945477    
   2000000   8340           200            200            0.0034134043   0.0012547769   0              0.0089854359   3.2138071e-11  0              3.1036648e-06  1.1965779e-13  0              2.9945477    
   2100000   8340           200            200            0.0034134049   0.0012547769   0              0.0089854379   1.4396156e-11  0              1.3902777e-06  1.1965779e-13  0              2.9945477    
   2200000   8340           200            200            0.0034134052   0.0012547769   0              0.0089854387   2.6711892e-13  0              2.5796433e-08  1.1965779e-13  0              2.9945477    
   2300000   8340           200            200            0.0034134051   0.0012547769   0              0.0089854384   2.975694e-13   0              2.8737123e-08  1.1965779e-13  0              2.9945477    
   2400000   8340           200            200            0.0034134051   0.0012547769   0              0.0089854383   1.1189692e-15  0              1.0806203e-10  1.1965779e-13  0              2.9945477    
   2500000   8340           200            200            0.0034134051   0.0012547769   0              0.0089854383   5.7460987e-15  0              5.5491708e-10  1.1965779e-13  0              2.9945477    
   2600000   8340           200            200            0.0034134051   0.0012547769   0              0.0089854383   8.7994762e-23  0              8.4979043e-18  1.1965779e-13  0              2.9945477    
   2700000   8340           200            200            0.0034134051   0.0012547769   0              0.0089854383   9.8455583e-17  0              9.5081355e-12  1.1965779e-13  0              2.9945477    
   2800000   8340           200            200            0.0034134051   0.0012547769   0              0.0089854383   2.8581144e-18  0              2.7601623e-13  1.1965779e-13  0              2.9945477    
   2900000   8340           200            200            0.0034134051   0.0012547769   0              0.0089854383   5.0126358e-18  0              4.8408448e-13  1.1965779e-13  0              2.9945477    
   3000000   8340           200            200            0.0034134051   0.0012547769   0              0.0089854383   7.3517232e-19  0              7.099768e-14   1.1965779e-13  0              2.9945477    
Loop time of 300.442 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8627284.232 ns/day, 0.000 hours/ns, 9985.283 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.102     | 36.673     | 63.768     | 420.0 | 12.21
Neigh   | 5.0521     | 5.1395     | 5.2293     |   3.5 |  1.71
Comm    | 20.013     | 41.685     | 81.634     | 366.0 | 13.87
Output  | 0.2724     | 0.27271    | 0.27305    |   0.1 |  0.09
Modify  | 109.39     | 159.43     | 179.34     | 230.0 | 53.07
Other   |            | 57.24      |            |       | 19.05

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         319.75 ave         640 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1279
Ave neighs/atom = 0.51139544
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 57

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.57                                                               
Lattice spacing in x,y,z = 5.57 5.57 5.57

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4177.5 ${n1e1} -100 100 -100 100 units box
region box block -4177.5 4177.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4177.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4177.5 4177.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4177.5 -100 -100) to (4177.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4177.5 -100 -100) to (4177.5 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4177.5 -100 -100) to (4177.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_57_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5391 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 106.9 | 106.9 | 106.9 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8355           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8355           200            200            0.0024197112   1.8511853e-40  0              0.0072591337   580071.53      0              5.6019156e+10  1.1965779e-13  0              3.3304303    
    200000   8355           200            200            0.00083095869  1.3535745e-34  0              0.0024928761   134595.91      0              1.2998309e+10  1.1965779e-13  0              3.0802745    
    300000   8355           200            200            1.4909047e-05  7.7350119e-35  0              4.4727141e-05  95.122808      0              9186279.9      1.1965779e-13  0              3.0443812    
    400000   8355           200            200            4.3897967e-05  7.7350908e-35  0              0.0001316939   801.90722      0              77442460       1.1965779e-13  0              3.0049753    
    500000   8355           200            200            0.011557137    0.023642742    0              0.011028668    1400.6794      0              1.3526759e+08  1.1965779e-13  0              2.9936054    
    600000   8355           200            200            0.011154696    0.024377384    0              0.0090867027   196.1064       0              18938553       1.1965779e-13  0              2.9941409    
    700000   8355           200            200            0.012162641    0.026450777    0              0.010037147    7.4350541      0              718024.31      1.1965779e-13  0              2.9938408    
    800000   8355           200            200            0.011808804    0.026063536    0              0.0093628754   0.83454989     0              80594.855      1.1965779e-13  0              2.9940358    
    900000   8355           200            200            0.011607711    0.025858106    0              0.0089650267   0.47279261     0              45658.926      1.1965779e-13  0              2.9941575    
   1000000   8355           200            200            0.011581569    0.025830595    0              0.0089141108   0.013918622    0              1344.1609      1.1965779e-13  0              2.994174     
   1100000   8355           200            200            0.011599415    0.025848542    0              0.0089497043   0.0026745081   0              258.28485      1.1965779e-13  0              2.9941633    
   1200000   8355           200            200            0.011609165    0.025858468    0              0.0089690253   0.0011491339   0              110.97512      1.1965779e-13  0              2.9941573    
   1300000   8355           200            200            0.011610148    0.025859509    0              0.0089709335   2.2996773e-05  0              2.2208637      1.1965779e-13  0              2.9941567    
   1400000   8355           200            200            0.011609175    0.025858535    0              0.0089689889   8.4512536e-06  0              0.81616158     1.1965779e-13  0              2.9941573    
   1500000   8355           200            200            0.011608704    0.025858056    0              0.0089680564   2.7438166e-06  0              0.26497817     1.1965779e-13  0              2.9941575    
   1600000   8355           200            200            0.011608672    0.025858022    0              0.0089679948   3.354843e-08   0              0.0032398672   1.1965779e-13  0              2.9941576    
   1700000   8355           200            200            0.011608724    0.025858074    0              0.0089680992   2.5542752e-08  0              0.0024667361   1.1965779e-13  0              2.9941575    
   1800000   8355           200            200            0.011608747    0.025858097    0              0.0089681437   6.4340726e-09  0              0.00062135668  1.1965779e-13  0              2.9941575    
   1900000   8355           200            200            0.011608748    0.025858098    0              0.0089681451   3.9700673e-11  0              3.8340069e-06  1.1965779e-13  0              2.9941575    
   2000000   8355           200            200            0.011608745    0.025858095    0              0.0089681396   7.4494547e-11  0              7.1941502e-06  1.1965779e-13  0              2.9941575    
   2100000   8355           200            200            0.011608744    0.025858094    0              0.0089681375   1.4801716e-11  0              1.4294438e-06  1.1965779e-13  0              2.9941575    
   2200000   8355           200            200            0.011608744    0.025858094    0              0.0089681375   2.9809799e-14  0              2.878817e-09   1.1965779e-13  0              2.9941575    
   2300000   8355           200            200            0.011608744    0.025858094    0              0.0089681378   2.1044546e-13  0              2.0323316e-08  1.1965779e-13  0              2.9941575    
   2400000   8355           200            200            0.011608744    0.025858094    0              0.0089681379   3.341298e-14   0              3.2267865e-09  1.1965779e-13  0              2.9941575    
   2500000   8355           200            200            0.011608744    0.025858094    0              0.0089681379   4.3936327e-18  0              4.2430559e-13  1.1965779e-13  0              2.9941575    
   2600000   8355           200            200            0.011608744    0.025858094    0              0.0089681379   5.5072272e-16  0              5.3184859e-11  1.1965779e-13  0              2.9941575    
   2700000   8355           200            200            0.011608744    0.025858094    0              0.0089681379   6.0962567e-17  0              5.8873284e-12  1.1965779e-13  0              2.9941575    
   2800000   8355           200            200            0.011608744    0.025858094    0              0.0089681379   1.655491e-18   0              1.5987547e-13  1.1965779e-13  0              2.9941575    
   2900000   8355           200            200            0.011608744    0.025858094    0              0.0089681379   3.5837921e-18  0              3.4609699e-13  1.1965779e-13  0              2.9941575    
   3000000   8355           200            200            0.011608744    0.025858094    0              0.0089681379   1.4105965e-18  0              1.3622532e-13  1.1965779e-13  0              2.9941575    
Loop time of 295.066 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8784464.884 ns/day, 0.000 hours/ns, 10167.205 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.932     | 36.362     | 62.265     | 419.0 | 12.32
Neigh   | 5.235      | 5.3359     | 5.4409     |   4.0 |  1.81
Comm    | 20.511     | 39.73      | 77.773     | 354.3 | 13.46
Output  | 0.27221    | 0.27252    | 0.27284    |   0.1 |  0.09
Modify  | 109.73     | 157.46     | 176.75     | 221.3 | 53.37
Other   |            | 55.9       |            |       | 18.95

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         321.75 ave         644 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1287
Ave neighs/atom = 0.51459416
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 58

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.58                                                               
Lattice spacing in x,y,z = 5.58 5.58 5.58

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4185 ${n1e1} -100 100 -100 100 units box
region box block -4185 4185 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4185 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4185 4185 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4185 -100 -100) to (4185 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4185 -100 -100) to (4185 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4185 -100 -100) to (4185 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_58_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5400 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 107.1 | 107.1 | 107.1 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8370           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8370           200            200            0.0024150493  -9.6509929e-36  0              0.007245148    579948.02      0              5.6007229e+10  1.1965779e-13  0              3.3305746    
    200000   8370           200            200            0.00082600235  1.9302417e-35  0              0.0024780071   133693.95      0              1.2911204e+10  1.1965779e-13  0              3.0814495    
    300000   8370           200            200            7.4803073e-06  3.8605173e-35  0              2.2440922e-05  24.525214      0              2368469.6      1.1965779e-13  0              3.0446972    
    400000   8370           200            200            3.0239416e-05 -7.7207726e-35  0              9.0718249e-05  390.71591      0              37732546       1.1965779e-13  0              3.0057203    
    500000   8370           200            200            0.0042795565   0.0025463415   0              0.010292328    1446.0515      0              1.3964931e+08  1.1965779e-13  0              2.994166     
    600000   8370           200            200            0.0038219953   0.0025125033   0              0.0089534827   196.58476      0              18984749       1.1965779e-13  0              2.9945306    
    700000   8370           200            200            0.0040365755   0.0029571907   0              0.0091525359   25.704309      0              2482338.2      1.1965779e-13  0              2.9944557    
    800000   8370           200            200            0.0039924175   0.0029526557   0              0.0090245968   3.4718906      0              335290.34      1.1965779e-13  0              2.9944908    
    900000   8370           200            200            0.0039894944   0.0029525241   0              0.0090159591   0.41289452     0              39874.397      1.1965779e-13  0              2.9944917    
   1000000   8370           200            200            0.0039819939   0.0029516781   0              0.0089943035   0.035296022    0              3408.6371      1.1965779e-13  0              2.9944978    
   1100000   8370           200            200            0.0039745448   0.0029505043   0              0.0089731303   0.0017256629   0              166.65217      1.1965779e-13  0              2.9945042    
   1200000   8370           200            200            0.0039703552   0.0029497997   0              0.0089612658   9.3627927e-06  0              0.90419151     1.1965779e-13  0              2.9945079    
   1300000   8370           200            200            0.0039684926   0.0029494839   0              0.0089559938   1.2317411e-05  0              1.1895274      1.1965779e-13  0              2.9945095    
   1400000   8370           200            200            0.0039677835   0.0029493629   0              0.0089539877   7.9146158e-06  0              0.76433694     1.1965779e-13  0              2.9945102    
   1500000   8370           200            200            0.0039675497   0.0029493227   0              0.0089533264   2.1053827e-06  0              0.20332279     1.1965779e-13  0              2.9945104    
   1600000   8370           200            200            0.0039674854   0.0029493116   0              0.0089531446   3.7583584e-07  0              0.036295536    1.1965779e-13  0              2.9945104    
   1700000   8370           200            200            0.0039674729   0.0029493093   0              0.0089531095   5.0009309e-08  0              0.0048295412   1.1965779e-13  0              2.9945104    
   1800000   8370           200            200            0.0039674731   0.0029493093   0              0.00895311     4.9384937e-09  0              0.00047692438  1.1965779e-13  0              2.9945104    
   1900000   8370           200            200            0.0039674749   0.0029493096   0              0.008953115    3.2058238e-10  0              3.0959551e-05  1.1965779e-13  0              2.9945104    
   2000000   8370           200            200            0.0039674761   0.0029493098   0              0.0089531184   7.6628559e-12  0              7.4002378e-07  1.1965779e-13  0              2.9945104    
   2100000   8370           200            200            0.0039674767   0.0029493099   0              0.0089531201   2.7249032e-13  0              2.6315165e-08  1.1965779e-13  0              2.9945104    
   2200000   8370           200            200            0.0039674769   0.00294931     0              0.0089531208   5.3377212e-13  0              5.154789e-08   1.1965779e-13  0              2.9945104    
   2300000   8370           200            200            0.003967477    0.00294931     0              0.008953121    1.8416064e-13  0              1.7784916e-08  1.1965779e-13  0              2.9945104    
   2400000   8370           200            200            0.003967477    0.00294931     0              0.0089531211   3.8065808e-14  0              3.6761233e-09  1.1965779e-13  0              2.9945104    
   2500000   8370           200            200            0.003967477    0.00294931     0              0.0089531211   5.7009913e-15  0              5.5056093e-10  1.1965779e-13  0              2.9945104    
   2600000   8370           200            200            0.003967477    0.00294931     0              0.0089531211   6.4721428e-16  0              6.2503322e-11  1.1965779e-13  0              2.9945104    
   2700000   8370           200            200            0.003967477    0.00294931     0              0.0089531211   3.9397499e-17  0              3.8047285e-12  1.1965779e-13  0              2.9945104    
   2800000   8370           200            200            0.003967477    0.00294931     0              0.0089531211   1.64371e-19    0              1.5873774e-14  1.1965779e-13  0              2.9945104    
   2900000   8370           200            200            0.003967477    0.00294931     0              0.0089531211   2.4756364e-19  0              2.3907924e-14  1.1965779e-13  0              2.9945104    
   3000000   8370           200            200            0.003967477    0.00294931     0              0.0089531211   6.5053273e-18  0              6.2823795e-13  1.1965779e-13  0              2.9945104    
Loop time of 296.721 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8735464.342 ns/day, 0.000 hours/ns, 10110.491 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.288     | 37.126     | 63.771     | 421.1 | 12.51
Neigh   | 5.2294     | 5.3375     | 5.4471     |   4.2 |  1.80
Comm    | 20.406     | 40.246     | 79.609     | 364.1 | 13.56
Output  | 0.27069    | 0.271      | 0.27134    |   0.1 |  0.09
Modify  | 109.11     | 157.58     | 177.06     | 224.4 | 53.11
Other   |            | 56.16      |            |       | 18.93

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         322.25 ave         645 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1289
Ave neighs/atom = 0.51539384
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 59

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.59                                                               
Lattice spacing in x,y,z = 5.59 5.59 5.59

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4192.5 ${n1e1} -100 100 -100 100 units box
region box block -4192.5 4192.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4192.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4192.5 4192.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4192.5 -100 -100) to (4192.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4192.5 -100 -100) to (4192.5 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4192.5 -100 -100) to (4192.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_59_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5410 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 107.2 | 107.2 | 107.3 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8385           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8385           200            200            0.002410669    6.6483027e-41  0              0.0072320069   579927.79      0              5.6005275e+10  1.1965779e-13  0              3.3305801    
    200000   8385           200            200            0.0008249073   1.1184384e-40  0              0.0024747219   133795.24      0              1.2920986e+10  1.1965779e-13  0              3.0812819    
    300000   8385           200            200            8.7637034e-06  3.8535373e-35  0              2.629111e-05   33.630311      0              3247774.7      1.1965779e-13  0              3.0446162    
    400000   8385           200            200            3.2350503e-05  1.1726363e-40  0              9.705151e-05   447.09962      0              43177681       1.1965779e-13  0              3.0055729    
    500000   8385           200            200            0.0026659851   0.0007653746   0              0.0072325808   1398.4292      0              1.3505028e+08  1.1965779e-13  0              2.9950593    
    600000   8385           200            200            0.0022673243   0.00064019446  0              0.0061617785   41.16759       0              3975671.2      1.1965779e-13  0              2.995399     
    700000   8385           200            200            0.0029351096   0.00088334793  0              0.0079219809   7.1079998      0              686439.75      1.1965779e-13  0              2.9947656    
    800000   8385           200            200            0.0032357887   0.0010730236   0              0.0086343426   1.8705876      0              180647.96      1.1965779e-13  0              2.9945301    
    900000   8385           200            200            0.0033286923   0.0011115687   0              0.0088745083   0.40426466     0              39040.988      1.1965779e-13  0              2.9944529    
   1000000   8385           200            200            0.0033478732   0.0011080143   0              0.0089356054   0.064084473    0              6188.8197      1.1965779e-13  0              2.9944331    
   1100000   8385           200            200            0.0033509557   0.0011084205   0              0.0089444464   0.0076961212   0              743.23629      1.1965779e-13  0              2.9944301    
   1200000   8385           200            200            0.0033501894   0.0011083386   0              0.0089422298   0.00067369728  0              65.060861      1.1965779e-13  0              2.9944307    
   1300000   8385           200            200            0.0033492494   0.0011082277   0              0.0089395206   3.5412094e-05  0              3.4198466      1.1965779e-13  0              2.9944316    
   1400000   8385           200            200            0.0033487089   0.0011081628   0              0.0089379639   3.3217285e-07  0              0.032078876    1.1965779e-13  0              2.994432     
   1500000   8385           200            200            0.0033484654   0.0011081333   0              0.0089372628   1.662913e-07   0              0.016059223    1.1965779e-13  0              2.9944323    
   1600000   8385           200            200            0.0033483714   0.0011081218   0              0.0089369925   1.2755873e-07  0              0.012318709    1.1965779e-13  0              2.9944324    
   1700000   8385           200            200            0.0033483399   0.001108118    0              0.0089369017   3.5989857e-08  0              0.0034756428   1.1965779e-13  0              2.9944324    
   1800000   8385           200            200            0.003348331    0.0011081169   0              0.0089368761   6.6928619e-09  0              0.0006463487   1.1965779e-13  0              2.9944324    
   1900000   8385           200            200            0.0033483291   0.0011081166   0              0.0089368707   9.281177e-10   0              8.9630964e-05  1.1965779e-13  0              2.9944324    
   2000000   8385           200            200            0.003348329    0.0011081166   0              0.0089368705   9.6798919e-11  0              9.3481467e-06  1.1965779e-13  0              2.9944324    
   2100000   8385           200            200            0.0033483292   0.0011081166   0              0.0089368711   6.9262152e-12  0              6.6888429e-07  1.1965779e-13  0              2.9944324    
   2200000   8385           200            200            0.0033483294   0.0011081166   0              0.0089368715   2.2673878e-13  0              2.1896808e-08  1.1965779e-13  0              2.9944324    
   2300000   8385           200            200            0.0033483295   0.0011081167   0              0.0089368717   8.5243426e-16  0              8.2321999e-11  1.1965779e-13  0              2.9944324    
   2400000   8385           200            200            0.0033483295   0.0011081167   0              0.0089368718   7.1220955e-15  0              6.8780101e-10  1.1965779e-13  0              2.9944324    
   2500000   8385           200            200            0.0033483295   0.0011081167   0              0.0089368719   3.0041827e-15  0              2.9012247e-10  1.1965779e-13  0              2.9944324    
   2600000   8385           200            200            0.0033483295   0.0011081167   0              0.0089368719   6.4296428e-16  0              6.2092888e-11  1.1965779e-13  0              2.9944324    
   2700000   8385           200            200            0.0033483295   0.0011081167   0              0.0089368719   1.0226548e-16  0              9.8760677e-12  1.1965779e-13  0              2.9944324    
   2800000   8385           200            200            0.0033483295   0.0011081167   0              0.0089368719   7.9100632e-18  0              7.6389729e-13  1.1965779e-13  0              2.9944324    
   2900000   8385           200            200            0.0033483295   0.0011081167   0              0.0089368719   2.0826092e-18  0              2.0112349e-13  1.1965779e-13  0              2.9944324    
   3000000   8385           200            200            0.0033483295   0.0011081167   0              0.0089368719   1.6595789e-18  0              1.6027025e-13  1.1965779e-13  0              2.9944324    
Loop time of 297.289 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8718798.936 ns/day, 0.000 hours/ns, 10091.202 timesteps/s
99.9% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.043     | 36.585     | 63.118     | 420.0 | 12.31
Neigh   | 5.2579     | 5.3601     | 5.4658     |   4.1 |  1.80
Comm    | 20.455     | 39.804     | 78.656     | 360.9 | 13.39
Output  | 0.29227    | 0.29257    | 0.29291    |   0.1 |  0.10
Modify  | 109.32     | 158.15     | 178.36     | 226.4 | 53.20
Other   |            | 57.1       |            |       | 19.21

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         320.25 ave         641 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1281
Ave neighs/atom = 0.51219512
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 60

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.6                                                               
Lattice spacing in x,y,z = 5.6 5.6 5.6

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4200 ${n1e1} -100 100 -100 100 units box
region box block -4200 4200 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4200 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4200 4200 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4200 -100 -100) to (4200 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4200 -100 -100) to (4200 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4200 -100 -100) to (4200 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_60_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5420 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 107.4 | 107.4 | 107.4 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8400           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8400           200            200            0.0024064926   1.9233203e-35  0              0.0072194777   579982.96      0              5.6010603e+10  1.1965779e-13  0              3.3304719    
    200000   8400           200            200            0.00082203414 -3.8465472e-35  0              0.0024661024   133432.68      0              1.2885973e+10  1.1965779e-13  0              3.0817013    
    300000   8400           200            200            1.2089526e-05 -1.3463207e-34  0              3.6268578e-05  63.6237        0              6144321.5      1.1965779e-13  0              3.0445844    
    400000   8400           200            200            4.5961934e-05  3.0218534e-40  0              0.0001378858   885.16943      0              85483328       1.1965779e-13  0              3.0050217    
    500000   8400           200            200            0.0022169682   2.5937792e-15  0              0.0066509047   1181.0743      0              1.140597e+08   1.1965779e-13  0              2.9950964    
    600000   8400           200            200            0.0029900417   3.4426805e-15  0              0.0089701252   169.64199      0              16382809       1.1965779e-13  0              2.9940738    
    700000   8400           200            200            0.0028082684   3.2056233e-15  0              0.0084248051   16.526202      0              1595982.3      1.1965779e-13  0              2.994349     
    800000   8400           200            200            0.003077681    3.5219875e-15  0              0.009233043    0.65952124     0              63691.841      1.1965779e-13  0              2.9939824    
    900000   8400           200            200            0.0029301358   3.3520552e-15  0              0.0087904074   0.0015719855   0              151.81111      1.1965779e-13  0              2.994178     
   1000000   8400           200            200            0.0029865642   3.4162319e-15  0              0.0089596927   0.01800407     0              1738.7042      1.1965779e-13  0              2.9941037    
   1100000   8400           200            200            0.0029708209   3.3986137e-15  0              0.0089124628   0.0062754117   0              606.03435      1.1965779e-13  0              2.994124     
   1200000   8400           200            200            0.0029731229   3.401051e-15   0              0.0089193686   0.0010157551   0              98.094354      1.1965779e-13  0              2.9941212    
   1300000   8400           200            200            0.0029737963   3.4018923e-15  0              0.008921389    8.8534645e-05  0              8.5500423      1.1965779e-13  0              2.9941202    
   1400000   8400           200            200            0.0029730609   3.4010327e-15  0              0.0089191827   2.6651972e-06  0              0.25738567     1.1965779e-13  0              2.9941212    
   1500000   8400           200            200            0.0029734339   3.4014614e-15  0              0.0089203018   5.7842633e-08  0              0.0055860275   1.1965779e-13  0              2.9941207    
   1600000   8400           200            200            0.0029732979   3.401307e-15   0              0.0089198937   1.3849357e-07  0              0.013374718    1.1965779e-13  0              2.9941209    
   1700000   8400           200            200            0.0029733334   3.4013465e-15  0              0.0089200001   4.0924103e-08  0              0.0039521569   1.1965779e-13  0              2.9941209    
   1800000   8400           200            200            0.0029733294   3.4013424e-15  0              0.0089199881   5.9864671e-09  0              0.00057813015  1.1965779e-13  0              2.9941209    
   1900000   8400           200            200            0.0029733271   3.4013397e-15  0              0.0089199813   4.6209377e-10  0              4.4625709e-05  1.1965779e-13  0              2.9941209    
   2000000   8400           200            200            0.0029733291   3.401342e-15   0              0.0089199872   9.7007426e-12  0              9.3682828e-07  1.1965779e-13  0              2.9941209    
   2100000   8400           200            200            0.0029733281   3.4013409e-15  0              0.0089199844   8.7868838e-13  0              8.4857434e-08  1.1965779e-13  0              2.9941209    
   2200000   8400           200            200            0.0029733284   3.4013413e-15  0              0.0089199853   1.0237443e-12  0              9.8865896e-08  1.1965779e-13  0              2.9941209    
   2300000   8400           200            200            0.0029733284   3.4013412e-15  0              0.0089199851   2.618411e-13   0              2.5286739e-08  1.1965779e-13  0              2.9941209    
   2400000   8400           200            200            0.0029733284   3.4013412e-15  0              0.0089199851   3.4728599e-14  0              3.3538395e-09  1.1965779e-13  0              2.9941209    
   2500000   8400           200            200            0.0029733284   3.4013412e-15  0              0.0089199851   2.3073296e-15  0              2.2282538e-10  1.1965779e-13  0              2.9941209    
   2600000   8400           200            200            0.0029733284   3.4013412e-15  0              0.0089199851   3.8065623e-17  0              3.6761054e-12  1.1965779e-13  0              2.9941209    
   2700000   8400           200            200            0.0029733284   3.4013412e-15  0              0.0089199851   1.081861e-19   0              1.0447839e-14  1.1965779e-13  0              2.9941209    
   2800000   8400           200            200            0.0029733284   3.4013412e-15  0              0.0089199851   3.5094955e-18  0              3.3892195e-13  1.1965779e-13  0              2.9941209    
   2900000   8400           200            200            0.0029733284   3.4013412e-15  0              0.0089199851   8.2914923e-19  0              8.0073298e-14  1.1965779e-13  0              2.9941209    
   3000000   8400           200            200            0.0029733284   3.4013412e-15  0              0.0089199851   1.4187628e-18  0              1.3701396e-13  1.1965779e-13  0              2.9941209    
Loop time of 293.095 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8843559.307 ns/day, 0.000 hours/ns, 10235.601 timesteps/s
99.9% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.032     | 34.959     | 59.609     | 402.0 | 11.93
Neigh   | 5.2507     | 5.3534     | 5.4589     |   4.0 |  1.83
Comm    | 20.487     | 38.974     | 75.049     | 339.6 | 13.30
Output  | 0.35224    | 0.35255    | 0.35289    |   0.1 |  0.12
Modify  | 109.48     | 157.07     | 177.22     | 223.0 | 53.59
Other   |            | 56.38      |            |       | 19.24

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         312.25 ave         625 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1249
Ave neighs/atom = 0.49940024
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 61

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.61                                                               
Lattice spacing in x,y,z = 5.61 5.61 5.61

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4207.5 ${n1e1} -100 100 -100 100 units box
region box block -4207.5 4207.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4207.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4207.5 4207.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4207.5 -100 -100) to (4207.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4207.5 -100 -100) to (4207.5 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4207.5 -100 -100) to (4207.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_61_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5430 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 107.6 | 107.6 | 107.6 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8415           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8415           200            200            0.0024018081   1.9198911e-35  0              0.0072054243   579830.47      0              5.5995877e+10  1.1965779e-13  0              3.3306632    
    200000   8415           200            200            0.00082137573  7.0346792e-40  0              0.0024641272   133644.37      0              1.2906416e+10  1.1965779e-13  0              3.081405     
    300000   8415           200            200            8.0544378e-06  1.919923e-35   0              2.4163313e-05  28.677719      0              2769488.9      1.1965779e-13  0              3.044578     
    400000   8415           200            200            3.051336e-05  -3.8397594e-35  0              9.1540079e-05  401.83663      0              38806506       1.1965779e-13  0              3.0055868    
    500000   8415           200            200            0.0017951098  -0.0013885916   0              0.0067739208   1362.2192      0              1.3155338e+08  1.1965779e-13  0              2.9951877    
    600000   8415           200            200            0.0011807086  -0.0025935037   0              0.0061356295   39.756287      0              3839377.6      1.1965779e-13  0              2.995372     
    700000   8415           200            200            0.0017840082  -0.002554479    0              0.0079065035   7.3096549      0              705914.15      1.1965779e-13  0              2.9947285    
    800000   8415           200            200            0.002034248   -0.0025615086   0              0.0086642525   2.4796302      0              239464.93      1.1965779e-13  0              2.9944747    
    900000   8415           200            200            0.0021095548  -0.002584185    0              0.0089128494   0.47556151     0              45926.326      1.1965779e-13  0              2.9943949    
   1000000   8415           200            200            0.0021179696  -0.0025893841   0              0.0089432928   0.038798622    0              3746.8932      1.1965779e-13  0              2.9943847    
   1100000   8415           200            200            0.0021126371  -0.0025885336   0              0.0089264449   0.00052527259  0              50.727067      1.1965779e-13  0              2.9943897    
   1200000   8415           200            200            0.0021082016  -0.0025877912   0              0.008912396    0.00017098071  0              16.512093      1.1965779e-13  0              2.9943941    
   1300000   8415           200            200            0.0021063131  -0.0025874683   0              0.0089064077   0.00011628519  0              11.229992      1.1965779e-13  0              2.9943959    
   1400000   8415           200            200            0.0021057999  -0.0025873789   0              0.0089047786   2.099021e-05   0              2.0270842      1.1965779e-13  0              2.9943965    
   1500000   8415           200            200            0.0021057525  -0.00258737     0              0.0089046276   1.5408064e-06  0              0.14880005     1.1965779e-13  0              2.9943965    
   1600000   8415           200            200            0.0021057939  -0.0025873767   0              0.0089047585   1.2633312e-08  0              0.0012200349   1.1965779e-13  0              2.9943965    
   1700000   8415           200            200            0.0021058246  -0.0025873819   0              0.0089048559   1.026219e-08   0              0.00099104889  1.1965779e-13  0              2.9943964    
   1800000   8415           200            200            0.0021058371  -0.0025873841   0              0.0089048955   5.5904987e-09  0              0.00053989035  1.1965779e-13  0              2.9943964    
   1900000   8415           200            200            0.0021058404  -0.0025873847   0              0.0089049057   9.2000309e-10  0              8.8847313e-05  1.1965779e-13  0              2.9943964    
   2000000   8415           200            200            0.0021058406  -0.0025873847   0              0.0089049064   6.0245367e-11  0              5.8180663e-06  1.1965779e-13  0              2.9943964    
   2100000   8415           200            200            0.0021058402  -0.0025873846   0              0.0089049054   2.2641046e-13  0              2.1865102e-08  1.1965779e-13  0              2.9943964    
   2200000   8415           200            200            0.00210584    -0.0025873846   0              0.0089049047   5.8896165e-13  0              5.68777e-08    1.1965779e-13  0              2.9943964    
   2300000   8415           200            200            0.0021058399  -0.0025873846   0              0.0089049044   2.6613372e-13  0              2.5701289e-08  1.1965779e-13  0              2.9943964    
   2400000   8415           200            200            0.0021058399  -0.0025873846   0              0.0089049044   3.9965285e-14  0              3.8595611e-09  1.1965779e-13  0              2.9943964    
   2500000   8415           200            200            0.0021058399  -0.0025873846   0              0.0089049044   2.3397678e-15  0              2.2595803e-10  1.1965779e-13  0              2.9943964    
   2600000   8415           200            200            0.0021058399  -0.0025873846   0              0.0089049044   2.3633141e-18  0              2.2823196e-13  1.1965779e-13  0              2.9943964    
   2700000   8415           200            200            0.0021058399  -0.0025873846   0              0.0089049044   3.8682052e-17  0              3.7356357e-12  1.1965779e-13  0              2.9943964    
   2800000   8415           200            200            0.0021058399  -0.0025873846   0              0.0089049044   1.3608873e-17  0              1.3142475e-12  1.1965779e-13  0              2.9943964    
   2900000   8415           200            200            0.0021058399  -0.0025873846   0              0.0089049044   7.6354068e-18  0              7.3737294e-13  1.1965779e-13  0              2.9943964    
   3000000   8415           200            200            0.0021058399  -0.0025873846   0              0.0089049044   7.3835963e-20  0              7.1305488e-15  1.1965779e-13  0              2.9943964    
Loop time of 295.497 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8771649.924 ns/day, 0.000 hours/ns, 10152.373 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.963     | 36.508     | 62.585     | 419.4 | 12.35
Neigh   | 5.1796     | 5.2739     | 5.3711     |   3.8 |  1.78
Comm    | 20.494     | 39.542     | 77.772     | 356.4 | 13.38
Output  | 0.28179    | 0.28209    | 0.28242    |   0.1 |  0.10
Modify  | 110.01     | 157.94     | 177.49     | 221.9 | 53.45
Other   |            | 55.95      |            |       | 18.93

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         320.25 ave         641 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1281
Ave neighs/atom = 0.51219512
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 62

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.62                                                               
Lattice spacing in x,y,z = 5.62 5.62 5.62

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4215 ${n1e1} -100 100 -100 100 units box
region box block -4215 4215 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4215 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4215 4215 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4215 -100 -100) to (4215 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4215 -100 -100) to (4215 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4215 -100 -100) to (4215 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_62_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5439 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 107.8 | 107.8 | 107.8 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8430           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8430           200            200            0.0023973986  -4.7911589e-36  0              0.0071921959   579781.53      0              5.599115e+10   1.1965779e-13  0              3.3306999    
    200000   8430           200            200            0.00081953182  2.3955964e-36  0              0.0024585955   133546.24      0              1.289694e+10   1.1965779e-13  0              3.0814919    
    300000   8430           200            200            7.3668149e-06 -9.5823118e-36  0              2.2100445e-05  24.136613      0              2330941.3      1.1965779e-13  0              3.0445665    
    400000   8430           200            200            2.8480231e-05  1.497245e-37   0              8.5440694e-05  352.56643      0              34048342       1.1965779e-13  0              3.0056322    
    500000   8430           200            200            0.0013496695  -0.0025558748   0              0.0066048832   1350.6483      0              1.3043594e+08  1.1965779e-13  0              2.9952453    
    600000   8430           200            200            0.00079270615 -0.0038801427   0              0.0062582612   56.7097        0              5476616.9      1.1965779e-13  0              2.9953225    
    700000   8430           200            200            0.00096799387 -0.0051724648   0              0.0080764465   13.828474      0              1335455        1.1965779e-13  0              2.9946742    
    800000   8430           200            200            0.0011249354  -0.0054146561   0              0.0087894622   3.3496465      0              323484.89      1.1965779e-13  0              2.9944393    
    900000   8430           200            200            0.0011673224  -0.0054558673   0              0.0089578345   0.39665098     0              38305.713      1.1965779e-13  0              2.9943848    
   1000000   8430           200            200            0.0011625599  -0.005455236    0              0.0089429157   0.013615731    0              1314.9099      1.1965779e-13  0              2.9943887    
   1100000   8430           200            200            0.0011534818  -0.005450343    0              0.0089107884   0.00031691514  0              30.605396      1.1965779e-13  0              2.9943986    
   1200000   8430           200            200            0.0011488548  -0.0054477495   0              0.008894314    0.00067450943  0              65.139292      1.1965779e-13  0              2.9944037    
   1300000   8430           200            200            0.0011474154  -0.0054469219   0              0.008889168    0.00015731529  0              15.192385      1.1965779e-13  0              2.9944053    
   1400000   8430           200            200            0.0011472101  -0.0054467977   0              0.008888428    1.3794502e-05  0              1.3321743      1.1965779e-13  0              2.9944056    
   1500000   8430           200            200            0.0011472861  -0.0054468381   0              0.0088886963   1.982645e-07   0              0.019146966    1.1965779e-13  0              2.9944055    
   1600000   8430           200            200            0.0011473575  -0.0054468781   0              0.0088889505   5.9922751e-08  0              0.0057869104   1.1965779e-13  0              2.9944054    
   1700000   8430           200            200            0.0011473883  -0.0054468956   0              0.0088890605   4.0367978e-08  0              0.0038984504   1.1965779e-13  0              2.9944054    
   1800000   8430           200            200            0.0011473964  -0.0054469003   0              0.0088890896   6.8209664e-09  0              0.00065872012  1.1965779e-13  0              2.9944054    
   1900000   8430           200            200            0.0011473969  -0.0054469007   0              0.0088890915   4.1702368e-10  0              4.0273162e-05  1.1965779e-13  0              2.9944054    
   2000000   8430           200            200            0.0011473961  -0.0054469002   0              0.0088890886   3.7163215e-13  0              3.5889573e-08  1.1965779e-13  0              2.9944054    
   2100000   8430           200            200            0.0011473956  -0.0054468999   0              0.0088890867   5.7754045e-12  0              5.5774723e-07  1.1965779e-13  0              2.9944054    
   2200000   8430           200            200            0.0011473954  -0.0054468998   0              0.008889086    2.1469168e-12  0              2.0733386e-07  1.1965779e-13  0              2.9944054    
   2300000   8430           200            200            0.0011473954  -0.0054468998   0              0.0088890859   2.69255e-13    0              2.6002721e-08  1.1965779e-13  0              2.9944054    
   2400000   8430           200            200            0.0011473954  -0.0054468998   0              0.0088890859   1.0204462e-14  0              9.8547394e-10  1.1965779e-13  0              2.9944054    
   2500000   8430           200            200            0.0011473954  -0.0054468998   0              0.0088890859   1.4011659e-16  0              1.3531458e-11  1.1965779e-13  0              2.9944054    
   2600000   8430           200            200            0.0011473954  -0.0054468998   0              0.0088890859   3.7631861e-16  0              3.6342157e-11  1.1965779e-13  0              2.9944054    
   2700000   8430           200            200            0.0011473954  -0.0054468998   0              0.0088890859   1.0215673e-16  0              9.8655662e-12  1.1965779e-13  0              2.9944054    
   2800000   8430           200            200            0.0011473954  -0.0054468998   0              0.0088890859   4.1558719e-18  0              4.0134436e-13  1.1965779e-13  0              2.9944054    
   2900000   8430           200            200            0.0011473954  -0.0054468998   0              0.0088890859   1.0905221e-18  0              1.0531482e-13  1.1965779e-13  0              2.9944054    
   3000000   8430           200            200            0.0011473954  -0.0054468998   0              0.0088890859   2.6854087e-18  0              2.5933755e-13  1.1965779e-13  0              2.9944054    
Loop time of 299.351 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8658727.718 ns/day, 0.000 hours/ns, 10021.676 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.198     | 36.889     | 63.947     | 420.9 | 12.32
Neigh   | 5.2644     | 5.3589     | 5.4584     |   3.8 |  1.79
Comm    | 20.562     | 41.815     | 81.706     | 364.1 | 13.97
Output  | 0.27197    | 0.27227    | 0.27261    |   0.1 |  0.09
Modify  | 108.67     | 158.22     | 178.18     | 228.5 | 52.85
Other   |            | 56.79      |            |       | 18.97

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         320.25 ave         641 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1281
Ave neighs/atom = 0.51219512
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 63

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.63                                                               
Lattice spacing in x,y,z = 5.63 5.63 5.63

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4222.5 ${n1e1} -100 100 -100 100 units box
region box block -4222.5 4222.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4222.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4222.5 4222.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4222.5 -100 -100) to (4222.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4222.5 -100 -100) to (4222.5 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4222.5 -100 -100) to (4222.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_63_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5449 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 108 | 108 | 108 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8445           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8445           200            200            0.0023929894   1.2909397e-40  0              0.0071789681   579726.58      0              5.5985843e+10  1.1965779e-13  0              3.3307443    
    200000   8445           200            200            0.00081768249 -3.4435225e-34  0              0.0024530475   133445.14      0              1.2887177e+10  1.1965779e-13  0              3.0815798    
    300000   8445           200            200            6.6468239e-06  2.7372313e-40  0              1.9940472e-05  19.777515      0              1909970.8      1.1965779e-13  0              3.0445519    
    400000   8445           200            200            2.661574e-05  -1.530453e-34   0              7.9847219e-05  310.03473      0              29940935       1.1965779e-13  0              3.0056673    
    500000   8445           200            200            0.0028511962   0.002439155    0              0.0061144335   1297.5218      0              1.2530537e+08  1.1965779e-13  0              2.9954248    
    600000   8445           200            200            0.003395456    0.004039511    0              0.0061468569   45.276561      0              4372486.2      1.1965779e-13  0              2.9953593    
    700000   8445           200            200            0.0043840414   0.0051618412   0              0.0079902829   11.596187      0              1119876.7      1.1965779e-13  0              2.9946983    
    800000   8445           200            200            0.0047350366   0.0055052856   0              0.0086998243   2.9707288      0              286891.73      1.1965779e-13  0              2.9944642    
    900000   8445           200            200            0.0048236393   0.0055790307   0              0.0088918871   0.47083061     0              45469.45       1.1965779e-13  0              2.994402     
   1000000   8445           200            200            0.0048314016   0.0055851357   0              0.0089090693   0.042026129    0              4058.5827      1.1965779e-13  0              2.9943959    
   1100000   8445           200            200            0.0048253739   0.0055825737   0              0.0088935481   0.0014350313   0              138.58505      1.1965779e-13  0              2.9944006    
   1200000   8445           200            200            0.00482061     0.0055804738   0              0.0088813561   1.2545498e-05  0              1.2115544      1.1965779e-13  0              2.9944043    
   1300000   8445           200            200            0.0048183925   0.0055794815   0              0.008875696    5.4200118e-05  0              5.2342594      1.1965779e-13  0              2.9944061    
   1400000   8445           200            200            0.0048176243   0.005579134    0              0.0088737389   1.769766e-05   0              1.7091133      1.1965779e-13  0              2.9944067    
   1500000   8445           200            200            0.0048174346   0.005579047    0              0.0088732569   2.8355428e-06  0              0.27383643     1.1965779e-13  0              2.9944069    
   1600000   8445           200            200            0.0048174176   0.0055790385   0              0.0088732142   2.5407926e-07  0              0.024537156    1.1965779e-13  0              2.9944069    
   1700000   8445           200            200            0.0048174323   0.0055790449   0              0.008873252    8.7624363e-09  0              0.00084621337  1.1965779e-13  0              2.9944069    
   1800000   8445           200            200            0.004817444    0.0055790501   0              0.0088732819   7.1037169e-11  0              6.8602613e-06  1.1965779e-13  0              2.9944069    
   1900000   8445           200            200            0.0048174494   0.0055790525   0              0.0088732957   3.2364809e-10  0              3.1255616e-05  1.1965779e-13  0              2.9944069    
   2000000   8445           200            200            0.0048174513   0.0055790533   0              0.0088733005   1.0631946e-10  0              1.0267572e-05  1.1965779e-13  0              2.9944069    
   2100000   8445           200            200            0.0048174518   0.0055790536   0              0.0088733017   1.7092668e-11  0              1.6506875e-06  1.1965779e-13  0              2.9944069    
   2200000   8445           200            200            0.0048174518   0.0055790536   0              0.0088733018   1.537473e-12   0              1.4847814e-07  1.1965779e-13  0              2.9944069    
   2300000   8445           200            200            0.0048174518   0.0055790536   0              0.0088733017   5.3730246e-14  0              5.1888826e-09  1.1965779e-13  0              2.9944069    
   2400000   8445           200            200            0.0048174517   0.0055790536   0              0.0088733017   4.3424251e-16  0              4.1936033e-11  1.1965779e-13  0              2.9944069    
   2500000   8445           200            200            0.0048174517   0.0055790536   0              0.0088733016   2.0637324e-15  0              1.993005e-10   1.1965779e-13  0              2.9944069    
   2600000   8445           200            200            0.0048174517   0.0055790535   0              0.0088733016   6.3416365e-16  0              6.1242986e-11  1.1965779e-13  0              2.9944069    
   2700000   8445           200            200            0.0048174517   0.0055790535   0              0.0088733016   9.8204608e-17  0              9.4838981e-12  1.1965779e-13  0              2.9944069    
   2800000   8445           200            200            0.0048174517   0.0055790535   0              0.0088733016   3.3375101e-18  0              3.2231283e-13  1.1965779e-13  0              2.9944069    
   2900000   8445           200            200            0.0048174517   0.0055790535   0              0.0088733016   3.7790272e-20  0              3.649514e-15   1.1965779e-13  0              2.9944069    
   3000000   8445           200            200            0.0048174517   0.0055790536   0              0.0088733016   7.0226958e-18  0              6.782017e-13   1.1965779e-13  0              2.9944069    
Loop time of 296.102 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8753731.760 ns/day, 0.000 hours/ns, 10131.634 timesteps/s
99.9% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.091     | 36.515     | 62.953     | 418.6 | 12.33
Neigh   | 5.2654     | 5.3673     | 5.4728     |   4.1 |  1.81
Comm    | 20.559     | 40.045     | 78.441     | 356.2 | 13.52
Output  | 0.35252    | 0.35283    | 0.35317    |   0.1 |  0.12
Modify  | 109.28     | 157.55     | 177.21     | 223.7 | 53.21
Other   |            | 56.28      |            |       | 19.01

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         319.25 ave         639 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1277
Ave neighs/atom = 0.51059576
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 64

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.64                                                               
Lattice spacing in x,y,z = 5.64 5.64 5.64

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4230 ${n1e1} -100 100 -100 100 units box
region box block -4230 4230 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4230 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4230 4230 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4230 -100 -100) to (4230 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4230 -100 -100) to (4230 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4230 -100 -100) to (4230 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_64_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5459 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 108.1 | 108.1 | 108.1 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8460           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8460           200            200            0.0023891808   1.7173673e-40  0              0.0071675425   579891.28      0              5.6001749e+10  1.1965779e-13  0              3.3305648    
    200000   8460           200            200            0.00081751456  3.8193817e-35  0              0.0024525437   133777.93      0              1.2919315e+10  1.1965779e-13  0              3.0812273    
    300000   8460           200            200            8.5543162e-06  7.6387968e-35  0              2.5662949e-05  32.633747      0              3151533.7      1.1965779e-13  0              3.0445587    
    400000   8460           200            200            2.7494913e-05 -3.8193415e-35  0              8.2484739e-05  331.47123      0              32011118       1.1965779e-13  0              3.0056368    
    500000   8460           200            200            0.0022683655   0.00098038576  0              0.0058247106   1298.4232      0              1.2539242e+08  1.1965779e-13  0              2.99556      
    600000   8460           200            200            0.0044924746   0.0024247017   0              0.011052722    121.14441      0              11699260       1.1965779e-13  0              2.9938739    
    700000   8460           200            200            0.0038568536   0.0023349252   0              0.0092356355   23.965833      0              2314448.6      1.1965779e-13  0              2.9943825    
    800000   8460           200            200            0.00357276     0.0022869921   0              0.0084312879   0.38088769     0              36783.406      1.1965779e-13  0              2.9946357    
    900000   8460           200            200            0.0037740723   0.0023209974   0              0.0090012196   0.13340493     0              12883.293      1.1965779e-13  0              2.9944603    
   1000000   8460           200            200            0.0037205057   0.002312534    0              0.0088489831   0.063958793    0              6176.6824      1.1965779e-13  0              2.9945058    
   1100000   8460           200            200            0.0037182467   0.0023120853   0              0.0088426548   0.0047156431   0              455.40305      1.1965779e-13  0              2.9945082    
   1200000   8460           200            200            0.0037265277   0.0023134541   0              0.0088661289   4.4260215e-06  0              0.42743347     1.1965779e-13  0              2.994501     
   1300000   8460           200            200            0.0037229755   0.0023128779   0              0.0088560486   0.00010494055  0              10.134407      1.1965779e-13  0              2.994504     
   1400000   8460           200            200            0.0037235142   0.0023129622   0              0.0088575803   2.016724e-05   0              1.9476077      1.1965779e-13  0              2.9945036    
   1500000   8460           200            200            0.0037237422   0.0023130007   0              0.0088582259   5.0594106e-07  0              0.048860167    1.1965779e-13  0              2.9945034    
   1600000   8460           200            200            0.0037235633   0.0023129714   0              0.0088577184   7.5185764e-08  0              0.0072609029   1.1965779e-13  0              2.9945035    
   1700000   8460           200            200            0.0037236159   0.0023129799   0              0.0088578679   5.0056623e-08  0              0.0048341103   1.1965779e-13  0              2.9945035    
   1800000   8460           200            200            0.0037236155   0.0023129799   0              0.0088578667   4.5280653e-09  0              0.00043728814  1.1965779e-13  0              2.9945035    
   1900000   8460           200            200            0.0037236086   0.0023129787   0              0.0088578471   1.4054288e-12  0              1.3572626e-07  1.1965779e-13  0              2.9945035    
   2000000   8460           200            200            0.0037236119   0.0023129792   0              0.0088578564   7.2652236e-11  0              7.016233e-06   1.1965779e-13  0              2.9945035    
   2100000   8460           200            200            0.0037236113   0.0023129792   0              0.0088578547   1.7076544e-11  0              1.6491304e-06  1.1965779e-13  0              2.9945035    
   2200000   8460           200            200            0.0037236111   0.0023129791   0              0.0088578542   6.0249419e-13  0              5.8184577e-08  1.1965779e-13  0              2.9945035    
   2300000   8460           200            200            0.0037236113   0.0023129792   0              0.0088578547   3.8281844e-14  0              3.6969865e-09  1.1965779e-13  0              2.9945035    
   2400000   8460           200            200            0.0037236112   0.0023129791   0              0.0088578545   3.8241684e-14  0              3.6931081e-09  1.1965779e-13  0              2.9945035    
   2500000   8460           200            200            0.0037236112   0.0023129791   0              0.0088578545   4.1783269e-15  0              4.0351291e-10  1.1965779e-13  0              2.9945035    
   2600000   8460           200            200            0.0037236112   0.0023129791   0              0.0088578546   8.1806801e-18  0              7.9003153e-13  1.1965779e-13  0              2.9945035    
   2700000   8460           200            200            0.0037236112   0.0023129791   0              0.0088578545   3.6975621e-17  0              3.5708408e-12  1.1965779e-13  0              2.9945035    
   2800000   8460           200            200            0.0037236112   0.0023129791   0              0.0088578545   1.3246424e-17  0              1.2792448e-12  1.1965779e-13  0              2.9945035    
   2900000   8460           200            200            0.0037236112   0.0023129791   0              0.0088578545   8.8894109e-19  0              8.5847568e-14  1.1965779e-13  0              2.9945035    
   3000000   8460           200            200            0.0037236112   0.0023129791   0              0.0088578545   2.9562472e-18  0              2.854932e-13   1.1965779e-13  0              2.9945035    
Loop time of 296.384 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8745411.289 ns/day, 0.000 hours/ns, 10122.004 timesteps/s
99.9% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.035     | 36.409     | 63.046     | 418.6 | 12.28
Neigh   | 5.2772     | 5.3773     | 5.4808     |   3.9 |  1.81
Comm    | 20.623     | 40.151     | 78.724     | 357.3 | 13.55
Output  | 0.3311     | 0.33141    | 0.33172    |   0.1 |  0.11
Modify  | 109.46     | 157.96     | 177.52     | 224.6 | 53.30
Other   |            | 56.16      |            |       | 18.95

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         319.25 ave         639 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1277
Ave neighs/atom = 0.51059576
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 65

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.65                                                               
Lattice spacing in x,y,z = 5.65 5.65 5.65

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4237.5 ${n1e1} -100 100 -100 100 units box
region box block -4237.5 4237.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4237.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4237.5 4237.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4237.5 -100 -100) to (4237.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4237.5 -100 -100) to (4237.5 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4237.5 -100 -100) to (4237.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_65_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5468 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 108.2 | 108.3 | 108.3 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8475           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8475           200            200            0.0023847157   7.446475e-37   0              0.007154147    579802.29      0              5.5993155e+10  1.1965779e-13  0              3.3306557    
    200000   8475           200            200            0.00081541066 -2.3828712e-36  0              0.002446232    133607.96      0              1.2902901e+10  1.1965779e-13  0              3.0813875    
    300000   8475           200            200            7.1756613e-06 -3.812417e-35   0              2.1526984e-05  23.159894      0              2236616.8      1.1965779e-13  0              3.0445372    
    400000   8475           200            200            2.5923387e-05  4.7657751e-36  0              7.777016e-05   296.53736      0              28637456       1.1965779e-13  0              3.0056697    
    500000   8475           200            200            0.0020588575   0.0010359906   0              0.005140582    1155.863       0              1.1162497e+08  1.1965779e-13  0              2.9957898    
    600000   8475           200            200            0.002419631    0.0015229823   0              0.0057359107   0.41531692     0              40108.335      1.1965779e-13  0              2.9954915    
    700000   8475           200            200            0.0029775813   0.0012695941   0              0.0076631498   0.12894893     0              12452.964      1.1965779e-13  0              2.9947992    
    800000   8475           200            200            0.0032082288   0.0012214683   0              0.0084032181   0.0012779864   0              123.41878      1.1965779e-13  0              2.9945546    
    900000   8475           200            200            0.0032999434   0.0012194042   0              0.0086804261   0.001421327    0              137.26159      1.1965779e-13  0              2.9944652    
   1000000   8475           200            200            0.0033339095   0.0012187499   0              0.0087829786   0.0011045485   0              106.66939      1.1965779e-13  0              2.9944324    
   1100000   8475           200            200            0.0033463603   0.0012185238   0              0.008820557    0.00037229443  0              35.953531      1.1965779e-13  0              2.9944204    
   1200000   8475           200            200            0.0033508894   0.0012184433   0              0.0088342249   9.3106346e-05  0              8.9915445      1.1965779e-13  0              2.994416     
   1300000   8475           200            200            0.0033525258   0.0012184144   0              0.0088391631   1.9925565e-05  0              1.9242685      1.1965779e-13  0              2.9944144    
   1400000   8475           200            200            0.0033531132   0.001218404    0              0.0088409355   3.8708989e-06  0              0.37382371     1.1965779e-13  0              2.9944138    
   1500000   8475           200            200            0.0033533226   0.0012184004   0              0.0088415674   7.0348164e-07  0              0.067937222    1.1965779e-13  0              2.9944136    
   1600000   8475           200            200            0.0033533967   0.001218399    0              0.0088417911   1.2170147e-07  0              0.011753057    1.1965779e-13  0              2.9944136    
   1700000   8475           200            200            0.0033534227   0.0012183986   0              0.0088418697   2.0262786e-08  0              0.0019568348   1.1965779e-13  0              2.9944135    
   1800000   8475           200            200            0.0033534318   0.0012183984   0              0.008841897    3.270751e-09   0              0.00031586572  1.1965779e-13  0              2.9944135    
   1900000   8475           200            200            0.0033534349   0.0012183984   0              0.0088419065   5.144758e-10   0              4.968439e-05   1.1965779e-13  0              2.9944135    
   2000000   8475           200            200            0.003353436    0.0012183983   0              0.0088419097   7.9149898e-11  0              7.6437306e-06  1.1965779e-13  0              2.9944135    
   2100000   8475           200            200            0.0033534364   0.0012183983   0              0.0088419108   1.1942294e-11  0              1.1533013e-06  1.1965779e-13  0              2.9944135    
   2200000   8475           200            200            0.0033534365   0.0012183983   0              0.0088419112   1.771457e-12   0              1.7107464e-07  1.1965779e-13  0              2.9944135    
   2300000   8475           200            200            0.0033534365   0.0012183983   0              0.0088419113   2.5862868e-13  0              2.4976507e-08  1.1965779e-13  0              2.9944135    
   2400000   8475           200            200            0.0033534365   0.0012183983   0              0.0088419113   3.7276407e-14  0              3.5998886e-09  1.1965779e-13  0              2.9944135    
   2500000   8475           200            200            0.0033534366   0.0012183983   0              0.0088419113   5.3084021e-15  0              5.1264748e-10  1.1965779e-13  0              2.9944135    
   2600000   8475           200            200            0.0033534366   0.0012183983   0              0.0088419113   7.3145894e-16  0              7.0639068e-11  1.1965779e-13  0              2.9944135    
   2700000   8475           200            200            0.0033534366   0.0012183983   0              0.0088419113   1.0204304e-16  0              9.8545863e-12  1.1965779e-13  0              2.9944135    
   2800000   8475           200            200            0.0033534366   0.0012183983   0              0.0088419113   1.3330892e-17  0              1.2874021e-12  1.1965779e-13  0              2.9944135    
   2900000   8475           200            200            0.0033534366   0.0012183983   0              0.0088419113   2.9633871e-19  0              2.8618272e-14  1.1965779e-13  0              2.9944135    
   3000000   8475           200            200            0.0033534366   0.0012183983   0              0.0088419113   5.5261251e-18  0              5.3367361e-13  1.1965779e-13  0              2.9944135    
Loop time of 295.708 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8765413.110 ns/day, 0.000 hours/ns, 10145.154 timesteps/s
99.9% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.011     | 36.284     | 62.31      | 417.4 | 12.27
Neigh   | 5.2883     | 5.3947     | 5.504      |   4.2 |  1.82
Comm    | 20.654     | 39.827     | 77.87      | 353.7 | 13.47
Output  | 0.34271    | 0.34303    | 0.34336    |   0.1 |  0.12
Modify  | 109.68     | 157.7      | 177.37     | 222.8 | 53.33
Other   |            | 56.16      |            |       | 18.99

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         318.75 ave         638 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1275
Ave neighs/atom = 0.50979608
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 66

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.66                                                               
Lattice spacing in x,y,z = 5.66 5.66 5.66

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4245 ${n1e1} -100 100 -100 100 units box
region box block -4245 4245 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4245 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4245 4245 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4245 -100 -100) to (4245 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4245 -100 -100) to (4245 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4245 -100 -100) to (4245 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_66_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5478 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 108.4 | 108.4 | 108.5 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8490           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8490           200            200            0.0023810277  -1.4271941e-35  0              0.0071430831   579986.65      0              5.601096e+10   1.1965779e-13  0              3.3305642    
    200000   8490           200            200            0.00081503088  1.7999666e-41  0              0.0024450926   133877.32      0              1.2928913e+10  1.1965779e-13  0              3.0812548    
    300000   8490           200            200            8.4745912e-06 -3.8057984e-35  0              2.5423774e-05  32.258621      0              3115306.7      1.1965779e-13  0              3.0446848    
    400000   8490           200            200            2.9942562e-05 -1.9029087e-35  0              8.9827686e-05  394.05737      0              38055241       1.1965779e-13  0              3.0057009    
    500000   8490           200            200            0.0020793388  -0.0024051544   0              0.0086431708   1468.5476      0              1.4182181e+08  1.1965779e-13  0              2.9946381    
    600000   8490           200            200            0.0017104101  -0.0028232253   0              0.0079544555   182.59562      0              17633778       1.1965779e-13  0              2.9948255    
    700000   8490           200            200            0.002127692   -0.0030595631   0              0.0094426391   20.040663      0              1935383.8      1.1965779e-13  0              2.9943389    
    800000   8490           200            200            0.002074976   -0.0030436387   0              0.0092685666   0.15338615     0              14812.936      1.1965779e-13  0              2.9943863    
    900000   8490           200            200            0.0019787355  -0.003016571    0              0.0089527776   0.19327946     0              18665.547      1.1965779e-13  0              2.9944825    
   1000000   8490           200            200            0.0019386872  -0.0030065975   0              0.0088226591   0.064422245    0              6221.4394      1.1965779e-13  0              2.9945234    
   1100000   8490           200            200            0.0019343109  -0.0030049467   0              0.0088078793   0.0025277801   0              244.11491      1.1965779e-13  0              2.9945284    
   1200000   8490           200            200            0.001937869   -0.0030054875   0              0.0088190945   0.00016051183  0              15.501083      1.1965779e-13  0              2.9945249    
   1300000   8490           200            200            0.0019400316  -0.0030058213   0              0.0088259163   0.00014923299  0              14.411854      1.1965779e-13  0              2.9945228    
   1400000   8490           200            200            0.0019404785  -0.0030058919   0              0.0088273274   1.2433218e-05  0              1.2007112      1.1965779e-13  0              2.9945223    
   1500000   8490           200            200            0.0019403781  -0.0030058774   0              0.0088270117   1.871295e-08   0              0.0018071628   1.1965779e-13  0              2.9945224    
   1600000   8490           200            200            0.0019402748  -0.0030058616   0              0.008826686    2.8541471e-07  0              0.02756331     1.1965779e-13  0              2.9945225    
   1700000   8490           200            200            0.0019402441  -0.0030058568   0              0.0088265891   4.4307108e-08  0              0.0042788634   1.1965779e-13  0              2.9945226    
   1800000   8490           200            200            0.0019402448  -0.0030058569   0              0.0088265914   3.2913863e-10  0              3.1785853e-05  1.1965779e-13  0              2.9945226    
   1900000   8490           200            200            0.0019402493  -0.0030058576   0              0.0088266055   4.2510666e-10  0              4.1053759e-05  1.1965779e-13  0              2.9945226    
   2000000   8490           200            200            0.0019402511  -0.0030058579   0              0.0088266113   1.2731083e-10  0              1.2294769e-05  1.1965779e-13  0              2.9945226    
   2100000   8490           200            200            0.0019402513  -0.0030058579   0              0.0088266118   4.2198849e-12  0              4.0752628e-07  1.1965779e-13  0              2.9945226    
   2200000   8490           200            200            0.0019402511  -0.0030058579   0              0.0088266113   4.112426e-13   0              3.9714867e-08  1.1965779e-13  0              2.9945226    
   2300000   8490           200            200            0.001940251   -0.0030058578   0              0.008826611    3.0470618e-13  0              2.9426342e-08  1.1965779e-13  0              2.9945226    
   2400000   8490           200            200            0.001940251   -0.0030058578   0              0.0088266109   2.2651315e-14  0              2.1875019e-09  1.1965779e-13  0              2.9945226    
   2500000   8490           200            200            0.001940251   -0.0030058578   0              0.0088266109   1.0223702e-16  0              9.8733201e-12  1.1965779e-13  0              2.9945226    
   2600000   8490           200            200            0.001940251   -0.0030058578   0              0.0088266109   5.7850395e-16  0              5.586777e-11   1.1965779e-13  0              2.9945226    
   2700000   8490           200            200            0.001940251   -0.0030058578   0              0.008826611    7.2726258e-17  0              7.0233815e-12  1.1965779e-13  0              2.9945226    
   2800000   8490           200            200            0.001940251   -0.0030058578   0              0.0088266109   1.7148612e-19  0              1.6560902e-14  1.1965779e-13  0              2.9945226    
   2900000   8490           200            200            0.001940251   -0.0030058578   0              0.0088266109   1.3039639e-18  0              1.259275e-13   1.1965779e-13  0              2.9945226    
   3000000   8490           200            200            0.001940251   -0.0030058578   0              0.0088266109   3.3389582e-18  0              3.2245268e-13  1.1965779e-13  0              2.9945226    
Loop time of 294.671 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8796236.371 ns/day, 0.000 hours/ns, 10180.829 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.882     | 36.423     | 62.522     | 418.9 | 12.36
Neigh   | 5.2761     | 5.3732     | 5.473      |   3.8 |  1.82
Comm    | 20.676     | 39.727     | 77.782     | 354.0 | 13.48
Output  | 0.27229    | 0.27259    | 0.27293    |   0.1 |  0.09
Modify  | 109.29     | 156.99     | 176.42     | 221.6 | 53.28
Other   |            | 55.88      |            |       | 18.96

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         320.25 ave         641 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1281
Ave neighs/atom = 0.51219512
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 67

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.67                                                               
Lattice spacing in x,y,z = 5.67 5.67 5.67

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4252.5 ${n1e1} -100 100 -100 100 units box
region box block -4252.5 4252.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4252.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4252.5 4252.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4252.5 -100 -100) to (4252.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4252.5 -100 -100) to (4252.5 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4252.5 -100 -100) to (4252.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_67_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5488 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 108.6 | 108.6 | 108.6 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8505           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8505           200            200            0.0023765992  -3.7991234e-35  0              0.0071297975   579899.04      0              5.6002498e+10  1.1965779e-13  0              3.3306614    
    200000   8505           200            200            0.00081336056  4.748934e-36   0              0.0024400817   133817         0              1.2923088e+10  1.1965779e-13  0              3.0813082    
    300000   8505           200            200            1.0525055e-05  1.7096187e-34  0              3.1575165e-05  49.620913      0              4792032.6      1.1965779e-13  0              3.0446232    
    400000   8505           200            200            3.975642e-05   1.2384864e-40  0              0.00011926926  685.33416      0              66184667       1.1965779e-13  0              3.0053145    
    500000   8505           200            200            0.0044613724   0.0013557382   0              0.012028379    1316.4922      0              1.271374e+08   1.1965779e-13  0              2.9934938    
    600000   8505           200            200            0.0040866196   0.0019129809   0              0.010346878    160.1805       0              15469086       1.1965779e-13  0              2.9939262    
    700000   8505           200            200            0.0039577089   0.0018337509   0              0.010039376    1.0933615      0              105589.03      1.1965779e-13  0              2.9939967    
    800000   8505           200            200            0.0034900443   0.0018076715   0              0.0086624614   3.1957999      0              308627.48      1.1965779e-13  0              2.9944076    
    900000   8505           200            200            0.0034939877   0.0018072412   0              0.008674722    0.1480364      0              14296.296      1.1965779e-13  0              2.9944068    
   1000000   8505           200            200            0.0035561231   0.0018104595   0              0.0088579099   0.025767052    0              2488.3974      1.1965779e-13  0              2.9943496    
   1100000   8505           200            200            0.003542932    0.0018100677   0              0.0088187283   0.0074750568   0              721.88749      1.1965779e-13  0              2.9943614    
   1200000   8505           200            200            0.003537442    0.0018098923   0              0.0088024339   8.6515375e-06  0              0.83550357     1.1965779e-13  0              2.9943665    
   1300000   8505           200            200            0.0035404075   0.0018099846   0              0.0088112379   0.00015118178  0              14.600055      1.1965779e-13  0              2.9943638    
   1400000   8505           200            200            0.0035405071   0.0018099884   0              0.008811533    5.1182614e-06  0              0.49428505     1.1965779e-13  0              2.9943637    
   1500000   8505           200            200            0.0035400855   0.0018099752   0              0.0088102814   1.3668662e-06  0              0.13200215     1.1965779e-13  0              2.9943641    
   1600000   8505           200            200            0.0035401633   0.0018099775   0              0.0088105123   3.1135854e-07  0              0.030068779    1.1965779e-13  0              2.994364     
   1700000   8505           200            200            0.0035402033   0.0018099788   0              0.0088106312   1.3701459e-09  0              0.00013231888  1.1965779e-13  0              2.994364     
   1800000   8505           200            200            0.0035401842   0.0018099782   0              0.0088105744   6.9336261e-09  0              0.00066959998  1.1965779e-13  0              2.994364     
   1900000   8505           200            200            0.0035401829   0.0018099782   0              0.0088105706   1.6939972e-10  0              1.6359412e-05  1.1965779e-13  0              2.994364     
   2000000   8505           200            200            0.0035401858   0.0018099782   0              0.0088105791   7.0832551e-11  0              6.8405008e-06  1.1965779e-13  0              2.994364     
   2100000   8505           200            200            0.0035401853   0.0018099782   0              0.0088105778   1.2786349e-11  0              1.234814e-06   1.1965779e-13  0              2.994364     
   2200000   8505           200            200            0.003540185    0.0018099782   0              0.0088105769   1.309937e-13   0              1.2650434e-08  1.1965779e-13  0              2.994364     
   2300000   8505           200            200            0.0035401852   0.0018099782   0              0.0088105773   3.1426045e-13  0              3.0349025e-08  1.1965779e-13  0              2.994364     
   2400000   8505           200            200            0.0035401852   0.0018099782   0              0.0088105773   5.3392048e-15  0              5.1562218e-10  1.1965779e-13  0              2.994364     
   2500000   8505           200            200            0.0035401852   0.0018099782   0              0.0088105773   3.5482305e-15  0              3.426627e-10   1.1965779e-13  0              2.994364     
   2600000   8505           200            200            0.0035401852   0.0018099782   0              0.0088105773   4.9160057e-16  0              4.7475264e-11  1.1965779e-13  0              2.994364     
   2700000   8505           200            200            0.0035401852   0.0018099782   0              0.0088105773   4.3823941e-18  0              4.2322026e-13  1.1965779e-13  0              2.994364     
   2800000   8505           200            200            0.0035401852   0.0018099782   0              0.0088105773   1.2526774e-17  0              1.2097462e-12  1.1965779e-13  0              2.994364     
   2900000   8505           200            200            0.0035401852   0.0018099782   0              0.0088105773   1.2780573e-19  0              1.2342562e-14  1.1965779e-13  0              2.994364     
   3000000   8505           200            200            0.0035401852   0.0018099782   0              0.0088105773   5.518896e-18   0              5.3297547e-13  1.1965779e-13  0              2.994364     
Loop time of 301.705 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8591165.105 ns/day, 0.000 hours/ns, 9943.478 timesteps/s
99.9% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.114     | 37.525     | 65.332     | 423.1 | 12.44
Neigh   | 5.2795     | 5.3729     | 5.4698     |   3.6 |  1.78
Comm    | 20.331     | 42.888     | 84.045     | 372.3 | 14.22
Output  | 0.2748     | 0.2751     | 0.27544    |   0.1 |  0.09
Modify  | 109.07     | 158.87     | 177.61     | 228.7 | 52.66
Other   |            | 56.77      |            |       | 18.82

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         319.75 ave         640 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1279
Ave neighs/atom = 0.51139544
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 68

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.68                                                               
Lattice spacing in x,y,z = 5.68 5.68 5.68

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4260 ${n1e1} -100 100 -100 100 units box
region box block -4260 4260 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4260 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4260 4260 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4260 -100 -100) to (4260 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4260 -100 -100) to (4260 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4260 -100 -100) to (4260 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_68_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5497 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 108.8 | 108.8 | 108.8 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8520           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8520           200            200            0.0023724531   1.6080699e-41  0              0.0071173592   579919.9       0              5.6004513e+10  1.1965779e-13  0              3.3305941    
    200000   8520           200            200            0.00081171147  3.7924938e-35  0              0.0024351344   133761.8       0              1.2917757e+10  1.1965779e-13  0              3.0813326    
    300000   8520           200            200            8.7915009e-06 -4.7405449e-36  0              2.6374503e-05  34.923172      0              3372630        1.1965779e-13  0              3.0446257    
    400000   8520           200            200            3.3144803e-05  7.5849969e-35  0              9.9434409e-05  483.44043      0              46687216       1.1965779e-13  0              3.0055425    
    500000   8520           200            200            0.0032581559   0.00033565268  0              0.009438815    1465.0425      0              1.4148332e+08  1.1965779e-13  0              2.9942876    
    600000   8520           200            200            0.0028077373  -0.00021733831  0              0.0086405502   197.79324      0              19101455       1.1965779e-13  0              2.9944994    
    700000   8520           200            200            0.0033207623  -4.1721268e-05  0              0.010004008    1.5908924      0              153637         1.1965779e-13  0              2.9940664    
    800000   8520           200            200            0.0029585288  -2.8531177e-05  0              0.0089041176   3.3276384      0              321359.5       1.1965779e-13  0              2.9943948    
    900000   8520           200            200            0.0028699405  -2.617847e-05   0              0.0086359999   0.029197778    0              2819.7124      1.1965779e-13  0              2.9944806    
   1000000   8520           200            200            0.002918094   -2.7395143e-05  0              0.0087816771   0.061098428    0              5900.4489      1.1965779e-13  0              2.9944357    
   1100000   8520           200            200            0.0029297486  -2.7706029e-05  0              0.0088169519   0.00041587547  0              40.162276      1.1965779e-13  0              2.9944244    
   1200000   8520           200            200            0.0029231026  -2.7535835e-05  0              0.0087968436   0.0011274707   0              108.88305      1.1965779e-13  0              2.9944306    
   1300000   8520           200            200            0.0029216082  -2.7495908e-05  0              0.0087923204   5.6230523e-06  0              0.54303414     1.1965779e-13  0              2.994432     
   1400000   8520           200            200            0.0029225211  -2.7519266e-05  0              0.0087950824   2.0754129e-05  0              2.0042852      1.1965779e-13  0              2.9944312    
   1500000   8520           200            200            0.0029227124  -2.752439e-05   0              0.0087956616   7.2111167e-08  0              0.0069639803   1.1965779e-13  0              2.994431     
   1600000   8520           200            200            0.0029225871  -2.7521181e-05  0              0.0087952825   3.8132013e-07  0              0.036825169    1.1965779e-13  0              2.9944311    
   1700000   8520           200            200            0.0029225627  -2.7520526e-05  0              0.0087952086   8.5635035e-10  0              8.2700187e-05  1.1965779e-13  0              2.9944311    
   1800000   8520           200            200            0.0029225799  -2.7520966e-05  0              0.0087952606   6.9925155e-09  0              0.00067528709  1.1965779e-13  0              2.9944311    
   1900000   8520           200            200            0.002922583   -2.752105e-05   0              0.00879527     9.0334338e-12  0              8.7238438e-07  1.1965779e-13  0              2.9944311    
   2000000   8520           200            200            0.0029225806  -2.7520989e-05  0              0.0087952629   1.2798819e-10  0              1.2360184e-05  1.1965779e-13  0              2.9944311    
   2100000   8520           200            200            0.0029225802  -2.7520979e-05  0              0.0087952617   7.7155074e-14  0              7.4510848e-09  1.1965779e-13  0              2.9944311    
   2200000   8520           200            200            0.0029225806  -2.7520987e-05  0              0.0087952627   2.3388319e-12  0              2.2586764e-07  1.1965779e-13  0              2.9944311    
   2300000   8520           200            200            0.0029225806  -2.7520988e-05  0              0.0087952628   3.784804e-16   0              3.6550928e-11  1.1965779e-13  0              2.9944311    
   2400000   8520           200            200            0.0029225806  -2.7520987e-05  0              0.0087952627   4.2608872e-14  0              4.1148598e-09  1.1965779e-13  0              2.9944311    
   2500000   8520           200            200            0.0029225806  -2.7520987e-05  0              0.0087952627   5.0145236e-24  0              4.842668e-19   1.1965779e-13  0              2.9944311    
   2600000   8520           200            200            0.0029225806  -2.7520987e-05  0              0.0087952627   7.7351541e-16  0              7.4700582e-11  1.1965779e-13  0              2.9944311    
   2700000   8520           200            200            0.0029225806  -2.7520987e-05  0              0.0087952627   6.9098698e-19  0              6.6730577e-14  1.1965779e-13  0              2.9944311    
   2800000   8520           200            200            0.0029225806  -2.7520987e-05  0              0.0087952627   1.2696779e-17  0              1.226164e-12   1.1965779e-13  0              2.9944311    
   2900000   8520           200            200            0.0029225806  -2.7520987e-05  0              0.0087952627   3.8626668e-19  0              3.7302871e-14  1.1965779e-13  0              2.9944311    
   3000000   8520           200            200            0.0029225806  -2.7520987e-05  0              0.0087952627   4.4422659e-18  0              4.2900224e-13  1.1965779e-13  0              2.9944311    
Loop time of 296.675 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8736836.662 ns/day, 0.000 hours/ns, 10112.079 timesteps/s
99.9% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.96      | 36.602     | 62.619     | 416.9 | 12.34
Neigh   | 5.3716     | 5.476      | 5.5852     |   4.1 |  1.85
Comm    | 21.098     | 39.997     | 77.758     | 350.1 | 13.48
Output  | 0.29006    | 0.29037    | 0.2907     |   0.1 |  0.10
Modify  | 110.59     | 158.3      | 177.5      | 220.7 | 53.36
Other   |            | 56.01      |            |       | 18.88

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         319.25 ave         639 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1277
Ave neighs/atom = 0.51059576
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 69

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.69                                                               
Lattice spacing in x,y,z = 5.69 5.69 5.69

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4267.5 ${n1e1} -100 100 -100 100 units box
region box block -4267.5 4267.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4267.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4267.5 4267.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4267.5 -100 -100) to (4267.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4267.5 -100 -100) to (4267.5 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4267.5 -100 -100) to (4267.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_69_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5507 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 108.9 | 108.9 | 109 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8535           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8535           200            200            0.0023681346   4.7322605e-36  0              0.0071044039   579865.47      0              5.5999257e+10  1.1965779e-13  0              3.3306355    
    200000   8535           200            200            0.00080989098  1.8929207e-35  0              0.0024296729   133659.67      0              1.2907894e+10  1.1965779e-13  0              3.0814178    
    300000   8535           200            200            8.1777173e-06 -1.8928853e-34  0              2.4533152e-05  30.385307      0              2934395.5      1.1965779e-13  0              3.0446073    
    400000   8535           200            200            3.0811406e-05  1.196558e-39   0              9.2434218e-05  420.9386       0              40651237       1.1965779e-13  0              3.0055924    
    500000   8535           200            200            0.0031056933   0.00095721393  0              0.0083598661   1465.5165      0              1.4152909e+08  1.1965779e-13  0              2.9946136    
    600000   8535           200            200            0.0038702315   0.0033209412   0              0.0082897534   193.05113      0              18643497       1.1965779e-13  0              2.9945989    
    700000   8535           200            200            0.0040481092   0.0023549449   0              0.0097893826   9.0912779      0              877970.55      1.1965779e-13  0              2.9941189    
    800000   8535           200            200            0.0037738795   0.0021929317   0              0.0091287067   1.3751535      0              132802.48      1.1965779e-13  0              2.9943129    
    900000   8535           200            200            0.0036115669   0.0021298495   0              0.0087048512   0.38171145     0              36862.959      1.1965779e-13  0              2.9944453    
   1000000   8535           200            200            0.0036174792   0.0021303017   0              0.0087221359   0.0047047049   0              454.34672      1.1965779e-13  0              2.9944408    
   1100000   8535           200            200            0.0036382622   0.0021329296   0              0.008781857    0.0086397824   0              834.36835      1.1965779e-13  0              2.9944221    
   1200000   8535           200            200            0.0036403496   0.0021331964   0              0.0087878525   1.2365788e-05  0              1.1941993      1.1965779e-13  0              2.9944201    
   1300000   8535           200            200            0.003637835    0.0021328971   0              0.0087806079   0.00014530682  0              14.032692      1.1965779e-13  0              2.9944224    
   1400000   8535           200            200            0.0036372084   0.0021328195   0              0.0087788057   4.5378381e-06  0              0.43823192     1.1965779e-13  0              2.994423     
   1500000   8535           200            200            0.0036374615   0.0021328495   0              0.008779535    1.7775659e-06  0              0.17166459     1.1965779e-13  0              2.9944227    
   1600000   8535           200            200            0.0036375808   0.0021328641   0              0.0087798783   2.2137726e-07  0              0.021379031    1.1965779e-13  0              2.9944226    
   1700000   8535           200            200            0.0036375631   0.002132862    0              0.0087798271   1.3270456e-08  0              0.0012815657   1.1965779e-13  0              2.9944226    
   1800000   8535           200            200            0.0036375445   0.0021328598   0              0.0087797738   6.2870514e-09  0              0.00060715842  1.1965779e-13  0              2.9944227    
   1900000   8535           200            200            0.0036375444   0.0021328598   0              0.0087797734   2.1578437e-11  0              2.083891e-06   1.1965779e-13  0              2.9944227    
   2000000   8535           200            200            0.0036375469   0.0021328601   0              0.0087797805   1.2844836e-10  0              1.2404623e-05  1.1965779e-13  0              2.9944227    
   2100000   8535           200            200            0.0036375472   0.0021328601   0              0.0087797815   8.6526549e-13  0              8.3561147e-08  1.1965779e-13  0              2.9944227    
   2200000   8535           200            200            0.0036375469   0.0021328601   0              0.0087797807   1.9623887e-12  0              1.8951345e-07  1.1965779e-13  0              2.9944227    
   2300000   8535           200            200            0.0036375468   0.0021328601   0              0.0087797805   1.0109717e-13  0              9.7632407e-09  1.1965779e-13  0              2.9944227    
   2400000   8535           200            200            0.0036375469   0.0021328601   0              0.0087797805   2.0969081e-14  0              2.0250438e-09  1.1965779e-13  0              2.9944227    
   2500000   8535           200            200            0.0036375469   0.0021328601   0              0.0087797806   3.952361e-15   0              3.8169073e-10  1.1965779e-13  0              2.9944227    
   2600000   8535           200            200            0.0036375469   0.0021328601   0              0.0087797806   1.022768e-16   0              9.8771616e-12  1.1965779e-13  0              2.9944227    
   2700000   8535           200            200            0.0036375469   0.0021328601   0              0.0087797806   9.2410359e-17  0              8.924331e-12   1.1965779e-13  0              2.9944227    
   2800000   8535           200            200            0.0036375469   0.0021328601   0              0.0087797806   1.2952161e-18  0              1.250827e-13   1.1965779e-13  0              2.9944227    
   2900000   8535           200            200            0.0036375469   0.0021328601   0              0.0087797806   7.3276255e-18  0              7.0764963e-13  1.1965779e-13  0              2.9944227    
   3000000   8535           200            200            0.0036375469   0.0021328601   0              0.0087797806   6.0788609e-19  0              5.8705288e-14  1.1965779e-13  0              2.9944227    
Loop time of 297.478 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8713263.557 ns/day, 0.000 hours/ns, 10084.796 timesteps/s
99.9% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.409     | 36.883     | 63.144     | 417.7 | 12.40
Neigh   | 5.3918     | 5.4939     | 5.6005     |   4.0 |  1.85
Comm    | 20.643     | 40.278     | 79.068     | 358.8 | 13.54
Output  | 0.30978    | 0.31009    | 0.3104     |   0.1 |  0.10
Modify  | 110.46     | 158.4      | 177.21     | 221.5 | 53.25
Other   |            | 56.12      |            |       | 18.86

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         319.75 ave         640 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1279
Ave neighs/atom = 0.51139544
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 70

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.7                                                               
Lattice spacing in x,y,z = 5.7 5.7 5.7

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4275 ${n1e1} -100 100 -100 100 units box
region box block -4275 4275 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4275 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4275 4275 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4275 -100 -100) to (4275 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4275 -100 -100) to (4275 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4275 -100 -100) to (4275 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_70_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5517 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 109.2 | 109.2 | 109.2 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8550           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8550           200            200            0.0023643026   1.2169353e-40  0              0.0070929077   579982.89      0              5.6010596e+10  1.1965779e-13  0              3.3305513    
    200000   8550           200            200            0.00081172264 -9.4477714e-36  0              0.0024351679   134527.79      0              1.2991731e+10  1.1965779e-13  0              3.0802046    
    300000   8550           200            200           -1.196093e-05   1.3227054e-34  0             -3.588279e-05   65.990498      0              6372889.9      1.1965779e-13  0              3.0444919    
    400000   8550           200            200           -8.2551398e-05  1.5116633e-34  0             -0.00024765419  3785.7481      0              3.6560045e+08  1.1965779e-13  0              3.00286      
    500000   8550           200            200            0.0047372241   1.8895928e-35  0              0.014211672    925.61925      0              89389682       1.1965779e-13  0              2.9938089    
    600000   8550           200            200            0.001946504   -1.8895597e-35  0              0.005839512    15.114525      0              1459652.7      1.1965779e-13  0              2.9966072    
    700000   8550           200            200            0.0032646164  -3.7791373e-35  0              0.0097938493   6.5310267      0              630719.81      1.1965779e-13  0              2.9951962    
    800000   8550           200            200            0.0028262986  -3.7791384e-35  0              0.0084788958   1.9343279      0              186803.54      1.1965779e-13  0              2.9956423    
    900000   8550           200            200            0.0029432701   9.4479647e-36  0              0.0088298104   0.40725257     0              39329.538      1.1965779e-13  0              2.9955196    
   1000000   8550           200            200            0.0029210975   1.8895855e-35  0              0.0087632924   0.065027708    0              6279.9105      1.1965779e-13  0              2.9955435    
   1100000   8550           200            200            0.0029207429   1.4171916e-35  0              0.0087622286   0.0083073703   0              802.26636      1.1965779e-13  0              2.9955434    
   1200000   8550           200            200            0.002924       1.0664314e-40  0              0.0087719999   0.00083640205  0              80.773723      1.1965779e-13  0              2.9955402    
   1300000   8550           200            200            0.0029217878   4.7240466e-36  0              0.0087653633   6.0728987e-05  0              5.8647709      1.1965779e-13  0              2.9955424    
   1400000   8550           200            200            0.0029228855  -2.3618603e-36  0              0.0087686566   2.2875456e-06  0              0.22091478     1.1965779e-13  0              2.9955413    
   1500000   8550           200            200            0.0029224213  -5.9038267e-37  0              0.008767264    4.7221193e-13  0              4.5602848e-08  1.1965779e-13  0              2.9955418    
   1600000   8550           200            200            0.0029225957   1.1810943e-36  0              0.0087677871   4.1834112e-08  0              0.0040400391   1.1965779e-13  0              2.9955416    
   1700000   8550           200            200            0.0029225372   1.095779e-40   0              0.0087676116   2.0165129e-08  0              0.0019474038   1.1965779e-13  0              2.9955417    
   1800000   8550           200            200            0.0029225543  -4.7238296e-36  0              0.008767663    5.0495792e-09  0              0.00048765221  1.1965779e-13  0              2.9955417    
   1900000   8550           200            200            0.0029225503   4.7240487e-36  0              0.008767651    9.1255623e-10  0              8.8128149e-05  1.1965779e-13  0              2.9955417    
   2000000   8550           200            200            0.0029225508  -1.4171707e-35  0              0.0087676524   1.2996416e-10  0              1.2551009e-05  1.1965779e-13  0              2.9955417    
   2100000   8550           200            200            0.002922551    1.8895866e-35  0              0.008767653    1.4778957e-11  0              1.4272459e-06  1.1965779e-13  0              2.9955417    
   2200000   8550           200            200            0.0029225508  -1.8895646e-35  0              0.0087676524   1.2832408e-12  0              1.2392621e-07  1.1965779e-13  0              2.9955417    
   2300000   8550           200            200            0.0029225509  -5.6687158e-35  0              0.0087676527   7.1858111e-14  0              6.9395421e-09  1.1965779e-13  0              2.9955417    
   2400000   8550           200            200            0.0029225509   9.4479876e-36  0              0.0087676526   1.1158199e-15  0              1.077579e-10   1.1965779e-13  0              2.9955417    
   2500000   8550           200            200            0.0029225509  -3.7791402e-35  0              0.0087676526   1.5890995e-16  0              1.5346385e-11  1.1965779e-13  0              2.9955417    
   2600000   8550           200            200            0.0029225509  -1.8895646e-35  0              0.0087676526   1.5838764e-16  0              1.5295944e-11  1.1965779e-13  0              2.9955417    
   2700000   8550           200            200            0.0029225509   3.7791621e-35  0              0.0087676526   6.1609744e-17  0              5.9498281e-12  1.1965779e-13  0              2.9955417    
   2800000   8550           200            200            0.0029225509   2.2674918e-34  0              0.0087676526   1.2650649e-17  0              1.2217092e-12  1.1965779e-13  0              2.9955417    
   2900000   8550           200            200            0.0029225509   1.7006192e-34  0              0.0087676526   3.0029241e-22  0              2.9000091e-17  1.1965779e-13  0              2.9955417    
   3000000   8550           200            200            0.0029225509  -7.5582921e-35  0              0.0087676526   4.8949714e-18  0              4.727213e-13   1.1965779e-13  0              2.9955417    
Loop time of 294.54 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8800170.517 ns/day, 0.000 hours/ns, 10185.383 timesteps/s
99.9% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.97      | 35.615     | 61.158     | 409.6 | 12.09
Neigh   | 5.3823     | 5.4797     | 5.5827     |   3.8 |  1.86
Comm    | 20.946     | 39.761     | 76.774     | 344.7 | 13.50
Output  | 0.32352    | 0.32383    | 0.32418    |   0.1 |  0.11
Modify  | 109.82     | 157.27     | 177.2      | 221.0 | 53.40
Other   |            | 56.09      |            |       | 19.04

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         316.25 ave         633 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1265
Ave neighs/atom = 0.50579768
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 71

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.71                                                               
Lattice spacing in x,y,z = 5.71 5.71 5.71

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4282.5 ${n1e1} -100 100 -100 100 units box
region box block -4282.5 4282.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4282.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4282.5 4282.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4282.5 -100 -100) to (4282.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4282.5 -100 -100) to (4282.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4282.5 -100 -100) to (4282.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_71_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5526 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 109.2 | 109.3 | 109.3 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8565           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8565           200            200            0.0023595078  -3.536749e-36   0              0.0070785233   579744.01      0              5.5987527e+10  1.1965779e-13  0              3.3307252    
    200000   8565           200            200            0.00080620653 -1.1317479e-34  0              0.0024186196   133439.33      0              1.2886615e+10  1.1965779e-13  0              3.081599     
    300000   8565           200            200            6.7661475e-06  4.001522e-40   0              2.0298442e-05  21.060691      0              2033890.8      1.1965779e-13  0              3.044563     
    400000   8565           200            200            2.848565e-05  -1.8862464e-35  0              8.5456949e-05  363.78672      0              35131918       1.1965779e-13  0              3.0056151    
    500000   8565           200            200            0.0020727038  -0.00099499428  0              0.0072131057   1417.7343      0              1.3691463e+08  1.1965779e-13  0              2.9949692    
    600000   8565           200            200            0.0025517387   6.2205309e-05  0              0.0075930107   171.29063      0              16542023       1.1965779e-13  0              2.9947981    
    700000   8565           200            200            0.0030713269  -0.00039098358  0              0.0096049643   13.906616      0              1343001.4      1.1965779e-13  0              2.9941433    
    800000   8565           200            200            0.0028518913  -0.00056924207  0              0.0091249159   1.0192572      0              98432.561      1.1965779e-13  0              2.9942828    
    900000   8565           200            200            0.0026746123  -0.00065548273  0              0.0086793195   0.39461481     0              38109.074      1.1965779e-13  0              2.9944219    
   1000000   8565           200            200            0.0026781495  -0.00065765444  0              0.0086921028   0.0059375847   0              573.40943      1.1965779e-13  0              2.9944189    
   1100000   8565           200            200            0.0026995382  -0.00065468625  0              0.0087533009   0.0083940363   0              810.63595      1.1965779e-13  0              2.9943996    
   1200000   8565           200            200            0.0027008403  -0.00065450165  0              0.0087570225   5.8335731e-06  0              0.56336474     1.1965779e-13  0              2.9943984    
   1300000   8565           200            200            0.0026980751  -0.00065485513  0              0.0087490804   0.00015794083  0              15.252795      1.1965779e-13  0              2.9944008    
   1400000   8565           200            200            0.0026976588  -0.00065491156  0              0.0087478881   5.9172197e-07  0              0.057144273    1.1965779e-13  0              2.9944012    
   1500000   8565           200            200            0.0026979957  -0.00065486821  0              0.0087488552   2.6507735e-06  0              0.25599273     1.1965779e-13  0              2.9944009    
   1600000   8565           200            200            0.0026980812  -0.00065485683  0              0.0087491003   6.0328308e-08  0              0.0058260761   1.1965779e-13  0              2.9944008    
   1700000   8565           200            200            0.0026980432  -0.00065486168  0              0.0087489912   3.9286119e-08  0              0.0037939722   1.1965779e-13  0              2.9944009    
   1800000   8565           200            200            0.0026980283  -0.00065486364  0              0.0087489487   2.5401662e-09  0              0.00024531107  1.1965779e-13  0              2.9944009    
   1900000   8565           200            200            0.0026980322  -0.00065486315  0              0.0087489597   4.992202e-10   0              4.8211114e-05  1.1965779e-13  0              2.9944009    
   2000000   8565           200            200            0.0026980345  -0.00065486285  0              0.0087489664   7.6473458e-11  0              7.3852592e-06  1.1965779e-13  0              2.9944009    
   2100000   8565           200            200            0.0026980342  -0.00065486289  0              0.0087489655   5.0728017e-12  0              4.8989488e-07  1.1965779e-13  0              2.9944009    
   2200000   8565           200            200            0.0026980338  -0.00065486293  0              0.0087489645   1.8929977e-12  0              1.8281217e-07  1.1965779e-13  0              2.9944009    
   2300000   8565           200            200            0.0026980339  -0.00065486293  0              0.0087489645   3.3688349e-14  0              3.2533797e-09  1.1965779e-13  0              2.9944009    
   2400000   8565           200            200            0.0026980339  -0.00065486292  0              0.0087489646   4.0691949e-14  0              3.9297372e-09  1.1965779e-13  0              2.9944009    
   2500000   8565           200            200            0.0026980339  -0.00065486292  0              0.0087489647   5.3315703e-17  0              5.148849e-12   1.1965779e-13  0              2.9944009    
   2600000   8565           200            200            0.0026980339  -0.00065486292  0              0.0087489646   7.6932713e-16  0              7.4296107e-11  1.1965779e-13  0              2.9944009    
   2700000   8565           200            200            0.0026980339  -0.00065486292  0              0.0087489646   4.053235e-19   0              3.9143243e-14  1.1965779e-13  0              2.9944009    
   2800000   8565           200            200            0.0026980339  -0.00065486292  0              0.0087489646   1.3823852e-17  0              1.3350087e-12  1.1965779e-13  0              2.9944009    
   2900000   8565           200            200            0.0026980339  -0.00065486292  0              0.0087489646   2.1015886e-18  0              2.0295639e-13  1.1965779e-13  0              2.9944009    
   3000000   8565           200            200            0.0026980339  -0.00065486292  0              0.0087489646   1.2180485e-18  0              1.176304e-13   1.1965779e-13  0              2.9944009    
Loop time of 294.359 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8805578.737 ns/day, 0.000 hours/ns, 10191.642 timesteps/s
99.9% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.897     | 36.15      | 61.846     | 416.6 | 12.28
Neigh   | 5.3452     | 5.4468     | 5.5529     |   4.0 |  1.85
Comm    | 20.794     | 39.547     | 77.272     | 351.6 | 13.44
Output  | 0.36195    | 0.36231    | 0.36269    |   0.1 |  0.12
Modify  | 108.83     | 156.65     | 176.89     | 222.8 | 53.22
Other   |            | 56.2       |            |       | 19.09

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         318.75 ave         638 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1275
Ave neighs/atom = 0.50979608
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 72

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.72                                                               
Lattice spacing in x,y,z = 5.72 5.72 5.72

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4290 ${n1e1} -100 100 -100 100 units box
region box block -4290 4290 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4290 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4290 4290 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4290 -100 -100) to (4290 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4290 -100 -100) to (4290 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4290 -100 -100) to (4290 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_72_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5536 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 109.4 | 109.4 | 109.4 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8580           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8580           200            200            0.0023551915   8.629409e-41   0              0.0070655744   579673.15      0              5.5980684e+10  1.1965779e-13  0              3.3307835    
    200000   8580           200            200            0.00080444222  1.4122274e-35  0              0.0024133267   133347.62      0              1.2877759e+10  1.1965779e-13  0              3.0816601    
    300000   8580           200            200            5.840032e-06  -3.7657908e-35  0              1.7520096e-05  15.8134        0              1527145        1.1965779e-13  0              3.0445341    
    400000   8580           200            200            2.4362153e-05 -5.8842725e-37  0              7.3086459e-05  269.05498      0              25983404       1.1965779e-13  0              3.0056989    
    500000   8580           200            200            0.0023351364   0.0014919445   0              0.0055134646   1230.5758      0              1.188402e+08   1.1965779e-13  0              2.9956132    
    600000   8580           200            200            0.0024753034   0.0015645899   0              0.0058613202   26.136435      0              2524069.9      1.1965779e-13  0              2.9954199    
    700000   8580           200            200            0.0031682519   0.0015529361   0              0.0079518195   14.591112      0              1409105.1      1.1965779e-13  0              2.9946743    
    800000   8580           200            200            0.0033669921   0.0013880678   0              0.0087129084   3.5224057      0              340168.73      1.1965779e-13  0              2.9944239    
    900000   8580           200            200            0.003406108    0.0013864805   0              0.0088318436   0.30540271     0              29493.608      1.1965779e-13  0              2.9943842    
   1000000   8580           200            200            0.0033928635   0.0013869413   0              0.0087916493   0.0032895736   0              317.68347      1.1965779e-13  0              2.9943962    
   1100000   8580           200            200            0.0033801523   0.0013874232   0              0.0087530339   0.0017837301   0              172.25989      1.1965779e-13  0              2.9944084    
   1200000   8580           200            200            0.0033748008   0.0013876349   0              0.0087367676   0.00099115624  0              95.718775      1.1965779e-13  0              2.9944136    
   1300000   8580           200            200            0.0033735038   0.0013876878   0              0.0087328237   0.00014431074  0              13.936498      1.1965779e-13  0              2.9944149    
   1400000   8580           200            200            0.0033734958   0.0013876887   0              0.0087327986   6.3047099e-06  0              0.60886375     1.1965779e-13  0              2.9944149    
   1500000   8580           200            200            0.0033736662   0.0013876821   0              0.0087333164   4.327364e-08   0              0.0041790584   1.1965779e-13  0              2.9944147    
   1600000   8580           200            200            0.0033737631   0.0013876782   0              0.0087336111   2.0767906e-07  0              0.020056157    1.1965779e-13  0              2.9944146    
   1700000   8580           200            200            0.0033737947   0.0013876769   0              0.0087337071   5.2113874e-08  0              0.005032785    1.1965779e-13  0              2.9944146    
   1800000   8580           200            200            0.0033737993   0.0013876767   0              0.0087337213   4.4809266e-09  0              0.00043273581  1.1965779e-13  0              2.9944146    
   1900000   8580           200            200            0.0033737977   0.0013876768   0              0.0087337163   4.7065998e-11  0              4.5452972e-06  1.1965779e-13  0              2.9944146    
   2000000   8580           200            200            0.0033737962   0.0013876769   0              0.0087337116   2.6733005e-11  0              2.5816823e-06  1.1965779e-13  0              2.9944146    
   2100000   8580           200            200            0.0033737955   0.0013876769   0              0.0087337096   1.4696111e-11  0              1.4192452e-06  1.1965779e-13  0              2.9944146    
   2200000   8580           200            200            0.0033737953   0.0013876769   0              0.0087337092   2.1289082e-12  0              2.0559472e-07  1.1965779e-13  0              2.9944146    
   2300000   8580           200            200            0.0033737953   0.0013876769   0              0.0087337092   9.2305473e-14  0              8.9142019e-09  1.1965779e-13  0              2.9944146    
   2400000   8580           200            200            0.0033737954   0.0013876769   0              0.0087337092   7.2112384e-16  0              6.9640978e-11  1.1965779e-13  0              2.9944146    
   2500000   8580           200            200            0.0033737954   0.0013876769   0              0.0087337093   3.2084135e-15  0              3.0984561e-10  1.1965779e-13  0              2.9944146    
   2600000   8580           200            200            0.0033737954   0.0013876769   0              0.0087337093   7.6839953e-16  0              7.4206526e-11  1.1965779e-13  0              2.9944146    
   2700000   8580           200            200            0.0033737954   0.0013876769   0              0.0087337093   5.1292224e-17  0              4.9534358e-12  1.1965779e-13  0              2.9944146    
   2800000   8580           200            200            0.0033737954   0.0013876769   0              0.0087337093   1.621717e-19   0              1.5661382e-14  1.1965779e-13  0              2.9944146    
   2900000   8580           200            200            0.0033737954   0.0013876769   0              0.0087337093   2.1416397e-18  0              2.0682423e-13  1.1965779e-13  0              2.9944146    
   3000000   8580           200            200            0.0033737954   0.0013876769   0              0.0087337093   1.6745047e-18  0              1.6171168e-13  1.1965779e-13  0              2.9944146    
Loop time of 296.243 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8749587.924 ns/day, 0.000 hours/ns, 10126.838 timesteps/s
99.9% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.987     | 36.399     | 62.652     | 418.8 | 12.29
Neigh   | 5.3318     | 5.4293     | 5.5297     |   3.8 |  1.83
Comm    | 20.791     | 39.888     | 78.222     | 355.7 | 13.46
Output  | 0.3571     | 0.35742    | 0.35776    |   0.1 |  0.12
Modify  | 109.46     | 157.78     | 177.86     | 224.2 | 53.26
Other   |            | 56.39      |            |       | 19.03

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         318.25 ave         637 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1273
Ave neighs/atom = 0.5089964
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 73

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.73                                                               
Lattice spacing in x,y,z = 5.73 5.73 5.73

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4297.5 ${n1e1} -100 100 -100 100 units box
region box block -4297.5 4297.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4297.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4297.5 4297.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4297.5 -100 -100) to (4297.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4297.5 -100 -100) to (4297.5 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4297.5 -100 -100) to (4297.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_73_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5546 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 109.6 | 109.6 | 109.6 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8595           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8595           200            200            0.0023509019   3.0282919e-42  0              0.0070527056   579608.82      0              5.5974471e+10  1.1965779e-13  0              3.3308202    
    200000   8595           200            200            0.00080241585 -1.8796692e-35  0              0.0024072475   133184.82      0              1.2862037e+10  1.1965779e-13  0              3.0818058    
    300000   8595           200            200            5.2748074e-06 -1.3157735e-34  0              1.5824422e-05  12.98594       0              1254089.1      1.1965779e-13  0              3.0445087    
    400000   8595           200            200            2.5879924e-05  1.8797116e-35  0              7.7639771e-05  303.79628      0              29338471       1.1965779e-13  0              3.0056354    
    500000   8595           200            200            0.0030938404   0.0021448351   0              0.007136686    1412.7041      0              1.3642885e+08  1.1965779e-13  0              2.9949562    
    600000   8595           200            200            0.0037178806   0.0036556412   0              0.0074980005   167.05482      0              16132958       1.1965779e-13  0              2.9947879    
    700000   8595           200            200            0.0043207871   0.0035903891   0              0.0093719723   19.087056      0              1843291.3      1.1965779e-13  0              2.9941669    
    800000   8595           200            200            0.0042562782   0.0036260574   0              0.0091427772   0.33471853     0              32324.72       1.1965779e-13  0              2.9942302    
    900000   8595           200            200            0.0041123764   0.0036489814   0              0.0086881477   0.46311015     0              44723.864      1.1965779e-13  0              2.9943714    
   1000000   8595           200            200            0.0041047412   0.0036553598   0              0.0086588636   0.00020418137  0              19.718375      1.1965779e-13  0              2.9943816    
   1100000   8595           200            200            0.0041247447   0.0036570118   0              0.0087172222   0.0086558275   0              835.91786      1.1965779e-13  0              2.9943633    
   1200000   8595           200            200            0.0041278514   0.0036572976   0              0.0087262567   3.4971891e-05  0              3.3773349      1.1965779e-13  0              2.9943603    
   1300000   8595           200            200            0.0041254046   0.0036570833   0              0.0087191306   0.00014525334  0              14.027528      1.1965779e-13  0              2.9943625    
   1400000   8595           200            200            0.0041247804   0.0036570271   0              0.0087173141   3.2824909e-06  0              0.31699947     1.1965779e-13  0              2.9943631    
   1500000   8595           200            200            0.0041250577   0.003657051    0              0.0087181222   2.1700888e-06  0              0.20957164     1.1965779e-13  0              2.9943629    
   1600000   8595           200            200            0.0041251653   0.0036570606   0              0.0087184352   1.3569139e-07  0              0.013104103    1.1965779e-13  0              2.9943628    
   1700000   8595           200            200            0.0041251369   0.0036570582   0              0.0087183526   2.8123581e-08  0              0.0027159742   1.1965779e-13  0              2.9943628    
   1800000   8595           200            200            0.00412512     0.0036570567   0              0.0087183034   4.0704382e-09  0              0.00039309378  1.1965779e-13  0              2.9943628    
   1900000   8595           200            200            0.0041251224   0.0036570569   0              0.0087183104   2.9759305e-10  0              2.8739406e-05  1.1965779e-13  0              2.9943628    
   2000000   8595           200            200            0.0041251249   0.0036570571   0              0.0087183176   1.0114841e-10  0              9.7681891e-06  1.1965779e-13  0              2.9943628    
   2100000   8595           200            200            0.0041251248   0.0036570571   0              0.0087183173   2.1911501e-12  0              2.1160559e-07  1.1965779e-13  0              2.9943628    
   2200000   8595           200            200            0.0041251245   0.0036570571   0              0.0087183163   2.1937779e-12  0              2.1185936e-07  1.1965779e-13  0              2.9943628    
   2300000   8595           200            200            0.0041251244   0.0036570571   0              0.0087183162   5.7706327e-15  0              5.572864e-10   1.1965779e-13  0              2.9943628    
   2400000   8595           200            200            0.0041251245   0.0036570571   0              0.0087183164   4.2502979e-14  0              4.1046334e-09  1.1965779e-13  0              2.9943628    
   2500000   8595           200            200            0.0041251245   0.0036570571   0              0.0087183164   5.2973928e-17  0              5.1158428e-12  1.1965779e-13  0              2.9943628    
   2600000   8595           200            200            0.0041251245   0.0036570571   0              0.0087183164   7.2702547e-16  0              7.0210916e-11  1.1965779e-13  0              2.9943628    
   2700000   8595           200            200            0.0041251245   0.0036570571   0              0.0087183164   5.3726207e-18  0              5.1884925e-13  1.1965779e-13  0              2.9943628    
   2800000   8595           200            200            0.0041251245   0.0036570571   0              0.0087183164   1.3429723e-17  0              1.2969465e-12  1.1965779e-13  0              2.9943628    
   2900000   8595           200            200            0.0041251245   0.0036570571   0              0.0087183164   1.6543683e-18  0              1.5976705e-13  1.1965779e-13  0              2.9943628    
   3000000   8595           200            200            0.0041251245   0.0036570571   0              0.0087183164   2.3297638e-18  0              2.2499191e-13  1.1965779e-13  0              2.9943628    
Loop time of 296.285 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8748345.615 ns/day, 0.000 hours/ns, 10125.400 timesteps/s
99.9% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.26      | 36.701     | 63.207     | 417.6 | 12.39
Neigh   | 5.383      | 5.4811     | 5.5828     |   3.8 |  1.85
Comm    | 20.499     | 40.446     | 79.452     | 360.4 | 13.65
Output  | 0.35964    | 0.35994    | 0.36027    |   0.1 |  0.12
Modify  | 108.97     | 157.26     | 176.34     | 223.9 | 53.08
Other   |            | 56.04      |            |       | 18.91

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         319.25 ave         639 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1277
Ave neighs/atom = 0.51059576
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 74

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.74                                                               
Lattice spacing in x,y,z = 5.74 5.74 5.74

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4305 ${n1e1} -100 100 -100 100 units box
region box block -4305 4305 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4305 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4305 4305 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4305 -100 -100) to (4305 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4305 -100 -100) to (4305 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4305 -100 -100) to (4305 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_74_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5555 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 109.8 | 109.8 | 109.8 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8610           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8610           200            200            0.0023465514   1.8764083e-34  0              0.0070396541   579512.37      0              5.5965157e+10  1.1965779e-13  0              3.330912     
    200000   8610           200            200            0.00080065553  5.6292304e-35  0              0.0024019666   133091.05      0              1.2852981e+10  1.1965779e-13  0              3.0818649    
    300000   8610           200            200            4.2045497e-06 -5.6292004e-35  0              1.2613649e-05  8.3418904      0              805600.06      1.1965779e-13  0              3.0444689    
    400000   8610           200            200            1.9867406e-05 -3.7527906e-35  0              5.9602219e-05  181.7565       0              17552741       1.1965779e-13  0              3.0057414    
    500000   8610           200            200            0.00085537665 -0.00094466928  0              0.0035107992   760.25256      0              73419751       1.1965779e-13  0              2.9965232    
    600000   8610           200            200            0.0016402718  -0.0016506227   0              0.0065714381   102.53929      0              9902510.7      1.1965779e-13  0              2.9951141    
    700000   8610           200            200            0.0024952092  -0.0012534644   0              0.0087390919   26.085667      0              2519167        1.1965779e-13  0              2.9943593    
    800000   8610           200            200            0.0025232862  -0.0013453487   0              0.0089152072   2.6531478      0              256222.02      1.1965779e-13  0              2.9943072    
    900000   8610           200            200            0.0024977528  -0.0013298014   0              0.0088230597   0.20056817     0              19369.438      1.1965779e-13  0              2.9943386    
   1000000   8610           200            200            0.0024770921  -0.0013257632   0              0.0087570395   0.0090217825   0              871.25918      1.1965779e-13  0              2.9943605    
   1100000   8610           200            200            0.0024663335  -0.0013255313   0              0.0087245318   3.7374959e-05  0              3.6094061      1.1965779e-13  0              2.9943712    
   1200000   8610           200            200            0.0024617924  -0.0013254279   0              0.008710805    7.2764119e-05  0              7.0270378      1.1965779e-13  0              2.9943757    
   1300000   8610           200            200            0.0024600758  -0.001325388    0              0.0087056155   4.5878195e-05  0              4.4305877      1.1965779e-13  0              2.9943774    
   1400000   8610           200            200            0.0024594908  -0.0013253744   0              0.0087038469   1.2772233e-05  0              1.2334508      1.1965779e-13  0              2.994378     
   1500000   8610           200            200            0.0024593143  -0.0013253703   0              0.0087033133   2.4936318e-06  0              0.24081711     1.1965779e-13  0              2.9943781    
   1600000   8610           200            200            0.0024592701  -0.0013253693   0              0.0087031797   3.8362243e-07  0              0.037047508    1.1965779e-13  0              2.9943782    
   1700000   8610           200            200            0.0024592631  -0.0013253692   0              0.0087031584   4.7962716e-08  0              0.0046318958   1.1965779e-13  0              2.9943782    
   1800000   8610           200            200            0.0024592641  -0.0013253692   0              0.0087031616   4.7896335e-09  0              0.00046254853  1.1965779e-13  0              2.9943782    
   1900000   8610           200            200            0.0024592658  -0.0013253693   0              0.0087031667   3.5080432e-10  0              3.387817e-05   1.1965779e-13  0              2.9943782    
   2000000   8610           200            200            0.0024592669  -0.0013253693   0              0.0087031699   1.390207e-11   0              1.3425624e-06  1.1965779e-13  0              2.9943782    
   2100000   8610           200            200            0.0024592674  -0.0013253693   0              0.0087031714   5.5003663e-15  0              5.3118601e-10  1.1965779e-13  0              2.9943782    
   2200000   8610           200            200            0.0024592676  -0.0013253693   0              0.008703172    2.0342597e-13  0              1.9645424e-08  1.1965779e-13  0              2.9943782    
   2300000   8610           200            200            0.0024592676  -0.0013253693   0              0.0087031722   1.0519216e-13  0              1.0158705e-08  1.1965779e-13  0              2.9943782    
   2400000   8610           200            200            0.0024592677  -0.0013253693   0              0.0087031723   2.7515942e-14  0              2.6572928e-09  1.1965779e-13  0              2.9943782    
   2500000   8610           200            200            0.0024592677  -0.0013253693   0              0.0087031723   5.1850283e-15  0              5.0073292e-10  1.1965779e-13  0              2.9943782    
   2600000   8610           200            200            0.0024592677  -0.0013253693   0              0.0087031723   7.6455953e-16  0              7.3835687e-11  1.1965779e-13  0              2.9943782    
   2700000   8610           200            200            0.0024592677  -0.0013253693   0              0.0087031723   9.4826268e-17  0              9.1576422e-12  1.1965779e-13  0              2.9943782    
   2800000   8610           200            200            0.0024592677  -0.0013253693   0              0.0087031723   1.1117757e-17  0              1.0736734e-12  1.1965779e-13  0              2.9943782    
   2900000   8610           200            200            0.0024592677  -0.0013253693   0              0.0087031723   3.3974242e-18  0              3.2809891e-13  1.1965779e-13  0              2.9943782    
   3000000   8610           200            200            0.0024592677  -0.0013253693   0              0.0087031723   2.8282041e-18  0              2.731277e-13   1.1965779e-13  0              2.9943782    
Loop time of 298.273 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8690014.428 ns/day, 0.000 hours/ns, 10057.887 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.216     | 36.328     | 62.444     | 416.5 | 12.18
Neigh   | 5.3549     | 5.4583     | 5.5644     |   4.1 |  1.83
Comm    | 20.708     | 40.266     | 78.564     | 354.6 | 13.50
Output  | 0.27244    | 0.27275    | 0.27308    |   0.1 |  0.09
Modify  | 111.48     | 159.62     | 179.64     | 221.8 | 53.51
Other   |            | 56.33      |            |       | 18.89

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         318.25 ave         637 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1273
Ave neighs/atom = 0.5089964
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 75

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.75                                                               
Lattice spacing in x,y,z = 5.75 5.75 5.75

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4312.5 ${n1e1} -100 100 -100 100 units box
region box block -4312.5 4312.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4312.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4312.5 4312.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4312.5 -100 -100) to (4312.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4312.5 -100 -100) to (4312.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4312.5 -100 -100) to (4312.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_75_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5565 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 110 | 110 | 110 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8625           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8625           200            200            0.0023417102   2.3414343e-36  0              0.0070251306   579203.62      0              5.5935339e+10  1.1965779e-13  0              3.3313539    
    200000   8625           200            200            0.00079958976 -1.8731388e-35  0              0.0023987693   133177.83      0              1.2861362e+10  1.1965779e-13  0              3.0817642    
    300000   8625           200            200            7.7705822e-06  2.5988532e-40  0              2.3311747e-05  28.05513       0              2709363.7      1.1965779e-13  0              3.0442873    
    400000   8625           200            200           -4.4907351e-05 -1.498513e-34   0             -0.00013472205  1046.4695      0              1.0106053e+08  1.1965779e-13  0              3.0048434    
    500000   8625           200            200            0.00090668363  3.7463063e-35  0              0.0027200509   321.53083      0              31051146       1.1965779e-13  0              2.9976849    
    600000   8625           200            200            0.0037611675   1.7037969e-40  0              0.011283503    41.060357      0              3965315.4      1.1965779e-13  0              2.9939086    
    700000   8625           200            200            0.002688776   -9.3655807e-36  0              0.0080663279   16.083646      0              1553243.4      1.1965779e-13  0              2.9951161    
    800000   8625           200            200            0.0029256033   3.7463022e-35  0              0.0087768098   3.1894041      0              308009.82      1.1965779e-13  0              2.9948435    
    900000   8625           200            200            0.0029037144   4.6829488e-36  0              0.0087111433   0.4396467      0              42457.931      1.1965779e-13  0              2.9948651    
   1000000   8625           200            200            0.0028875393   4.6829242e-36  0              0.0086626178   0.044025147    0              4251.6336      1.1965779e-13  0              2.9948857    
   1100000   8625           200            200            0.0029015916   4.0248709e-37  0              0.0087047748   0.0028388981   0              274.16045      1.1965779e-13  0              2.9948687    
   1200000   8625           200            200            0.0028942331   5.3253579e-41  0              0.0086826992   6.2366983e-05  0              6.0229568      1.1965779e-13  0              2.9948775    
   1300000   8625           200            200            0.0028973409   1.4048636e-35  0              0.0086920227   3.3094464e-06  0              0.31960264     1.1965779e-13  0              2.9948738    
   1400000   8625           200            200            0.0028962204  -7.0242398e-36  0              0.0086886613   5.3041187e-06  0              0.51223381     1.1965779e-13  0              2.9948751    
   1500000   8625           200            200            0.0028965629  -1.8731393e-35  0              0.0086896887   1.7442486e-06  0              0.16844705     1.1965779e-13  0              2.9948747    
   1600000   8625           200            200            0.0028964812   9.3657748e-36  0              0.0086894437   3.4491081e-07  0              0.033309017    1.1965779e-13  0              2.9948748    
   1700000   8625           200            200            0.0028964905  -2.3414254e-35  0              0.0086894716   4.8899673e-08  0              0.0047223804   1.1965779e-13  0              2.9948748    
   1800000   8625           200            200            0.0028964952   4.6828665e-35  0              0.0086894857   5.0571649e-09  0              0.00048838479  1.1965779e-13  0              2.9948748    
   1900000   8625           200            200            0.0028964908   1.8731497e-35  0              0.0086894723   3.4276235e-10  0              3.3101535e-05  1.1965779e-13  0              2.9948748    
   2000000   8625           200            200            0.0028964932  -9.3656704e-36  0              0.0086894795   8.9553343e-12  0              8.6484209e-07  1.1965779e-13  0              2.9948748    
   2100000   8625           200            200            0.0028964921   9.3657745e-36  0              0.0086894764   2.1508174e-13  0              2.0771055e-08  1.1965779e-13  0              2.9948748    
   2200000   8625           200            200            0.0028964925   9.3657746e-36  0              0.0086894776   5.1758696e-13  0              4.9984843e-08  1.1965779e-13  0              2.9948748    
   2300000   8625           200            200            0.0028964924   9.3657745e-36  0              0.0086894772   1.8214325e-13  0              1.7590092e-08  1.1965779e-13  0              2.9948748    
   2400000   8625           200            200            0.0028964924   5.1893773e-41  0              0.0086894773   3.7396505e-14  0              3.6114868e-09  1.1965779e-13  0              2.9948748    
   2500000   8625           200            200            0.0028964924   5.6194387e-35  0              0.0086894773   5.4255854e-15  0              5.239642e-10   1.1965779e-13  0              2.9948748    
   2600000   8625           200            200            0.0028964924   2.8097173e-34  0              0.0086894773   5.7378771e-16  0              5.541231e-11   1.1965779e-13  0              2.9948748    
   2700000   8625           200            200            0.0028964924   3.7462942e-35  0              0.0086894773   5.4950913e-17  0              5.3067658e-12  1.1965779e-13  0              2.9948748    
   2800000   8625           200            200            0.0028964924  -3.7462838e-35  0              0.0086894773   2.2598418e-18  0              2.1823935e-13  1.1965779e-13  0              2.9948748    
   2900000   8625           200            200            0.0028964924   1.1238872e-34  0              0.0086894773   6.6516756e-18  0              6.4237122e-13  1.1965779e-13  0              2.9948748    
   3000000   8625           200            200            0.0028964924  -5.6194282e-35  0              0.0086894773   2.8695846e-18  0              2.7712394e-13  1.1965779e-13  0              2.9948748    
Loop time of 293.689 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8825656.971 ns/day, 0.000 hours/ns, 10214.881 timesteps/s
99.9% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.162     | 35.562     | 61.201     | 408.2 | 12.11
Neigh   | 5.3805     | 5.4861     | 5.5948     |   4.1 |  1.87
Comm    | 20.808     | 39.752     | 76.94      | 346.4 | 13.54
Output  | 0.31455    | 0.31488    | 0.31523    |   0.1 |  0.11
Modify  | 109        | 156.6      | 176.68     | 222.1 | 53.32
Other   |            | 55.97      |            |       | 19.06

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         325.75 ave         652 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1303
Ave neighs/atom = 0.5209916
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 76

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.76                                                               
Lattice spacing in x,y,z = 5.76 5.76 5.76

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4320 ${n1e1} -100 100 -100 100 units box
region box block -4320 4320 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4320 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4320 4320 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4320 -100 -100) to (4320 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4320 -100 -100) to (4320 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4320 -100 -100) to (4320 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_76_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5575 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 110.1 | 110.1 | 110.1 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8640           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8640           200            200            0.0023379597  -5.8434121e-37  0              0.007013879    579351.63      0              5.5949633e+10  1.1965779e-13  0              3.3310087    
    200000   8640           200            200            0.00079687408  1.4045296e-40  0              0.0023906222   132830.2       0              1.282779e+10   1.1965779e-13  0              3.0820498    
    300000   8640           200            200            2.8949849e-06 -9.3494435e-35  0              8.6849546e-06  4.0412977      0              390279.61      1.1965779e-13  0              3.0443913    
    400000   8640           200            200            1.4207912e-05  2.9819546e-40  0              4.2623736e-05  94.74493       0              9149787.2      1.1965779e-13  0              3.0057626    
    500000   8640           200            200            0.00072013838 -7.4513331e-06  0              0.0021678665   385.68322      0              37246525       1.1965779e-13  0              2.9970813    
    600000   8640           200            200            0.0019263157  -0.00010212332  0              0.0058810703   37.749985      0              3645623.4      1.1965779e-13  0              2.9954042    
    700000   8640           200            200            0.0027889085  -0.0001411514   0              0.0085078769   25.747191      0              2486479.5      1.1965779e-13  0              2.994503     
    800000   8640           200            200            0.0029647585  -0.00014308947  0              0.0090373649   1.1649081      0              112498.49      1.1965779e-13  0              2.9943294    
    900000   8640           200            200            0.002890429   -0.00014234978  0              0.0088136367   0.11345949     0              10957.106      1.1965779e-13  0              2.994398     
   1000000   8640           200            200            0.0028425355  -0.0001418362   0              0.0086694426   0.064425726    0              6221.7755      1.1965779e-13  0              2.9944439    
   1100000   8640           200            200            0.0028370887  -0.00014177331  0              0.0086530394   0.0013351589   0              128.94009      1.1965779e-13  0              2.9944494    
   1200000   8640           200            200            0.0028417749  -0.00014182349  0              0.0086671483   0.00050393486  0              48.666422      1.1965779e-13  0              2.994445     
   1300000   8640           200            200            0.002844024   -0.00014184813  0              0.00867392     0.00014813815  0              14.306123      1.1965779e-13  0              2.9944428    
   1400000   8640           200            200            0.0028441171  -0.00014184933  0              0.0086742006   8.0504986e-07  0              0.077745953    1.1965779e-13  0              2.9944427    
   1500000   8640           200            200            0.0028438437  -0.00014184639  0              0.0086733776   1.8288329e-06  0              0.17661559     1.1965779e-13  0              2.994443     
   1600000   8640           200            200            0.002843743   -0.00014184528  0              0.0086730743   3.1045937e-07  0              0.029981944    1.1965779e-13  0              2.9944431    
   1700000   8640           200            200            0.0028437474  -0.00014184532  0              0.0086730875   7.3167932e-12  0              7.0660351e-07  1.1965779e-13  0              2.9944431    
   1800000   8640           200            200            0.0028437624  -0.00014184548  0              0.0086731327   5.7805466e-09  0              0.00055824381  1.1965779e-13  0              2.9944431    
   1900000   8640           200            200            0.0028437666  -0.00014184553  0              0.0086731454   5.8356935e-10  0              5.6356951e-05  1.1965779e-13  0              2.994443     
   2000000   8640           200            200            0.002843766   -0.00014184552  0              0.0086731435   6.0709471e-12  0              5.8628862e-07  1.1965779e-13  0              2.994443     
   2100000   8640           200            200            0.0028437652  -0.00014184551  0              0.0086731411   1.6429369e-11  0              1.5866309e-06  1.1965779e-13  0              2.994443     
   2200000   8640           200            200            0.002843765   -0.00014184551  0              0.0086731406   9.5026496e-13  0              9.1769788e-08  1.1965779e-13  0              2.994443     
   2300000   8640           200            200            0.0028437651  -0.00014184551  0              0.0086731408   5.3926332e-14  0              5.2078191e-09  1.1965779e-13  0              2.994443     
   2400000   8640           200            200            0.0028437651  -0.00014184551  0              0.0086731409   4.2662745e-14  0              4.1200625e-09  1.1965779e-13  0              2.994443     
   2500000   8640           200            200            0.0028437651  -0.00014184551  0              0.0086731409   1.2799093e-15  0              1.2360448e-10  1.1965779e-13  0              2.994443     
   2600000   8640           200            200            0.0028437651  -0.00014184551  0              0.0086731409   2.2914519e-16  0              2.2129202e-11  1.1965779e-13  0              2.994443     
   2700000   8640           200            200            0.0028437651  -0.00014184551  0              0.0086731409   9.6772473e-17  0              9.3455928e-12  1.1965779e-13  0              2.994443     
   2800000   8640           200            200            0.0028437651  -0.00014184551  0              0.0086731409   9.5472248e-21  0              9.2200263e-16  1.1965779e-13  0              2.994443     
   2900000   8640           200            200            0.0028437651  -0.00014184551  0              0.0086731409   1.9476289e-18  0              1.8808806e-13  1.1965779e-13  0              2.994443     
   3000000   8640           200            200            0.0028437651  -0.00014184551  0              0.0086731409   2.3359215e-18  0              2.2558658e-13  1.1965779e-13  0              2.994443     
Loop time of 296.362 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8746060.838 ns/day, 0.000 hours/ns, 10122.756 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.307     | 36.05      | 61.909     | 408.8 | 12.16
Neigh   | 5.3764     | 5.4822     | 5.5932     |   4.2 |  1.85
Comm    | 20.457     | 40.04      | 77.955     | 352.4 | 13.51
Output  | 0.27144    | 0.27175    | 0.27208    |   0.1 |  0.09
Modify  | 109.69     | 157.87     | 178.45     | 224.0 | 53.27
Other   |            | 56.65      |            |       | 19.11

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         317.25 ave         635 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1269
Ave neighs/atom = 0.50739704
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 77

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.77                                                               
Lattice spacing in x,y,z = 5.77 5.77 5.77

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4327.5 ${n1e1} -100 100 -100 100 units box
region box block -4327.5 4327.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4327.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4327.5 4327.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4327.5 -100 -100) to (4327.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4327.5 -100 -100) to (4327.5 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4327.5 -100 -100) to (4327.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_77_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5584 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 110.3 | 110.3 | 110.3 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8655           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8655           200            200            0.0023343003   4.6666356e-35  0              0.0070029008   579499.06      0              5.5963872e+10  1.1965779e-13  0              3.3308818    
    200000   8655           200            200            0.00079650508  8.2054634e-43  0              0.0023895152   133097.77      0              1.285363e+10   1.1965779e-13  0              3.081784     
    300000   8655           200            200            3.4217377e-06 -9.3332231e-36  0              1.0265213e-05  5.6249186      0              543214.38      1.1965779e-13  0              3.0444248    
    400000   8655           200            200            2.4258006e-05 -9.333222e-35   0              7.2774017e-05  271.40325      0              26210183       1.1965779e-13  0              3.0056078    
    500000   8655           200            200            0.0022776378  -0.0034335861   0              0.010266499    1435.1927      0              1.3860064e+08  1.1965779e-13  0              2.9938641    
    600000   8655           200            200            0.0019683997  -0.0047638433   0              0.010669042    131.07165      0              12657962       1.1965779e-13  0              2.9937133    
    700000   8655           200            200            0.0013576165  -0.0055175746   0              0.0095904242   10.857721      0              1048561        1.1965779e-13  0              2.9940086    
    800000   8655           200            200            0.00075319005 -0.0060468743   0              0.0083064445   1.3064467      0              126167.27      1.1965779e-13  0              2.9944096    
    900000   8655           200            200            0.00086397093 -0.0060086761   0              0.0086005889   0.41571116     0              40146.408      1.1965779e-13  0              2.9943184    
   1000000   8655           200            200            0.00090704712 -0.0059960227   0              0.0087171641   0.00030889763  0              29.831122      1.1965779e-13  0              2.9942809    
   1100000   8655           200            200            0.00088433432 -0.0059995125   0              0.0086525154   0.0082453901   0              796.28076      1.1965779e-13  0              2.994301     
   1200000   8655           200            200            0.00088372056 -0.0059996393   0              0.008650801    0.00029824484  0              28.802352      1.1965779e-13  0              2.9943017    
   1300000   8655           200            200            0.00088692251 -0.0059991157   0              0.0086598833   7.247325e-05   0              6.9989478      1.1965779e-13  0              2.9942989    
   1400000   8655           200            200            0.00088631321 -0.0059992113   0              0.0086581509   1.7398201e-05  0              1.6801937      1.1965779e-13  0              2.9942994    
   1500000   8655           200            200            0.00088601323 -0.0059992609   0              0.0086573006   6.0485452e-08  0              0.005841252    1.1965779e-13  0              2.9942997    
   1600000   8655           200            200            0.00088616031 -0.0059992372   0              0.0086577182   3.7921055e-07  0              0.036621441    1.1965779e-13  0              2.9942995    
   1700000   8655           200            200            0.00088616896 -0.0059992357   0              0.0086577425   1.0006843e-08  0              0.00096638923  1.1965779e-13  0              2.9942995    
   1800000   8655           200            200            0.00088614725 -0.0059992392   0              0.0086576809   3.7725016e-09  0              0.0003643212   1.1965779e-13  0              2.9942995    
   1900000   8655           200            200            0.00088615078 -0.0059992386   0              0.008657691    7.1710757e-10  0              6.9253116e-05  1.1965779e-13  0              2.9942995    
   2000000   8655           200            200            0.00088615294 -0.0059992383   0              0.0086576971   6.2095124e-12  0              5.9967027e-07  1.1965779e-13  0              2.9942995    
   2100000   8655           200            200            0.000886152   -0.0059992384   0              0.0086576944   1.7230981e-11  0              1.6640448e-06  1.1965779e-13  0              2.9942995    
   2200000   8655           200            200            0.00088615191 -0.0059992385   0              0.0086576942   3.1519307e-13  0              3.043909e-08   1.1965779e-13  0              2.9942995    
   2300000   8655           200            200            0.00088615206 -0.0059992384   0              0.0086576946   1.9238012e-13  0              1.8578695e-08  1.1965779e-13  0              2.9942995    
   2400000   8655           200            200            0.00088615204 -0.0059992384   0              0.0086576945   2.9054774e-14  0              2.8059022e-09  1.1965779e-13  0              2.9942995    
   2500000   8655           200            200            0.00088615202 -0.0059992384   0              0.0086576945   4.9782351e-16  0              4.8076231e-11  1.1965779e-13  0              2.9942995    
   2600000   8655           200            200            0.00088615203 -0.0059992384   0              0.0086576945   7.7310737e-16  0              7.4661176e-11  1.1965779e-13  0              2.9942995    
   2700000   8655           200            200            0.00088615203 -0.0059992384   0              0.0086576945   1.0357194e-17  0              1.0002237e-12  1.1965779e-13  0              2.9942995    
   2800000   8655           200            200            0.00088615203 -0.0059992384   0              0.0086576945   4.4533933e-18  0              4.3007685e-13  1.1965779e-13  0              2.9942995    
   2900000   8655           200            200            0.00088615203 -0.0059992384   0              0.0086576945   1.9925669e-18  0              1.9242785e-13  1.1965779e-13  0              2.9942995    
   3000000   8655           200            200            0.00088615203 -0.0059992384   0              0.0086576945   9.696261e-19   0              9.3639549e-14  1.1965779e-13  0              2.9942995    
Loop time of 299.202 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8663043.120 ns/day, 0.000 hours/ns, 10026.670 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.248     | 36.637     | 63.701     | 419.2 | 12.25
Neigh   | 5.3985     | 5.5001     | 5.6052     |   3.9 |  1.84
Comm    | 20.692     | 41.193     | 80.512     | 360.8 | 13.77
Output  | 0.29039    | 0.2907     | 0.29104    |   0.1 |  0.10
Modify  | 109.48     | 158.53     | 178.12     | 226.4 | 52.99
Other   |            | 57.05      |            |       | 19.07

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         317.75 ave         636 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1271
Ave neighs/atom = 0.50819672
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 78

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.78                                                               
Lattice spacing in x,y,z = 5.78 5.78 5.78

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4335 ${n1e1} -100 100 -100 100 units box
region box block -4335 4335 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4335 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4335 4335 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4335 -100 -100) to (4335 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4335 -100 -100) to (4335 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4335 -100 -100) to (4335 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_78_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5594 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 110.4 | 110.4 | 110.5 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8670           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8670           200            200            0.0023305031   9.317131e-36   0              0.0069915092   579577.98      0              5.5971493e+10  1.1965779e-13  0              3.3309006    
    200000   8670           200            200            0.00079545069  7.4537044e-35  0              0.0023863521   133176.46      0              1.2861229e+10  1.1965779e-13  0              3.0818583    
    300000   8670           200            200            4.7271652e-06 -3.7267408e-35  0              1.4181496e-05  10.646471      0              1028160        1.1965779e-13  0              3.0445502    
    400000   8670           200            200            2.1492241e-05  5.5903138e-35  0              6.4476722e-05  214.90444      0              20753933       1.1965779e-13  0              3.0057778    
    500000   8670           200            200            0.0017336005   0.00010287648  0              0.0050979249   1168.2102      0              1.1281738e+08  1.1965779e-13  0              2.9958096    
    600000   8670           200            200            0.0020713224   0.00042965861  0              0.0057843087   20.791828      0              2007925.9      1.1965779e-13  0              2.9954715    
    700000   8670           200            200            0.0025925735   0.00013936926  0              0.0076383514   6.1184596      0              590877.04      1.1965779e-13  0              2.9947843    
    800000   8670           200            200            0.0028001255   2.7998958e-05  0              0.0083723776   2.1190172      0              204639.51      1.1965779e-13  0              2.9945325    
    900000   8670           200            200            0.0028807826   2.2403149e-05  0              0.0086199448   0.46580021     0              44983.65       1.1965779e-13  0              2.9944506    
   1000000   8670           200            200            0.0028961313   2.2110614e-05  0              0.0086662833   0.054652978    0              5277.9935      1.1965779e-13  0              2.994435     
   1100000   8670           200            200            0.002894339    2.2250747e-05  0              0.0086607662   0.0029233775   0              282.31888      1.1965779e-13  0              2.9944365    
   1200000   8670           200            200            0.0028911841   2.2533424e-05  0              0.0086510188   5.0436109e-06  0              0.48707584     1.1965779e-13  0              2.9944396    
   1300000   8670           200            200            0.0028894564   2.2690992e-05  0              0.0086456782   3.4671807e-05  0              3.3483549      1.1965779e-13  0              2.9944413    
   1400000   8670           200            200            0.0028888027   2.2751294e-05  0              0.0086436567   1.5853402e-05  0              1.5310081      1.1965779e-13  0              2.9944419    
   1500000   8670           200            200            0.0028886272   2.2767717e-05  0              0.008643114    2.8675955e-06  0              0.27693185     1.1965779e-13  0              2.9944421    
   1600000   8670           200            200            0.0028886058   2.2769845e-05  0              0.0086430476   2.713629e-07   0              0.026206286    1.1965779e-13  0              2.9944421    
   1700000   8670           200            200            0.0028886161   2.2768959e-05  0              0.0086430793   9.4171162e-09  0              0.00090943768  1.1965779e-13  0              2.9944421    
   1800000   8670           200            200            0.0028886254   2.2768118e-05  0              0.0086431081   9.2900454e-11  0              8.9716609e-06  1.1965779e-13  0              2.9944421    
   1900000   8670           200            200            0.0028886298   2.2767712e-05  0              0.0086431218   3.6526486e-10  0              3.5274665e-05  1.1965779e-13  0              2.9944421    
   2000000   8670           200            200            0.0028886313   2.2767572e-05  0              0.0086431264   1.1321608e-10  0              1.0933599e-05  1.1965779e-13  0              2.9944421    
   2100000   8670           200            200            0.0028886317   2.2767539e-05  0              0.0086431275   1.6564143e-11  0              1.5996464e-06  1.1965779e-13  0              2.9944421    
   2200000   8670           200            200            0.0028886317   2.2767538e-05  0              0.0086431276   1.2263599e-12  0              1.1843306e-07  1.1965779e-13  0              2.9944421    
   2300000   8670           200            200            0.0028886317   2.2767541e-05  0              0.0086431274   2.0541368e-14  0              1.9837383e-09  1.1965779e-13  0              2.9944421    
   2400000   8670           200            200            0.0028886316   2.2767543e-05  0              0.0086431274   3.613114e-15   0              3.4892869e-10  1.1965779e-13  0              2.9944421    
   2500000   8670           200            200            0.0028886316   2.2767545e-05  0              0.0086431273   3.3300769e-15  0              3.2159499e-10  1.1965779e-13  0              2.9944421    
   2600000   8670           200            200            0.0028886316   2.2767545e-05  0              0.0086431273   7.4521444e-16  0              7.1967476e-11  1.1965779e-13  0              2.9944421    
   2700000   8670           200            200            0.0028886316   2.2767545e-05  0              0.0086431273   7.8251524e-17  0              7.5569721e-12  1.1965779e-13  0              2.9944421    
   2800000   8670           200            200            0.0028886316   2.2767545e-05  0              0.0086431273   8.718838e-19   0              8.4200297e-14  1.1965779e-13  0              2.9944421    
   2900000   8670           200            200            0.0028886316   2.2767545e-05  0              0.0086431273   2.1599095e-20  0              2.085886e-15   1.1965779e-13  0              2.9944421    
   3000000   8670           200            200            0.0028886316   2.2767545e-05  0              0.0086431273   7.5422508e-18  0              7.283766e-13   1.1965779e-13  0              2.9944421    
Loop time of 297.811 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8703507.813 ns/day, 0.000 hours/ns, 10073.504 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.128     | 36.189     | 62.073     | 415.1 | 12.15
Neigh   | 5.4217     | 5.5251     | 5.6336     |   4.1 |  1.86
Comm    | 20.928     | 39.885     | 77.763     | 351.7 | 13.39
Output  | 0.2748     | 0.2751     | 0.27542    |   0.1 |  0.09
Modify  | 111.5      | 159.53     | 179.84     | 222.0 | 53.57
Other   |            | 56.4       |            |       | 18.94

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         318.75 ave         638 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1275
Ave neighs/atom = 0.50979608
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 79

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.79                                                               
Lattice spacing in x,y,z = 5.79 5.79 5.79

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4342.5 ${n1e1} -100 100 -100 100 units box
region box block -4342.5 4342.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4342.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4342.5 4342.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4342.5 -100 -100) to (4342.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4342.5 -100 -100) to (4342.5 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4342.5 -100 -100) to (4342.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_79_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5604 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 110.6 | 110.6 | 110.6 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8685           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8685           200            200            0.0023269935   8.8740148e-42  0              0.0069809805   579776.57      0              5.5990672e+10  1.1965779e-13  0              3.3306986    
    200000   8685           200            200            0.00079526523 -1.1626272e-36  0              0.0023857957   133491.62      0              1.2891665e+10  1.1965779e-13  0              3.0815534    
    300000   8685           200            200            6.8458257e-06 -4.6504799e-36  0              2.0537477e-05  22.151314      0              2139215.4      1.1965779e-13  0              3.044572     
    400000   8685           200            200            2.6293715e-05 -3.7203183e-35  0              7.8881145e-05  319.76817      0              30880921       1.1965779e-13  0              3.005673     
    500000   8685           200            200            0.001833065    0.00012407844  0              0.0053751165   1211.9245      0              1.17039e+08    1.1965779e-13  0              2.9956737    
    600000   8685           200            200            0.0018842593  -5.6085012e-05  0              0.0057088629   9.9755047      0              963362.84      1.1965779e-13  0              2.995479     
    700000   8685           200            200            0.0025163994   3.4804161e-05  0              0.0075143942   1.0990332      0              106136.76      1.1965779e-13  0              2.9947963    
    800000   8685           200            200            0.002744145   -1.7827562e-05  0              0.0082502627   0.7689055      0              74255.39       1.1965779e-13  0              2.9945394    
    900000   8685           200            200            0.0028362259  -3.0112283e-05  0              0.0085387901   0.32138207     0              31036.78       1.1965779e-13  0              2.9944435    
   1000000   8685           200            200            0.0028627     -3.4667845e-05  0              0.0086227679   0.063445113    0              6127.0749      1.1965779e-13  0              2.9944158    
   1100000   8685           200            200            0.002867295   -3.4929179e-05  0              0.0086368141   0.0072845836   0              703.49295      1.1965779e-13  0              2.994411     
   1200000   8685           200            200            0.0028665079  -3.4892197e-05  0              0.0086344159   0.0004313266   0              41.654436      1.1965779e-13  0              2.9944117    
   1300000   8685           200            200            0.0028653836  -3.4833345e-05  0              0.0086309843   3.2807367e-06  0              0.31683007     1.1965779e-13  0              2.9944128    
   1400000   8685           200            200            0.0028647689  -3.4800483e-05  0              0.0086291072   2.6868357e-06  0              0.25947536     1.1965779e-13  0              2.9944134    
   1500000   8685           200            200            0.0028645262  -3.4787345e-05  0              0.0086283659   1.6793354e-06  0              0.16217819     1.1965779e-13  0              2.9944136    
   1600000   8685           200            200            0.0028644534  -3.4783356e-05  0              0.0086281435   3.7243099e-07  0              0.035966719    1.1965779e-13  0              2.9944137    
   1700000   8685           200            200            0.0028644394  -3.478257e-05   0              0.0086281008   4.696574e-08   0              0.004535615    1.1965779e-13  0              2.9944137    
   1800000   8685           200            200            0.0028644403  -3.4782603e-05  0              0.0086281034   3.2164388e-09  0              0.00031062064  1.1965779e-13  0              2.9944137    
   1900000   8685           200            200            0.0028644427  -3.4782731e-05  0              0.0086281109   5.1145269e-11  0              4.939244e-06   1.1965779e-13  0              2.9944137    
   2000000   8685           200            200            0.0028644442  -3.4782808e-05  0              0.0086281153   9.3764417e-12  0              9.0550962e-07  1.1965779e-13  0              2.9944137    
   2100000   8685           200            200            0.0028644448  -3.4782841e-05  0              0.0086281171   8.5817039e-12  0              8.2875954e-07  1.1965779e-13  0              2.9944137    
   2200000   8685           200            200            0.002864445   -3.4782851e-05  0              0.0086281177   2.1501489e-12  0              2.0764599e-07  1.1965779e-13  0              2.9944137    
   2300000   8685           200            200            0.002864445   -3.4782854e-05  0              0.0086281178   2.977867e-13   0              2.8758108e-08  1.1965779e-13  0              2.9944137    
   2400000   8685           200            200            0.002864445   -3.4782854e-05  0              0.0086281178   2.3254969e-14  0              2.2457985e-09  1.1965779e-13  0              2.9944137    
   2500000   8685           200            200            0.002864445   -3.4782853e-05  0              0.0086281178   6.206171e-16   0              5.9934757e-11  1.1965779e-13  0              2.9944137    
   2600000   8685           200            200            0.002864445   -3.4782853e-05  0              0.0086281178   1.6716154e-17  0              1.6143265e-12  1.1965779e-13  0              2.9944137    
   2700000   8685           200            200            0.002864445   -3.4782853e-05  0              0.0086281178   4.7918603e-17  0              4.6276357e-12  1.1965779e-13  0              2.9944137    
   2800000   8685           200            200            0.002864445   -3.4782853e-05  0              0.0086281178   1.3546578e-17  0              1.3082316e-12  1.1965779e-13  0              2.9944137    
   2900000   8685           200            200            0.002864445   -3.4782853e-05  0              0.0086281178   6.115798e-18   0              5.9062e-13     1.1965779e-13  0              2.9944137    
   3000000   8685           200            200            0.002864445   -3.4782853e-05  0              0.0086281178   6.836773e-21   0              6.602466e-16   1.1965779e-13  0              2.9944137    
Loop time of 299.731 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8647744.128 ns/day, 0.000 hours/ns, 10008.963 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.25      | 36.564     | 62.962     | 418.1 | 12.20
Neigh   | 5.432      | 5.5369     | 5.6468     |   4.1 |  1.85
Comm    | 20.849     | 40.511     | 79.204     | 357.0 | 13.52
Output  | 0.27906    | 0.27938    | 0.27974    |   0.1 |  0.09
Modify  | 111.45     | 160.29     | 179.71     | 224.5 | 53.48
Other   |            | 56.55      |            |       | 18.87

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         319.25 ave         639 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1277
Ave neighs/atom = 0.51059576
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 80

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.8                                                               
Lattice spacing in x,y,z = 5.8 5.8 5.8

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4350 ${n1e1} -100 100 -100 100 units box
region box block -4350 4350 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4350 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4350 4350 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4350 -100 -100) to (4350 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4350 -100 -100) to (4350 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4350 -100 -100) to (4350 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_80_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5613 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 110.8 | 110.8 | 110.8 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8700           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8700           200            200            0.0023229572   6.9637456e-36  0              0.0069688717   579776.32      0              5.5990647e+10  1.1965779e-13  0              3.3306341    
    200000   8700           200            200            0.00079220392 -3.7139389e-35  0              0.0023766117   133040.23      0              1.2848073e+10  1.1965779e-13  0              3.0820428    
    300000   8700           200            200            8.9569663e-06  1.8570231e-35  0              2.6870899e-05  37.757156      0              3646315.9      1.1965779e-13  0              3.0445402    
    400000   8700           200            200            3.7968209e-05 -1.856973e-35   0              0.00011390463  655.1279       0              63267563       1.1965779e-13  0              3.0052264    
    500000   8700           200            200            0.002612457    9.488519e-41   0              0.0078373709   1293.4455      0              1.2491171e+08  1.1965779e-13  0              2.9944106    
    600000   8700           200            200            0.0031529958  -1.8569837e-35  0              0.0094589873   150.13297      0              14498767       1.1965779e-13  0              2.9937183    
    700000   8700           200            200            0.0026375626   1.5130516e-40  0              0.0079126878   9.4227215      0              909979         1.1965779e-13  0              2.9944504    
    800000   8700           200            200            0.0029835185  -2.7854842e-35  0              0.0089505554   0.075887036    0              7328.6267      1.1965779e-13  0              2.9939672    
    900000   8700           200            200            0.0028318752  -4.6423845e-36  0              0.0084956257   0.058143323    0              5615.066       1.1965779e-13  0              2.9941737    
   1000000   8700           200            200            0.0028802228  -7.4279737e-35  0              0.0086406683   0.035815832    0              3458.8366      1.1965779e-13  0              2.9941084    
   1100000   8700           200            200            0.0028701143  -2.3211084e-36  0              0.008610343    0.0075204958   0              726.27565      1.1965779e-13  0              2.9941217    
   1200000   8700           200            200            0.0028699588   1.1607615e-36  0              0.0086098764   0.0008505957   0              82.144444      1.1965779e-13  0              2.9941221    
   1300000   8700           200            200            0.0028714227   1.1607613e-36  0              0.0086142681   4.4760158e-05  0              4.3226157      1.1965779e-13  0              2.99412      
   1400000   8700           200            200            0.0028705204   4.6426306e-36  0              0.0086115612   7.9833318e-08  0              0.0077097304   1.1965779e-13  0              2.9941213    
   1500000   8700           200            200            0.002870892   -9.2848447e-36  0              0.0086126759   5.2569601e-07  0              0.050767958    1.1965779e-13  0              2.9941208    
   1600000   8700           200            200            0.0028707794   1.3895308e-40  0              0.0086123382   2.4556492e-07  0              0.023714903    1.1965779e-13  0              2.9941209    
   1700000   8700           200            200            0.0028708002   1.8570106e-35  0              0.0086124007   4.6105208e-08  0              0.0044525109   1.1965779e-13  0              2.9941209    
   1800000   8700           200            200            0.0028708023  -3.7139795e-35  0              0.0086124069   4.6990021e-09  0              0.00045379599  1.1965779e-13  0              2.9941209    
   1900000   8700           200            200            0.0028707982  -2.599794e-34   0              0.0086123946   2.0314765e-10  0              1.9618546e-05  1.1965779e-13  0              2.9941209    
   2000000   8700           200            200            0.0028708005  -1.8569828e-35  0              0.0086124015   6.9651608e-14  0              6.7264538e-09  1.1965779e-13  0              2.9941209    
   2100000   8700           200            200            0.0028707996   1.8570106e-35  0              0.0086123988   4.3703582e-12  0              4.2205792e-07  1.1965779e-13  0              2.9941209    
   2200000   8700           200            200            0.0028707999  -3.7139796e-35  0              0.0086123996   1.6463331e-12  0              1.5899107e-07  1.1965779e-13  0              2.9941209    
   2300000   8700           200            200            0.0028707998   1.8570106e-35  0              0.0086123994   2.7802789e-13  0              2.6849943e-08  1.1965779e-13  0              2.9941209    
   2400000   8700           200            200            0.0028707998   3.7140073e-35  0              0.0086123994   2.5508056e-14  0              2.4633855e-09  1.1965779e-13  0              2.9941209    
   2500000   8700           200            200            0.0028707998  -3.7139795e-35  0              0.0086123995   8.6064991e-16  0              8.3115408e-11  1.1965779e-13  0              2.9941209    
   2600000   8700           200            200            0.0028707998   3.7140073e-35  0              0.0086123994   3.3446603e-18  0              3.2300335e-13  1.1965779e-13  0              2.9941209    
   2700000   8700           200            200            0.0028707998  -1.485596e-34   0              0.0086123994   1.0321607e-17  0              9.9678693e-13  1.1965779e-13  0              2.9941209    
   2800000   8700           200            200            0.0028707998   3.7140072e-35  0              0.0086123994   6.9527569e-18  0              6.714475e-13   1.1965779e-13  0              2.9941209    
   2900000   8700           200            200            0.0028707998  -7.4279727e-35  0              0.0086123994   2.2100025e-18  0              2.1342622e-13  1.1965779e-13  0              2.9941209    
   3000000   8700           200            200            0.0028707998   4.828193e-34   0              0.0086123994   2.1029817e-19  0              2.0309092e-14  1.1965779e-13  0              2.9941209    
Loop time of 292.408 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8864321.232 ns/day, 0.000 hours/ns, 10259.631 timesteps/s
99.9% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.943     | 34.654     | 59.343     | 399.2 | 11.85
Neigh   | 5.4141     | 5.5238     | 5.6378     |   4.3 |  1.89
Comm    | 20.917     | 39.37      | 75.134     | 335.2 | 13.46
Output  | 0.30912    | 0.30944    | 0.30977    |   0.1 |  0.11
Modify  | 108.91     | 156.42     | 176.74     | 223.0 | 53.49
Other   |            | 56.13      |            |       | 19.20

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         311.25 ave         623 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1245
Ave neighs/atom = 0.49780088
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 81

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.81                                                               
Lattice spacing in x,y,z = 5.81 5.81 5.81

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4357.5 ${n1e1} -100 100 -100 100 units box
region box block -4357.5 4357.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4357.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4357.5 4357.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4357.5 -100 -100) to (4357.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4357.5 -100 -100) to (4357.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4357.5 -100 -100) to (4357.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_81_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5623 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 111 | 111 | 111 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8715           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8715           200            200            0.0023184197   4.634535e-36   0              0.006955259    579565.13      0              5.5970252e+10  1.1965779e-13  0              3.3308681    
    200000   8715           200            200            0.00079128563 -1.8537635e-35  0              0.0023738569   133163.91      0              1.2860017e+10  1.1965779e-13  0              3.0818097    
    300000   8715           200            200            4.7211285e-06  7.5505923e-41  0              1.4163385e-05  10.728849      0              1036115.4      1.1965779e-13  0              3.0444914    
    400000   8715           200            200            2.1511983e-05 -7.4150258e-35  0              6.4535949e-05  217.4914       0              21003763       1.1965779e-13  0              3.0057187    
    500000   8715           200            200            0.0013512072  -0.00036908028  0              0.0044227018   1030.297       0              99498708       1.1965779e-13  0              2.9960431    
    600000   8715           200            200            0.0016453812  -0.00066688884  0              0.0056030323   0.08824038     0              8521.6243      1.1965779e-13  0              2.9954689    
    700000   8715           200            200            0.002584958    0.00029189953  0              0.0074629745   0.46243435     0              44658.6        1.1965779e-13  0              2.994769     
    800000   8715           200            200            0.00292412     0.00054663685  0              0.0082257233   0.82967487     0              80124.061      1.1965779e-13  0              2.9945079    
    900000   8715           200            200            0.0030176606   0.00054391408  0              0.0085090676   0.31978952     0              30882.983      1.1965779e-13  0              2.994414     
   1000000   8715           200            200            0.0030438283   0.00054094432  0              0.0085905404   0.06278253     0              6063.0874      1.1965779e-13  0              2.994387     
   1100000   8715           200            200            0.0030490685   0.00054191238  0              0.0086052931   0.0077776195   0              751.10682      1.1965779e-13  0              2.9943819    
   1200000   8715           200            200            0.0030485983   0.00054184569  0              0.0086039491   0.00057952288  0              55.966172      1.1965779e-13  0              2.9943823    
   1300000   8715           200            200            0.0030475833   0.00054167118  0              0.0086010787   1.5237742e-05  0              1.4715521      1.1965779e-13  0              2.9943832    
   1400000   8715           200            200            0.0030469809   0.00054156578  0              0.0085993769   4.693851e-07   0              0.045329854    1.1965779e-13  0              2.9943837    
   1500000   8715           200            200            0.0030467224   0.00054152015  0              0.0085986472   9.5293737e-07  0              0.09202787     1.1965779e-13  0              2.994384     
   1600000   8715           200            200            0.0030466341   0.00054150441  0              0.0085983978   3.0060346e-07  0              0.02903013     1.1965779e-13  0              2.9943841    
   1700000   8715           200            200            0.0030466109   0.00054150024  0              0.0085983326   5.2058856e-08  0              0.0050274717   1.1965779e-13  0              2.9943841    
   1800000   8715           200            200            0.0030466077   0.00054149962  0              0.0085983234   5.7444426e-09  0              0.00055475715  1.1965779e-13  0              2.9943841    
   1900000   8715           200            200            0.0030466086   0.00054149978  0              0.0085983262   3.5972939e-10  0              3.474009e-05   1.1965779e-13  0              2.9943841    
   2000000   8715           200            200            0.0030466097   0.00054149997  0              0.0085983292   4.9455712e-12  0              4.7760787e-07  1.1965779e-13  0              2.9943841    
   2100000   8715           200            200            0.0030466103   0.00054150007  0              0.0085983309   1.2077989e-12  0              1.1664057e-07  1.1965779e-13  0              2.9943841    
   2200000   8715           200            200            0.0030466105   0.00054150011  0              0.0085983315   1.042508e-12   0              1.0067796e-07  1.1965779e-13  0              2.9943841    
   2300000   8715           200            200            0.0030466106   0.00054150012  0              0.0085983317   2.7272344e-13  0              2.6337678e-08  1.1965779e-13  0              2.9943841    
   2400000   8715           200            200            0.0030466106   0.00054150013  0              0.0085983318   4.1986531e-14  0              4.0547586e-09  1.1965779e-13  0              2.9943841    
   2500000   8715           200            200            0.0030466106   0.00054150013  0              0.0085983318   4.1007344e-15  0              3.9601958e-10  1.1965779e-13  0              2.9943841    
   2600000   8715           200            200            0.0030466106   0.00054150013  0              0.0085983318   2.0363968e-16  0              1.9666062e-11  1.1965779e-13  0              2.9943841    
   2700000   8715           200            200            0.0030466106   0.00054150013  0              0.0085983318   2.5679599e-19  0              2.4799518e-14  1.1965779e-13  0              2.9943841    
   2800000   8715           200            200            0.0030466106   0.00054150013  0              0.0085983318   4.1827847e-18  0              4.0394341e-13  1.1965779e-13  0              2.9943841    
   2900000   8715           200            200            0.0030466106   0.00054150013  0              0.0085983318   1.7573594e-18  0              1.6971319e-13  1.1965779e-13  0              2.9943841    
   3000000   8715           200            200            0.0030466106   0.00054150013  0              0.0085983318   3.4130371e-18  0              3.2960669e-13  1.1965779e-13  0              2.9943841    
Loop time of 294.506 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8801175.245 ns/day, 0.000 hours/ns, 10186.545 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.931     | 36.107     | 61.992     | 416.0 | 12.26
Neigh   | 5.4258     | 5.5302     | 5.6373     |   4.1 |  1.88
Comm    | 20.899     | 39.831     | 77.671     | 351.6 | 13.52
Output  | 0.27368    | 0.27397    | 0.2743     |   0.1 |  0.09
Modify  | 108.9      | 156.74     | 176.61     | 222.7 | 53.22
Other   |            | 56.02      |            |       | 19.02

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         318.25 ave         637 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1273
Ave neighs/atom = 0.5089964
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 82

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.82                                                               
Lattice spacing in x,y,z = 5.82 5.82 5.82

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4365 ${n1e1} -100 100 -100 100 units box
region box block -4365 4365 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4365 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4365 4365 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4365 -100 -100) to (4365 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4365 -100 -100) to (4365 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4365 -100 -100) to (4365 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_82_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5633 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 111.2 | 111.2 | 111.2 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8730           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8730           200            200            0.0023141031   1.6808018e-42  0              0.0069423094   579440.21      0              5.5958188e+10  1.1965779e-13  0              3.3309665    
    200000   8730           200            200            0.00078917233  1.3177935e-40  0              0.002367517    132964.76      0              1.2840784e+10  1.1965779e-13  0              3.0819667    
    300000   8730           200            200            3.6200075e-06  8.4590914e-41  0              1.0860022e-05  6.3889903      0              617002.95      1.1965779e-13  0              3.0444411    
    400000   8730           200            200            1.9427742e-05 -7.4023883e-35  0              5.8283225e-05  178.74323      0              17261742       1.1965779e-13  0              3.0057211    
    500000   8730           200            200            0.0013263374   0.00020763167  0              0.0037713806   849.71545      0              82059436       1.1965779e-13  0              2.996346     
    600000   8730           200            200            0.0019430084  -0.00016514052  0              0.0059941658   44.633316      0              4310366.2      1.1965779e-13  0              2.9952833    
    700000   8730           200            200            0.0025653596  -0.00040058818  0              0.0080966669   21.822722      0              2107482.3      1.1965779e-13  0              2.9944792    
    800000   8730           200            200            0.0026526595  -0.00040958303  0              0.0083675615   2.6691673      0              257769.08      1.1965779e-13  0              2.994392     
    900000   8730           200            200            0.0026834722  -0.00041276105  0              0.0084631776   0.20063831     0              19376.211      1.1965779e-13  0              2.994362     
   1000000   8730           200            200            0.0027046992  -0.00041442529  0              0.008528523    0.0066186019   0              639.1772       1.1965779e-13  0              2.994341     
   1100000   8730           200            200            0.0027156515  -0.00041523853  0              0.0085621931   2.9414128e-05  0              2.8406059      1.1965779e-13  0              2.9943301    
   1200000   8730           200            200            0.0027202649  -0.00041558019  0              0.0085763748   0.00021592203  0              20.852204      1.1965779e-13  0              2.9943255    
   1300000   8730           200            200            0.0027219244  -0.00041570348  0              0.0085814767   8.5804776e-05  0              8.2864111      1.1965779e-13  0              2.9943238    
   1400000   8730           200            200            0.0027224303  -0.00041574136  0              0.0085830324   1.8636992e-05  0              1.7998273      1.1965779e-13  0              2.9943233    
   1500000   8730           200            200            0.0027225505  -0.00041575051  0              0.0085834019   2.8432995e-06  0              0.27458551     1.1965779e-13  0              2.9943232    
   1600000   8730           200            200            0.0027225639  -0.00041575163  0              0.0085834434   3.1848317e-07  0              0.030756825    1.1965779e-13  0              2.9943232    
   1700000   8730           200            200            0.0027225569  -0.00041575115  0              0.0085834217   2.4435435e-08  0              0.0023597994   1.1965779e-13  0              2.9943232    
   1800000   8730           200            200            0.0027225502  -0.00041575067  0              0.0085834014   9.1066146e-10  0              8.7945166e-05  1.1965779e-13  0              2.9943232    
   1900000   8730           200            200            0.0027225467  -0.00041575042  0              0.0085833905   3.1879941e-13  0              3.0787365e-08  1.1965779e-13  0              2.9943232    
   2000000   8730           200            200            0.0027225452  -0.0004157503   0              0.0085833858   1.9842817e-11  0              1.9162772e-06  1.1965779e-13  0              2.9943232    
   2100000   8730           200            200            0.0027225446  -0.00041575026  0              0.0085833841   8.7217618e-12  0              8.4228533e-07  1.1965779e-13  0              2.9943232    
   2200000   8730           200            200            0.0027225444  -0.00041575025  0              0.0085833836   1.9812535e-12  0              1.9133528e-07  1.1965779e-13  0              2.9943232    
   2300000   8730           200            200            0.0027225444  -0.00041575025  0              0.0085833834   3.1212899e-13  0              3.0143184e-08  1.1965779e-13  0              2.9943232    
   2400000   8730           200            200            0.0027225444  -0.00041575025  0              0.0085833834   3.6110965e-14  0              3.4873385e-09  1.1965779e-13  0              2.9943232    
   2500000   8730           200            200            0.0027225444  -0.00041575025  0              0.0085833834   2.8992204e-15  0              2.7998595e-10  1.1965779e-13  0              2.9943232    
   2600000   8730           200            200            0.0027225444  -0.00041575025  0              0.0085833834   1.2044222e-16  0              1.1631448e-11  1.1965779e-13  0              2.9943232    
   2700000   8730           200            200            0.0027225444  -0.00041575025  0              0.0085833834   1.0723965e-18  0              1.0356438e-13  1.1965779e-13  0              2.9943232    
   2800000   8730           200            200            0.0027225444  -0.00041575025  0              0.0085833834   4.6438619e-18  0              4.4847095e-13  1.1965779e-13  0              2.9943232    
   2900000   8730           200            200            0.0027225444  -0.00041575025  0              0.0085833834   3.9336198e-18  0              3.7988085e-13  1.1965779e-13  0              2.9943232    
   3000000   8730           200            200            0.0027225444  -0.00041575025  0              0.0085833834   9.9586535e-19  0              9.6173547e-14  1.1965779e-13  0              2.9943232    
Loop time of 295.066 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8784466.040 ns/day, 0.000 hours/ns, 10167.206 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.856     | 36.383     | 62.347     | 419.5 | 12.33
Neigh   | 5.4142     | 5.5211     | 5.632      |   4.2 |  1.87
Comm    | 20.989     | 40.058     | 78.152     | 353.0 | 13.58
Output  | 0.29133    | 0.29164    | 0.29197    |   0.1 |  0.10
Modify  | 109.04     | 156.9      | 176.4      | 222.3 | 53.17
Other   |            | 55.91      |            |       | 18.95

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         319.75 ave         640 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1279
Ave neighs/atom = 0.51139544
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 83

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.83                                                               
Lattice spacing in x,y,z = 5.83 5.83 5.83

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4372.5 ${n1e1} -100 100 -100 100 units box
region box block -4372.5 4372.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4372.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4372.5 4372.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4372.5 -100 -100) to (4372.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4372.5 -100 -100) to (4372.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4372.5 -100 -100) to (4372.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_83_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5642 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 111.2 | 111.3 | 111.3 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8745           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8745           200            200            0.0023097726   1.8474452e-35  0              0.0069293179   579304.68      0              5.5945099e+10  1.1965779e-13  0              3.3310718    
    200000   8745           200            200            0.00078696208  3.6949797e-35  0              0.0023608863   132737.93      0              1.2818879e+10  1.1965779e-13  0              3.0821501    
    300000   8745           200            200            2.2035731e-06 -3.6948042e-35  0              6.6107192e-06  2.4301239      0              234683.97      1.1965779e-13  0              3.0443839    
    400000   8745           200            200            1.5537217e-05 -2.216913e-34   0              4.6611652e-05  115.67266      0              11170838       1.1965779e-13  0              3.0057459    
    500000   8745           200            200            0.0009242791  -0.0002384236   0              0.0030112609   609.76911      0              58887136       1.1965779e-13  0              2.996705     
    600000   8745           200            200            0.0017750865  -0.00092626571  0              0.0062515253   82.120846      0              7930643.5      1.1965779e-13  0              2.9951413    
    700000   8745           200            200            0.0021406927  -0.001797732    0              0.00821981     23.829387      0              2301271.6      1.1965779e-13  0              2.9944373    
    800000   8745           200            200            0.0023265645  -0.0016128996   0              0.0085925931   3.4920147      0              337233.79      1.1965779e-13  0              2.9943171    
    900000   8745           200            200            0.002329427   -0.0016338904   0              0.0086221713   0.41423496     0              40003.847      1.1965779e-13  0              2.9943091    
   1000000   8745           200            200            0.0023210789  -0.0016392786   0              0.0086025152   0.041002395    0              3959.7178      1.1965779e-13  0              2.9943162    
   1100000   8745           200            200            0.0023157575  -0.0016380359   0              0.0085853085   0.0031651475   0              305.66729      1.1965779e-13  0              2.9943221    
   1200000   8745           200            200            0.0023128284  -0.0016373689   0              0.0085758541   0.00015452689  0              14.923101      1.1965779e-13  0              2.9943253    
   1300000   8745           200            200            0.0023114785  -0.0016370657   0              0.0085715012   1.4215927e-06  0              0.13728725     1.1965779e-13  0              2.9943267    
   1400000   8745           200            200            0.0023109203  -0.0016369414   0              0.0085697021   6.9652549e-07  0              0.067265446    1.1965779e-13  0              2.9943273    
   1500000   8745           200            200            0.0023107081  -0.0016368944   0              0.0085690186   5.6296741e-07  0              0.054367363    1.1965779e-13  0              2.9943276    
   1600000   8745           200            200            0.0023106335  -0.001636878    0              0.0085687785   1.7420662e-07  0              0.016823629    1.1965779e-13  0              2.9943276    
   1700000   8745           200            200            0.0023106094  -0.0016368728   0              0.0085687011   3.7477616e-08  0              0.0036193199   1.1965779e-13  0              2.9943277    
   1800000   8745           200            200            0.0023106025  -0.0016368713   0              0.0085686789   6.4696479e-09  0              0.00062479229  1.1965779e-13  0              2.9943277    
   1900000   8745           200            200            0.0023106009  -0.0016368709   0              0.0085686736   9.4234143e-10  0              9.100459e-05   1.1965779e-13  0              2.9943277    
   2000000   8745           200            200            0.0023106006  -0.0016368709   0              0.0085686728   1.1732733e-10  0              1.1330634e-05  1.1965779e-13  0              2.9943277    
   2100000   8745           200            200            0.0023106007  -0.0016368709   0              0.008568673    1.232106e-11   0              1.1898798e-06  1.1965779e-13  0              2.9943277    
   2200000   8745           200            200            0.0023106008  -0.0016368709   0              0.0085686733   1.0359075e-12  0              1.0004054e-07  1.1965779e-13  0              2.9943277    
   2300000   8745           200            200            0.0023106008  -0.0016368709   0              0.0085686734   6.0430815e-14  0              5.8359756e-09  1.1965779e-13  0              2.9943277    
   2400000   8745           200            200            0.0023106008  -0.0016368709   0              0.0085686735   1.3778566e-15  0              1.3306353e-10  1.1965779e-13  0              2.9943277    
   2500000   8745           200            200            0.0023106009  -0.0016368709   0              0.0085686735   6.9601721e-17  0              6.7216361e-12  1.1965779e-13  0              2.9943277    
   2600000   8745           200            200            0.0023106009  -0.0016368709   0              0.0085686735   1.075762e-16   0              1.0388939e-11  1.1965779e-13  0              2.9943277    
   2700000   8745           200            200            0.0023106009  -0.0016368709   0              0.0085686735   2.5865715e-17  0              2.4979256e-12  1.1965779e-13  0              2.9943277    
   2800000   8745           200            200            0.0023106009  -0.0016368709   0              0.0085686735   2.9108576e-18  0              2.811098e-13   1.1965779e-13  0              2.9943277    
   2900000   8745           200            200            0.0023106009  -0.0016368709   0              0.0085686735   2.7320173e-18  0              2.6383868e-13  1.1965779e-13  0              2.9943277    
   3000000   8745           200            200            0.0023106009  -0.0016368709   0              0.0085686735   5.3823701e-19  0              5.1979078e-14  1.1965779e-13  0              2.9943277    
Loop time of 297.878 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8701554.952 ns/day, 0.000 hours/ns, 10071.244 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.793     | 36.488     | 61.649     | 415.8 | 12.25
Neigh   | 5.4084     | 5.515      | 5.6254     |   4.2 |  1.85
Comm    | 21.627     | 40.002     | 76.523     | 339.0 | 13.43
Output  | 0.27857    | 0.27888    | 0.27922    |   0.1 |  0.09
Modify  | 111.42     | 158.78     | 178.88     | 219.3 | 53.30
Other   |            | 56.81      |            |       | 19.07

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         317.25 ave         635 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1269
Ave neighs/atom = 0.50739704
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 84

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.84                                                               
Lattice spacing in x,y,z = 5.84 5.84 5.84

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4380 ${n1e1} -100 100 -100 100 units box
region box block -4380 4380 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4380 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4380 4380 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4380 -100 -100) to (4380 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4380 -100 -100) to (4380 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4380 -100 -100) to (4380 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_84_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5652 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 111.4 | 111.5 | 111.5 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8760           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8760           200            200            0.0023054033  -2.3053439e-36  0              0.0069162098   579149.19      0              5.5930084e+10  1.1965779e-13  0              3.3311911    
    200000   8760           200            200            0.00078465315 -3.6885209e-35  0              0.0023539594   132483.24      0              1.2794283e+10  1.1965779e-13  0              3.0823521    
    300000   8760           200            200            7.48223e-07    4.6107164e-36  0              2.244669e-06   0.31068233     0              30003.476      1.1965779e-13  0              3.0443151    
    400000   8760           200            200            1.182589e-05  -1.8442274e-35  0              3.547767e-05   67.844435      0              6551929.9      1.1965779e-13  0              3.0057487    
    500000   8760           200            200            0.00064308276 -0.00055064736  0              0.0024798956   391.77374      0              37834703       1.1965779e-13  0              2.996988     
    600000   8760           200            200            0.002779215    0.0011857386   0              0.0071519066   156.33213      0              15097438       1.1965779e-13  0              2.9947686    
    700000   8760           200            200            0.003266383    0.0010720451   0              0.0087271038   25.387014      0              2451696.1      1.1965779e-13  0              2.9942401    
    800000   8760           200            200            0.0032863281   0.0010791091   0              0.0087798753   2.4834359      0              239832.47      1.1965779e-13  0              2.9942277    
    900000   8760           200            200            0.0032514045   0.0010746486   0              0.008679565    0.16207259     0              15651.811      1.1965779e-13  0              2.9942623    
   1000000   8760           200            200            0.0032269172   0.0010715564   0              0.0086091952   0.0040944473   0              395.41241      1.1965779e-13  0              2.9942861    
   1100000   8760           200            200            0.0032149656   0.0010700487   0              0.008574848    0.00010722984  0              10.355491      1.1965779e-13  0              2.9942976    
   1200000   8760           200            200            0.0032100834   0.0010694347   0              0.0085608156   0.00024709454  0              23.862622      1.1965779e-13  0              2.9943022    
   1300000   8760           200            200            0.0032083493   0.0010692177   0              0.0085558302   8.7914554e-05  0              8.4901584      1.1965779e-13  0              2.9943039    
   1400000   8760           200            200            0.0032078192   0.0010691519   0              0.0085543058   1.854054e-05   0              1.7905126      1.1965779e-13  0              2.9943044    
   1500000   8760           200            200            0.0032076898   0.0010691361   0              0.0085539334   2.8437156e-06  0              0.27462569     1.1965779e-13  0              2.9943045    
   1600000   8760           200            200            0.0032076727   0.0010691341   0              0.0085538839   3.305374e-07   0              0.031920937    1.1965779e-13  0              2.9943045    
   1700000   8760           200            200            0.0032076783   0.0010691349   0              0.0085539001   2.774112e-08   0              0.0026790388   1.1965779e-13  0              2.9943045    
   1800000   8760           200            200            0.0032076846   0.0010691357   0              0.0085539179   1.3393894e-09  0              0.00012934864  1.1965779e-13  0              2.9943045    
   1900000   8760           200            200            0.003207688    0.0010691362   0              0.008553928    6.8375655e-12  0              6.6032314e-07  1.1965779e-13  0              2.9943045    
   2000000   8760           200            200            0.0032076896   0.0010691364   0              0.0085539324   9.8889042e-12  0              9.5499958e-07  1.1965779e-13  0              2.9943045    
   2100000   8760           200            200            0.0032076902   0.0010691364   0              0.0085539341   6.2902285e-12  0              6.0746524e-07  1.1965779e-13  0              2.9943045    
   2200000   8760           200            200            0.0032076904   0.0010691365   0              0.0085539347   1.6761421e-12  0              1.618698e-07   1.1965779e-13  0              2.9943045    
   2300000   8760           200            200            0.0032076904   0.0010691365   0              0.0085539349   3.0118463e-13  0              2.9086256e-08  1.1965779e-13  0              2.9943045    
   2400000   8760           200            200            0.0032076905   0.0010691365   0              0.0085539349   4.0712983e-14  0              3.9317685e-09  1.1965779e-13  0              2.9943045    
   2500000   8760           200            200            0.0032076905   0.0010691365   0              0.0085539349   4.2069323e-15  0              4.062754e-10   1.1965779e-13  0              2.9943045    
   2600000   8760           200            200            0.0032076905   0.0010691365   0              0.0085539349   2.6484382e-16  0              2.557672e-11   1.1965779e-13  0              2.9943045    
   2700000   8760           200            200            0.0032076905   0.0010691365   0              0.0085539349   1.326521e-17   0              1.281059e-12   1.1965779e-13  0              2.9943045    
   2800000   8760           200            200            0.0032076905   0.0010691365   0              0.0085539349   3.6745353e-19  0              3.5486032e-14  1.1965779e-13  0              2.9943045    
   2900000   8760           200            200            0.0032076905   0.0010691365   0              0.0085539349   2.2984083e-20  0              2.2196383e-15  1.1965779e-13  0              2.9943045    
   3000000   8760           200            200            0.0032076905   0.0010691365   0              0.0085539349   6.30543e-18    0              6.089333e-13   1.1965779e-13  0              2.9943045    
Loop time of 294.629 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8797512.688 ns/day, 0.000 hours/ns, 10182.306 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.896     | 35.934     | 61.073     | 410.8 | 12.20
Neigh   | 5.4566     | 5.5622     | 5.6713     |   4.1 |  1.89
Comm    | 21.563     | 39.638     | 76.067     | 339.1 | 13.45
Output  | 0.32581    | 0.32613    | 0.32648    |   0.1 |  0.11
Modify  | 109.93     | 157.07     | 177.11     | 219.8 | 53.31
Other   |            | 56.09      |            |       | 19.04

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         315.75 ave         632 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1263
Ave neighs/atom = 0.504998
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 85

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.85                                                               
Lattice spacing in x,y,z = 5.85 5.85 5.85

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4387.5 ${n1e1} -100 100 -100 100 units box
region box block -4387.5 4387.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4387.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4387.5 4387.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4387.5 -100 -100) to (4387.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4387.5 -100 -100) to (4387.5 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4387.5 -100 -100) to (4387.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_85_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5662 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 111.6 | 111.6 | 111.7 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8775           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8775           200            200            0.0023010991   3.3368625e-40  0              0.0069032974   579018.06      0              5.591742e+10   1.1965779e-13  0              3.3312516    
    200000   8775           200            200            0.00078215194 -1.8411211e-35  0              0.0023464558   132175.02      0              1.2764518e+10  1.1965779e-13  0              3.0826096    
    300000   8775           200            200           -1.3568432e-06 -4.6027982e-36  0             -4.0705296e-06  0.81246204     0              78461.768      1.1965779e-13  0              3.0442226    
    400000   8775           200            200            6.9183215e-06  9.2056759e-36  0              2.0754964e-05  23.667475      0              2285635.3      1.1965779e-13  0              3.0057631    
    500000   8775           200            200            0.0017952969  -6.6749502e-05  0              0.0054526402   1315.6226      0              1.2705341e+08  1.1965779e-13  0              2.9952468    
    600000   8775           200            200            0.0025197871  -0.00025551936  0              0.0078148808   196.3985       0              18966761       1.1965779e-13  0              2.9943811    
    700000   8775           200            200            0.0028545934  -0.00024674456  0              0.0088105249   25.41527       0              2454424.8      1.1965779e-13  0              2.9940956    
    800000   8775           200            200            0.0028206486  -0.00024085231  0              0.008702798    3.1259925      0              301885.98      1.1965779e-13  0              2.9941311    
    900000   8775           200            200            0.0027918491  -0.0002400747   0              0.0086156219   0.38176218     0              36867.859      1.1965779e-13  0              2.9941581    
   1000000   8775           200            200            0.0027776004  -0.00023968745  0              0.0085724886   0.045666415    0              4410.1355      1.1965779e-13  0              2.9941713    
   1100000   8775           200            200            0.0027711945  -0.00023951306  0              0.0085530964   0.0053170356   0              513.48124      1.1965779e-13  0              2.9941772    
   1200000   8775           200            200            0.0027684434  -0.00023943828  0              0.0085447683   0.00059935297  0              57.88122       1.1965779e-13  0              2.9941797    
   1300000   8775           200            200            0.0027672973  -0.00023940721  0              0.0085412992   6.496682e-05   0              6.2740305      1.1965779e-13  0              2.9941808    
   1400000   8775           200            200            0.0027668309  -0.0002393946   0              0.0085398872   6.7055307e-06  0              0.64757216     1.1965779e-13  0              2.9941812    
   1500000   8775           200            200            0.0027666445  -0.00023938958  0              0.008539323    6.4901966e-07  0              0.062677673    1.1965779e-13  0              2.9941814    
   1600000   8775           200            200            0.0027665711  -0.0002393876   0              0.0085391011   5.7401942e-08  0              0.0055434687   1.1965779e-13  0              2.9941814    
   1700000   8775           200            200            0.0027665427  -0.00023938684  0              0.008539015    4.4174025e-09  0              0.00042660111  1.1965779e-13  0              2.9941815    
   1800000   8775           200            200            0.0027665318  -0.00023938655  0              0.0085389819   2.6458704e-10  0              2.5551922e-05  1.1965779e-13  0              2.9941815    
   1900000   8775           200            200            0.0027665277  -0.00023938644  0              0.0085389694   8.5586903e-12  0              8.2653704e-07  1.1965779e-13  0              2.9941815    
   2000000   8775           200            200            0.0027665261  -0.0002393864   0              0.0085389648   3.0775838e-15  0              2.9721102e-10  1.1965779e-13  0              2.9941815    
   2100000   8775           200            200            0.0027665255  -0.00023938638  0              0.008538963    1.8928271e-13  0              1.8279569e-08  1.1965779e-13  0              2.9941815    
   2200000   8775           200            200            0.0027665253  -0.00023938638  0              0.0085389624   9.663223e-14   0              9.3320491e-09  1.1965779e-13  0              2.9941815    
   2300000   8775           200            200            0.0027665253  -0.00023938637  0              0.0085389621   2.8585334e-14  0              2.760567e-09   1.1965779e-13  0              2.9941815    
   2400000   8775           200            200            0.0027665252  -0.00023938637  0              0.0085389621   6.5521637e-15  0              6.3276107e-10  1.1965779e-13  0              2.9941815    
   2500000   8775           200            200            0.0027665252  -0.00023938637  0              0.008538962    1.3159954e-15  0              1.2708941e-10  1.1965779e-13  0              2.9941815    
   2600000   8775           200            200            0.0027665252  -0.00023938637  0              0.008538962    2.5547473e-16  0              2.4671921e-11  1.1965779e-13  0              2.9941815    
   2700000   8775           200            200            0.0027665252  -0.00023938637  0              0.008538962    3.4158219e-17  0              3.2987563e-12  1.1965779e-13  0              2.9941815    
   2800000   8775           200            200            0.0027665252  -0.00023938637  0              0.008538962    1.5284042e-18  0              1.4760234e-13  1.1965779e-13  0              2.9941815    
   2900000   8775           200            200            0.0027665252  -0.00023938637  0              0.008538962    7.8124597e-18  0              7.5447144e-13  1.1965779e-13  0              2.9941815    
   3000000   8775           200            200            0.0027665252  -0.00023938637  0              0.008538962    1.5776872e-18  0              1.5236173e-13  1.1965779e-13  0              2.9941815    
Loop time of 297.271 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8719304.121 ns/day, 0.000 hours/ns, 10091.787 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.853     | 36.351     | 62.516     | 417.5 | 12.23
Neigh   | 5.3956     | 5.5021     | 5.6126     |   4.2 |  1.85
Comm    | 21.126     | 40.099     | 78.047     | 351.4 | 13.49
Output  | 0.27414    | 0.27445    | 0.27478    |   0.1 |  0.09
Modify  | 110.05     | 158.4      | 178.87     | 224.1 | 53.29
Other   |            | 56.64      |            |       | 19.05

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         319.75 ave         640 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1279
Ave neighs/atom = 0.51139544
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 86

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.86                                                               
Lattice spacing in x,y,z = 5.86 5.86 5.86

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4395 ${n1e1} -100 100 -100 100 units box
region box block -4395 4395 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4395 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4395 4395 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4395 -100 -100) to (4395 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4395 -100 -100) to (4395 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4395 -100 -100) to (4395 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_86_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5671 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 111.8 | 111.8 | 111.8 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8790           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8790           200            200            0.0022977168   2.4090045e-40  0              0.0068931504   579225.8       0              5.5937481e+10  1.1965779e-13  0              3.3310724    
    200000   8790           200            200            0.0007824964  -3.6759623e-35  0              0.0023474892   132625.71      0              1.2808041e+10  1.1965779e-13  0              3.0821534    
    300000   8790           200            200            1.5027507e-06 -5.513924e-35   0              4.5082522e-06  1.1704585      0              113034.51      1.1965779e-13  0              3.0442718    
    400000   8790           200            200            1.2547286e-05 -5.5139217e-35  0              3.7641857e-05  76.749894      0              7411955.4      1.1965779e-13  0              3.005692     
    500000   8790           200            200            0.00082049488  0.00011174814  0              0.0023497365   327.01634      0              31580897       1.1965779e-13  0              2.9970285    
    600000   8790           200            200            0.0034454096   0.002990952    0              0.0073452769   167.40016      0              16166309       1.1965779e-13  0              2.9946347    
    700000   8790           200            200            0.0039461876   0.0030756403   0              0.0087629224   24.900234      0              2404686.4      1.1965779e-13  0              2.9941606    
    800000   8790           200            200            0.0038871807   0.0029853636   0              0.0086761784   3.0395408      0              293537.09      1.1965779e-13  0              2.9941935    
    900000   8790           200            200            0.0038596972   0.0029878756   0              0.0085912161   0.38173335     0              36865.075      1.1965779e-13  0              2.994223     
   1000000   8790           200            200            0.00384556     0.0029844005   0              0.0085522795   0.048150902    0              4650.0695      1.1965779e-13  0              2.9942364    
   1100000   8790           200            200            0.0038394969   0.0029826326   0              0.0085358581   0.0060264917   0              581.99543      1.1965779e-13  0              2.994242     
   1200000   8790           200            200            0.0038370049   0.0029819079   0              0.0085291068   0.00074676217  0              72.116945      1.1965779e-13  0              2.9942443    
   1300000   8790           200            200            0.0038359968   0.0029816155   0              0.0085263749   9.1494313e-05  0              8.8358658      1.1965779e-13  0              2.9942453    
   1400000   8790           200            200            0.003835594    0.002981499    0              0.0085252828   1.1069909e-05  0              1.0690526      1.1965779e-13  0              2.9942456    
   1500000   8790           200            200            0.0038354346   0.0029814531   0              0.0085248507   1.3206263e-06  0              0.12753663     1.1965779e-13  0              2.9942458    
   1600000   8790           200            200            0.0038353721   0.0029814351   0              0.0085246811   1.5505664e-07  0              0.014974261    1.1965779e-13  0              2.9942458    
   1700000   8790           200            200            0.0038353477   0.0029814281   0              0.0085246151   1.7874509e-08  0              0.0017261922   1.1965779e-13  0              2.9942459    
   1800000   8790           200            200            0.0038353383   0.0029814254   0              0.0085245896   2.0166967e-09  0              0.00019475813  1.1965779e-13  0              2.9942459    
   1900000   8790           200            200            0.0038353347   0.0029814243   0              0.0085245798   2.2173322e-10  0              2.1413408e-05  1.1965779e-13  0              2.9942459    
   2000000   8790           200            200            0.0038353333   0.002981424    0              0.008524576    2.3625323e-11  0              2.2815646e-06  1.1965779e-13  0              2.9942459    
   2100000   8790           200            200            0.0038353328   0.0029814238   0              0.0085245746   2.4183488e-12  0              2.3354681e-07  1.1965779e-13  0              2.9942459    
   2200000   8790           200            200            0.0038353326   0.0029814237   0              0.0085245741   2.345311e-13   0              2.2649335e-08  1.1965779e-13  0              2.9942459    
   2300000   8790           200            200            0.0038353325   0.0029814237   0              0.0085245739   2.12728e-14    0              2.0543748e-09  1.1965779e-13  0              2.9942459    
   2400000   8790           200            200            0.0038353325   0.0029814237   0              0.0085245738   1.8004312e-15  0              1.7387276e-10  1.1965779e-13  0              2.9942459    
   2500000   8790           200            200            0.0038353325   0.0029814237   0              0.0085245738   1.001369e-16   0              9.6705053e-12  1.1965779e-13  0              2.9942459    
   2600000   8790           200            200            0.0038353325   0.0029814237   0              0.0085245737   3.8763706e-18  0              3.7435213e-13  1.1965779e-13  0              2.9942459    
   2700000   8790           200            200            0.0038353325   0.0029814237   0              0.0085245737   2.1837023e-18  0              2.1088634e-13  1.1965779e-13  0              2.9942459    
   2800000   8790           200            200            0.0038353325   0.0029814237   0              0.0085245737   8.2500036e-19  0              7.967263e-14   1.1965779e-13  0              2.9942459    
   2900000   8790           200            200            0.0038353325   0.0029814237   0              0.0085245737   7.6607868e-19  0              7.3982395e-14  1.1965779e-13  0              2.9942459    
   3000000   8790           200            200            0.0038353325   0.0029814237   0              0.0085245737   1.3632718e-18  0              1.3165503e-13  1.1965779e-13  0              2.9942459    
Loop time of 297.981 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8698553.790 ns/day, 0.000 hours/ns, 10067.771 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.067     | 36.138     | 62.133     | 416.2 | 12.13
Neigh   | 5.4463     | 5.5533     | 5.6636     |   4.1 |  1.86
Comm    | 20.671     | 41.587     | 80.503     | 356.5 | 13.96
Output  | 0.27226    | 0.27258    | 0.27292    |   0.1 |  0.09
Modify  | 108.68     | 157.78     | 177.95     | 227.1 | 52.95
Other   |            | 56.65      |            |       | 19.01

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         317.25 ave         635 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1269
Ave neighs/atom = 0.50739704
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 87

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.87                                                               
Lattice spacing in x,y,z = 5.87 5.87 5.87

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4402.5 ${n1e1} -100 100 -100 100 units box
region box block -4402.5 4402.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4402.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4402.5 4402.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4402.5 -100 -100) to (4402.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4402.5 -100 -100) to (4402.5 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4402.5 -100 -100) to (4402.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_87_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5681 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 112 | 112 | 112 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8805           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8805           200            200            0.0022947781   8.9874385e-42  0              0.0068843342   579574.45      0              5.5971152e+10  1.1965779e-13  0              3.3309481    
    200000   8805           200            200            0.00078330669  5.1140945e-40  0              0.0023499201   133188.03      0              1.2862346e+10  1.1965779e-13  0              3.0818991    
    300000   8805           200            200            5.3023697e-06  9.1742845e-36  0              1.5907109e-05  13.757701      0              1328620.2      1.1965779e-13  0              3.0445899    
    400000   8805           200            200            2.6532282e-05 -3.6696476e-35  0              7.9596845e-05  334.27374      0              32281766       1.1965779e-13  0              3.0056764    
    500000   8805           200            200            0.0029499235   0.0026047146   0              0.006245056    1339.0913      0              1.2931985e+08  1.1965779e-13  0              2.9953032    
    600000   8805           200            200            0.0036703811   0.0053124543   0              0.0056986889   19.541345      0              1887163.3      1.1965779e-13  0              2.9954634    
    700000   8805           200            200            0.0040722305   0.0047749977   0              0.0074416937   2.8312068      0              273417.69      1.1965779e-13  0              2.9947988    
    800000   8805           200            200            0.0041855001   0.0044047612   0              0.008151739    0.96538653     0              93230.121      1.1965779e-13  0              2.9945516    
    900000   8805           200            200            0.0042640578   0.004382857    0              0.0084093163   0.27183017     0              26251.412      1.1965779e-13  0              2.9944648    
   1000000   8805           200            200            0.0042898124   0.0043805186   0              0.0084889185   0.054617323    0              5274.5501      1.1965779e-13  0              2.9944381    
   1100000   8805           200            200            0.0042967716   0.0043811435   0              0.0085091713   0.0086030178   0              830.81788      1.1965779e-13  0              2.9944312    
   1200000   8805           200            200            0.0042979246   0.0043812555   0              0.0085125182   0.0010993032   0              106.16283      1.1965779e-13  0              2.99443      
   1300000   8805           200            200            0.0042977887   0.0043812462   0              0.0085121198   0.00011259788  0              10.873897      1.1965779e-13  0              2.9944301    
   1400000   8805           200            200            0.0042975385   0.0043812246   0              0.0085113908   8.5736383e-06  0              0.82798062     1.1965779e-13  0              2.9944303    
   1500000   8805           200            200            0.0042973823   0.0043812108   0              0.0085109362   3.7303035e-07  0              0.036024602    1.1965779e-13  0              2.9944305    
   1600000   8805           200            200            0.0042973072   0.0043812041   0              0.0085107175   9.6032031e-10  0              9.2740862e-05  1.1965779e-13  0              2.9944305    
   1700000   8805           200            200            0.0042972758   0.0043812012   0              0.0085106263   3.6935578e-09  0              0.00035669737  1.1965779e-13  0              2.9944306    
   1800000   8805           200            200            0.0042972641   0.0043812002   0              0.0085105922   2.1684405e-09  0              0.00020941246  1.1965779e-13  0              2.9944306    
   1900000   8805           200            200            0.0042972602   0.0043811998   0              0.0085105807   5.8946832e-10  0              5.6926631e-05  1.1965779e-13  0              2.9944306    
   2000000   8805           200            200            0.004297259    0.0043811997   0              0.0085105773   1.1344708e-10  0              1.0955907e-05  1.1965779e-13  0              2.9944306    
   2100000   8805           200            200            0.0042972587   0.0043811997   0              0.0085105764   1.7248802e-11  0              1.6657658e-06  1.1965779e-13  0              2.9944306    
   2200000   8805           200            200            0.0042972587   0.0043811997   0              0.0085105763   2.1309292e-12  0              2.0578989e-07  1.1965779e-13  0              2.9944306    
   2300000   8805           200            200            0.0042972587   0.0043811997   0              0.0085105764   2.0958372e-13  0              2.0240095e-08  1.1965779e-13  0              2.9944306    
   2400000   8805           200            200            0.0042972587   0.0043811997   0              0.0085105764   1.5060066e-14  0              1.4543934e-09  1.1965779e-13  0              2.9944306    
   2500000   8805           200            200            0.0042972587   0.0043811997   0              0.0085105764   6.0215662e-16  0              5.8151976e-11  1.1965779e-13  0              2.9944306    
   2600000   8805           200            200            0.0042972587   0.0043811997   0              0.0085105764   2.952697e-19   0              2.8515034e-14  1.1965779e-13  0              2.9944306    
   2700000   8805           200            200            0.0042972587   0.0043811997   0              0.0085105764   1.6007492e-17  0              1.545889e-12   1.1965779e-13  0              2.9944306    
   2800000   8805           200            200            0.0042972587   0.0043811997   0              0.0085105764   7.3125862e-18  0              7.0619723e-13  1.1965779e-13  0              2.9944306    
   2900000   8805           200            200            0.0042972587   0.0043811997   0              0.0085105764   2.4063499e-18  0              2.3238804e-13  1.1965779e-13  0              2.9944306    
   3000000   8805           200            200            0.0042972587   0.0043811997   0              0.0085105764   3.8009162e-18  0              3.6706528e-13  1.1965779e-13  0              2.9944306    
Loop time of 297.424 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8714837.265 ns/day, 0.000 hours/ns, 10086.617 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.097     | 36.309     | 62.627     | 417.2 | 12.21
Neigh   | 5.4482     | 5.5609     | 5.6784     |   4.4 |  1.87
Comm    | 20.825     | 40.282     | 78.634     | 354.8 | 13.54
Output  | 0.27158    | 0.2719     | 0.27227    |   0.1 |  0.09
Modify  | 109.7      | 158.26     | 178.54     | 225.0 | 53.21
Other   |            | 56.74      |            |       | 19.08

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         317.25 ave         635 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1269
Ave neighs/atom = 0.50739704
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 88

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.88                                                               
Lattice spacing in x,y,z = 5.88 5.88 5.88

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4410 ${n1e1} -100 100 -100 100 units box
region box block -4410 4410 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4410 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4410 4410 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4410 -100 -100) to (4410 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4410 -100 -100) to (4410 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4410 -100 -100) to (4410 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_88_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5691 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 112.1 | 112.1 | 112.2 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8820           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8820           200            200            0.0022911697   5.8208791e-41  0              0.0068735091   579701.61      0              5.5983432e+10  1.1965779e-13  0              3.3307331    
    200000   8820           200            200            0.00078276456 -2.1064905e-34  0              0.0023482937   133405.57      0              1.2883355e+10  1.1965779e-13  0              3.0815854    
    300000   8820           200            200            5.9731082e-06  2.5172436e-40  0              1.7919325e-05  17.454315      0              1685612.8      1.1965779e-13  0              3.0445352    
    400000   8820           200            200            2.272006e-05  -1.0990355e-34  0              6.8160181e-05  247.75839      0              23926732       1.1965779e-13  0              3.0057118    
    500000   8820           200            200            0.0016848125  -0.00010835076  0              0.0051627882   1237.9293      0              1.1955036e+08  1.1965779e-13  0              2.9957205    
    600000   8820           200            200            0.0033791002  -0.00029697565  0              0.010434276    132.92993      0              12837421       1.1965779e-13  0              2.9939241    
    700000   8820           200            200            0.002878324   -0.00029236801  0              0.0089273401   22.945036      0              2215867.4      1.1965779e-13  0              2.9943612    
    800000   8820           200            200            0.0025977805  -0.0002858508   0              0.0080791923   0.25938919     0              25049.951      1.1965779e-13  0              2.9946382    
    900000   8820           200            200            0.0027794827  -0.0002901256   0              0.0086285737   0.16017882     0              15468.924      1.1965779e-13  0              2.994462     
   1000000   8820           200            200            0.002734061   -0.00028913306  0              0.008491316    0.064796996    0              6257.6301      1.1965779e-13  0              2.9945047    
   1100000   8820           200            200            0.0027305837  -0.00028904357  0              0.0084807948   0.0041890168   0              404.54526      1.1965779e-13  0              2.9945085    
   1200000   8820           200            200            0.0027383289  -0.00028922129  0              0.0085042079   1.7347594e-05  0              1.6753064      1.1965779e-13  0              2.994501     
   1300000   8820           200            200            0.0027351902  -0.00028915068  0              0.0084947212   0.00011389446  0              10.999112      1.1965779e-13  0              2.994504     
   1400000   8820           200            200            0.0027356083  -0.00028915967  0              0.0084959844   1.9468538e-05  0              1.8801321      1.1965779e-13  0              2.9945036    
   1500000   8820           200            200            0.0027358367  -0.00028916501  0              0.0084966752   3.8066714e-07  0              0.036762107    1.1965779e-13  0              2.9945034    
   1600000   8820           200            200            0.0027356739  -0.00028916131  0              0.0084961829   9.4600217e-08  0              0.0091358118   1.1965779e-13  0              2.9945035    
   1700000   8820           200            200            0.0027357189  -0.00028916232  0              0.0084963191   5.1332116e-08  0              0.0049572884   1.1965779e-13  0              2.9945035    
   1800000   8820           200            200            0.0027357199  -0.00028916235  0              0.008496322    4.1100673e-09  0              0.00039692088  1.1965779e-13  0              2.9945035    
   1900000   8820           200            200            0.0027357134  -0.0002891622   0              0.0084963023   4.6119896e-13  0              4.4539295e-08  1.1965779e-13  0              2.9945035    
   2000000   8820           200            200            0.0027357163  -0.00028916226  0              0.0084963111   8.0353851e-11  0              7.7599998e-06  1.1965779e-13  0              2.9945035    
   2100000   8820           200            200            0.0027357158  -0.00028916225  0              0.0084963097   1.6695782e-11  0              1.6123591e-06  1.1965779e-13  0              2.9945035    
   2200000   8820           200            200            0.0027357156  -0.00028916225  0              0.0084963091   4.8350735e-13  0              4.6693679e-08  1.1965779e-13  0              2.9945035    
   2300000   8820           200            200            0.0027357158  -0.00028916225  0              0.0084963096   5.146179e-14   0              4.9698114e-09  1.1965779e-13  0              2.9945035    
   2400000   8820           200            200            0.0027357157  -0.00028916225  0              0.0084963094   3.9743359e-14  0              3.8381291e-09  1.1965779e-13  0              2.9945035    
   2500000   8820           200            200            0.0027357157  -0.00028916225  0              0.0084963094   3.866177e-15   0              3.733677e-10   1.1965779e-13  0              2.9945035    
   2600000   8820           200            200            0.0027357157  -0.00028916225  0              0.0084963095   1.9524512e-18  0              1.8855376e-13  1.1965779e-13  0              2.9945035    
   2700000   8820           200            200            0.0027357157  -0.00028916225  0              0.0084963095   4.0480739e-17  0              3.9093401e-12  1.1965779e-13  0              2.9945035    
   2800000   8820           200            200            0.0027357157  -0.00028916225  0              0.0084963095   1.3220282e-17  0              1.2767202e-12  1.1965779e-13  0              2.9945035    
   2900000   8820           200            200            0.0027357157  -0.00028916225  0              0.0084963095   1.1094959e-18  0              1.0714717e-13  1.1965779e-13  0              2.9945035    
   3000000   8820           200            200            0.0027357157  -0.00028916225  0              0.0084963095   2.829811e-18   0              2.7328289e-13  1.1965779e-13  0              2.9945035    
Loop time of 297.683 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8707245.890 ns/day, 0.000 hours/ns, 10077.831 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.128     | 36.233     | 62.364     | 413.9 | 12.17
Neigh   | 5.4802     | 5.5878     | 5.7004     |   4.2 |  1.88
Comm    | 20.7       | 41.667     | 80.573     | 356.2 | 14.00
Output  | 0.27573    | 0.27604    | 0.27639    |   0.1 |  0.09
Modify  | 109.06     | 157.76     | 177.11     | 225.2 | 53.00
Other   |            | 56.15      |            |       | 18.86

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         317.75 ave         636 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1271
Ave neighs/atom = 0.50819672
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 89

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.89                                                               
Lattice spacing in x,y,z = 5.89 5.89 5.89

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4417.5 ${n1e1} -100 100 -100 100 units box
region box block -4417.5 4417.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4417.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4417.5 4417.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4417.5 -100 -100) to (4417.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4417.5 -100 -100) to (4417.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4417.5 -100 -100) to (4417.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_89_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5700 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 112.3 | 112.4 | 112.4 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8835           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8835           200            200            0.0022867223  -2.2857739e-36  0              0.0068601668   579486.46      0              5.5962654e+10  1.1965779e-13  0              3.3309283    
    200000   8835           200            200            0.00078005037 -1.8285901e-35  0              0.0023401511   133033.41      0              1.2847415e+10  1.1965779e-13  0              3.0819139    
    300000   8835           200            200            3.9396895e-06 -4.5715415e-36  0              1.1819068e-05  7.7226242      0              745795.77      1.1965779e-13  0              3.0444584    
    400000   8835           200            200            1.9118546e-05  2.0114885e-34  0              5.7355637e-05  177.31533      0              17123846       1.1965779e-13  0              3.0057366    
    500000   8835           200            200            0.0011668393  -0.000446276    0              0.0039467938   924.69963      0              89300872       1.1965779e-13  0              2.9962278    
    600000   8835           200            200            0.0014171131  -0.0012877424   0              0.0055390816   2.12286        0              205010.63      1.1965779e-13  0              2.9954455    
    700000   8835           200            200            0.0022280757  -0.00066651747  0              0.0073507445   0.0060461482   0              583.89372      1.1965779e-13  0              2.9947555    
    800000   8835           200            200            0.0024643398  -0.00069273425  0              0.0080857535   0.40465261     0              39078.452      1.1965779e-13  0              2.9945007    
    900000   8835           200            200            0.0025530668  -0.00071319698  0              0.0083723973   0.23781778     0              22966.739      1.1965779e-13  0              2.9944045    
   1000000   8835           200            200            0.0025834401  -0.00071287468  0              0.008463195    0.057161781    0              5520.2757      1.1965779e-13  0              2.9943741    
   1100000   8835           200            200            0.0025903547  -0.00071309211  0              0.0084841561   0.0085233327   0              823.12247      1.1965779e-13  0              2.9943669    
   1200000   8835           200            200            0.0025908713  -0.00071311067  0              0.0084857246   0.00082800411  0              79.96271       1.1965779e-13  0              2.9943663    
   1300000   8835           200            200            0.0025902801  -0.00071309368  0              0.0084839339   4.3160107e-05  0              4.1680942      1.1965779e-13  0              2.9943669    
   1400000   8835           200            200            0.0025898197  -0.00071307994  0              0.0084825391   2.1335489e-07  0              0.020604288    1.1965779e-13  0              2.9943674    
   1500000   8835           200            200            0.0025895952  -0.00071307315  0              0.0084818586   3.3731451e-07  0              0.032575421    1.1965779e-13  0              2.9943676    
   1600000   8835           200            200            0.0025895088  -0.00071307051  0              0.0084815969   1.9916179e-07  0              0.01923362     1.1965779e-13  0              2.9943677    
   1700000   8835           200            200            0.002589482   -0.00071306968  0              0.0084815156   4.6958022e-08  0              0.0045348697   1.1965779e-13  0              2.9943677    
   1800000   8835           200            200            0.0025894759  -0.00071306949  0              0.0084814972   6.899766e-09   0              0.00066633001  1.1965779e-13  0              2.9943677    
   1900000   8835           200            200            0.0025894755  -0.00071306948  0              0.008481496    6.5971386e-10  0              6.3710442e-05  1.1965779e-13  0              2.9943677    
   2000000   8835           200            200            0.0025894761  -0.00071306949  0              0.0084814977   3.336397e-11   0              3.2220534e-06  1.1965779e-13  0              2.9943677    
   2100000   8835           200            200            0.0025894765  -0.00071306951  0              0.008481499    1.2509543e-13  0              1.2080822e-08  1.1965779e-13  0              2.9943677    
   2200000   8835           200            200            0.0025894767  -0.00071306951  0              0.0084814996   2.9686688e-13  0              2.8669278e-08  1.1965779e-13  0              2.9943677    
   2300000   8835           200            200            0.0025894768  -0.00071306951  0              0.0084814998   1.6646229e-13  0              1.6075736e-08  1.1965779e-13  0              2.9943677    
   2400000   8835           200            200            0.0025894768  -0.00071306951  0              0.0084814999   3.8518011e-14  0              3.7197938e-09  1.1965779e-13  0              2.9943677    
   2500000   8835           200            200            0.0025894768  -0.00071306952  0              0.0084814999   5.5800641e-15  0              5.3888265e-10  1.1965779e-13  0              2.9943677    
   2600000   8835           200            200            0.0025894768  -0.00071306952  0              0.0084814999   5.312086e-16   0              5.1300324e-11  1.1965779e-13  0              2.9943677    
   2700000   8835           200            200            0.0025894768  -0.00071306952  0              0.0084814999   1.6815797e-17  0              1.6239493e-12  1.1965779e-13  0              2.9943677    
   2800000   8835           200            200            0.0025894768  -0.00071306952  0              0.0084814999   2.3011649e-19  0              2.2223003e-14  1.1965779e-13  0              2.9943677    
   2900000   8835           200            200            0.0025894768  -0.00071306952  0              0.0084814999   1.1182187e-18  0              1.0798956e-13  1.1965779e-13  0              2.9943677    
   3000000   8835           200            200            0.0025894768  -0.00071306952  0              0.0084814999   4.4138657e-18  0              4.2625956e-13  1.1965779e-13  0              2.9943677    
Loop time of 295.777 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8763358.181 ns/day, 0.000 hours/ns, 10142.776 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.902     | 36.262     | 62.507     | 418.2 | 12.26
Neigh   | 5.4719     | 5.5732     | 5.6785     |   3.9 |  1.88
Comm    | 20.904     | 40.218     | 78.613     | 355.2 | 13.60
Output  | 0.2762     | 0.27651    | 0.27683    |   0.1 |  0.09
Modify  | 109.05     | 157.31     | 176.53     | 223.8 | 53.19
Other   |            | 56.14      |            |       | 18.98

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         317.75 ave         636 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1271
Ave neighs/atom = 0.50819672
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 90

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.9                                                               
Lattice spacing in x,y,z = 5.9 5.9 5.9

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4425 ${n1e1} -100 100 -100 100 units box
region box block -4425 4425 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4425 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4425 4425 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4425 -100 -100) to (4425 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4425 -100 -100) to (4425 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4425 -100 -100) to (4425 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_90_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5710 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 112.4 | 112.5 | 112.5 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8850           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8850           200            200            0.0022822736   5.7047595e-37  0              0.0068468207   579271.08      0              5.5941855e+10  1.1965779e-13  0              3.3310797    
    200000   8850           200            200            0.00077731253  2.1906392e-34  0              0.0023319376   132654.34      0              1.2810806e+10  1.1965779e-13  0              3.0822138    
    300000   8850           200            200            1.9667624e-06  5.0201885e-35  0              5.9002871e-06  1.994366       0              192601.6       1.1965779e-13  0              3.0443575    
    400000   8850           200            200            1.5446716e-05 -7.3020355e-35  0              4.6340147e-05  117.067        0              11305493       1.1965779e-13  0              3.0057309    
    500000   8850           200            200            0.00088298329 -4.63493e-05    0              0.0026952992   491.66656      0              47481637       1.1965779e-13  0              2.9968815    
    600000   8850           200            200            0.0036223494  -0.00028892362  0              0.011155972    43.184277      0              4170428.4      1.1965779e-13  0              2.9934249    
    700000   8850           200            200            0.0028577081  -0.00027965455  0              0.0088527788   21.978422      0              2122518.7      1.1965779e-13  0              2.9941996    
    800000   8850           200            200            0.0026008045  -0.0002747399   0              0.0080771535   0.12586146     0              12154.799      1.1965779e-13  0              2.9944878    
    900000   8850           200            200            0.0027307194  -0.00027725079  0              0.0084694089   0.46080627     0              44501.371      1.1965779e-13  0              2.9943458    
   1000000   8850           200            200            0.0027473297  -0.00027757898  0              0.0085195682   0.0027665621   0              267.17476      1.1965779e-13  0              2.9943265    
   1100000   8850           200            200            0.0027272251  -0.00027720589  0              0.0084588813   0.0070131287   0              677.27777      1.1965779e-13  0              2.9943484    
   1200000   8850           200            200            0.0027279948  -0.00027721752  0              0.008461202    0.00038354051  0              37.039597      1.1965779e-13  0              2.9943478    
   1300000   8850           200            200            0.0027305911  -0.00027726638  0              0.0084690395   7.0216824e-05  0              6.7810383      1.1965779e-13  0              2.9943449    
   1400000   8850           200            200            0.0027301001  -0.00027725753  0              0.0084675577   1.5153693e-05  0              1.4634352      1.1965779e-13  0              2.9943454    
   1500000   8850           200            200            0.002729823   -0.00027725226  0              0.0084667212   3.024145e-07   0              0.029205028    1.1965779e-13  0              2.9943457    
   1600000   8850           200            200            0.0027299306  -0.00027725424  0              0.0084670459   3.688061e-07   0              0.035616653    1.1965779e-13  0              2.9943456    
   1700000   8850           200            200            0.0027299519  -0.00027725466  0              0.0084671104   2.6868257e-10  0              2.5947439e-05  1.1965779e-13  0              2.9943456    
   1800000   8850           200            200            0.0027299342  -0.00027725433  0              0.0084670569   6.3200146e-09  0              0.00061034178  1.1965779e-13  0              2.9943456    
   1900000   8850           200            200            0.002729934   -0.00027725432  0              0.0084670562   1.979962e-10   0              1.9121056e-05  1.1965779e-13  0              2.9943456    
   2000000   8850           200            200            0.0027299364  -0.00027725437  0              0.0084670635   7.4447429e-11  0              7.1895998e-06  1.1965779e-13  0              2.9943456    
   2100000   8850           200            200            0.0027299361  -0.00027725436  0              0.0084670625   1.0147184e-11  0              9.7994238e-07  1.1965779e-13  0              2.9943456    
   2200000   8850           200            200            0.0027299358  -0.00027725436  0              0.0084670617   4.75258e-13    0              4.5897016e-08  1.1965779e-13  0              2.9943456    
   2300000   8850           200            200            0.0027299359  -0.00027725436  0              0.008467062    2.8360897e-13  0              2.7388925e-08  1.1965779e-13  0              2.9943456    
   2400000   8850           200            200            0.0027299359  -0.00027725436  0              0.008467062    1.7834291e-16  0              1.7223082e-11  1.1965779e-13  0              2.9943456    
   2500000   8850           200            200            0.0027299359  -0.00027725436  0              0.008467062    5.4675788e-15  0              5.2801962e-10  1.1965779e-13  0              2.9943456    
   2600000   8850           200            200            0.0027299359  -0.00027725436  0              0.008467062    8.8248844e-17  0              8.5224417e-12  1.1965779e-13  0              2.9943456    
   2700000   8850           200            200            0.0027299359  -0.00027725436  0              0.008467062    5.4598789e-17  0              5.2727603e-12  1.1965779e-13  0              2.9943456    
   2800000   8850           200            200            0.0027299359  -0.00027725436  0              0.008467062    9.461926e-18   0              9.1376509e-13  1.1965779e-13  0              2.9943456    
   2900000   8850           200            200            0.0027299359  -0.00027725436  0              0.008467062    5.6115273e-20  0              5.4192114e-15  1.1965779e-13  0              2.9943456    
   3000000   8850           200            200            0.0027299359  -0.00027725436  0              0.008467062    1.1270416e-18  0              1.0884161e-13  1.1965779e-13  0              2.9943456    
Loop time of 294.628 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8797538.097 ns/day, 0.000 hours/ns, 10182.336 timesteps/s
99.9% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.979     | 35.356     | 60.906     | 407.8 | 12.00
Neigh   | 5.4785     | 5.5804     | 5.686      |   4.0 |  1.89
Comm    | 20.977     | 39.956     | 77.019     | 344.6 | 13.56
Output  | 0.29959    | 0.29989    | 0.3002     |   0.1 |  0.10
Modify  | 109.73     | 157.49     | 177.3      | 222.4 | 53.45
Other   |            | 55.94      |            |       | 18.99

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         313.75 ave         628 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1255
Ave neighs/atom = 0.50179928
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 91

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.91                                                               
Lattice spacing in x,y,z = 5.91 5.91 5.91

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4432.5 ${n1e1} -100 100 -100 100 units box
region box block -4432.5 4432.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4432.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4432.5 4432.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4432.5 -100 -100) to (4432.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4432.5 -100 -100) to (4432.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4432.5 -100 -100) to (4432.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_91_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5720 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 112.6 | 112.6 | 112.6 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8865           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8865           200            200            0.00227762     6.7409553e-42  0              0.0068328601   578967.43      0              5.5912531e+10  1.1965779e-13  0              3.3313343    
    200000   8865           200            200            0.00077421208  1.1390226e-36  0              0.0023226362   132175.53      0              1.2764567e+10  1.1965779e-13  0              3.0826026    
    300000   8865           200            200           -8.6557587e-07  3.6448919e-35  0             -2.5967276e-06  0.32078451     0              30979.072      1.1965779e-13  0              3.0442345    
    400000   8865           200            200            7.2511887e-06  9.1121988e-35  0              2.1753566e-05  26.492282      0              2558435        1.1965779e-13  0              3.0057366    
    500000   8865           200            200            0.00043074175 -0.0006275739   0              0.0019197992   129.2957       0              12486454       1.1965779e-13  0              2.9973032    
    600000   8865           200            200            0.0025158668  -0.001365642    0              0.0089132423   189.69199      0              18319094       1.1965779e-13  0              2.9940949    
    700000   8865           200            200            0.0027879981  -0.0011451639   0              0.0095091582   4.5300452      0              437479.34      1.1965779e-13  0              2.9939192    
    800000   8865           200            200            0.0026067972  -0.0010549629   0              0.0088753545   0.010115879    0              976.91922      1.1965779e-13  0              2.9941263    
    900000   8865           200            200            0.0025176954  -0.0010394547   0              0.0085925409   0.086234525    0              8327.9132      1.1965779e-13  0              2.9942199    
   1000000   8865           200            200            0.0024857018  -0.0010345191   0              0.0084916245   0.033712087    0              3255.672       1.1965779e-13  0              2.9942535    
   1100000   8865           200            200            0.0024758142  -0.0010329859   0              0.0084604284   0.0073790009   0              712.61109      1.1965779e-13  0              2.9942638    
   1200000   8865           200            200            0.0024733493  -0.0010326068   0              0.0084526546   0.0011560347   0              111.64155      1.1965779e-13  0              2.9942664    
   1300000   8865           200            200            0.0024729952  -0.0010325556   0              0.0084515413   0.00013624309  0              13.157382      1.1965779e-13  0              2.9942667    
   1400000   8865           200            200            0.0024730855  -0.0010325719   0              0.0084518285   1.1547656e-05  0              1.11519        1.1965779e-13  0              2.9942666    
   1500000   8865           200            200            0.0024731951  -0.0010325899   0              0.0084521752   5.6251286e-07  0              0.054323466    1.1965779e-13  0              2.9942665    
   1600000   8865           200            200            0.0024732579  -0.0010326      0              0.0084523737   2.985823e-09   0              0.00028834941  1.1965779e-13  0              2.9942664    
   1700000   8865           200            200            0.002473286   -0.0010326045   0              0.0084524626   4.0700629e-09  0              0.00039305754  1.1965779e-13  0              2.9942664    
   1800000   8865           200            200            0.0024732968  -0.0010326062   0              0.0084524967   2.6023233e-09  0              0.00025131376  1.1965779e-13  0              2.9942664    
   1900000   8865           200            200            0.0024733004  -0.0010326068   0              0.0084525081   6.9117751e-10  0              6.6748977e-05  1.1965779e-13  0              2.9942664    
   2000000   8865           200            200            0.0024733014  -0.001032607    0              0.0084525112   1.2326593e-10  0              1.1904142e-05  1.1965779e-13  0              2.9942664    
   2100000   8865           200            200            0.0024733016  -0.001032607    0              0.0084525118   1.6387825e-11  0              1.5826189e-06  1.1965779e-13  0              2.9942664    
   2200000   8865           200            200            0.0024733016  -0.001032607    0              0.0084525118   1.6162814e-12  0              1.5608889e-07  1.1965779e-13  0              2.9942664    
   2300000   8865           200            200            0.0024733016  -0.001032607    0              0.0084525118   1.0498188e-13  0              1.0138399e-08  1.1965779e-13  0              2.9942664    
   2400000   8865           200            200            0.0024733016  -0.001032607    0              0.0084525117   2.6092356e-15  0              2.5198129e-10  1.1965779e-13  0              2.9942664    
   2500000   8865           200            200            0.0024733016  -0.001032607    0              0.0084525117   1.0501103e-16  0              1.0141213e-11  1.1965779e-13  0              2.9942664    
   2600000   8865           200            200            0.0024733016  -0.001032607    0              0.0084525117   1.7580822e-16  0              1.6978299e-11  1.1965779e-13  0              2.9942664    
   2700000   8865           200            200            0.0024733016  -0.001032607    0              0.0084525117   4.5453169e-17  0              4.3895418e-12  1.1965779e-13  0              2.9942664    
   2800000   8865           200            200            0.0024733016  -0.001032607    0              0.0084525117   6.9224118e-18  0              6.6851698e-13  1.1965779e-13  0              2.9942664    
   2900000   8865           200            200            0.0024733016  -0.001032607    0              0.0084525117   5.8055608e-18  0              5.6065951e-13  1.1965779e-13  0              2.9942664    
   3000000   8865           200            200            0.0024733016  -0.001032607    0              0.0084525117   3.4370684e-18  0              3.3192746e-13  1.1965779e-13  0              2.9942664    
Loop time of 296.898 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8730263.736 ns/day, 0.000 hours/ns, 10104.472 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.882     | 35.878     | 61.612     | 414.2 | 12.08
Neigh   | 5.4894     | 5.6011     | 5.7151     |   4.3 |  1.89
Comm    | 21.293     | 39.987     | 77.487     | 347.6 | 13.47
Output  | 0.27178    | 0.27209    | 0.27243    |   0.1 |  0.09
Modify  | 108.88     | 157.54     | 179.7      | 227.0 | 53.06
Other   |            | 57.62      |            |       | 19.41

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         316.25 ave         633 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1265
Ave neighs/atom = 0.50579768
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 92

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.92                                                               
Lattice spacing in x,y,z = 5.92 5.92 5.92

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4440 ${n1e1} -100 100 -100 100 units box
region box block -4440 4440 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4440 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4440 4440 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4440 -100 -100) to (4440 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4440 -100 -100) to (4440 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4440 -100 -100) to (4440 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_92_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5730 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 112.8 | 112.8 | 112.8 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8880           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8880           200            200            0.0022727958  -6.8225783e-36  0              0.0068183873   578595.17      0              5.587658e+10   1.1965779e-13  0              3.3316248    
    200000   8880           200            200            0.00077063773 -1.8193364e-35  0              0.0023119132   131567.8       0              1.2705876e+10  1.1965779e-13  0              3.0830864    
    300000   8880           200            200           -4.2332791e-06  9.096834e-36   0             -1.2699837e-05  8.646966       0              835062.08      1.1965779e-13  0              3.04406      
    400000   8880           200            200           -1.0348395e-06 -3.638684e-35   0             -3.1045185e-06  0.48394477     0              46735.921      1.1965779e-13  0              3.0056541    
    500000   8880           200            200            0.00055678213 -5.1991543e-05  0              0.0017223379   17.892104      0              1727891.3      1.1965779e-13  0              2.9973612    
    600000   8880           200            200            0.0036813138  -0.00047217758  0              0.011516119    15.377636      0              1485062        1.1965779e-13  0              2.9932084    
    700000   8880           200            200            0.0027680235  -0.00035647393  0              0.0086605444   24.880413      0              2402772.2      1.1965779e-13  0              2.9941343    
    800000   8880           200            200            0.0025630686  -0.00036060947  0              0.0080498153   0.33322633     0              32180.614      1.1965779e-13  0              2.9943386    
    900000   8880           200            200            0.0026686715  -0.00036447816  0              0.0083704926   0.37787032     0              36492.011      1.1965779e-13  0              2.9942255    
   1000000   8880           200            200            0.0027061171  -0.00036570334  0              0.0084840545   0.019450294    0              1878.3702      1.1965779e-13  0              2.9941871    
   1100000   8880           200            200            0.002695471   -0.00036534373  0              0.0084517566   0.0047653053   0              460.19908      1.1965779e-13  0              2.9941985    
   1200000   8880           200            200            0.0026893626  -0.00036514322  0              0.0084332311   0.00066272574  0              64.001308      1.1965779e-13  0              2.9942048    
   1300000   8880           200            200            0.0026901832  -0.00036517205  0              0.0084357215   4.5151382e-05  0              4.3603973      1.1965779e-13  0              2.9942039    
   1400000   8880           200            200            0.0026910898  -0.00036520205  0              0.0084384714   1.7218998e-05  0              1.6628876      1.1965779e-13  0              2.994203     
   1500000   8880           200            200            0.0026910704  -0.00036520118  0              0.0084384122   2.3904765e-07  0              0.023085511    1.1965779e-13  0              2.994203     
   1600000   8880           200            200            0.0026909461  -0.00036519705  0              0.0084380353   3.7089713e-07  0              0.03581859     1.1965779e-13  0              2.9942031    
   1700000   8880           200            200            0.0026909362  -0.00036519675  0              0.0084380053   2.178223e-11   0              2.1035718e-06  1.1965779e-13  0              2.9942031    
   1800000   8880           200            200            0.002690952   -0.00036519728  0              0.0084380532   6.8277206e-09  0              0.00065937238  1.1965779e-13  0              2.9942031    
   1900000   8880           200            200            0.0026909549  -0.00036519737  0              0.008438062    5.9078761e-11  0              5.7054039e-06  1.1965779e-13  0              2.9942031    
   2000000   8880           200            200            0.0026909531  -0.00036519731  0              0.0084380565   1.0761311e-10  0              1.0392504e-05  1.1965779e-13  0              2.9942031    
   2100000   8880           200            200            0.0026909525  -0.00036519729  0              0.0084380547   4.331807e-12   0              4.1833491e-07  1.1965779e-13  0              2.9942031    
   2200000   8880           200            200            0.0026909527  -0.0003651973   0              0.0084380553   1.4149595e-12  0              1.3664666e-07  1.1965779e-13  0              2.9942031    
   2300000   8880           200            200            0.0026909528  -0.0003651973   0              0.0084380556   1.6052427e-13  0              1.5502285e-08  1.1965779e-13  0              2.9942031    
   2400000   8880           200            200            0.0026909527  -0.0003651973   0              0.0084380555   1.4420064e-14  0              1.3925866e-09  1.1965779e-13  0              2.9942031    
   2500000   8880           200            200            0.0026909527  -0.0003651973   0              0.0084380555   4.4221107e-15  0              4.270558e-10   1.1965779e-13  0              2.9942031    
   2600000   8880           200            200            0.0026909527  -0.0003651973   0              0.0084380555   8.8847146e-17  0              8.5802214e-12  1.1965779e-13  0              2.9942031    
   2700000   8880           200            200            0.0026909527  -0.0003651973   0              0.0084380555   9.9580372e-17  0              9.6167595e-12  1.1965779e-13  0              2.9942031    
   2800000   8880           200            200            0.0026909527  -0.0003651973   0              0.0084380555   4.8339044e-19  0              4.6682388e-14  1.1965779e-13  0              2.9942031    
   2900000   8880           200            200            0.0026909527  -0.0003651973   0              0.0084380555   7.7439511e-18  0              7.4785537e-13  1.1965779e-13  0              2.9942031    
   3000000   8880           200            200            0.0026909527  -0.0003651973   0              0.0084380555   1.4932528e-18  0              1.4420767e-13  1.1965779e-13  0              2.9942031    
Loop time of 293.811 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8821983.394 ns/day, 0.000 hours/ns, 10210.629 timesteps/s
99.9% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.843     | 35.544     | 60.802     | 410.7 | 12.10
Neigh   | 5.5055     | 5.6103     | 5.7182     |   4.1 |  1.91
Comm    | 21.006     | 39.698     | 76.754     | 345.1 | 13.51
Output  | 0.27273    | 0.27303    | 0.27335    |   0.1 |  0.09
Modify  | 109.02     | 156.69     | 176.55     | 222.5 | 53.33
Other   |            | 55.99      |            |       | 19.06

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         313.75 ave         628 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1255
Ave neighs/atom = 0.50179928
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 93

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.93                                                               
Lattice spacing in x,y,z = 5.93 5.93 5.93

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4447.5 ${n1e1} -100 100 -100 100 units box
region box block -4447.5 4447.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4447.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4447.5 4447.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4447.5 -100 -100) to (4447.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4447.5 -100 -100) to (4447.5 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4447.5 -100 -100) to (4447.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_93_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5739 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 113 | 113 | 113 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8895           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8895           200            200            0.0022687511  -1.1351778e-36  0              0.0068062533   578537.83      0              5.5871043e+10  1.1965779e-13  0              3.3314959    
    200000   8895           200            200            0.00076873186 -7.2650898e-35  0              0.0023061956   131413.69      0              1.2690993e+10  1.1965779e-13  0              3.0830201    
    300000   8895           200            200           -6.5053068e-06 -1.0897541e-34  0             -1.951592e-05   20.777338      0              2006526.6      1.1965779e-13  0              3.0438463    
    400000   8895           200            200           -1.0256685e-05 -3.6324354e-35  0             -3.0770055e-05  53.735958      0              5189434.2      1.1965779e-13  0              3.0054594    
    500000   8895           200            200            0.00069503606 -0.00072566467  0              0.0028107729   533.41969      0              51513855       1.1965779e-13  0              2.9965436    
    600000   8895           200            200            0.002958607   -0.0005339141   0              0.009409735    173.38531      0              16744313       1.1965779e-13  0              2.9937769    
    700000   8895           200            200            0.0021947383  -0.00085447304  0              0.0074386881   4.8060008      0              464129.15      1.1965779e-13  0              2.9944446    
    800000   8895           200            200            0.00266699    -0.00080441341  0              0.0088053835   0.41971457     0              40533.029      1.1965779e-13  0              2.9939596    
    900000   8895           200            200            0.0025242733  -0.00078781567  0              0.0083606355   0.37692895     0              36401.1        1.1965779e-13  0              2.9941159    
   1000000   8895           200            200            0.0025389618  -0.00078811456  0              0.0084050001   0.055685983    0              5377.7537      1.1965779e-13  0              2.994099     
   1100000   8895           200            200            0.0025511032  -0.00078833602  0              0.0084416456   0.0016487882   0              159.22817      1.1965779e-13  0              2.9940866    
   1200000   8895           200            200            0.0025427824  -0.00078817974  0              0.0084165271   0.00011264947  0              10.87888       1.1965779e-13  0              2.9940954    
   1300000   8895           200            200            0.0025454985  -0.00078823155  0              0.0084247269   0.00012164836  0              11.747928      1.1965779e-13  0              2.9940925    
   1400000   8895           200            200            0.0025452     -0.0007882255   0              0.0084238255   1.8812334e-05  0              1.8167605      1.1965779e-13  0              2.9940928    
   1500000   8895           200            200            0.0025449897  -0.00078822167  0              0.0084231907   6.0971062e-07  0              0.058881487    1.1965779e-13  0              2.994093     
   1600000   8895           200            200            0.00254514    -0.00078822449  0              0.0084236444   3.1224807e-08  0              0.0030154684   1.1965779e-13  0              2.9940929    
   1700000   8895           200            200            0.0025450897  -0.00078822353  0              0.0084234927   3.911806e-08   0              0.0037777422   1.1965779e-13  0              2.9940929    
   1800000   8895           200            200            0.0025450957  -0.00078822365  0              0.0084235109   6.3394871e-09  0              0.00061222229  1.1965779e-13  0              2.9940929    
   1900000   8895           200            200            0.0025450994  -0.00078822372  0              0.0084235218   2.2398104e-10  0              2.1630486e-05  1.1965779e-13  0              2.9940929    
   2000000   8895           200            200            0.0025450967  -0.00078822366  0              0.0084235136   8.4861294e-12  0              8.1952964e-07  1.1965779e-13  0              2.9940929    
   2100000   8895           200            200            0.0025450976  -0.00078822368  0              0.0084235164   1.255616e-11   0              1.2125841e-06  1.1965779e-13  0              2.9940929    
   2200000   8895           200            200            0.0025450975  -0.00078822368  0              0.0084235161   2.1330538e-12  0              2.0599507e-07  1.1965779e-13  0              2.9940929    
   2300000   8895           200            200            0.0025450974  -0.00078822368  0              0.0084235159   8.1791385e-14  0              7.8988265e-09  1.1965779e-13  0              2.9940929    
   2400000   8895           200            200            0.0025450975  -0.00078822368  0              0.008423516    2.1623952e-15  0              2.0882865e-10  1.1965779e-13  0              2.9940929    
   2500000   8895           200            200            0.0025450974  -0.00078822368  0              0.008423516    4.0320014e-15  0              3.8938184e-10  1.1965779e-13  0              2.9940929    
   2600000   8895           200            200            0.0025450974  -0.00078822368  0              0.008423516    7.1072738e-16  0              6.8636964e-11  1.1965779e-13  0              2.9940929    
   2700000   8895           200            200            0.0025450974  -0.00078822368  0              0.008423516    1.4531848e-17  0              1.4033819e-12  1.1965779e-13  0              2.9940929    
   2800000   8895           200            200            0.0025450974  -0.00078822368  0              0.008423516    2.2438318e-18  0              2.1669322e-13  1.1965779e-13  0              2.9940929    
   2900000   8895           200            200            0.0025450974  -0.00078822368  0              0.008423516    8.6346496e-19  0              8.3387265e-14  1.1965779e-13  0              2.9940929    
   3000000   8895           200            200            0.0025450974  -0.00078822368  0              0.008423516    4.7925243e-18  0              4.6282769e-13  1.1965779e-13  0              2.9940929    
Loop time of 293.749 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8823853.055 ns/day, 0.000 hours/ns, 10212.793 timesteps/s
99.9% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.87      | 35.655     | 60.881     | 411.5 | 12.14
Neigh   | 5.5196     | 5.6256     | 5.7349     |   4.1 |  1.92
Comm    | 21.141     | 39.679     | 76.775     | 345.3 | 13.51
Output  | 0.28983    | 0.29013    | 0.29044    |   0.1 |  0.10
Modify  | 109.03     | 156.51     | 176.03     | 221.7 | 53.28
Other   |            | 55.99      |            |       | 19.06

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         315.25 ave         631 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1261
Ave neighs/atom = 0.50419832
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 94

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.94                                                               
Lattice spacing in x,y,z = 5.94 5.94 5.94

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4455 ${n1e1} -100 100 -100 100 units box
region box block -4455 4455 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4455 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4455 4455 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4455 -100 -100) to (4455 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4455 -100 -100) to (4455 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4455 -100 -100) to (4455 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_94_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5749 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 113.2 | 113.2 | 113.2 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8910           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8910           200            200            0.0022677258   2.9464978e-35  0              0.0068031775   579558.9       0              5.5969651e+10  1.1965779e-13  0              3.3310481    
    200000   8910           200            200            0.00077386648  4.5331028e-36  0              0.0023215994   133125.51      0              1.2856309e+10  1.1965779e-13  0              3.0820801    
    300000   8910           200            200            5.3353863e-06  1.8132691e-35  0              1.6006159e-05  14.254815      0              1376628        1.1965779e-13  0              3.0446959    
    400000   8910           200            200            2.7004224e-05  5.0770438e-34  0              8.1012671e-05  354.02593      0              34189290       1.1965779e-13  0              3.0057557    
    500000   8910           200            200            0.0030839654  -0.00019988553  0              0.0094517817   1454.8595      0              1.4049992e+08  1.1965779e-13  0              2.9942324    
    600000   8910           200            200            0.0026628357  -0.00035049704  0              0.0083390042   196.45029      0              18971763       1.1965779e-13  0              2.9945549    
    700000   8910           200            200            0.0027274444  -0.00038865313  0              0.0085709864   25.882805      0              2499576        1.1965779e-13  0              2.9944645    
    800000   8910           200            200            0.0026897025  -0.00039878864  0              0.0084678961   3.4953759      0              337558.38      1.1965779e-13  0              2.994494     
    900000   8910           200            200            0.0026892572  -0.00039840779  0              0.0084661794   0.42046968     0              40605.952      1.1965779e-13  0              2.9944929    
   1000000   8910           200            200            0.0026827074  -0.00040009435  0              0.0084482166   0.036786139    0              3552.542       1.1965779e-13  0              2.9944982    
   1100000   8910           200            200            0.0026762     -0.00040048948  0              0.0084290895   0.0018891969   0              182.44512      1.1965779e-13  0              2.9945043    
   1200000   8910           200            200            0.0026725159  -0.00040059604  0              0.0084181436   1.4804245e-05  0              1.429688       1.1965779e-13  0              2.9945079    
   1300000   8910           200            200            0.0026708582  -0.00040065025  0              0.0084132248   1.0434314e-05  0              1.0076714      1.1965779e-13  0              2.9945095    
   1400000   8910           200            200            0.0026702214  -0.00040067222  0              0.0084113364   7.4442689e-06  0              0.7189142      1.1965779e-13  0              2.9945101    
   1500000   8910           200            200            0.0026700095  -0.00040067972  0              0.0084107081   2.04668e-06    0              0.19765371     1.1965779e-13  0              2.9945104    
   1600000   8910           200            200            0.0026699504  -0.00040068184  0              0.008410533    3.7279275e-07  0              0.036001655    1.1965779e-13  0              2.9945104    
   1700000   8910           200            200            0.0026699386  -0.00040068228  0              0.0084104979   5.0478469e-08  0              0.0048748492   1.1965779e-13  0              2.9945104    
   1800000   8910           200            200            0.0026699384  -0.00040068229  0              0.0084104976   5.0873918e-09  0              0.00049130388  1.1965779e-13  0              2.9945104    
   1900000   8910           200            200            0.00266994    -0.00040068224  0              0.0084105021   3.4162449e-10  0              3.2991648e-05  1.1965779e-13  0              2.9945104    
   2000000   8910           200            200            0.002669941   -0.00040068221  0              0.0084105052   9.130238e-12   0              8.8173304e-07  1.1965779e-13  0              2.9945104    
   2100000   8910           200            200            0.0026699415  -0.00040068219  0              0.0084105067   1.8164315e-13  0              1.7541796e-08  1.1965779e-13  0              2.9945104    
   2200000   8910           200            200            0.0026699417  -0.00040068218  0              0.0084105074   4.8954598e-13  0              4.7276846e-08  1.1965779e-13  0              2.9945104    
   2300000   8910           200            200            0.0026699418  -0.00040068218  0              0.0084105076   1.7731009e-13  0              1.7123339e-08  1.1965779e-13  0              2.9945104    
   2400000   8910           200            200            0.0026699418  -0.00040068218  0              0.0084105077   3.7475988e-14  0              3.6191627e-09  1.1965779e-13  0              2.9945104    
   2500000   8910           200            200            0.0026699418  -0.00040068218  0              0.0084105077   5.7220209e-15  0              5.5259182e-10  1.1965779e-13  0              2.9945104    
   2600000   8910           200            200            0.0026699418  -0.00040068218  0              0.0084105077   6.6140643e-16  0              6.3873899e-11  1.1965779e-13  0              2.9945104    
   2700000   8910           200            200            0.0026699418  -0.00040068218  0              0.0084105077   4.1271245e-17  0              3.9856815e-12  1.1965779e-13  0              2.9945104    
   2800000   8910           200            200            0.0026699418  -0.00040068218  0              0.0084105077   1.2898581e-19  0              1.2456526e-14  1.1965779e-13  0              2.9945104    
   2900000   8910           200            200            0.0026699418  -0.00040068218  0              0.0084105077   2.8031125e-18  0              2.7070454e-13  1.1965779e-13  0              2.9945104    
   3000000   8910           200            200            0.0026699418  -0.00040068218  0              0.0084105077   1.9574546e-19  0              1.8903696e-14  1.1965779e-13  0              2.9945104    
Loop time of 297.78 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8704405.732 ns/day, 0.000 hours/ns, 10074.544 timesteps/s
99.9% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.94      | 36.607     | 62.749     | 421.5 | 12.29
Neigh   | 5.5457     | 5.6495     | 5.7588     |   4.0 |  1.90
Comm    | 21.149     | 40.421     | 78.821     | 354.3 | 13.57
Output  | 0.2717     | 0.27201    | 0.27235    |   0.1 |  0.09
Modify  | 110.05     | 158.32     | 177.88     | 223.4 | 53.17
Other   |            | 56.51      |            |       | 18.98

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         318.75 ave         638 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1275
Ave neighs/atom = 0.50979608
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 95

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.95                                                               
Lattice spacing in x,y,z = 5.95 5.95 5.95

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4462.5 ${n1e1} -100 100 -100 100 units box
region box block -4462.5 4462.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4462.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4462.5 4462.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4462.5 -100 -100) to (4462.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4462.5 -100 -100) to (4462.5 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4462.5 -100 -100) to (4462.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_95_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5759 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 113.3 | 113.3 | 113.3 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8925           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8925           200            200            0.0022651992  -1.1313626e-36  0              0.0067955977   580075.09      0              5.60195e+10    1.1965779e-13  0              3.3304694    
    200000   8925           200            200            0.00077580184 -9.0508314e-36  0              0.0023274055   134012.37      0              1.2941956e+10  1.1965779e-13  0              3.081126     
    300000   8925           200            200            9.3492648e-06 -7.2407108e-35  0              2.8047794e-05  43.202785      0              4172215.8      1.1965779e-13  0              3.0446862    
    400000   8925           200            200            3.2766847e-05  5.6568217e-37  0              9.830054e-05   517.37582      0              49964453       1.1965779e-13  0              3.0055656    
    500000   8925           200            200            0.003111959   -0.00052777654  0              0.0098636536   1434.1064      0              1.3849574e+08  1.1965779e-13  0              2.9940836    
    600000   8925           200            200            0.0026428252  -0.0005039893   0              0.008432465    197.91139      0              19112866       1.1965779e-13  0              2.9945067    
    700000   8925           200            200            0.002946254   -0.00057675628  0              0.0094155184   6.8484501      0              661374.29      1.1965779e-13  0              2.9941748    
    800000   8925           200            200            0.0027238766  -0.00056238826  0              0.008734018    1.3113875      0              126644.42      1.1965779e-13  0              2.9943871    
    900000   8925           200            200            0.0025985951  -0.00055641335  0              0.0083521986   0.44361287     0              42840.956      1.1965779e-13  0              2.9945123    
   1000000   8925           200            200            0.0025943377  -0.00055615092  0              0.0083391639   0.00060112815  0              58.052654      1.1965779e-13  0              2.9945174    
   1100000   8925           200            200            0.0026100223  -0.00055693492  0              0.0083870018   0.0069496593   0              671.14835      1.1965779e-13  0              2.9945019    
   1200000   8925           200            200            0.0026147987  -0.0005571776   0              0.0084015737   0.00065071948  0              62.841829      1.1965779e-13  0              2.994497     
   1300000   8925           200            200            0.0026139514  -0.0005571375   0              0.0083989918   1.9863386e-05  0              1.9182637      1.1965779e-13  0              2.9944978    
   1400000   8925           200            200            0.0026130817  -0.00055709413  0              0.0083963394   2.1407896e-05  0              2.0674213      1.1965779e-13  0              2.9944987    
   1500000   8925           200            200            0.0026129645  -0.000557088    0              0.0083959816   3.9749117e-07  0              0.038386852    1.1965779e-13  0              2.9944988    
   1600000   8925           200            200            0.0026130507  -0.00055709222  0              0.0083962442   2.081876e-07   0              0.020105269    1.1965779e-13  0              2.9944987    
   1700000   8925           200            200            0.0026130894  -0.00055709417  0              0.0083963623   4.2641384e-08  0              0.0041179996   1.1965779e-13  0              2.9944987    
   1800000   8925           200            200            0.0026130881  -0.00055709412  0              0.0083963583   4.3271042e-11  0              4.1788075e-06  1.1965779e-13  0              2.9944987    
   1900000   8925           200            200            0.0026130825  -0.00055709384  0              0.0083963414   8.7643548e-10  0              8.4639865e-05  1.1965779e-13  0              2.9944987    
   2000000   8925           200            200            0.0026130812  -0.00055709377  0              0.0083963374   4.8907278e-11  0              4.7231148e-06  1.1965779e-13  0              2.9944987    
   2100000   8925           200            200            0.0026130816  -0.00055709379  0              0.0083963386   4.5435659e-12  0              4.3878508e-07  1.1965779e-13  0              2.9944987    
   2200000   8925           200            200            0.0026130819  -0.00055709381  0              0.0083963395   2.2823055e-12  0              2.2040873e-07  1.1965779e-13  0              2.9944987    
   2300000   8925           200            200            0.0026130819  -0.00055709381  0              0.0083963395   1.3028502e-14  0              1.2581995e-09  1.1965779e-13  0              2.9944987    
   2400000   8925           200            200            0.0026130819  -0.00055709381  0              0.0083963394   2.9842303e-14  0              2.8819561e-09  1.1965779e-13  0              2.9944987    
   2500000   8925           200            200            0.0026130819  -0.00055709381  0              0.0083963394   3.7889037e-15  0              3.6590519e-10  1.1965779e-13  0              2.9944987    
   2600000   8925           200            200            0.0026130819  -0.00055709381  0              0.0083963394   3.8989143e-17  0              3.7652923e-12  1.1965779e-13  0              2.9944987    
   2700000   8925           200            200            0.0026130819  -0.00055709381  0              0.0083963394   1.0291086e-16  0              9.9383946e-12  1.1965779e-13  0              2.9944987    
   2800000   8925           200            200            0.0026130819  -0.00055709381  0              0.0083963394   2.1115549e-19  0              2.0391886e-14  1.1965779e-13  0              2.9944987    
   2900000   8925           200            200            0.0026130819  -0.00055709381  0              0.0083963394   2.4094376e-18  0              2.3268624e-13  1.1965779e-13  0              2.9944987    
   3000000   8925           200            200            0.0026130819  -0.00055709381  0              0.0083963394   6.8674273e-19  0              6.6320697e-14  1.1965779e-13  0              2.9944987    
Loop time of 296.877 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8730901.428 ns/day, 0.000 hours/ns, 10105.210 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 10.903     | 36.164     | 61.951     | 417.1 | 12.18
Neigh   | 5.5447     | 5.6466     | 5.7541     |   4.0 |  1.90
Comm    | 21.097     | 40.282     | 78.099     | 349.9 | 13.57
Output  | 0.27437    | 0.27467    | 0.275      |   0.1 |  0.09
Modify  | 110.59     | 158.43     | 178.12     | 221.3 | 53.37
Other   |            | 56.08      |            |       | 18.89

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         318.25 ave         637 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1273
Ave neighs/atom = 0.5089964
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 96

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.96                                                               
Lattice spacing in x,y,z = 5.96 5.96 5.96

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4470 ${n1e1} -100 100 -100 100 units box
region box block -4470 4470 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4470 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4470 4470 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4470 -100 -100) to (4470 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4470 -100 -100) to (4470 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4470 -100 -100) to (4470 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_96_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5768 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 113.5 | 113.5 | 113.5 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8940           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8940           200            200            0.0022603515   2.2589359e-36  0              0.0067810546   579673.15      0              5.5980684e+10  1.1965779e-13  0              3.3307835    
    200000   8940           200            200            0.00077204858  2.8236634e-36  0              0.0023161457   133347.62      0              1.2877759e+10  1.1965779e-13  0              3.0816601    
    300000   8940           200            200            5.6048629e-06  1.6852035e-40  0              1.6814589e-05  15.8134        0              1527145        1.1965779e-13  0              3.0445341    
    400000   8940           200            200            2.3381127e-05  3.6142991e-35  0              7.014338e-05   269.05498      0              25983404       1.1965779e-13  0              3.0056989    
    500000   8940           200            200            0.001679449   -0.00025309886  0              0.0052914459   1230.5758      0              1.188402e+08   1.1965779e-13  0              2.9956132    
    600000   8940           200            200            0.0017198646  -0.00046569999  0              0.0056252939   26.136435      0              2524069.9      1.1965779e-13  0              2.9954199    
    700000   8940           200            200            0.0023269148  -0.00065086757  0              0.007631612    14.591112      0              1409105.1      1.1965779e-13  0              2.9946743    
    800000   8940           200            200            0.0025552542  -0.00069629053  0              0.008362053    3.5224057      0              340168.73      1.1965779e-13  0              2.9944239    
    900000   8940           200            200            0.0025924696  -0.00069879015  0              0.0084761989   0.30540271     0              29493.608      1.1965779e-13  0              2.9943842    
   1000000   8940           200            200            0.0025798606  -0.00069804136  0              0.0084376232   0.0032895736   0              317.68347      1.1965779e-13  0              2.9943962    
   1100000   8940           200            200            0.0025677614  -0.00069727857  0              0.0084005627   0.0017837301   0              172.25989      1.1965779e-13  0              2.9944084    
   1200000   8940           200            200            0.0025626674  -0.00069694935  0              0.0083849514   0.00099115624  0              95.718775      1.1965779e-13  0              2.9944136    
   1300000   8940           200            200            0.0025614329  -0.00069686772  0              0.0083811664   0.00014431074  0              13.936498      1.1965779e-13  0              2.9944149    
   1400000   8940           200            200            0.0025614253  -0.00069686635  0              0.0083811423   6.3047099e-06  0              0.60886376     1.1965779e-13  0              2.9944149    
   1500000   8940           200            200            0.0025615876  -0.0006968766   0              0.0083816393   4.3273559e-08  0              0.0041790506   1.1965779e-13  0              2.9944147    
   1600000   8940           200            200            0.0025616798  -0.00069688255  0              0.0083819221   2.0767909e-07  0              0.02005616     1.1965779e-13  0              2.9944146    
   1700000   8940           200            200            0.0025617099  -0.00069688452  0              0.0083820142   5.2113957e-08  0              0.0050327929   1.1965779e-13  0              2.9944146    
   1800000   8940           200            200            0.0025617143  -0.00069688482  0              0.0083820278   4.4809584e-09  0              0.00043273889  1.1965779e-13  0              2.9944146    
   1900000   8940           200            200            0.0025617128  -0.00069688472  0              0.008382023    4.7067783e-11  0              4.5454696e-06  1.1965779e-13  0              2.9944146    
   2000000   8940           200            200            0.0025617113  -0.00069688463  0              0.0083820185   2.6731208e-11  0              2.5815087e-06  1.1965779e-13  0              2.9944146    
   2100000   8940           200            200            0.0025617107  -0.00069688459  0              0.0083820166   1.4695885e-11  0              1.4192234e-06  1.1965779e-13  0              2.9944146    
   2200000   8940           200            200            0.0025617105  -0.00069688458  0              0.0083820162   2.1288112e-12  0              2.0558535e-07  1.1965779e-13  0              2.9944146    
   2300000   8940           200            200            0.0025617105  -0.00069688458  0              0.0083820162   9.2344782e-14  0              8.9179981e-09  1.1965779e-13  0              2.9944146    
   2400000   8940           200            200            0.0025617106  -0.00069688458  0              0.0083820162   7.0973925e-16  0              6.8541536e-11  1.1965779e-13  0              2.9944146    
   2500000   8940           200            200            0.0025617106  -0.00069688458  0              0.0083820163   3.2074572e-15  0              3.0975326e-10  1.1965779e-13  0              2.9944146    
   2600000   8940           200            200            0.0025617106  -0.00069688458  0              0.0083820163   7.6485803e-16  0              7.3864514e-11  1.1965779e-13  0              2.9944146    
   2700000   8940           200            200            0.0025617106  -0.00069688458  0              0.0083820163   4.9393122e-17  0              4.7700342e-12  1.1965779e-13  0              2.9944146    
   2800000   8940           200            200            0.0025617106  -0.00069688458  0              0.0083820163   3.2195088e-19  0              3.1091712e-14  1.1965779e-13  0              2.9944146    
   2900000   8940           200            200            0.0025617106  -0.00069688458  0              0.0083820163   8.4358854e-19  0              8.1467743e-14  1.1965779e-13  0              2.9944146    
   3000000   8940           200            200            0.0025617106  -0.00069688458  0              0.0083820163   5.089847e-18   0              4.9154099e-13  1.1965779e-13  0              2.9944146    
Loop time of 296.82 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8732553.222 ns/day, 0.000 hours/ns, 10107.122 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.332     | 36.493     | 62.035     | 415.8 | 12.29
Neigh   | 5.5379     | 5.6437     | 5.7544     |   4.1 |  1.90
Comm    | 20.76      | 40.105     | 77.899     | 350.8 | 13.51
Output  | 0.2745     | 0.27482    | 0.27517    |   0.1 |  0.09
Modify  | 111.02     | 158.35     | 177.18     | 218.9 | 53.35
Other   |            | 55.95      |            |       | 18.85

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         318.25 ave         637 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1273
Ave neighs/atom = 0.5089964
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 97

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.97                                                               
Lattice spacing in x,y,z = 5.97 5.97 5.97

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4477.5 ${n1e1} -100 100 -100 100 units box
region box block -4477.5 4477.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4477.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4477.5 4477.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4477.5 -100 -100) to (4477.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4477.5 -100 -100) to (4477.5 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4477.5 -100 -100) to (4477.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_97_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5778 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 113.6 | 113.6 | 113.7 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8955           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8955           200            200            0.0022547294   4.5102958e-36  0              0.0067641881   578967.43      0              5.5912531e+10  1.1965779e-13  0              3.3313343    
    200000   8955           200            200            0.00076643106 -3.6082089e-35  0              0.0022992932   132175.53      0              1.2764567e+10  1.1965779e-13  0              3.0826026    
    300000   8955           200            200           -8.5687662e-07 -9.0205604e-36  0             -2.5706299e-06  0.32078451     0              30979.072      1.1965779e-13  0              3.0442345    
    400000   8955           200            200            7.1783124e-06  1.8041307e-35  0              2.1534937e-05  26.492282      0              2558435        1.1965779e-13  0              3.0057366    
    500000   8955           200            200            0.00059214996 -0.00012405483  0              0.0019005047   129.2957       0              12486454       1.1965779e-13  0              2.9973032    
    600000   8955           200            200            0.0025768887  -0.0010929959   0              0.008823662    189.69199      0              18319094       1.1965779e-13  0              2.9940949    
    700000   8955           200            200            0.0028058665  -0.00099598924  0              0.0094135888   4.5300452      0              437479.34      1.1965779e-13  0              2.9939192    
    800000   8955           200            200            0.0026124427  -0.00094882683  0              0.008786155    0.010115879    0              976.91922      1.1965779e-13  0              2.9941263    
    900000   8955           200            200            0.0025241841  -0.00093363141  0              0.0085061837   0.086234525    0              8327.9132      1.1965779e-13  0              2.9942199    
   1000000   8955           200            200            0.0024918685  -0.00093067586  0              0.0084062815   0.033712087    0              3255.672       1.1965779e-13  0              2.9942535    
   1100000   8955           200            200            0.0024818692  -0.00092979126  0              0.008375399    0.0073790009   0              712.61109      1.1965779e-13  0              2.9942638    
   1200000   8955           200            200            0.0024793773  -0.00092957151  0              0.0083677033   0.0011560347   0              111.64155      1.1965779e-13  0              2.9942664    
   1300000   8955           200            200            0.0024790198  -0.00092954182  0              0.0083666012   0.00013624308  0              13.157382      1.1965779e-13  0              2.9942667    
   1400000   8955           200            200            0.0024791114  -0.00092955125  0              0.0083668855   1.1547657e-05  0              1.11519        1.1965779e-13  0              2.9942666    
   1500000   8955           200            200            0.0024792223  -0.0009295617   0              0.0083672287   5.625129e-07   0              0.05432347     1.1965779e-13  0              2.9942665    
   1600000   8955           200            200            0.0024792859  -0.00092956757  0              0.0083674252   2.985818e-09   0              0.00028834893  1.1965779e-13  0              2.9942664    
   1700000   8955           200            200            0.0024793144  -0.00092957019  0              0.0083675133   4.0700743e-09  0              0.00039305864  1.1965779e-13  0              2.9942664    
   1800000   8955           200            200            0.0024793253  -0.00092957118  0              0.008367547    2.6023303e-09  0              0.00025131443  1.1965779e-13  0              2.9942664    
   1900000   8955           200            200            0.0024793289  -0.00092957151  0              0.0083675582   6.911789e-10   0              6.6749111e-05  1.1965779e-13  0              2.9942664    
   2000000   8955           200            200            0.0024793299  -0.0009295716   0              0.0083675613   1.2326312e-10  0              1.1903869e-05  1.1965779e-13  0              2.9942664    
   2100000   8955           200            200            0.0024793301  -0.00092957161  0              0.008367562    1.6386412e-11  0              1.5824824e-06  1.1965779e-13  0              2.9942664    
   2200000   8955           200            200            0.0024793301  -0.00092957161  0              0.008367562    1.6161628e-12  0              1.5607743e-07  1.1965779e-13  0              2.9942664    
   2300000   8955           200            200            0.0024793301  -0.00092957161  0              0.0083675619   1.0500348e-13  0              1.0140485e-08  1.1965779e-13  0              2.9942664    
   2400000   8955           200            200            0.0024793301  -0.00092957161  0              0.0083675618   2.5991179e-15  0              2.510042e-10   1.1965779e-13  0              2.9942664    
   2500000   8955           200            200            0.0024793301  -0.00092957161  0              0.0083675618   1.1307839e-16  0              1.0920301e-11  1.1965779e-13  0              2.9942664    
   2600000   8955           200            200            0.0024793301  -0.00092957161  0              0.0083675618   1.787166e-16   0              1.725917e-11   1.1965779e-13  0              2.9942664    
   2700000   8955           200            200            0.0024793301  -0.00092957161  0              0.0083675618   4.4272283e-17  0              4.2755002e-12  1.1965779e-13  0              2.9942664    
   2800000   8955           200            200            0.0024793301  -0.00092957161  0              0.0083675618   6.4606206e-18  0              6.2392049e-13  1.1965779e-13  0              2.9942664    
   2900000   8955           200            200            0.0024793301  -0.00092957161  0              0.0083675618   4.7856835e-18  0              4.6216706e-13  1.1965779e-13  0              2.9942664    
   3000000   8955           200            200            0.0024793301  -0.00092957161  0              0.0083675618   3.7828032e-18  0              3.6531606e-13  1.1965779e-13  0              2.9942664    
Loop time of 297.711 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8706426.784 ns/day, 0.000 hours/ns, 10076.883 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.162     | 36.013     | 61.569     | 414.2 | 12.10
Neigh   | 5.552      | 5.6572     | 5.767      |   4.1 |  1.90
Comm    | 20.592     | 41.366     | 79.981     | 354.7 | 13.89
Output  | 0.27702    | 0.27732    | 0.27764    |   0.1 |  0.09
Modify  | 108.57     | 157.57     | 177.62     | 227.1 | 52.93
Other   |            | 56.83      |            |       | 19.09

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         316.25 ave         633 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1265
Ave neighs/atom = 0.50579768
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 98

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.98                                                               
Lattice spacing in x,y,z = 5.98 5.98 5.98

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4485 ${n1e1} -100 100 -100 100 units box
region box block -4485 4485 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4485 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4485 4485 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4485 -100 -100) to (4485 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4485 -100 -100) to (4485 100 100)
  create_atoms CPU = 0.000 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4485 -100 -100) to (4485 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_98_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5788 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 113.8 | 113.8 | 113.8 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8970           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8970           200            200            0.0022468906   1.8011081e-35  0              0.0067406717   577402.26      0              5.5761377e+10  1.1965779e-13  0              3.3325534    
    200000   8970           200            200            0.00075561634  3.6335591e-43  0              0.002266849    129599.13      0              1.2515756e+10  1.1965779e-13  0              3.0846593    
    300000   8970           200            200           -1.4901094e-05 -3.6020473e-35  0             -4.4703281e-05  113.84574      0              10994406       1.1965779e-13  0              3.0434225    
    400000   8970           200            200           -2.729366e-05  -1.080651e-34   0             -8.188098e-05   403.54288      0              38971283       1.1965779e-13  0              3.0049062    
    500000   8970           200            200            0.0021642486  -0.0019898918   0              0.0084826377   1405.4621      0              1.3572947e+08  1.1965779e-13  0              2.9938603    
    600000   8970           200            200            0.0015227911  -0.0010883275   0              0.0056567009   11.148152      0              1076608.8      1.1965779e-13  0              2.9950253    
    700000   8970           200            200            0.0025076942  -0.0015357412   0              0.009058824    15.030905      0              1451577.2      1.1965779e-13  0              2.9937161    
    800000   8970           200            200            0.0022395954  -0.0014918634   0              0.0082106498   2.9848019      0              288250.81      1.1965779e-13  0              2.9940094    
    900000   8970           200            200            0.0022880189  -0.0014939944   0              0.008358051    0.45802976     0              44233.236      1.1965779e-13  0              2.9939596    
   1000000   8970           200            200            0.0022909059  -0.0014945978   0              0.0083673154   0.056914728    0              5496.4171      1.1965779e-13  0              2.9939549    
   1100000   8970           200            200            0.0022827903  -0.001493359    0              0.0083417298   0.0056566229   0              546.27615      1.1965779e-13  0              2.9939646    
   1200000   8970           200            200            0.0022880876  -0.0014941471   0              0.0083584098   0.00041409222  0              39.990063      1.1965779e-13  0              2.9939585    
   1300000   8970           200            200            0.0022854857  -0.0014937654   0              0.0083502226   1.646597e-05   0              1.5901656      1.1965779e-13  0              2.9939615    
   1400000   8970           200            200            0.0022865877  -0.001493926    0              0.008353689    7.7804578e-09  0              0.00075138092  1.1965779e-13  0              2.9939602    
   1500000   8970           200            200            0.0022861692  -0.0014938655   0              0.0083523731   2.3612424e-07  0              0.022803189    1.1965779e-13  0              2.9939607    
   1600000   8970           200            200            0.0022863127  -0.0014938861   0              0.0083528242   1.2334595e-07  0              0.011911869    1.1965779e-13  0              2.9939605    
   1700000   8970           200            200            0.002286269   -0.0014938798   0              0.0083526868   3.2280956e-08  0              0.0031174636   1.1965779e-13  0              2.9939606    
   1800000   8970           200            200            0.0022862802  -0.0014938814   0              0.0083527219   6.094831e-09   0              0.00058859516  1.1965779e-13  0              2.9939606    
   1900000   8970           200            200            0.0022862782  -0.0014938812   0              0.0083527159   9.1632386e-10  0              8.8491999e-05  1.1965779e-13  0              2.9939606    
   2000000   8970           200            200            0.0022862781  -0.0014938811   0              0.0083527153   1.1243599e-10  0              1.0858263e-05  1.1965779e-13  0              2.9939606    
   2100000   8970           200            200            0.0022862785  -0.0014938812   0              0.0083527165   1.1022185e-11  0              1.0644438e-06  1.1965779e-13  0              2.9939606    
   2200000   8970           200            200            0.0022862782  -0.0014938811   0              0.0083527158   7.8721714e-13  0              7.6023796e-08  1.1965779e-13  0              2.9939606    
   2300000   8970           200            200            0.0022862783  -0.0014938812   0              0.0083527161   2.9320001e-14  0              2.8315158e-09  1.1965779e-13  0              2.9939606    
   2400000   8970           200            200            0.0022862783  -0.0014938812   0              0.008352716    5.1915686e-19  0              5.0136454e-14  1.1965779e-13  0              2.9939606    
   2500000   8970           200            200            0.0022862783  -0.0014938812   0              0.0083527161   5.4039089e-16  0              5.2187084e-11  1.1965779e-13  0              2.9939606    
   2600000   8970           200            200            0.0022862783  -0.0014938812   0              0.008352716    2.5521973e-16  0              2.4647295e-11  1.1965779e-13  0              2.9939606    
   2700000   8970           200            200            0.0022862783  -0.0014938812   0              0.008352716    4.8949342e-17  0              4.727177e-12   1.1965779e-13  0              2.9939606    
   2800000   8970           200            200            0.0022862783  -0.0014938812   0              0.008352716    7.216011e-18   0              6.9687069e-13  1.1965779e-13  0              2.9939606    
   2900000   8970           200            200            0.0022862783  -0.0014938812   0              0.008352716    4.094126e-18   0              3.9538139e-13  1.1965779e-13  0              2.9939606    
   3000000   8970           200            200            0.0022862783  -0.0014938812   0              0.008352716    6.7606924e-18  0              6.5289928e-13  1.1965779e-13  0              2.9939606    
Loop time of 296.07 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8754691.845 ns/day, 0.000 hours/ns, 10132.745 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.137     | 35.663     | 60.885     | 406.9 | 12.05
Neigh   | 5.571      | 5.6822     | 5.7969     |   4.3 |  1.92
Comm    | 20.74      | 41.443     | 79.333     | 348.4 | 14.00
Output  | 0.27385    | 0.27415    | 0.27449    |   0.1 |  0.09
Modify  | 108.84     | 156.99     | 176.54     | 223.5 | 53.03
Other   |            | 56.02      |            |       | 18.92

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         309.25 ave         619 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1237
Ave neighs/atom = 0.49460216
Neighbor list builds = 166
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop

include granular.in
### Simulation of contact between two chain

##################### Simulation setup ####################

units micro                              # units
dimension	3                            # dimension
boundary	p p p                        # boundary condition p: periodic
atom_style	sphere                       # atom style
#processors * * 1

####################### Parameter ##################################

variable ind equal ${num}
variable ind equal 99

#variable lat0 equal 1                    #
variable lat1 equal 3+(200*0.01)+(v_ind*0.01)  # .491+(v_ind*0.001)       # Lattice distance of bottom chain
variable lat2 equal 3                    # Lattice distance of top chain
variable d1 equal 3                      # Diamter of particle at bottom chain
variable d2 equal 3                      # Diamter of particle at top chain
#variable d3 equal 1                      # Diamter of supporting particle

variable n2e1 equal 500*v_lat2             # Half length of top chain. 1500 is number of particles
variable n1e1 equal 1.5*v_n2e1*(v_lat1/v_lat2)             # Half length of bottom chain, which is 1.5 time larger than top chain
variable n1e2 equal -v_n1e1
variable n2e2 equal -v_n2e1
#variable lenspr equal -(v_n2e1+100)           # length of the spring connecting top chain and supporting particle
#variable lenspr1 equal -v_lenspr-0.1         # Position of supporting particle upper bound
#variable lenspr2 equal -v_lenspr+0.1         # Position of supporting particle lower bound

variable den equal 2.2 #grams/cm^3      # micrometer^3=10^-12 cm^3 Density of materials

variable V1 equal (1/6)*PI*(v_d1^3)     # Volume of particle 1
variable V2 equal (1/6)*PI*(v_d2^3)     # Volume of particle 2
#variable V3 equal (1/6)*PI*(v_d3^3)     # Volume of particle 3

variable mass1 equal v_den*v_V1  # Mass of particle 1 (picograms)
variable mass2 equal v_den*v_V2  # Mass of particle 2
#variable mass3 equal v_den*v_V3  # Mass of particle 3

# E GPa to picogram/(micrometer-microsecond^2)= 10^3 Pa= 10^-6 GPa
# Force unit(picogram-micrometer/microsecond^2)=10^-9 N= 1nN
# Spring stiffness (force/distance) 10^-3 N/m

variable K0 equal (1500/50)*(10^5)             # Spring stiffness conneting top chain and sup particle
variable E equal 100*(10^6)                    # Young's Modulus using for Hertz/material model
variable PR equal 0.3                          # Poisson's ratio using for Hertz/material model
variable Fn equal -1000                        # Force apply to each particles in top chain
variable dt equal 0.00001                      # Time step units microsecond
variable lgv equal 0.5                         #damping for langevin thermostat for slider


################### Creating the model #################################
lattice sc ${lat1}                                                               # Bottom chain type1
lattice sc 5.99                                                               
Lattice spacing in x,y,z = 5.99 5.99 5.99

region box block ${n1e2} ${n1e1} -100 100 -100 100 units box
region box block -4492.5 ${n1e1} -100 100 -100 100 units box
region box block -4492.5 4492.5 -100 100 -100 100 units box
region substrate block ${n1e2} ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4492.5 ${n1e1} -0.5 0.5 0 0.5 units box
region substrate block -4492.5 4492.5 -0.5 0.5 0 0.5 units box

create_box 2 box
Created orthogonal box = (-4492.5 -100 -100) to (4492.5 100 100)
  4 by 1 by 1 MPI processor grid
create_atoms 1 region substrate
Created 1500 atoms
  using lattice units in orthogonal box = (-4492.5 -100 -100) to (4492.5 100 100)
  create_atoms CPU = 0.001 seconds

lattice sc ${lat2}                                                             # Top chain type2
lattice sc 3                                                             
Lattice spacing in x,y,z = 3 3 3

region slider1 block ${n2e2} ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 ${n2e1} -0.1 0.1 5.9 6.1 units box
region slider1 block -1500 1500 -0.1 0.1 5.9 6.1 units box

create_atoms 2 region slider1
Created 1001 atoms
  using lattice units in orthogonal box = (-4492.5 -100 -100) to (4492.5 100 100)
  create_atoms CPU = 0.001 seconds

#lattice sc ${lat0}                                                             # Supporting particle type3

#region support block ${lenspr1} ${lenspr2} -0.1 0.1 7.9 8.1 units box

#create_atoms 3 region support

set type 1 diameter ${d1}                    # Set mass and diameter for each particles type
set type 1 diameter 3                    
Setting atom values ...
  1500 settings made for diameter
set type 1 mass ${mass1}
set type 1 mass 31.101767270539
Setting atom values ...
  1500 settings made for mass
set type 2 diameter ${d2}
set type 2 diameter 3
Setting atom values ...
  1001 settings made for diameter
set type 2 mass ${mass2}
set type 2 mass 31.101767270539
Setting atom values ...
  1001 settings made for mass
#set type 3 diameter ${d3}
#set type 3 mass ${mass3}

group substrate region substrate           # Define gorup
1500 atoms in group substrate
group slider1 region slider1
1001 atoms in group slider1
#group support region support
#group substrate_slider union substrate slider1

########################## Potential ###################################
pair_style granular
pair_coeff 1 1 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic              ########### set E between each particle in same type is small to neglect their interaction
pair_coeff 1 1 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic              
pair_coeff 2 2 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 2 2 hertz/material 0.00000001 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 3 3 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material ${E} 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
pair_coeff 1 2 hertz/material 100000000 0.001 0.3 tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 1 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
#pair_coeff 2 3 hertz/material 0.00000001 0.001 ${PR} tangential mindlin NULL 0.1 0.01 damping viscoelastic
comm_modify     vel yes
neigh_modify    delay 0 every 1 check yes

### Compute properties ###

compute 1 slider1 com                      # Compute the center of mass of top chain
#compute 2 support com                      # Compute the center of mass of supporting particle

variable p0 equal "step"

variable slider_z equal "c_1[3]"          # output the position of top chain in z-direction

#variable distance equal "c_2[1]-c_1[1]"   # Distance between COM of top chain and supporting particle

thermo 100000
thermo_style custom step lx ly lz press pxx pyy pzz ke pe temp c_1[1] c_1[2] c_1[3] #c_2[1] c_2[2] c_2[3] v_distance

############### Fix ##################


############## Equilibrium the system with apply force ########################

fix force_slider1 slider1 setforce NULL 0 NULL                                # Fix top chain not to move in y-direction

fix f_sub substrate freeze                                                    # Freeze the bottom chain

fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 ${lgv} 6987532   # NVE+langevin
fix rigid_top slider1 rigid/nve group 1 slider1 langevin 0 0 0.5 6987532   
  1 rigid bodies with 1001 atoms

fix add slider1 addforce 0 0 ${Fn} every 1                                    # Add force to top layer
fix add slider1 addforce 0 0 -1000 every 1                                    

timestep ${dt}
timestep 1e-05

# fix  nve_1 slider1 nve

dump 		D1 all custom 100000 Equi_${num}_*.dump id type diameter mass xu yu zu fx fy fz
dump 		D1 all custom 100000 Equi_99_*.dump id type diameter mass xu yu zu fx fy fz

run 3000000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update every 1 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 3.1
  ghost atom cutoff = 3.1
  binsize = 1.55, bins = 5797 130 130
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair granular, perpetual
      attributes: half, newton on, size, history
      pair build: half/size/bin/newton
      stencil: half/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 114 | 114 | 114 Mbytes
   Step           Lx             Ly             Lz           Press           Pxx            Pyy            Pzz           KinEng         PotEng          Temp          c_1[1]         c_1[2]         c_1[3]    
         0   8985           200            200            0              0              0              0              0              0              0              1.1965779e-13  0              6            
    100000   8985           200            200            0.0022271155  -8.99041e-36    0              0.0066813466   571286.59      0              5.517077e+10   1.1965779e-13  0              3.336968     
    200000   8985           200            200            0.00071549985  8.9904707e-36  0              0.0021464996   119253.44      0              1.1516644e+10  1.1965779e-13  0              3.0926604    
    300000   8985           200            200           -7.0115063e-05  5.4770673e-41  0             -0.00021034519  2874.7407      0              2.7762189e+08  1.1965779e-13  0              3.0377871    
    400000   8985           200            200            0.001035938   -0.017469329    0              0.020577143    5886.9306      0              5.6851762e+08  1.1965779e-13  0              2.9882803    
    500000   8985           200            200            0.0023414077  -0.0057044938   0              0.012728717    845.64466      0              81666308       1.1965779e-13  0              2.9908988    
    600000   8985           200            200            0.0011218615  -0.0028595012   0              0.0062250858   38.597493      0              3727469.6      1.1965779e-13  0              2.9936206    
    700000   8985           200            200            0.0013284494  -0.003588291    0              0.0075736391   7.0931661      0              685007.21      1.1965779e-13  0              2.9929426    
    800000   8985           200            200            0.0015380596  -0.0037412915   0              0.0083554702   3.05539        0              295067.69      1.1965779e-13  0              2.9925886    
    900000   8985           200            200            0.0015668758  -0.0037465305   0              0.0084471578   0.076473046    0              7385.2194      1.1965779e-13  0              2.9925507    
   1000000   8985           200            200            0.001545488   -0.0037369395   0              0.0083734035   0.017116965    0              1653.034       1.1965779e-13  0              2.9925841    
   1100000   8985           200            200            0.001534134   -0.0037321463   0              0.0083345483   0.0075358163   0              727.7552       1.1965779e-13  0              2.9926012    
   1200000   8985           200            200            0.0015326499  -0.0037316918   0              0.0083296417   0.00024626454  0              23.782466      1.1965779e-13  0              2.9926033    
   1300000   8985           200            200            0.0015336329  -0.0037320899   0              0.0083329886   3.2305991e-05  0              3.1198814      1.1965779e-13  0              2.9926018    
   1400000   8985           200            200            0.001534208   -0.0037323146   0              0.0083349386   1.8526102e-05  0              1.7891183      1.1965779e-13  0              2.9926009    
   1500000   8985           200            200            0.0015342964  -0.0037323474   0              0.0083352364   7.8771322e-07  0              0.076071704    1.1965779e-13  0              2.9926008    
   1600000   8985           200            200            0.0015342527  -0.0037323296   0              0.0083350877   5.7518602e-08  0              0.0055547349   1.1965779e-13  0              2.9926008    
   1700000   8985           200            200            0.001534224   -0.0037323184   0              0.0083349903   4.4955304e-08  0              0.0043414615   1.1965779e-13  0              2.9926009    
   1800000   8985           200            200            0.0015342188  -0.0037323165   0              0.0083349729   2.4150242e-09  0              0.00023322575  1.1965779e-13  0              2.9926009    
   1900000   8985           200            200            0.0015342207  -0.0037323172   0              0.0083349794   9.4663033e-11  0              9.1418782e-06  1.1965779e-13  0              2.9926009    
   2000000   8985           200            200            0.0015342221  -0.0037323178   0              0.0083349842   1.0763894e-10  0              1.0394999e-05  1.1965779e-13  0              2.9926009    
   2100000   8985           200            200            0.0015342224  -0.0037323179   0              0.0083349852   7.1598646e-12  0              6.9144848e-07  1.1965779e-13  0              2.9926009    
   2200000   8985           200            200            0.0015342223  -0.0037323179   0              0.0083349849   1.3794508e-13  0              1.3321748e-08  1.1965779e-13  0              2.9926009    
   2300000   8985           200            200            0.0015342223  -0.0037323179   0              0.0083349847   2.5407289e-13  0              2.4536541e-08  1.1965779e-13  0              2.9926009    
   2400000   8985           200            200            0.0015342223  -0.0037323178   0              0.0083349846   2.0608913e-14  0              1.9902613e-09  1.1965779e-13  0              2.9926009    
   2500000   8985           200            200            0.0015342223  -0.0037323179   0              0.0083349846   2.1050789e-16  0              2.0329346e-11  1.1965779e-13  0              2.9926009    
   2600000   8985           200            200            0.0015342223  -0.0037323179   0              0.0083349847   5.7479079e-16  0              5.5509181e-11  1.1965779e-13  0              2.9926009    
   2700000   8985           200            200            0.0015342223  -0.0037323179   0              0.0083349847   7.9562752e-17  0              7.6836011e-12  1.1965779e-13  0              2.9926009    
   2800000   8985           200            200            0.0015342223  -0.0037323179   0              0.0083349847   4.4218026e-19  0              4.2702604e-14  1.1965779e-13  0              2.9926009    
   2900000   8985           200            200            0.0015342223  -0.0037323179   0              0.0083349847   7.3959749e-18  0              7.1425032e-13  1.1965779e-13  0              2.9926009    
   3000000   8985           200            200            0.0015342223  -0.0037323178   0              0.0083349847   2.236073e-19   0              2.1594392e-14  1.1965779e-13  0              2.9926009    
Loop time of 296.794 on 4 procs for 3000000 steps with 2501 atoms

Performance: 8733317.362 ns/day, 0.000 hours/ns, 10108.006 timesteps/s
100.0% CPU use with 4 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 11.098     | 34.562     | 58.65      | 398.5 | 11.64
Neigh   | 5.5421     | 5.643      | 5.7474     |   3.9 |  1.90
Comm    | 20.876     | 40.899     | 77.166     | 336.1 | 13.78
Output  | 0.27419    | 0.27452    | 0.27491    |   0.1 |  0.09
Modify  | 110.16     | 158.51     | 178.93     | 225.1 | 53.41
Other   |            | 56.91      |            |       | 19.17

Nlocal:         625.25 ave         876 max         375 min
Histogram: 2 0 0 0 0 0 0 0 0 2
Nghost:           1.75 ave           3 max           1 min
Histogram: 2 0 0 0 0 1 0 0 0 1
Neighs:         303.75 ave         608 max           0 min
Histogram: 2 0 0 0 0 0 0 0 0 2

Total # of neighbors = 1215
Ave neighs/atom = 0.48580568
Neighbor list builds = 164
Dangerous builds = 0

undump D1

############ Add spring between top chain to supp particle and then equilibrium  ###########

#fix sp1 support spring couple slider1 ${K0} ${lenspr} NULL NULL 0                                 # Add spring

#dump 		D2 all custom 100000 add_${num}*.dump id type diameter mass xu yu zu

#fix add1 all print 10 "${p0} ${distance} ${slider_z}" file add_distance_${num}.txt screen no      # out put step, distance(spring length), z-position of top chain

#run 1000000

#undump D2

#unfix add1

########## Pulling the supporting particle with constant velocity #############

#fix m1 support move linear 0.1 0 0 units box                                                      # apply constant velocity to supporting particles along x-direction V=0.1m/s

#fix move1 all print 100 "${p0} ${distance} ${slider_z}" file move_distance_${num}.txt screen no

#dump 		1 all custom 50000 move_${num}_*.dump id type diameter mass xu yu zu

#run 1000000

clear
  using 1 OpenMP thread(s) per MPI task

next num

jump SELF startloop
Total wall time: 8:18:35
